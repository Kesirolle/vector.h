<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Ion: ion::port::Mutex Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Ion
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classion_1_1port_1_1_mutex.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classion_1_1port_1_1_mutex-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ion::port::Mutex Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A <a class="el" href="classion_1_1port_1_1_mutex.html" title="A Mutex is used to ensure that only one thread or process can access a block of code at one time...">Mutex</a> is used to ensure that only one thread or process can access a block of code at one time.  
 <a href="classion_1_1port_1_1_mutex.html#details">More...</a></p>

<p><code>#include &quot;<a class="el" href="mutex_8h_source.html">mutex.h</a>&quot;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a53897cffdfe164c067d1fc2b29770989"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classion_1_1port_1_1_mutex.html#a53897cffdfe164c067d1fc2b29770989">Mutex</a> ()</td></tr>
<tr class="memdesc:a53897cffdfe164c067d1fc2b29770989"><td class="mdescLeft">&#160;</td><td class="mdescRight">POSIX mutexes are non-recursive, meaning that if the same thread tries to <a class="el" href="classion_1_1port_1_1_mutex.html#aef041f98f14dec6d76a21a5d82c43fef" title="Locks the Mutex. ">Lock()</a> the mutex, it will block indefinitely.  <a href="#a53897cffdfe164c067d1fc2b29770989">More...</a><br/></td></tr>
<tr class="separator:a53897cffdfe164c067d1fc2b29770989"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a21c821452704c6f734fe436dfd4aac"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classion_1_1port_1_1_mutex.html#a5a21c821452704c6f734fe436dfd4aac">~Mutex</a> ()</td></tr>
<tr class="separator:a5a21c821452704c6f734fe436dfd4aac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8262c4e9b43a8fdad7c6f0b6e59898b2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classion_1_1port_1_1_mutex.html#a8262c4e9b43a8fdad7c6f0b6e59898b2">IsLocked</a> ()</td></tr>
<tr class="memdesc:a8262c4e9b43a8fdad7c6f0b6e59898b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns whether the <a class="el" href="classion_1_1port_1_1_mutex.html" title="A Mutex is used to ensure that only one thread or process can access a block of code at one time...">Mutex</a> is currently locked. Does not block.  <a href="#a8262c4e9b43a8fdad7c6f0b6e59898b2">More...</a><br/></td></tr>
<tr class="separator:a8262c4e9b43a8fdad7c6f0b6e59898b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef041f98f14dec6d76a21a5d82c43fef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classion_1_1port_1_1_mutex.html#aef041f98f14dec6d76a21a5d82c43fef">Lock</a> ()</td></tr>
<tr class="memdesc:aef041f98f14dec6d76a21a5d82c43fef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Locks the <a class="el" href="classion_1_1port_1_1_mutex.html" title="A Mutex is used to ensure that only one thread or process can access a block of code at one time...">Mutex</a>.  <a href="#aef041f98f14dec6d76a21a5d82c43fef">More...</a><br/></td></tr>
<tr class="separator:aef041f98f14dec6d76a21a5d82c43fef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08debaefd4f986a4c9571db9e8c62f09"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classion_1_1port_1_1_mutex.html#a08debaefd4f986a4c9571db9e8c62f09">TryLock</a> ()</td></tr>
<tr class="memdesc:a08debaefd4f986a4c9571db9e8c62f09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if the mutex was successfully locked, and false otherwise.  <a href="#a08debaefd4f986a4c9571db9e8c62f09">More...</a><br/></td></tr>
<tr class="separator:a08debaefd4f986a4c9571db9e8c62f09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af94d533979bcabd7f70264ed8b3da2c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classion_1_1port_1_1_mutex.html#af94d533979bcabd7f70264ed8b3da2c2">Unlock</a> ()</td></tr>
<tr class="memdesc:af94d533979bcabd7f70264ed8b3da2c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlocks the <a class="el" href="classion_1_1port_1_1_mutex.html" title="A Mutex is used to ensure that only one thread or process can access a block of code at one time...">Mutex</a>.  <a href="#af94d533979bcabd7f70264ed8b3da2c2">More...</a><br/></td></tr>
<tr class="separator:af94d533979bcabd7f70264ed8b3da2c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A <a class="el" href="classion_1_1port_1_1_mutex.html" title="A Mutex is used to ensure that only one thread or process can access a block of code at one time...">Mutex</a> is used to ensure that only one thread or process can access a block of code at one time. </p>

<p>Definition at line <a class="el" href="mutex_8h_source.html#l00034">34</a> of file <a class="el" href="mutex_8h_source.html">mutex.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a53897cffdfe164c067d1fc2b29770989"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ion::port::Mutex::Mutex </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>POSIX mutexes are non-recursive, meaning that if the same thread tries to <a class="el" href="classion_1_1port_1_1_mutex.html#aef041f98f14dec6d76a21a5d82c43fef" title="Locks the Mutex. ">Lock()</a> the mutex, it will block indefinitely. </p>
<p>On Windows, a CRITICAL_SECTION can be entered recursively, so long as the number of EnterCriticalSection()s matches the number of LeaveCriticalSection()s, and TryEnterCriticalSection() always succeeds if the same thread is already in the critical section. POSIX threads can match this behavior if you set them PTHREAD_MUTEX_RECURSIVE.</p>
<p>Recursive locks are in general a bad idea, and lead to poorly written code: if a lock is held, there is no reason to try to acquire that lock again.</p>
<p>Windows supports non-recursive Mutexes, but they are very slow. Instead, we wrap an Event test around Interlocked(Increment|Decrement), which are very fast (faster than (Try)EnterCriticalSection()) atomic operations. A slower path is only taken when there are multiple contenders; if a single thread repeatedly <a class="el" href="classion_1_1port_1_1_mutex.html#aef041f98f14dec6d76a21a5d82c43fef" title="Locks the Mutex. ">Lock()</a>s and <a class="el" href="classion_1_1port_1_1_mutex.html#af94d533979bcabd7f70264ed8b3da2c2" title="Unlocks the Mutex. ">Unlock()</a>s a mutex, the Event is never tested, and the only cost is the (very small) increment and decrement cost plus that of an if. Intel has shown that the costs of WaitForSingleObject() and EnterCriticalSection() are very similar for multiple threads under high contention: See <a href="http://software.intel.com/en-us/articles/implementing-scalable-atomic-">http://software.intel.com/en-us/articles/implementing-scalable-atomic-</a> locks-for-multi-core-intel-em64t-and-ia32-architectures</p>
<p>To use a CRITICAL_SECTION anyway, uncomment the following line, otherwise the above interlocking increment/decrement scheme is used. This will cause tests in mutex_tests.cc and lockguards_test.cc to fail; their logic must be updated. #define ION_MUTEX_USE_CRITICAL_SECTION </p>

<p>Definition at line <a class="el" href="mutex_8cc_source.html#l00053">53</a> of file <a class="el" href="mutex_8cc_source.html">mutex.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a5a21c821452704c6f734fe436dfd4aac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ion::port::Mutex::~Mutex </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="mutex_8cc_source.html#l00069">69</a> of file <a class="el" href="mutex_8cc_source.html">mutex.cc</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a8262c4e9b43a8fdad7c6f0b6e59898b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ion::port::Mutex::IsLocked </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns whether the <a class="el" href="classion_1_1port_1_1_mutex.html" title="A Mutex is used to ensure that only one thread or process can access a block of code at one time...">Mutex</a> is currently locked. Does not block. </p>

<p>Definition at line <a class="el" href="mutex_8cc_source.html#l00083">83</a> of file <a class="el" href="mutex_8cc_source.html">mutex.cc</a>.</p>

<p>References <a class="el" href="mutex_8cc_source.html#l00116">TryLock()</a>, and <a class="el" href="mutex_8cc_source.html#l00145">Unlock()</a>.</p>

<p>Referenced by <a class="el" href="font_8cc_source.html#l00060">ion::text::Font::GetMutableGlyphGridLocked()</a>.</p>

</div>
</div>
<a class="anchor" id="aef041f98f14dec6d76a21a5d82c43fef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ion::port::Mutex::Lock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Locks the <a class="el" href="classion_1_1port_1_1_mutex.html" title="A Mutex is used to ensure that only one thread or process can access a block of code at one time...">Mutex</a>. </p>
<p>Blocks the calling thread or process until the lock is available; no thread or process can return from <a class="el" href="classion_1_1port_1_1_mutex.html#aef041f98f14dec6d76a21a5d82c43fef" title="Locks the Mutex. ">Lock()</a> until the lock owner <a class="el" href="classion_1_1port_1_1_mutex.html#af94d533979bcabd7f70264ed8b3da2c2" title="Unlocks the Mutex. ">Unlock()</a>s. </p>

<p>Definition at line <a class="el" href="mutex_8cc_source.html#l00092">92</a> of file <a class="el" href="mutex_8cc_source.html">mutex.cc</a>.</p>

<p>References <a class="el" href="threadutils_8cc_source.html#l00363">ion::port::GetCurrentThreadId()</a>.</p>

<p>Referenced by <a class="el" href="readwritelock_8cc_source.html#l00029">ion::base::ReadWriteLock::LockForRead()</a>, and <a class="el" href="readwritelock_8cc_source.html#l00048">ion::base::ReadWriteLock::LockForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a08debaefd4f986a4c9571db9e8c62f09"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ion::port::Mutex::TryLock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if the mutex was successfully locked, and false otherwise. </p>
<p>Does not block. </p>

<p>Definition at line <a class="el" href="mutex_8cc_source.html#l00116">116</a> of file <a class="el" href="mutex_8cc_source.html">mutex.cc</a>.</p>

<p>References <a class="el" href="threadutils_8cc_source.html#l00363">ion::port::GetCurrentThreadId()</a>.</p>

<p>Referenced by <a class="el" href="mutex_8cc_source.html#l00083">IsLocked()</a>.</p>

</div>
</div>
<a class="anchor" id="af94d533979bcabd7f70264ed8b3da2c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ion::port::Mutex::Unlock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlocks the <a class="el" href="classion_1_1port_1_1_mutex.html" title="A Mutex is used to ensure that only one thread or process can access a block of code at one time...">Mutex</a>. </p>
<p>Any thread or process can now return from <a class="el" href="classion_1_1port_1_1_mutex.html#aef041f98f14dec6d76a21a5d82c43fef" title="Locks the Mutex. ">Lock()</a>. Does nothing if the <a class="el" href="classion_1_1port_1_1_mutex.html" title="A Mutex is used to ensure that only one thread or process can access a block of code at one time...">Mutex</a> was not locked by the calling thread or at all. Does not block. </p>

<p>Definition at line <a class="el" href="mutex_8cc_source.html#l00145">145</a> of file <a class="el" href="mutex_8cc_source.html">mutex.cc</a>.</p>

<p>References <a class="el" href="threadutils_8cc_source.html#l00363">ion::port::GetCurrentThreadId()</a>.</p>

<p>Referenced by <a class="el" href="mutex_8cc_source.html#l00083">IsLocked()</a>, <a class="el" href="readwritelock_8cc_source.html#l00029">ion::base::ReadWriteLock::LockForRead()</a>, and <a class="el" href="readwritelock_8cc_source.html#l00054">ion::base::ReadWriteLock::UnlockForWrite()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>port/<a class="el" href="mutex_8h_source.html">mutex.h</a></li>
<li>port/<a class="el" href="mutex_8cc_source.html">mutex.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceion.html">ion</a></li><li class="navelem"><a class="el" href="namespaceion_1_1port.html">port</a></li><li class="navelem"><a class="el" href="classion_1_1port_1_1_mutex.html">Mutex</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
