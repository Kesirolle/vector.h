<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Ion: gfxprofile/gpuprofiler.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Ion
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('gpuprofiler_8cc_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">gpuprofiler.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="gpuprofiler_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="gpuprofiler_8h.html">ion/gfxprofile/gpuprofiler.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="calltracemanager_8h.html">ion/profile/calltracemanager.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="tracerecorder_8h.html">ion/profile/tracerecorder.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">namespace </span>ion {</div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="namespaceion_1_1gfxprofile.html">   24</a></span>&#160;<span class="keyword">namespace </span>gfxprofile {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#ac5cb841c1b9a07e4f20b7c6bb0eebb8f">   26</a></span>&#160;<a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html">GpuProfiler</a>* <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#ac5cb841c1b9a07e4f20b7c6bb0eebb8f">GpuProfiler::Get</a>() {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="staticsafedeclare_8h.html#aa0c4d1e0fc76f7ea923240084c166b4c">ION_DECLARE_SAFE_STATIC_POINTER</a>(<a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html">GpuProfiler</a>, profiler);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordflow">return</span> profiler;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;}</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aa9bdd1e303665525e95f87e0968a2bec">   31</a></span>&#160;<a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aa9bdd1e303665525e95f87e0968a2bec">GpuProfiler::GpuProfiler</a>()</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    : manager_(ion::profile::<a class="code" href="namespaceion_1_1profile.html#a6abacb3baa9ac40d60fae7b50699af6c">GetCallTraceManager</a>()),</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      enable_gpu_tracing_(<span class="stringliteral">&quot;enable_gpu_tracing&quot;</span>, false),</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      gl_timer_offset_ns_(0) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;}</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aa9bdd1e303665525e95f87e0968a2bec">GpuProfiler::GpuProfiler</a>(<a class="code" href="classion_1_1profile_1_1_call_trace_manager.html">ion::profile::CallTraceManager</a>* manager)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    : manager_(manager),</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      enable_gpu_tracing_(<span class="stringliteral">&quot;enable_gpu_tracing&quot;</span>, false),</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      gl_timer_offset_ns_(0) {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a690ff6bf40f96c43170593dd6355b215">   43</a></span>&#160;<a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a690ff6bf40f96c43170593dd6355b215">GpuProfiler::~GpuProfiler</a>() {}</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a362187bd2f1c3c4ceda45b9de292b000">   45</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a362187bd2f1c3c4ceda45b9de292b000">GpuProfiler::IsGpuProfilingSupported</a>(</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">ion::gfx::GraphicsManagerPtr</a>&amp; gfx_mgr)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">if</span> (!gfx_mgr-&gt;IsExtensionSupported(<span class="stringliteral">&quot;GL_EXT_disjoint_timer_query&quot;</span>)) {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  GLint bits = 0;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  gfx_mgr-&gt;GetQueryiv(<a class="code" href="glheaders_8h.html#abd347cd1ddb219f4acae3acffe0c9655">GL_TIMESTAMP_EXT</a>, <a class="code" href="glheaders_8h.html#a1f9ba277160a177530f814ba484fa06f">GL_QUERY_COUNTER_BITS_EXT</a>, &amp;bits);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (bits == 0) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a600403f23f2a9997119da47e3e250d00">   60</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a600403f23f2a9997119da47e3e250d00">GpuProfiler::SetGraphicsManager</a>(</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">ion::gfx::GraphicsManagerPtr</a>&amp; gfx_mgr) {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a362187bd2f1c3c4ceda45b9de292b000">IsGpuProfilingSupported</a>(gfx_mgr)) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  graphics_manager_ = gfx_mgr;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  SyncGlTimebase();</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;}</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;GLuint GpuProfiler::TryAllocateGlQueryId() {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html">ion::gfx::GraphicsManager</a>* gfx_mgr = <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aaa928f56ae93d01f9f3fbfa29d78ac8a">GetGraphicsManagerOrNull</a>();</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">if</span> (!gfx_mgr) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  GLuint query_id = 0;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordflow">if</span> (gl_timer_query_id_pool_.empty()) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(gfx_mgr);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    gfx_mgr-&gt;GenQueries(1, &amp;query_id);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    query_id = gl_timer_query_id_pool_.top();</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    gl_timer_query_id_pool_.pop();</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">return</span> query_id;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;}</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aea0225b71e9ab6fce71d6cc28e6cfded">   88</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aea0225b71e9ab6fce71d6cc28e6cfded">GpuProfiler::EnterGlScope</a>(uint32 <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html">ion::gfx::GraphicsManager</a>* gfx_mgr = <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aaa928f56ae93d01f9f3fbfa29d78ac8a">GetGraphicsManagerOrNull</a>();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordflow">if</span> (!gfx_mgr) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  GLuint query_id = TryAllocateGlQueryId();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">if</span> (query_id != 0) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    gfx_mgr-&gt;QueryCounter(query_id, <a class="code" href="glheaders_8h.html#abd347cd1ddb219f4acae3acffe0c9655">GL_TIMESTAMP_EXT</a>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    pending_gpu_queries_.push_back(GpuTimerQuery(</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        manager_-&gt;<a class="code" href="classion_1_1profile_1_1_call_trace_manager.html#aa5d45263a81f9c72d3758eae6e2341e2">GetTimeInNs</a>(), <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>, query_id,</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        GpuTimerQuery::kQueryBeginScope));</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aa155e760ee6704ffc8da38902121f4da">  103</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aa155e760ee6704ffc8da38902121f4da">GpuProfiler::LeaveGlScope</a>() {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html">ion::gfx::GraphicsManager</a>* gfx_mgr = <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aaa928f56ae93d01f9f3fbfa29d78ac8a">GetGraphicsManagerOrNull</a>();</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordflow">if</span> (!gfx_mgr) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  GLuint query_id = TryAllocateGlQueryId();</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">if</span> (query_id != 0) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    gfx_mgr-&gt;QueryCounter(query_id, <a class="code" href="glheaders_8h.html#abd347cd1ddb219f4acae3acffe0c9655">GL_TIMESTAMP_EXT</a>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    pending_gpu_queries_.push_back(</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        GpuTimerQuery(manager_-&gt;<a class="code" href="classion_1_1profile_1_1_call_trace_manager.html#aa5d45263a81f9c72d3758eae6e2341e2">GetTimeInNs</a>(), 0, query_id,</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                      GpuTimerQuery::kQueryEndScope));</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordtype">void</span> GpuProfiler::SyncGlTimebase() {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html">ion::gfx::GraphicsManager</a>* gfx_mgr = <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aaa928f56ae93d01f9f3fbfa29d78ac8a">GetGraphicsManagerOrNull</a>();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">if</span> (!gfx_mgr) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  GLint disjoint = 0;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  gfx_mgr-&gt;GetIntegerv(<a class="code" href="glheaders_8h.html#a0d4ed66e60a71285af463fa68fbfb1b9">GL_GPU_DISJOINT_EXT</a>, &amp;disjoint);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordtype">int</span> attempts_remaining = 3;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="glheaders_8h.html#a8053760e053f2167e5e5915a8f50bc39">GLint64</a> gl_timestamp = 0;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    gfx_mgr-&gt;GetInteger64v(<a class="code" href="glheaders_8h.html#abd347cd1ddb219f4acae3acffe0c9655">GL_TIMESTAMP_EXT</a>, &amp;gl_timestamp);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    int64 cpu_timebase_ns = <span class="keyword">static_cast&lt;</span>int64<span class="keyword">&gt;</span>(manager_-&gt;<a class="code" href="classion_1_1profile_1_1_call_trace_manager.html#aa5d45263a81f9c72d3758eae6e2341e2">GetTimeInNs</a>());</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    disjoint = 0;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    gfx_mgr-&gt;GetIntegerv(<a class="code" href="glheaders_8h.html#a0d4ed66e60a71285af463fa68fbfb1b9">GL_GPU_DISJOINT_EXT</a>, &amp;disjoint);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span> (!disjoint) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      gl_timer_offset_ns_ = cpu_timebase_ns - gl_timestamp;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;Skipping disjoint GPU timestamp&quot;</span>;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  } <span class="keywordflow">while</span> (--attempts_remaining &gt; 0);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">if</span> (attempts_remaining == 0) {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;Failed to sync GL timebase due to disjoint results&quot;</span>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    gl_timer_offset_ns_ = 0;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;}</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a4b772447b6c5550a638fc175d51e7aa5">  156</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a4b772447b6c5550a638fc175d51e7aa5">GpuProfiler::PollGlTimerQueries</a>() {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html">ion::gfx::GraphicsManager</a>* gfx_mgr = <a class="code" href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aaa928f56ae93d01f9f3fbfa29d78ac8a">GetGraphicsManagerOrNull</a>();</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">if</span> (!gfx_mgr) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="classion_1_1profile_1_1_trace_recorder.html">ion::profile::TraceRecorder</a>* recorder = manager_-&gt;<a class="code" href="classion_1_1profile_1_1_call_trace_manager.html#a18e0b360227c35881b175bab44bd8888">GetNamedTraceRecorder</a>(</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;     <a class="code" href="classion_1_1profile_1_1_call_trace_manager.html#a6eab0ecec972f16e622b89def71d3847a3b81243ffc0989b330460eee812d0e94">ion::profile::CallTraceManager::kRecorderGpu</a>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  GLuint begin_frame_id = TryAllocateGlQueryId();</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">if</span> (begin_frame_id != 0) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    gfx_mgr-&gt;QueryCounter(begin_frame_id, <a class="code" href="glheaders_8h.html#abd347cd1ddb219f4acae3acffe0c9655">GL_TIMESTAMP_EXT</a>);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    pending_gpu_queries_.push_back(</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;       GpuTimerQuery(manager_-&gt;<a class="code" href="classion_1_1profile_1_1_call_trace_manager.html#aa5d45263a81f9c72d3758eae6e2341e2">GetTimeInNs</a>(), 0, begin_frame_id,</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                     GpuTimerQuery::kQueryBeginFrame));</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordtype">bool</span> has_checked_disjoint = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">bool</span> was_disjoint = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">if</span> (pending_gpu_queries_.empty()) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    GpuTimerQuery query = pending_gpu_queries_.front();</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    GLint available = 0;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    gfx_mgr-&gt;<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#a865ec04c394670ff80666952ff4f5898">GetQueryObjectiv</a>(query.gl_query_id,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                              <a class="code" href="glheaders_8h.html#abf85514071139366c34fbc980f25bc45">GL_QUERY_RESULT_AVAILABLE_EXT</a>, &amp;available);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">if</span> (!available) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    pending_gpu_queries_.pop_front();</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    gl_timer_query_id_pool_.push(query.gl_query_id);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (!has_checked_disjoint) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      has_checked_disjoint = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      GLint disjoint_occurred = 0;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      gfx_mgr-&gt;GetIntegerv(<a class="code" href="glheaders_8h.html#a0d4ed66e60a71285af463fa68fbfb1b9">GL_GPU_DISJOINT_EXT</a>, &amp;disjoint_occurred);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      was_disjoint = !!disjoint_occurred;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">if</span> (was_disjoint) {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;Skipping disjoint GPU events&quot;</span>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (was_disjoint) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <a class="code" href="glheaders_8h.html#a8053760e053f2167e5e5915a8f50bc39">GLint64</a> timestamp_ns = 0;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    gfx_mgr-&gt;GetQueryObjecti64v(query.gl_query_id,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                <a class="code" href="glheaders_8h.html#ac34f9cbbf620b4c40d12bef77090de51">GL_QUERY_RESULT_EXT</a>, &amp;timestamp_ns);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="classuint64.html">uint64</a> adjusted_timestamp_ns = timestamp_ns + gl_timer_offset_ns_;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">if</span> (query.query_type == GpuTimerQuery::kQueryBeginFrame ||</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        query.query_type == GpuTimerQuery::kQueryBeginScope) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keywordflow">if</span> (adjusted_timestamp_ns &lt; query.cpu_timestamp_ns) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        gl_timer_offset_ns_ += query.cpu_timestamp_ns - adjusted_timestamp_ns;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        adjusted_timestamp_ns = query.cpu_timestamp_ns;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    uint32 adjusted_timestamp_us =</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keyword">static_cast&lt;</span>uint32<span class="keyword">&gt;</span>(adjusted_timestamp_ns / 1000ll);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">switch</span> (query.query_type) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">case</span> GpuTimerQuery::kQueryBeginFrame:</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">case</span> GpuTimerQuery::kQueryBeginScope:</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      recorder-&gt;<a class="code" href="classion_1_1profile_1_1_trace_recorder.html#ad0fb69632f01e52b15ed92b009f069b5">EnterScopeAtTime</a>(adjusted_timestamp_us, query.scope_event_id);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">case</span> GpuTimerQuery::kQueryEndScope:</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      recorder-&gt;<a class="code" href="classion_1_1profile_1_1_trace_recorder.html#abe78bbccf106deadf68d7c1b9e329204">LeaveScopeAtTime</a>(adjusted_timestamp_us);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;}</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}  <span class="comment">// namespace gfxprofile</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;}  <span class="comment">// namespace ion</span></div>
<div class="ttc" id="glheaders_8h_html_a8053760e053f2167e5e5915a8f50bc39"><div class="ttname"><a href="glheaders_8h.html#a8053760e053f2167e5e5915a8f50bc39">GLint64</a></div><div class="ttdeci">int64_t GLint64</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00130">glheaders.h:130</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html">ion::gfx::GraphicsManager</a></div><div class="ttdoc">GraphicsManager manages the graphics library for an application. </div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00054">graphicsmanager.h:54</a></div></div>
<div class="ttc" id="classion_1_1gfxprofile_1_1_gpu_profiler_html_a362187bd2f1c3c4ceda45b9de292b000"><div class="ttname"><a href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a362187bd2f1c3c4ceda45b9de292b000">ion::gfxprofile::GpuProfiler::IsGpuProfilingSupported</a></div><div class="ttdeci">bool IsGpuProfilingSupported(const ion::gfx::GraphicsManagerPtr &amp;gfx_mgr) const </div><div class="ttdef"><b>Definition:</b> <a href="gpuprofiler_8cc_source.html#l00045">gpuprofiler.cc:45</a></div></div>
<div class="ttc" id="tracerecorder_8h_html"><div class="ttname"><a href="tracerecorder_8h.html">tracerecorder.h</a></div></div>
<div class="ttc" id="classion_1_1gfxprofile_1_1_gpu_profiler_html_a690ff6bf40f96c43170593dd6355b215"><div class="ttname"><a href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a690ff6bf40f96c43170593dd6355b215">ion::gfxprofile::GpuProfiler::~GpuProfiler</a></div><div class="ttdeci">~GpuProfiler()</div><div class="ttdef"><b>Definition:</b> <a href="gpuprofiler_8cc_source.html#l00043">gpuprofiler.cc:43</a></div></div>
<div class="ttc" id="staticsafedeclare_8h_html_aa0c4d1e0fc76f7ea923240084c166b4c"><div class="ttname"><a href="staticsafedeclare_8h.html#aa0c4d1e0fc76f7ea923240084c166b4c">ION_DECLARE_SAFE_STATIC_POINTER</a></div><div class="ttdeci">#define ION_DECLARE_SAFE_STATIC_POINTER(type, variable)</div><div class="ttdoc">Declare a static non-array pointer and calls a default constructor. </div><div class="ttdef"><b>Definition:</b> <a href="staticsafedeclare_8h_source.html#l00111">staticsafedeclare.h:111</a></div></div>
<div class="ttc" id="classion_1_1profile_1_1_trace_recorder_html"><div class="ttname"><a href="classion_1_1profile_1_1_trace_recorder.html">ion::profile::TraceRecorder</a></div><div class="ttdoc">Class for recording frame events. </div><div class="ttdef"><b>Definition:</b> <a href="tracerecorder_8h_source.html#l00042">tracerecorder.h:42</a></div></div>
<div class="ttc" id="namespaceion_1_1profile_html_a6abacb3baa9ac40d60fae7b50699af6c"><div class="ttname"><a href="namespaceion_1_1profile.html#a6abacb3baa9ac40d60fae7b50699af6c">ion::profile::GetCallTraceManager</a></div><div class="ttdeci">CallTraceManager * GetCallTraceManager()</div><div class="ttdoc">Get the global, static instance of CallTraceManager. </div><div class="ttdef"><b>Definition:</b> <a href="profiling_8cc_source.html#l00025">profiling.cc:25</a></div></div>
<div class="ttc" id="base_2logging_8h_html_a3b7d10ddea0bbcbabddb9a5d3625ecb9"><div class="ttname"><a href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a></div><div class="ttdeci">#define DCHECK(expr)</div><div class="ttdef"><b>Definition:</b> <a href="base_2logging_8h_source.html#l00331">logging.h:331</a></div></div>
<div class="ttc" id="classion_1_1gfxprofile_1_1_gpu_profiler_html_aea0225b71e9ab6fce71d6cc28e6cfded"><div class="ttname"><a href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aea0225b71e9ab6fce71d6cc28e6cfded">ion::gfxprofile::GpuProfiler::EnterGlScope</a></div><div class="ttdeci">void EnterGlScope(uint32 id)</div><div class="ttdoc">Records the beginning of a scoped GL trace event. </div><div class="ttdef"><b>Definition:</b> <a href="gpuprofiler_8cc_source.html#l00088">gpuprofiler.cc:88</a></div></div>
<div class="ttc" id="base_2logging_8h_html_accad43a85d781d53381cd53a9894b6ae"><div class="ttname"><a href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a></div><div class="ttdeci">#define LOG(severity)</div><div class="ttdoc">Logs the streamed message unconditionally with a severity of severity. </div><div class="ttdef"><b>Definition:</b> <a href="base_2logging_8h_source.html#l00216">logging.h:216</a></div></div>
<div class="ttc" id="classuint64_html"><div class="ttname"><a href="classuint64.html">uint64</a></div></div>
<div class="ttc" id="calltracemanager_8h_html"><div class="ttname"><a href="calltracemanager_8h.html">calltracemanager.h</a></div></div>
<div class="ttc" id="classion_1_1gfxprofile_1_1_gpu_profiler_html_ac5cb841c1b9a07e4f20b7c6bb0eebb8f"><div class="ttname"><a href="classion_1_1gfxprofile_1_1_gpu_profiler.html#ac5cb841c1b9a07e4f20b7c6bb0eebb8f">ion::gfxprofile::GpuProfiler::Get</a></div><div class="ttdeci">static GpuProfiler * Get()</div><div class="ttdoc">Gets the GpuProfiler singleton instance. </div><div class="ttdef"><b>Definition:</b> <a href="gpuprofiler_8cc_source.html#l00026">gpuprofiler.cc:26</a></div></div>
<div class="ttc" id="classion_1_1profile_1_1_trace_recorder_html_ad0fb69632f01e52b15ed92b009f069b5"><div class="ttname"><a href="classion_1_1profile_1_1_trace_recorder.html#ad0fb69632f01e52b15ed92b009f069b5">ion::profile::TraceRecorder::EnterScopeAtTime</a></div><div class="ttdeci">void EnterScopeAtTime(uint32 timestamp, int event_id)</div><div class="ttdoc">Same as EnterScope, but with specified timestamp. </div><div class="ttdef"><b>Definition:</b> <a href="tracerecorder_8cc_source.html#l00099">tracerecorder.cc:99</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_a865ec04c394670ff80666952ff4f5898"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#a865ec04c394670ff80666952ff4f5898">ion::gfx::GraphicsManager::GetQueryObjectiv</a></div><div class="ttdeci">framebuffer alpha dfactor const GLvoid usage alpha const GLvoid data border const GLuint buffers const GLuint renderbuffers count renderbuffer GLuint framebuffers GLsizei GLint GLenum GLchar name GLsizei GLuint shaders GLint data GLsizei GLchar info_log GLint params GLint GLint precision GLint params GLint params GLint params GLfloat params GLvoid pointer height height const GLchar const GLint length mask dppass param param const GLvoid data const GLint1 value const GLfloat2 value v2 v2 v3 v3 const GLmatrix2 value const GLmatrix4 value v1 v2 v3 const GLvoid pointer GLsizei GLchar label const GLchar marker const void userParam const GLchar buf void params height const GLuint1 value const GLuint2 value const GLuint3 value const GLuint4 value void image primCount divisor length size sampler GLuint samplers GLint params const GLfloat params const GLint params flags timeout const GLvoid data const GLvoid pixels fixed_sample_locations GLfloat val height fixed_sample_locations primitive_mode const GLuint ids GLsizei GLsizei GLenum GLchar name const GLchar buffer_mode GLuint arrays GLint params GetQueryObjectiv</div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00706">graphicsmanager.h:706</a></div></div>
<div class="ttc" id="gpuprofiler_8h_html"><div class="ttname"><a href="gpuprofiler_8h.html">gpuprofiler.h</a></div></div>
<div class="ttc" id="glheaders_8h_html_a0d4ed66e60a71285af463fa68fbfb1b9"><div class="ttname"><a href="glheaders_8h.html#a0d4ed66e60a71285af463fa68fbfb1b9">GL_GPU_DISJOINT_EXT</a></div><div class="ttdeci">#define GL_GPU_DISJOINT_EXT</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00405">glheaders.h:405</a></div></div>
<div class="ttc" id="calltracemanager_8cc_html_a3384d9640634d49e84776a97f3e2c241"><div class="ttname"><a href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a></div><div class="ttdeci">uint32 id</div><div class="ttdef"><b>Definition:</b> <a href="calltracemanager_8cc_source.html#l00040">calltracemanager.cc:40</a></div></div>
<div class="ttc" id="classion_1_1profile_1_1_call_trace_manager_html_a6eab0ecec972f16e622b89def71d3847a3b81243ffc0989b330460eee812d0e94"><div class="ttname"><a href="classion_1_1profile_1_1_call_trace_manager.html#a6eab0ecec972f16e622b89def71d3847a3b81243ffc0989b330460eee812d0e94">ion::profile::CallTraceManager::kRecorderGpu</a></div><div class="ttdef"><b>Definition:</b> <a href="calltracemanager_8h_source.html#l00090">calltracemanager.h:90</a></div></div>
<div class="ttc" id="classion_1_1gfxprofile_1_1_gpu_profiler_html_aa9bdd1e303665525e95f87e0968a2bec"><div class="ttname"><a href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aa9bdd1e303665525e95f87e0968a2bec">ion::gfxprofile::GpuProfiler::GpuProfiler</a></div><div class="ttdeci">GpuProfiler()</div><div class="ttdef"><b>Definition:</b> <a href="gpuprofiler_8cc_source.html#l00031">gpuprofiler.cc:31</a></div></div>
<div class="ttc" id="glheaders_8h_html_a1f9ba277160a177530f814ba484fa06f"><div class="ttname"><a href="glheaders_8h.html#a1f9ba277160a177530f814ba484fa06f">GL_QUERY_COUNTER_BITS_EXT</a></div><div class="ttdeci">#define GL_QUERY_COUNTER_BITS_EXT</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00639">glheaders.h:639</a></div></div>
<div class="ttc" id="namespaceion_1_1port_html_ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116"><div class="ttname"><a href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ion::port::ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="port_2logging_8h_source.html#l00029">logging.h:29</a></div></div>
<div class="ttc" id="glheaders_8h_html_ac34f9cbbf620b4c40d12bef77090de51"><div class="ttname"><a href="glheaders_8h.html#ac34f9cbbf620b4c40d12bef77090de51">GL_QUERY_RESULT_EXT</a></div><div class="ttdeci">#define GL_QUERY_RESULT_EXT</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00648">glheaders.h:648</a></div></div>
<div class="ttc" id="classion_1_1gfxprofile_1_1_gpu_profiler_html_a600403f23f2a9997119da47e3e250d00"><div class="ttname"><a href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a600403f23f2a9997119da47e3e250d00">ion::gfxprofile::GpuProfiler::SetGraphicsManager</a></div><div class="ttdeci">void SetGraphicsManager(const gfx::GraphicsManagerPtr &amp;gfx_mgr)</div><div class="ttdoc">Sets the GraphicsManager that is required for performing GPU tracing via OpenGL. </div><div class="ttdef"><b>Definition:</b> <a href="gpuprofiler_8cc_source.html#l00060">gpuprofiler.cc:60</a></div></div>
<div class="ttc" id="classion_1_1gfxprofile_1_1_gpu_profiler_html"><div class="ttname"><a href="classion_1_1gfxprofile_1_1_gpu_profiler.html">ion::gfxprofile::GpuProfiler</a></div><div class="ttdoc">Singleton class that augments CallTraceManager with GPU tracing support. </div><div class="ttdef"><b>Definition:</b> <a href="gpuprofiler_8h_source.html#l00055">gpuprofiler.h:55</a></div></div>
<div class="ttc" id="classion_1_1profile_1_1_call_trace_manager_html_a18e0b360227c35881b175bab44bd8888"><div class="ttname"><a href="classion_1_1profile_1_1_call_trace_manager.html#a18e0b360227c35881b175bab44bd8888">ion::profile::CallTraceManager::GetNamedTraceRecorder</a></div><div class="ttdeci">TraceRecorder * GetNamedTraceRecorder(NamedTraceRecorderType name)</div><div class="ttdoc">Gets the TraceRecorder instance specific to the current thread of the given name. ...</div><div class="ttdef"><b>Definition:</b> <a href="calltracemanager_8cc_source.html#l00282">calltracemanager.cc:282</a></div></div>
<div class="ttc" id="classion_1_1profile_1_1_call_trace_manager_html"><div class="ttname"><a href="classion_1_1profile_1_1_call_trace_manager.html">ion::profile::CallTraceManager</a></div><div class="ttdoc">Manages call trace recording for visualization in Web Tracing Framework (WTF) format. </div><div class="ttdef"><b>Definition:</b> <a href="calltracemanager_8h_source.html#l00044">calltracemanager.h:44</a></div></div>
<div class="ttc" id="classion_1_1gfxprofile_1_1_gpu_profiler_html_aaa928f56ae93d01f9f3fbfa29d78ac8a"><div class="ttname"><a href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aaa928f56ae93d01f9f3fbfa29d78ac8a">ion::gfxprofile::GpuProfiler::GetGraphicsManagerOrNull</a></div><div class="ttdeci">gfx::GraphicsManager * GetGraphicsManagerOrNull() const </div><div class="ttdoc">Gets the GraphicsManager if GPU tracing is enabled. </div><div class="ttdef"><b>Definition:</b> <a href="gpuprofiler_8h_source.html#l00080">gpuprofiler.h:80</a></div></div>
<div class="ttc" id="namespaceion_1_1port_html_ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a"><div class="ttname"><a href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">ion::port::WARNING</a></div><div class="ttdef"><b>Definition:</b> <a href="port_2logging_8h_source.html#l00028">logging.h:28</a></div></div>
<div class="ttc" id="glheaders_8h_html_abd347cd1ddb219f4acae3acffe0c9655"><div class="ttname"><a href="glheaders_8h.html#abd347cd1ddb219f4acae3acffe0c9655">GL_TIMESTAMP_EXT</a></div><div class="ttdeci">#define GL_TIMESTAMP_EXT</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l01074">glheaders.h:1074</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_shared_ptr_html"><div class="ttname"><a href="classion_1_1base_1_1_shared_ptr.html">ion::base::SharedPtr</a></div><div class="ttdoc">A SharedPtr is a smart shared pointer to an instance of some class that implements reference counting...</div><div class="ttdef"><b>Definition:</b> <a href="sharedptr_8h_source.html#l00060">sharedptr.h:60</a></div></div>
<div class="ttc" id="classion_1_1profile_1_1_trace_recorder_html_abe78bbccf106deadf68d7c1b9e329204"><div class="ttname"><a href="classion_1_1profile_1_1_trace_recorder.html#abe78bbccf106deadf68d7c1b9e329204">ion::profile::TraceRecorder::LeaveScopeAtTime</a></div><div class="ttdeci">void LeaveScopeAtTime(uint32 timestamp)</div><div class="ttdoc">Same as LeaveScope, but with specified timestamp. </div><div class="ttdef"><b>Definition:</b> <a href="tracerecorder_8cc_source.html#l00124">tracerecorder.cc:124</a></div></div>
<div class="ttc" id="classion_1_1gfxprofile_1_1_gpu_profiler_html_aa155e760ee6704ffc8da38902121f4da"><div class="ttname"><a href="classion_1_1gfxprofile_1_1_gpu_profiler.html#aa155e760ee6704ffc8da38902121f4da">ion::gfxprofile::GpuProfiler::LeaveGlScope</a></div><div class="ttdeci">void LeaveGlScope()</div><div class="ttdoc">Records the end of a scoped GL trace event. </div><div class="ttdef"><b>Definition:</b> <a href="gpuprofiler_8cc_source.html#l00103">gpuprofiler.cc:103</a></div></div>
<div class="ttc" id="glheaders_8h_html_abf85514071139366c34fbc980f25bc45"><div class="ttname"><a href="glheaders_8h.html#abf85514071139366c34fbc980f25bc45">GL_QUERY_RESULT_AVAILABLE_EXT</a></div><div class="ttdeci">#define GL_QUERY_RESULT_AVAILABLE_EXT</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00645">glheaders.h:645</a></div></div>
<div class="ttc" id="classion_1_1gfxprofile_1_1_gpu_profiler_html_a4b772447b6c5550a638fc175d51e7aa5"><div class="ttname"><a href="classion_1_1gfxprofile_1_1_gpu_profiler.html#a4b772447b6c5550a638fc175d51e7aa5">ion::gfxprofile::GpuProfiler::PollGlTimerQueries</a></div><div class="ttdeci">void PollGlTimerQueries()</div><div class="ttdoc">Polls (non-blocking) for completed GL timer query data and adds events into the trace buffer...</div><div class="ttdef"><b>Definition:</b> <a href="gpuprofiler_8cc_source.html#l00156">gpuprofiler.cc:156</a></div></div>
<div class="ttc" id="classion_1_1profile_1_1_call_trace_manager_html_aa5d45263a81f9c72d3758eae6e2341e2"><div class="ttname"><a href="classion_1_1profile_1_1_call_trace_manager.html#aa5d45263a81f9c72d3758eae6e2341e2">ion::profile::CallTraceManager::GetTimeInNs</a></div><div class="ttdeci">uint64 GetTimeInNs() const </div><div class="ttdoc">Returns the time in nanoseconds, relative to the timebase. </div><div class="ttdef"><b>Definition:</b> <a href="calltracemanager_8h_source.html#l00157">calltracemanager.h:157</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_edf06580600a4b2bd3e71da6974f54df.html">gfxprofile</a></li><li class="navelem"><a class="el" href="gpuprofiler_8cc.html">gpuprofiler.cc</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
