<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Ion: gfx/renderer.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Ion
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('renderer_8cc_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">renderer.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="renderer_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;bitset&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;base/integral_types.h&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="allocationmanager_8h.html">ion/base/allocationmanager.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="allocationsizetracker_8h.html">ion/base/allocationsizetracker.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="enumhelper_8h.html">ion/base/enumhelper.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="invalid_8h.html">ion/base/invalid.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lockguards_8h.html">ion/base/lockguards.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="base_2logging_8h.html">ion/base/logging.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="readwritelock_8h.html">ion/base/readwritelock.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="serialize_8h.html">ion/base/serialize.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="staticsafedeclare_8h.html">ion/base/staticsafedeclare.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="allocset_8h.html">ion/base/stlalloc/allocset.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="allocunorderedset_8h.html">ion/base/stlalloc/allocunorderedset.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="allocvector_8h.html">ion/base/stlalloc/allocvector.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="attribute_8h.html">ion/gfx/attribute.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="attributearray_8h.html">ion/gfx/attributearray.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="bufferobject_8h.html">ion/gfx/bufferobject.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cubemaptexture_8h.html">ion/gfx/cubemaptexture.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="framebufferobject_8h.html">ion/gfx/framebufferobject.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="image_8h.html">ion/gfx/image.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="renderer_8h.html">ion/gfx/renderer.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="resourcebase_8h.html">ion/gfx/resourcebase.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="shaderinputregistry_8h.html">ion/gfx/shaderinputregistry.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="shape_8h.html">ion/gfx/shape.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="texture_8h.html">ion/gfx/texture.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="texturemanager_8h.html">ion/gfx/texturemanager.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="updatestatetable_8h.html">ion/gfx/updatestatetable.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="matrix_8h.html">ion/math/matrix.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="matrixutils_8h.html">ion/math/matrixutils.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="range_8h.html">ion/math/range.h</a>&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rangeutils_8h.html">ion/math/rangeutils.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html">ion/math/utils.h</a>&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vector_8h.html">ion/math/vector.h</a>&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="atomic_8h.html">ion/port/atomic.h</a>&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="macros_8h.html">ion/port/macros.h</a>&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mutex_8h.html">ion/port/mutex.h</a>&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="glheaders_8h.html">ion/portgfx/glheaders.h</a>&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="visual_8h.html">ion/portgfx/visual.h</a>&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keyword">namespace </span>ion {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">namespace </span>gfx {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">using</span> base::DataContainer;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceion_1_1base.html#a9aea056fa3b5c46e3182f5427fb5f010">base::DataContainerPtr</a>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keyword">using</span> math::Point3ui;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceion_1_1math.html#a55c6c70c3e325850f7118620bcc879a2">math::Range1i</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">math::Range1ui</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> GLuint kInvalidGluint = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(-1);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keyword">static</span> base::ReadWriteLock* GetResourceBinderLock() {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="staticsafedeclare_8h.html#aa0c4d1e0fc76f7ea923240084c166b4c">ION_DECLARE_SAFE_STATIC_POINTER</a>(base::ReadWriteLock, lock);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">return</span> lock;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> GetAttributeSlotCountAndStride(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a6c1236c56d99c202b404c5f6166c85ad">BufferObject::ComponentType</a> <a class="code" href="printer_8cc.html#a75b160f574a0be26114bae2c7686a5e1">type</a>,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                                           GLuint* stride, GLuint* slots) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  *stride = 0U;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  *slots = 1U;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">switch</span> (type) {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a6c1236c56d99c202b404c5f6166c85adad8f12f1bc152a2823f548ef1c9140bb3">BufferObject::kFloatMatrixColumn2</a>:</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      *stride = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(2U * <span class="keyword">sizeof</span>(float));</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      *slots = 2U;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a6c1236c56d99c202b404c5f6166c85adae77299693d4d746b487bfa830ba4909d">BufferObject::kFloatMatrixColumn3</a>:</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      *stride = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(3U * <span class="keyword">sizeof</span>(float));</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      *slots = 3U;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a6c1236c56d99c202b404c5f6166c85adad16a39ae4cc9c9ab8eaa28298a3414a8">BufferObject::kFloatMatrixColumn4</a>:</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      *stride = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(4U * <span class="keyword">sizeof</span>(float));</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      *slots = 4U;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keyword">static</span> GLuint GetAttributeSlotCountByGlType(GLenum type) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  GLuint slots = 1U;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordflow">switch</span> (type) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">case</span> GL_FLOAT_MAT2:</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      slots = 2U;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">case</span> GL_FLOAT_MAT3:</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      slots = 3U;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">case</span> GL_FLOAT_MAT4:</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      slots = 4U;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">return</span> slots;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* GetShaderTypeString(GLenum shader_type) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* type = <span class="stringliteral">&quot;&lt;UNKNOWN&gt;&quot;</span>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">if</span> (shader_type == GL_VERTEX_SHADER)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    type = <span class="stringliteral">&quot;vertex&quot;</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shader_type == GL_FRAGMENT_SHADER)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    type = <span class="stringliteral">&quot;fragment&quot;</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="printer_8cc.html#a75b160f574a0be26114bae2c7686a5e1">type</a>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> SetObjectLabel(GraphicsManager* gm, GLenum type, GLuint <span class="keywordtype">id</span>,</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                           <span class="keyword">const</span> std::string&amp; <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">#if !ION_PRODUCTION</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572afba40b4d0911b93123d0984538d3749f">GraphicsManager::kDebugLabel</a>)) {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    gm-&gt;LabelObject(type, <span class="keywordtype">id</span>, static_cast&lt;GLsizei&gt;(label.length()),</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                    label.c_str());</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> ValidateUniformType(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="printer_8cc.html#a9b45b3e13bd9167aab02e17e08916231">name</a>,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                                <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader_input.html#a1ffe1d1593ef0ac8c0e9b7efa0cc73b6">Uniform::ValueType</a> spec_type,</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                                GLenum type) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordtype">bool</span> types_equal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">switch</span> (spec_type) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a5eec43d1921c8d1bad9bf03ecacebd22">kIntUniform</a>:</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      types_equal = type == GL_INT;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a08f89b65739f59e8d7ec80c6ba321108">kFloatUniform</a>:</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      types_equal = type == GL_FLOAT;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a54de8efde6ddd1e64bcef41ca8f9e902">kUnsignedIntUniform</a>:</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      types_equal = type == GL_UNSIGNED_INT;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a81b379b9dc3585ac8815021f56f90c41">kCubeMapTextureUniform</a>:</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      types_equal = type == GL_INT_SAMPLER_CUBE ||</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                    type == GL_INT_SAMPLER_CUBE_MAP_ARRAY ||</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    type == GL_SAMPLER_CUBE ||</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    type == GL_SAMPLER_CUBE_MAP_ARRAY ||</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                    type == GL_SAMPLER_CUBE_MAP_ARRAY_SHADOW ||</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                    type == GL_SAMPLER_CUBE_SHADOW ||</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                    type == GL_UNSIGNED_INT_SAMPLER_CUBE ||</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                    type == GL_UNSIGNED_INT_SAMPLER_CUBE_MAP_ARRAY;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1fb38ca96a9985f325f838de5757e95d">kTextureUniform</a>:</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      types_equal =</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          type == GL_INT_SAMPLER_1D || type == GL_INT_SAMPLER_1D_ARRAY ||</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;          type == GL_INT_SAMPLER_2D || type == GL_INT_SAMPLER_2D_ARRAY ||</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          type == GL_INT_SAMPLER_3D || type == GL_SAMPLER_1D ||</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;          type == GL_SAMPLER_1D_ARRAY || type == GL_SAMPLER_1D_ARRAY_SHADOW ||</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;          type == GL_SAMPLER_1D_SHADOW || type == GL_SAMPLER_2D ||</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          type == GL_SAMPLER_2D_ARRAY || type == GL_SAMPLER_2D_ARRAY_SHADOW ||</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          type == GL_SAMPLER_2D_MULTISAMPLE ||</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;          type == GL_SAMPLER_2D_MULTISAMPLE_ARRAY ||</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          type == GL_SAMPLER_2D_SHADOW || type == GL_SAMPLER_3D ||</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;          type == <a class="code" href="glheaders_8h.html#a4be001d607f5f1fa944db63aebb9593b">GL_SAMPLER_EXTERNAL_OES</a> ||</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;          type == GL_UNSIGNED_INT_SAMPLER_1D ||</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;          type == GL_UNSIGNED_INT_SAMPLER_1D_ARRAY ||</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          type == GL_UNSIGNED_INT_SAMPLER_2D ||</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;          type == GL_UNSIGNED_INT_SAMPLER_2D_ARRAY ||</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;          type == GL_UNSIGNED_INT_SAMPLER_3D;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1be83413a343e7dc56d49bace786fa07">kFloatVector2Uniform</a>:</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      types_equal = type == GL_FLOAT_VEC2;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a68f812bcd8299939236e4cf49ed1806d">kFloatVector3Uniform</a>:</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      types_equal = type == GL_FLOAT_VEC3;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643ac4e47e833e681048f10c0fbd01932b06">kFloatVector4Uniform</a>:</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      types_equal = type == GL_FLOAT_VEC4;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643accab86be40af728bc046aefcd5be3251">kIntVector2Uniform</a>:</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      types_equal = type == GL_INT_VEC2;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a6cc63466f4f1bfe9372c50399132a9c8">kIntVector3Uniform</a>:</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      types_equal = type == GL_INT_VEC3;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643aac51fc132916cc16df51547ffe5071b7">kIntVector4Uniform</a>:</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      types_equal = type == GL_INT_VEC4;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a19e35e1961a97c1a02c045a721798df6">kMatrix2x2Uniform</a>:</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      types_equal = type == GL_FLOAT_MAT2;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a91294d85362f36dc0a5fb4a92c66294e">kMatrix3x3Uniform</a>:</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      types_equal = type == GL_FLOAT_MAT3;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a0525286b6d441457ee2d3cd1f1390f07">kMatrix4x4Uniform</a>:</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      types_equal = type == GL_FLOAT_MAT4;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1f639abee657c971cd86c895ac9d52df">kUnsignedIntVector2Uniform</a>:</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      types_equal = type == GL_UNSIGNED_INT_VEC2;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1bd04e896509c052970b6238a1eb972a">kUnsignedIntVector3Uniform</a>:</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      types_equal = type == GL_UNSIGNED_INT_VEC3;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a827f2bfcad70a68aa5435e931fa18286">kUnsignedIntVector4Uniform</a>:</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      types_equal = type == GL_UNSIGNED_INT_VEC4;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor">#if !defined(ION_COVERAGE)  // COV_NF_START</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="preprocessor">#endif  // COV_NF_END</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">return</span> types_equal;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keyword">static</span> GLuint CompileShader(<span class="keyword">const</span> std::string&amp; id_string, GLenum shader_type,</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                            <span class="keyword">const</span> std::string&amp; source, std::string* info_log,</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                            GraphicsManager* gm) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  info_log-&gt;clear();</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  GLuint <span class="keywordtype">id</span> = gm-&gt;CreateShader(shader_type);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* source_string = source.c_str();</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    gm-&gt;ShaderSource(<span class="keywordtype">id</span>, 1, &amp;source_string, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    gm-&gt;CompileShader(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    GLint ok = GL_FALSE;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    gm-&gt;GetShaderiv(<span class="keywordtype">id</span>, GL_COMPILE_STATUS, &amp;ok);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (!ok) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordtype">char</span> log[2048];</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      log[0] = 0;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      gm-&gt;GetShaderInfoLog(<span class="keywordtype">id</span>, 2047, <span class="keyword">nullptr</span>, log);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      *info_log = log;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to compile &quot;</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                 &lt;&lt; GetShaderTypeString(shader_type) &lt;&lt; <span class="stringliteral">&quot; shader for &#39;&quot;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                 &lt;&lt; id_string &lt;&lt; <span class="stringliteral">&quot;&#39;: &quot;</span> &lt;&lt; log;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      gm-&gt;DeleteShader(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="keywordtype">id</span> = 0;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to create shader object&quot;</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="keyword">static</span> GLuint RelinkShaderProgram(<span class="keyword">const</span> std::string&amp; id_string,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                  GLuint program_id, GLuint vertex_shader_id,</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                  GLuint fragment_shader_id,</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                  std::string* info_log, GraphicsManager* gm) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  info_log-&gt;clear();</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  gm-&gt;LinkProgram(program_id);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  GLint ok = GL_FALSE;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  gm-&gt;GetProgramiv(program_id, GL_LINK_STATUS, &amp;ok);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordflow">if</span> (!ok) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordtype">char</span> log[2048];</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    log[0] = 0;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    gm-&gt;GetProgramInfoLog(program_id, 2047, <span class="keyword">nullptr</span>, log);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    *info_log = log;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to link shader program for &#39;&quot;</span> &lt;&lt; id_string</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;&#39;: &quot;</span> &lt;&lt; log;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    gm-&gt;DeleteProgram(program_id);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    program_id = 0;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">return</span> program_id;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;}</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keyword">static</span> GLuint LinkShaderProgram(<span class="keyword">const</span> std::string&amp; id_string,</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                GLuint vertex_shader_id,</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                                GLuint fragment_shader_id,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                std::string* info_log, GraphicsManager* gm) {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  GLuint program_id = gm-&gt;CreateProgram();</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordflow">if</span> (program_id) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">if</span> (vertex_shader_id)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      gm-&gt;AttachShader(program_id, vertex_shader_id);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> (fragment_shader_id)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      gm-&gt;AttachShader(program_id, fragment_shader_id);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    program_id = RelinkShaderProgram(id_string, program_id, vertex_shader_id,</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                     fragment_shader_id, info_log, gm);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to create shader program object&quot;</span>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">return</span> program_id;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;}</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a> GetCubeMapTextureImageOrMipmap(<span class="keyword">const</span> CubeMapTexture&amp; tex,</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                                              <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90c">CubeMapTexture::CubeFace</a> face) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> mipmap_count = tex.GetImageCount(face);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; mipmap_count; ++i) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">if</span> (tex.HasImage(face, i))</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">return</span> tex.GetImage(face, i);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a>();</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a> GetTextureImageOrMipmap(<span class="keyword">const</span> Texture&amp; tex) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a> <a class="code" href="sdfutils_8cc.html#a3555e065e55befd710eaa182fcf387f5">image</a>;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> mipmap_count = tex.GetImageCount();</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; mipmap_count; ++i) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> (tex.HasImage(i)) {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      image = tex.GetImage(i);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="sdfutils_8cc.html#a3555e065e55befd710eaa182fcf387f5">image</a>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;}</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="keyword">class </span>AttributeArrayEmulator : <span class="keyword">public</span> AttributeArray {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  AttributeArrayEmulator() {}</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  ~AttributeArrayEmulator()<span class="keyword"> override </span>{}</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;};</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="keyword">static</span> Image::PixelFormat GetCompatiblePixelFormat(Image::PixelFormat pf,</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                                                   GraphicsManager* gm) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">if</span> (gm-&gt;GetGlVersion() &gt;= 30 &amp;&amp;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      gm-&gt;GetGlApiStandard() == <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#afe483c6cc2e75618b57e9269e5cd7628a3c9133c01de9c071adfb3db11f38b1d3">GraphicsManager::kDesktop</a>) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> (pf.format == <a class="code" href="glheaders_8h.html#a5ebfb7e4321ee2838cb17b10b8d44959">GL_LUMINANCE</a>) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      pf.format = GL_RED;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      pf.internal_format = GL_R8;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordflow">return</span> pf;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pf.format == <a class="code" href="glheaders_8h.html#a40a697d91ac01487b948b83fab98d15a">GL_LUMINANCE_ALPHA</a>) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      pf.format = GL_RG;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      pf.internal_format = GL_RG8;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordflow">return</span> pf;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gm-&gt;GetGlVersion() &lt; 30) {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (pf.format == GL_RED) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      pf.format = pf.internal_format = <a class="code" href="glheaders_8h.html#a5ebfb7e4321ee2838cb17b10b8d44959">GL_LUMINANCE</a>;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">return</span> pf;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pf.format == GL_RG) {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      pf.format = pf.internal_format = <a class="code" href="glheaders_8h.html#a40a697d91ac01487b948b83fab98d15a">GL_LUMINANCE_ALPHA</a>;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keywordflow">return</span> pf;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">return</span> pf;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;}</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="keyword">typedef</span> void (GraphicsManager::*UniformMatrixSetter)(</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    GLint, GLsizei, GLboolean, <span class="keyword">const</span> GLfloat*);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">int</span> Dimension&gt;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> SendMatrixUniform(<span class="keyword">const</span> Uniform&amp; uniform,</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                     GraphicsManager*gm,</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                                     GLint location,</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                     UniformMatrixSetter setter) {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keyword">typedef</span> math::Matrix&lt;Dimension, float&gt; Matrix;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">if</span> (uniform.IsArrayOf&lt;Matrix&gt;()) {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keyword">const</span> GLint count = <span class="keyword">static_cast&lt;</span>GLint<span class="keyword">&gt;</span>(uniform.GetCount());</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceion_1_1base.html#a43c6663b5bdd5e5839eba0729b613c28">base::AllocatorPtr</a>&amp; allocator =</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <a class="code" href="classion_1_1base_1_1_allocation_manager.html#a026c479373cc9b9d16738cbaf86d49f1">base::AllocationManager::GetDefaultAllocatorForLifetime</a>(</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757ca0e572cccc7b2f48ced01134b3acc3396">base::kShortTerm</a>);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    Matrix* mats = <span class="keyword">static_cast&lt;</span>Matrix*<span class="keyword">&gt;</span>(allocator-&gt;AllocateMemory(</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keyword">sizeof</span>(Matrix) * count));</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">for</span> (GLint i = 0; i &lt; count; ++i)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      mats[i] = <a class="code" href="namespaceion_1_1math.html#a249c32950a150c8cf5d7f8b80292ce21">math::Transpose</a>(uniform.GetValueAt&lt;Matrix&gt;(i));</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    (gm-&gt;*setter)(location, count, GL_FALSE, reinterpret_cast&lt;float*&gt;(mats));</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    allocator-&gt;DeallocateMemory(mats);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    (gm-&gt;*setter)(location, 1, GL_FALSE,</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                <a class="code" href="namespaceion_1_1math.html#a249c32950a150c8cf5d7f8b80292ce21">math::Transpose</a>(uniform.GetValue&lt;Matrix&gt;()).Data());</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;}  <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource {};</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;AttributeArray&gt; {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keyword">typedef</span> Renderer::VertexArrayResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;};</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;AttributeArrayEmulator&gt; {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keyword">typedef</span> Renderer::VertexArrayEmulatorResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;};</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;BufferObject&gt; {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keyword">typedef</span> Renderer::BufferResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;};</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;CubeMapTexture&gt; {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keyword">typedef</span> Renderer::TextureResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;};</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;FramebufferObject&gt; {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keyword">typedef</span> Renderer::FramebufferResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;};</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;IndexBuffer&gt; {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keyword">typedef</span> Renderer::BufferResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;};</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;Sampler&gt; {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keyword">typedef</span> Renderer::SamplerResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;};</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;Shader&gt; {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keyword">typedef</span> Renderer::ShaderResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;};</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;ShaderProgram&gt; {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keyword">typedef</span> Renderer::ShaderProgramResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;};</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;ShaderInputRegistry&gt; {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keyword">typedef</span> Renderer::ShaderInputRegistryResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;};</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;TextureBase&gt; {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keyword">typedef</span> Renderer::TextureResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;};</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="keyword">struct </span>Renderer::HolderToResource&lt;Texture&gt; {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keyword">typedef</span> Renderer::TextureResource <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;};</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="keyword">class </span>Renderer::ResourceManager : <span class="keyword">public</span> gfx::ResourceManager {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keyword">class </span>Resource : <span class="keyword">public</span> ResourceBase, <span class="keyword">public</span> <a class="code" href="classion_1_1base_1_1_allocatable.html#a1b65140be876e9bb2e7bba08ed3b69b4">Allocatable</a> {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;   <span class="keyword">public</span>:</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    ResourceManager* <a class="code" href="classion_1_1gfx_1_1_renderer.html#aa71c7f5c7a6cc8b71ab0a0d713a7781b">GetResourceManager</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> resource_manager_; }</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordtype">size_t</span> GetGpuMemoryUsed()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> gpu_memory_used_.load(); }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   <span class="keyword">protected</span>:</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keyword">explicit</span> Resource(ResourceManager* rm, <span class="keyword">const</span> ResourceHolder* holder,</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                      <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        : <a class="code" href="classion_1_1gfx_1_1_resource_base.html#abd0637110d81f9e4e1991182c925d04e">ResourceBase</a>(holder, key),</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;          index_(0),</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;          resource_manager_(rm),</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;          gpu_memory_used_(0U) {}</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Release(<span class="keywordtype">bool</span> can_make_gl_calls) = 0;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Update(ResourceBinder* rb) = 0;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Unbind(ResourceBinder* rb) = 0;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keyword">virtual</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a> GetType() <span class="keyword">const</span> = 0;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordtype">void</span> SetUsedGpuMemory(<span class="keywordtype">size_t</span> count) {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a> type = GetType();</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> old_used = gpu_memory_used_.load();</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      resource_manager_-&gt;IncreaseGpuMemoryUsage(type, count);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      resource_manager_-&gt;DecreaseGpuMemoryUsage(type, old_used);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="keywordflow">if</span> (resource_manager_-&gt;GetAllocator().Get() &amp;&amp;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          resource_manager_-&gt;GetAllocator()-&gt;GetTracker().Get() &amp;&amp;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;          resource_manager_-&gt;GetAllocator()</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;              -&gt;GetTracker()</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;              -&gt;GetGpuTracker()</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;              .Get()) {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceion_1_1base.html#ab2c3e3e952284ecabd82c1e941c93f28">base::AllocationSizeTrackerPtr</a>&amp; global_gpu_tracker =</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            resource_manager_-&gt;GetAllocator()-&gt;GetTracker()-&gt;GetGpuTracker();</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        UpdateAllocationSizeTracker(global_gpu_tracker, count, old_used);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      }</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()-&gt;GetTracker().Get() &amp;&amp;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          <a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()-&gt;GetTracker()-&gt;GetGpuTracker().Get()) {</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceion_1_1base.html#ab2c3e3e952284ecabd82c1e941c93f28">base::AllocationSizeTrackerPtr</a>&amp; gpu_tracker =</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()-&gt;<a class="code" href="classion_1_1base_1_1_allocator.html#a182a6de600883f0ad16ff31a537d8571">GetTracker</a>()-&gt;<a class="code" href="classion_1_1base_1_1_allocation_tracker.html#a087f02cd46f4551363caef5f6b7201ee">GetGpuTracker</a>();</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        UpdateAllocationSizeTracker(gpu_tracker, count, old_used);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      gpu_memory_used_ = count;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keyword">typename</span> HolderToResource&lt;HolderType&gt;::ResourceType* GetResource(</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keyword">const</span> HolderType* holder, ResourceBinder* binder, GLuint gl_id = 0) {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(resource_manager_);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">return</span> resource_manager_-&gt;GetResource(holder, binder, gl_id);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordtype">void</span> UnbindAll() {</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      base::ReadLock read_lock(GetResourceBinderLock());</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <a class="code" href="namespaceion_1_1base.html#ab470a11cceef7441df42bf6f489a69e5">base::ReadGuard</a> read_guard(&amp;read_lock);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      ResourceBinderMap&amp; binders = GetResourceBinderMap();</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="keywordflow">for</span> (ResourceBinderMap::iterator it = binders.begin();</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;           it != binders.end();</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;           ++it)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        Unbind(it-&gt;second.get());</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   <span class="keyword">private</span>:</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordtype">void</span> SetIndex(<span class="keywordtype">size_t</span> index) { index_ = index; }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordtype">size_t</span> GetIndex()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> index_; }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordtype">void</span> UpdateAllocationSizeTracker(</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceion_1_1base.html#ab2c3e3e952284ecabd82c1e941c93f28">base::AllocationSizeTrackerPtr</a>&amp; tracker, <span class="keywordtype">size_t</span> count,</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordtype">size_t</span> old_used) {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordflow">if</span> (count) tracker-&gt;TrackAllocationSize(count);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keywordflow">if</span> (old_used) tracker-&gt;TrackDeallocationSize(old_used);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordtype">size_t</span> index_;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    ResourceManager* resource_manager_;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    std::atomic&lt;size_t&gt; gpu_memory_used_;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keyword">friend</span> <span class="keyword">class </span>ResourceBinder;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keyword">friend</span> <span class="keyword">class </span>Renderer::ResourceManager;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  };</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="keyword">typedef</span> base::AllocVector&lt;Resource*&gt; ResourceVector;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keyword">class </span>ResourceAccessor;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keyword">class </span>ResourceContainer : <span class="keyword">public</span> <a class="code" href="classion_1_1base_1_1_allocatable.html#a1b65140be876e9bb2e7bba08ed3b69b4">Allocatable</a> {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;   <span class="keyword">public</span>:</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    ResourceContainer() : resources_(*this) {}</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;   <span class="keyword">private</span>:</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keyword">friend</span> <span class="keyword">class </span>ResourceAccessor;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    port::Mutex <a class="code" href="freetypefont_8cc.html#ab1b7efa1bbe0578df2c74e7c31a79a92">mutex_</a>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    ResourceVector resources_;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  };</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keyword">class </span>ResourceAccessor {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   <span class="keyword">public</span>:</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keyword">explicit</span> ResourceAccessor(ResourceContainer&amp; container)  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        : container_(container),</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;          owns_lock_(true) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      container_.mutex_.Lock();</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    ResourceAccessor(ResourceAccessor&amp; other)  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        : container_(other.container_),</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;          owns_lock_(true) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      other.owns_lock_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    ~ResourceAccessor() {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="keywordflow">if</span> (owns_lock_)</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        container_.mutex_.Unlock();</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    ResourceVector&amp; GetResources() { <span class="keywordflow">return</span> container_.resources_; }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;   <span class="keyword">private</span>:</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    ResourceContainer&amp; container_;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordtype">bool</span> owns_lock_;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  };</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keyword">explicit</span> <a class="code" href="classion_1_1gfx_1_1_resource_manager.html#ad9c0dafbfca720ab47ef9748c5452972">ResourceManager</a>(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a443fc9334fbde5d43d4df744d4d8a9f5">GraphicsManagerPtr</a>&amp; gm)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      : gfx::<a class="code" href="classion_1_1gfx_1_1_resource_manager.html#ad9c0dafbfca720ab47ef9748c5452972">ResourceManager</a>(gm),</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        resource_index_(AcquireOrReleaseResourceIndex(false, 0U)),</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        memory_usage_(*this),</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        resources_to_release_(*this) {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    memory_usage_.resize(<a class="code" href="classion_1_1gfx_1_1_renderer.html#ac114f7e665e2dc43ae183edae3f684ce">kNumResourceTypes</a>);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    ResourceAccessor(resources_[<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a984a3857aee726e827404bd6bf6acf0f">kAttributeArray</a>]).GetResources().reserve(128U);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    ResourceAccessor(resources_[<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48af218895b0ea64fb55e541c7a266d3b89">kBufferObject</a>]).GetResources().reserve(128U);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    ResourceAccessor(resources_[<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a5541dbcaa8a562a504dff0b911fee221">kFramebufferObject</a>]).GetResources().reserve(</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        16U);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    ResourceAccessor(resources_[<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a2fc332037c1a96c6a14cf89e02c447b5">kSampler</a>]).GetResources().reserve(32U);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    ResourceAccessor(resources_[<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a85ad8164455e6994e3304e287c9df6bc">kShaderInputRegistry</a>]).GetResources().reserve(</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        16U);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    ResourceAccessor(resources_[<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a8e60defeac9388416b220d35aa41f750">kShaderProgram</a>]).GetResources().reserve(16U);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    ResourceAccessor(resources_[<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a813a96489fc6982cfca789dae313c193">kShader</a>]).GetResources().reserve(16U);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    ResourceAccessor(resources_[<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a4c2dda32f304492a88754518cf801811">kTexture</a>]).GetResources().reserve(128U);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  ~<a class="code" href="classion_1_1gfx_1_1_resource_manager.html#ad9c0dafbfca720ab47ef9748c5452972">ResourceManager</a>()<span class="keyword"> override </span>{}</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordtype">size_t</span> GetResourceIndex()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> resource_index_; }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  ResourceAccessor AccessResources(<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a> type) {</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    ResourceAccessor accessor(resources_[type]);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">return</span> accessor;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> GetResourceKey(ResourceBinder* resource_binder,</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                             <span class="keyword">const</span> ResourceHolder* holder) {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a><span class="keyword">&gt;</span>(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  }</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  std::vector&lt;ResourceKey&gt; GetAllResourceKeys(ResourceBinder* resource_binder) {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    std::vector&lt;ResourceKey&gt; keys;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    keys.push_back(GetResourceKey&lt;T&gt;(resource_binder, <span class="keyword">nullptr</span>));</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">return</span> keys;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  }</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keyword">typename</span> HolderToResource&lt;HolderType&gt;::ResourceType* GetResource(</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="keyword">const</span> HolderType* holder, ResourceBinder* resource_binder,</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      GLuint gl_id = 0);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keywordtype">void</span> IncreaseGpuMemoryUsage(<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a> type, <span class="keywordtype">size_t</span> count) {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    memory_usage_[<a class="code" href="printer_8cc.html#a75b160f574a0be26114bae2c7686a5e1">type</a>].value += count;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keywordtype">void</span> DecreaseGpuMemoryUsage(<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a> type, <span class="keywordtype">size_t</span> count) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <a class="code" href="base_2logging_8h.html#a4395e95bab44e222cb2e77251017a0e2">DCHECK_LE</a>(count, memory_usage_[type].<a class="code" href="benchmarkutils_8cc.html#aee90379adb0307effb138f4871edbc5c">value</a>.load());</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    memory_usage_[<a class="code" href="printer_8cc.html#a75b160f574a0be26114bae2c7686a5e1">type</a>].value -= count;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  }</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a6f54e85cc8adc7230686c24b81f6cfce">GetGpuMemoryUsage</a>(<a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a> type)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">return</span> memory_usage_[<a class="code" href="printer_8cc.html#a75b160f574a0be26114bae2c7686a5e1">type</a>].value.load();</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  }</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordtype">void</span> DisassociateElementBufferFromArrays(BufferResource* resource);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keywordtype">void</span> AddResource(Resource* resource) {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    ResourceAccessor accessor(resources_[resource-&gt;GetType()]);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    ResourceVector&amp; resources = accessor.GetResources();</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    resource-&gt;SetIndex(resources.size());</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    resources.push_back(resource);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="keywordtype">void</span> MarkForRelease(Resource* resource) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <a class="code" href="namespaceion_1_1base.html#aa3d42b89a77ac34d6dff5e676032778b">base::LockGuard</a> locker(&amp;release_mutex_);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(resource);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    resources_to_release_.push_back(resource);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="keywordtype">void</span> DestroyResource(Resource* resource) {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(resource);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    ResourceAccessor accessor(resources_[resource-&gt;GetType()]);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    ResourceVector&amp; resources = accessor.GetResources();</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_resources = resources.size();</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordflow">if</span> (num_resources &gt; 1U) {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> index = resource-&gt;GetIndex();</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keywordflow">if</span> (resources[index] == resource) {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        Resource* moved_resource = resources[num_resources - 1U];</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        resources[index] = moved_resource;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        moved_resource-&gt;SetIndex(index);</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        resources.resize(num_resources - 1U);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      }</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (num_resources == 1U) {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      <span class="keywordflow">if</span> (resources[0] == resource)</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        resources.clear();</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a461f0570b14d2a978dcb90b9434abe32">ReleaseResources</a>(<span class="keyword">const</span> HolderType* holder, ResourceBinder* binder) {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keyword">typedef</span> <span class="keyword">typename</span> HolderToResource&lt;HolderType&gt;::ResourceType <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">if</span> (holder) {</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="keyword">const</span> std::vector&lt;ResourceKey&gt; keys =</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;          GetAllResourceKeys&lt;ResourceType&gt;(binder);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key : keys) {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <span class="keywordflow">if</span> (ResourceBase* resource =</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            holder-&gt;GetResource(resource_index_, key)) {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          resource-&gt;OnDestroyed();</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      ReleaseAll(binder);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    }</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordtype">void</span> ReleaseTypedResources(ResourceType type) {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    ResourceAccessor accessor(resources_[type]);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    ResourceVector&amp; resources = accessor.GetResources();</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> resource : resources) {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      resource-&gt;OnDestroyed();</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  }</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keywordtype">void</span> ReleaseAll(ResourceBinder* resource_binder) {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> can_make_gl_calls = <a class="code" href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">portgfx::Visual::GetCurrent</a>() != <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      ResourceVector resources_to_destroy(*<span class="keyword">this</span>);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <a class="code" href="namespaceion_1_1base.html#aa3d42b89a77ac34d6dff5e676032778b">base::LockGuard</a> locker(&amp;release_mutex_);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keywordflow">for</span> (Resource* resource : resources_to_release_) {</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;          resource-&gt;Release(can_make_gl_calls);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;          resources_to_destroy.push_back(resource);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          DestroyResource(resource);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        resources_to_release_.clear();</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="keywordflow">for</span> (Resource* resource : resources_to_destroy)</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keyword">delete</span> resource;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <a class="code" href="namespaceion_1_1base.html#aa3d42b89a77ac34d6dff5e676032778b">base::LockGuard</a> locker(&amp;release_mutex_);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="keywordflow">if</span> (resources_to_release_.empty())</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    }</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keywordtype">void</span> DestroyAllResources() {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> can_make_gl_calls = <a class="code" href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">portgfx::Visual::GetCurrent</a>() != <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ac114f7e665e2dc43ae183edae3f684ce">kNumResourceTypes</a>; ++i) {</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      ResourceAccessor accessor(resources_[i]);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      ResourceVector&amp; resources = accessor.GetResources();</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="keywordflow">for</span> (Resource* resource : resources) {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        resource-&gt;Release(can_make_gl_calls);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keyword">delete</span> resource;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      resources.clear();</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    }</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    AcquireOrReleaseResourceIndex(<span class="keyword">true</span>, resource_index_);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> ProcessDataRequests()  {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <a class="code" href="namespaceion_1_1base.html#aa3d42b89a77ac34d6dff5e676032778b">base::LockGuard</a> guard(&amp;this-&gt;request_mutex_);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    std::vector&lt;DataRequest&lt;T&gt; &gt;&amp; requests = *GetDataRequestVector&lt;T&gt;();</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> request_count = requests.size();</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    std::vector&lt;T&gt; infos(1);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; request_count; ++i) {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <a class="code" href="class_t.html">T</a> info;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      FillDataFromRenderer(requests[i].<span class="keywordtype">id</span>, &amp;info);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <a class="code" href="classion_1_1gfx_1_1_resource_manager.html#a392a07a92965295fa8ebd714f27fb4a4">FillInfoFromOpenGL</a>(&amp;info);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      infos[0] = info;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      requests[i].callback(infos);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    }</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    requests.clear();</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  }</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType, <span class="keyword">typename</span> InfoType&gt;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="keywordtype">void</span> ProcessInfoRequests(ResourceContainer* resource_container,</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                           ResourceBinder* resource_binder) {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <a class="code" href="namespaceion_1_1base.html#aa3d42b89a77ac34d6dff5e676032778b">base::LockGuard</a> guard(&amp;this-&gt;request_mutex_);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    std::vector&lt;ResourceRequest&lt;HolderType, InfoType&gt; &gt;&amp; requests =</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        *GetResourceRequestVector&lt;HolderType, InfoType&gt;();</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> request_count = requests.size();</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; request_count; ++i)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      ProcessInfoRequest&lt;HolderType, InfoType&gt;(requests[i], resource_container,</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                                               resource_binder);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    requests.clear();</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  }</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType, <span class="keyword">typename</span> InfoType&gt;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordtype">void</span> ProcessInfoRequest(<span class="keyword">const</span> ResourceRequest&lt;HolderType, InfoType&gt;&amp; request,</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                          ResourceContainer* resource_container,</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                          ResourceBinder* resource_binder) {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keyword">typedef</span> <span class="keyword">typename</span> HolderToResource&lt;HolderType&gt;::ResourceType <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    std::vector&lt;InfoType&gt; infos;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">if</span> (request.holder.Get()) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="keywordflow">if</span> (ResourceType* resource =</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;              GetResource(request.holder.Get(), resource_binder))</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        AppendResourceInfo(&amp;infos, resource, resource_binder);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      ResourceAccessor accessor(*resource_container);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      ResourceVector&amp; resources = accessor.GetResources();</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="keyword">const</span> std::vector&lt;ResourceKey&gt; keys =</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;          GetAllResourceKeys&lt;ResourceType&gt;(resource_binder);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      std::unordered_set&lt;ResourceKey&gt; key_set(keys.begin(), keys.end());</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordflow">for</span> (Resource* resource : resources) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">if</span> (key_set.find(resource-&gt;GetKey()) != key_set.end()) {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;          ResourceType* typed_resource = <span class="keyword">static_cast&lt;</span>ResourceType*<span class="keyword">&gt;</span>(resource);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;          AppendResourceInfo(&amp;infos, typed_resource, resource_binder);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        }</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      }</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    request.callback(infos);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InfoType, <span class="keyword">typename</span> ResourceType&gt;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="keywordtype">void</span> AppendResourceInfo(std::vector&lt;InfoType&gt;* infos,</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                          ResourceType* resource, ResourceBinder* rb) {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    InfoType info;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    resource-&gt;Bind(rb);</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    info.id = resource-&gt;GetId();</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    info.label = resource-&gt;GetHolder()-&gt;GetLabel();</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    FillInfoFromResource(&amp;info, resource, rb);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_resource_manager.html#a392a07a92965295fa8ebd714f27fb4a4">FillInfoFromOpenGL</a>(&amp;info);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    resource-&gt;Unbind(rb);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    infos-&gt;push_back(info);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InfoType, <span class="keyword">typename</span> ResourceType&gt;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="keywordtype">void</span> FillInfoFromResource(InfoType* info, ResourceType* resource,</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                            ResourceBinder* rb) {}</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InfoType&gt;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keywordtype">void</span> FillDataFromRenderer(GLuint <span class="keywordtype">id</span>, InfoType* info);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#aed5eca10b4c97950bf65af9b88414b4f">ProcessResourceInfoRequests</a>(ResourceBinder* resource_binder);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="keyword">struct </span>AtomicSizeT {</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    AtomicSizeT() : <a class="code" href="benchmarkutils_8cc.html#aee90379adb0307effb138f4871edbc5c">value</a>(0U) {}</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    AtomicSizeT(<span class="keyword">const</span> AtomicSizeT&amp; other) : <a class="code" href="benchmarkutils_8cc.html#aee90379adb0307effb138f4871edbc5c">value</a>(other.<a class="code" href="benchmarkutils_8cc.html#aee90379adb0307effb138f4871edbc5c">value</a>.load()) {}</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    AtomicSizeT&amp; <a class="code" href="classion_1_1base_1_1_allocatable.html#adeca96d4002bdb25bc780f693c3e0a75">operator=</a>(<span class="keyword">const</span> AtomicSizeT&amp; other) {</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <a class="code" href="benchmarkutils_8cc.html#aee90379adb0307effb138f4871edbc5c">value</a> = other.value.load();</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    std::atomic&lt;size_t&gt; <a class="code" href="benchmarkutils_8cc.html#aee90379adb0307effb138f4871edbc5c">value</a>;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  };</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">size_t</span> AcquireOrReleaseResourceIndex(<span class="keywordtype">bool</span> is_release, <span class="keywordtype">size_t</span> index) {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keyword">typedef</span> std::set&lt;size_t&gt; IndexSet;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <a class="code" href="staticsafedeclare_8h.html#aa0c4d1e0fc76f7ea923240084c166b4c">ION_DECLARE_SAFE_STATIC_POINTER</a>(port::Mutex, mutex);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <a class="code" href="staticsafedeclare_8h.html#aa0c4d1e0fc76f7ea923240084c166b4c">ION_DECLARE_SAFE_STATIC_POINTER</a>(IndexSet, used_indices);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <a class="code" href="namespaceion_1_1base.html#aa3d42b89a77ac34d6dff5e676032778b">base::LockGuard</a> guard(mutex);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordtype">size_t</span> new_index = index;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    IndexSet::const_iterator end = used_indices-&gt;end();</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">if</span> (is_release) {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      IndexSet::iterator it = used_indices-&gt;find(index);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(it != end);</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      used_indices-&gt;erase(it);</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      new_index = 0U;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="keywordflow">while</span> (used_indices-&gt;find(new_index) != end)</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        ++new_index;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      used_indices-&gt;insert(new_index);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordflow">return</span> new_index;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="keyword">typename</span> HolderToResource&lt;HolderType&gt;::ResourceType* CreateResource(</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="keyword">const</span> HolderType* holder, ResourceBinder* binder, <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key,</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      GLuint gl_id);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keywordtype">size_t</span> resource_index_;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  ResourceContainer resources_[<a class="code" href="classion_1_1gfx_1_1_renderer.html#ac114f7e665e2dc43ae183edae3f684ce">kNumResourceTypes</a>];</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  base::AllocVector&lt;AtomicSizeT&gt; memory_usage_;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  ResourceVector resources_to_release_;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  port::Mutex release_mutex_;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;};</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="keyword">class </span>Renderer::ResourceBinder : <span class="keyword">public</span> Allocatable {</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="keyword">typedef</span> base::AllocVector&lt;Uniform&gt; UniformStack;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keyword">struct </span>BufferBinding {</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    BufferBinding() : <a class="code" href="calltracemanager_8cc.html#ab3d71a3630661054e58116e2249c2e9e">buffer</a>(0U), resource(nullptr) {}</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    GLuint <a class="code" href="calltracemanager_8cc.html#ab3d71a3630661054e58116e2249c2e9e">buffer</a>;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    BufferResource* resource;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  };</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keyword">struct </span>ImageUnit {</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    ImageUnit() : sampler(0U), resource(nullptr) {}</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    GLuint sampler;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    TextureResource* resource;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  };</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="preprocessor">#if ION_PRODUCTION</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="preprocessor"></span>  <span class="keyword">class </span>StreamAnnotator : <span class="keyword">public</span> base::Allocatable {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keyword">public</span>:</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keyword">explicit</span> StreamAnnotator(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a443fc9334fbde5d43d4df744d4d8a9f5">GraphicsManagerPtr</a>&amp; gm) {}</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordtype">void</span> Push(<span class="keyword">const</span> std::string&amp; label) {}</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordtype">void</span> Pop() {}</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  };</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="preprocessor"></span>  <span class="keyword">class </span>StreamAnnotator : <span class="keyword">public</span> base::Allocatable {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;   <span class="keyword">public</span>:</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="keyword">explicit</span> StreamAnnotator(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a443fc9334fbde5d43d4df744d4d8a9f5">GraphicsManagerPtr</a>&amp; gm)</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        : gm_(gm),</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;          gl_supports_markers_(</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;              gm_-&gt;IsFunctionGroupAvailable(GraphicsManager::kDebugMarker)) {}</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordtype">void</span> Push(<span class="keyword">const</span> std::string&amp; marker) {</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="keywordflow">if</span> (std::ostream* out = gm_-&gt;GetTracingStream())</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        *out &lt;&lt; std::string(<a class="code" href="resourcehandler_8cc.html#a3999ffc0ef0ce38e233111591785f7d9">indent_</a>.length(), <span class="charliteral">&#39;-&#39;</span>) &lt;&lt; <span class="stringliteral">&quot;&gt;&quot;</span> &lt;&lt; marker &lt;&lt; <span class="stringliteral">&quot;:\n&quot;</span>;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <a class="code" href="resourcehandler_8cc.html#a3999ffc0ef0ce38e233111591785f7d9">indent_</a> += <span class="stringliteral">&quot;  &quot;</span>;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      gm_-&gt;SetTracingPrefix(<a class="code" href="resourcehandler_8cc.html#a3999ffc0ef0ce38e233111591785f7d9">indent_</a>);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="keywordflow">if</span> (gl_supports_markers_)</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        gm_-&gt;PushGroupMarker(static_cast&lt;GLsizei&gt;(marker.length()),</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                             marker.c_str());</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordtype">void</span> Pop() {</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="calltracemanager_8cc.html#ae4f719e9aed394c364b0e8c7dbb2e67a">length</a> = <a class="code" href="resourcehandler_8cc.html#a3999ffc0ef0ce38e233111591785f7d9">indent_</a>.length()) {</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        <span class="keywordflow">if</span> (gl_supports_markers_)</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;          gm_-&gt;PopGroupMarker();</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <a class="code" href="resourcehandler_8cc.html#a3999ffc0ef0ce38e233111591785f7d9">indent_</a> = <a class="code" href="resourcehandler_8cc.html#a3999ffc0ef0ce38e233111591785f7d9">indent_</a>.substr(0, <a class="code" href="calltracemanager_8cc.html#ae4f719e9aed394c364b0e8c7dbb2e67a">length</a> - 2U);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        gm_-&gt;SetTracingPrefix(<a class="code" href="resourcehandler_8cc.html#a3999ffc0ef0ce38e233111591785f7d9">indent_</a>);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      }</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    }</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;   <span class="keyword">private</span>:</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <a class="code" href="namespaceion_1_1gfx.html#a443fc9334fbde5d43d4df744d4d8a9f5">GraphicsManagerPtr</a> gm_;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    std::string <a class="code" href="resourcehandler_8cc.html#a3999ffc0ef0ce38e233111591785f7d9">indent_</a>;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> gl_supports_markers_;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  };</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <span class="keyword">class </span>InfoRequestGuard {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;   <span class="keyword">public</span>:</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keyword">explicit</span> InfoRequestGuard(ResourceBinder* rb)</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      : rb_(rb) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      rb_-&gt;processing_info_requests_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    }</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    ~InfoRequestGuard() {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      rb_-&gt;processing_info_requests_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;   <span class="keyword">private</span>:</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    ResourceBinder* rb_;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  };</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="keyword">explicit</span> ResourceBinder(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a443fc9334fbde5d43d4df744d4d8a9f5">GraphicsManagerPtr</a>&amp; gm)</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      : graphics_manager_(gm),</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        stream_annotator_(new (<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()) StreamAnnotator(gm)),</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        image_units_(*this),</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        texture_last_bindings_(*this),</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        active_image_unit_(kInvalidGluint),</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        active_framebuffer_(kInvalidGluint),</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        active_framebuffer_resource_(nullptr),</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        active_shader_id_(0U),</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        active_shader_resource_(nullptr),</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        active_vertex_array_(0U),</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        active_vertex_array_resource_(nullptr),</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        current_shader_program_(nullptr),</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        vertex_array_keys_(*this),</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        gl_state_table_(new (<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()) StateTable(0, 0)),</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        client_state_table_(new (<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()) StateTable(0, 0)),</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        traversal_state_tables_(*this),</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        current_traversal_index_(0U),</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        processing_info_requests_(false) {</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    memset(saved_ids_, 0, <span class="keyword">sizeof</span>(saved_ids_));</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    saved_state_table_ = <span class="keyword">new</span> (<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()) StateTable();</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">if</span> (gm-&gt;GetGlApiStandard() == <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#afe483c6cc2e75618b57e9269e5cd7628a3c9133c01de9c071adfb3db11f38b1d3">GraphicsManager::kDesktop</a>) {</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      <span class="keywordflow">if</span> (gm-&gt;GetGlProfileType() != <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#af20512ea9ca4ca9eaca3411f59bffe61aa0d790c20a0a9c6227b562b26ba37853">GraphicsManager::kCoreProfile</a>)</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        gm-&gt;Enable(<a class="code" href="glheaders_8h.html#aa9c2d29fbaccd5badfc18959375c7d74">GL_POINT_SPRITE</a>);</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      gm-&gt;Enable(GL_PROGRAM_POINT_SIZE);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    }</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_renderer.html#ac1c04abbc2f2b2a68d8c5a37ac55b392">UpdateDefaultFramebufferFromOpenGL</a>();</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> max_image_units = <a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">GetGraphicsManager</a>()-&gt;GetCapabilityValue&lt;<span class="keywordtype">int</span>&gt;(</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#a5739ea2401844cf4db67bf82349bc13daacf37b197f8db1eb8eb8633d34cf293f">GraphicsManager::kMaxTextureImageUnits</a>);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    image_units_.resize(max_image_units);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    texture_manager_.reset(<span class="keyword">new</span> (<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>())</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                               TextureManager(max_image_units));</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(texture_manager_.get());</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    traversal_state_tables_.resize(16);</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; 16U; ++i)</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      traversal_state_tables_[i] = <span class="keyword">new</span>(<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()) StateTable;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  }</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  ~ResourceBinder()<span class="keyword"> override </span>{}</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ac1c04abbc2f2b2a68d8c5a37ac55b392">UpdateDefaultFramebufferFromOpenGL</a>() {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">GetGraphicsManager</a>()-&gt;GetIntegerv(GL_FRAMEBUFFER_BINDING,</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                                      GetSavedId(<a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04add695796ee0afeb78859849f893278ac">Renderer::kSaveFramebuffer</a>));</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a443fc9334fbde5d43d4df744d4d8a9f5">GraphicsManagerPtr</a>&amp; <a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">GetGraphicsManager</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordflow">return</span> graphics_manager_;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  TextureManager* GetTextureManager()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> texture_manager_.get(); }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  ResourceManager* <a class="code" href="classion_1_1gfx_1_1_renderer.html#aa71c7f5c7a6cc8b71ab0a0d713a7781b">GetResourceManager</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> resource_manager_; }</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="keywordtype">void</span> SetResourceManager(ResourceManager* manager) {</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    resource_manager_ = manager;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  }</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  StreamAnnotator* GetStreamAnnotator()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordflow">return</span> stream_annotator_.get();</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  }</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a4394f60096b9d80558dd2cf5c32433bb">FramebufferObjectPtr</a> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a31b7860918be8b91265255f0bbad4d64">GetCurrentFramebuffer</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordflow">return</span> current_fbo_.Acquire();</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  }</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="keywordtype">void</span> SetCurrentFramebuffer(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a4394f60096b9d80558dd2cf5c32433bb">FramebufferObjectPtr</a>&amp; fbo) {</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    current_fbo_ = base::WeakReferentPtr&lt;FramebufferObject&gt;(fbo);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  }</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  ShaderProgramResource* GetActiveShaderProgram()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">return</span> active_shader_resource_;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  }</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  FramebufferResource* GetActiveFramebuffer()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordflow">return</span> active_framebuffer_resource_;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  }</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  VertexArrayResource* GetActiveVertexArray()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">return</span> active_vertex_array_resource_;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  }</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keywordtype">void</span> SetActiveVertexArray(VertexArrayResource* resource) {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    active_vertex_array_resource_ = resource;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  }</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  StateTable* <a class="code" href="classion_1_1gfx_1_1_renderer.html#a0f79fd68a46a70be60799714f1213365">GetStateTable</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> gl_state_table_.Get(); }</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <span class="keywordtype">void</span> BindBuffer(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521">BufferObject::Target</a> target, GLuint <span class="keywordtype">id</span>,</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                  BufferResource* resource);</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a2d8dcaec87d0c04f51726301060fcfd5">BindFramebuffer</a>(GLuint <span class="keywordtype">id</span>, FramebufferResource* fbo);</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="keywordtype">bool</span> BindProgram(GLuint <span class="keywordtype">id</span>, ShaderProgramResource* resource);</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <span class="keywordtype">void</span> BindSamplerToUnit(GLuint <span class="keywordtype">id</span>, GLuint unit) {</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(unit, image_units_.size());</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keywordflow">if</span> (!<span class="keywordtype">id</span> || <span class="keywordtype">id</span> != image_units_[unit].sampler) {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      image_units_[unit].sampler = <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">GetGraphicsManager</a>()-&gt;BindSampler(unit, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    }</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  }</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="keywordtype">void</span> ActivateUnit(GLuint unit);</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="keywordtype">void</span> BindTextureToUnit(TextureResource* resource, GLuint unit);</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordtype">bool</span> WasTextureEvicted(TextureResource* resource) {</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="keyword">auto</span> found = texture_last_bindings_.find(resource);</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordflow">if</span> (found == texture_last_bindings_.end())</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordflow">if</span> (image_units_[found-&gt;second].resource == resource)</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  }</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  <span class="keywordtype">int</span> GetLastBoundUnit(TextureResource* resource) {</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="keyword">auto</span> found = texture_last_bindings_.find(resource);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keywordflow">if</span> (found != texture_last_bindings_.end())</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      <span class="keywordflow">return</span> found-&gt;second;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  }</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="keywordtype">void</span> ClearAssignedImageUnit(TextureResource* resource) {</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    texture_last_bindings_.erase(resource);</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  }</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="keywordtype">void</span> BindVertexArray(GLuint <span class="keywordtype">id</span>, VertexArrayResource* resource);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <span class="keywordtype">void</span> ClearBufferBinding(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521">BufferObject::Target</a> target, GLuint <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">if</span> (!<span class="keywordtype">id</span> || <span class="keywordtype">id</span> == active_buffers_[target].<a class="code" href="calltracemanager_8cc.html#ab3d71a3630661054e58116e2249c2e9e">buffer</a>) {</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      active_buffers_[target].buffer = 0;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      active_buffers_[target].resource = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    }</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  }</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="keywordtype">void</span> ClearFramebufferBinding(GLuint <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="keywordflow">if</span> (!<span class="keywordtype">id</span> || <span class="keywordtype">id</span> == active_framebuffer_) {</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      active_framebuffer_ = kInvalidGluint;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      active_framebuffer_resource_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    }</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  }</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordtype">void</span> ClearProgramBinding(GLuint <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keywordflow">if</span> (!<span class="keywordtype">id</span> || <span class="keywordtype">id</span> == active_shader_id_) {</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      active_shader_id_ = 0;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      active_shader_resource_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    }</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  }</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <span class="keywordtype">void</span> ClearSamplerBindings(GLuint <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> count = image_units_.size();</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i)</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == image_units_[i].sampler)</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        image_units_[i].sampler = 0;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  }</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  <span class="keywordtype">void</span> ClearTextureBinding(GLuint <span class="keywordtype">id</span>, GLuint unit);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  <span class="keywordtype">void</span> ClearVertexArrayBinding(GLuint <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <span class="keywordtype">void</span> ClearNonFramebufferCachedBindings();</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#afae611dad38f36622bdd0a672624ee65">BindResource</a>(<span class="keyword">const</span> HolderType* holder) {</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keywordflow">if</span> (holder) {</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">typename</span> HolderToResource&lt;HolderType&gt;::ResourceType* resource =</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;          resource_manager_-&gt;GetResource(holder, <span class="keyword">this</span>)) {</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        resource-&gt;Update(<span class="keyword">this</span>);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      }</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    }</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  }</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  <span class="keyword">struct </span>CreateOrUpdateOp {</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> Process(ResourceBinder* rb, <span class="keyword">const</span> HolderType* holder,</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                        GLuint gl_id) {</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <span class="keywordflow">if</span> (holder) {</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="keyword">typename</span> HolderToResource&lt;HolderType&gt;::ResourceType* resource =</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            rb-&gt;GetResourceManager()-&gt;GetResource(holder, rb, gl_id);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keywordflow">if</span> (resource) {</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;          resource-&gt;UnbindAll();</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;          <span class="keywordflow">if</span> (resource-&gt;AnyModifiedBitsSet())</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;            resource-&gt;Update(rb);</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        }</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      }</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    }</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  };</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <span class="keyword">struct </span>RequestUpdateOp {</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> Process(ResourceBinder* rb, <span class="keyword">const</span> HolderType* holder,</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                        GLuint gl_id) {</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      <span class="keywordflow">if</span> (holder) {</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        Renderer::SetResourceHolderBit(holder,</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                                       <a class="code" href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488ea8cdf432d687b44c1099911986875a928">ResourceHolder::kResourceChanged</a>);</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        holder-&gt;Notify();</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      }</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    }</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  };</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Operation, <span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <span class="keyword">struct </span>OperationImpl {</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> Process(ResourceBinder* rb, <span class="keyword">const</span> HolderType* holder,</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                        GLuint gl_id) {</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      Operation::Process(rb, holder, gl_id);</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    }</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  };</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Operation&gt;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keyword">struct </span>OperationImpl&lt;Operation, AttributeArray&gt; {</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> Process(ResourceBinder* rb, <span class="keyword">const</span> AttributeArray* aa,</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                        GLuint gl_id) {</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      <span class="keywordflow">if</span> (aa == <span class="keyword">nullptr</span>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      std::set&lt;BufferObject*&gt; buffers;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> buffer_attribute_count = aa-&gt;GetBufferAttributeCount();</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; buffer_attribute_count; ++i) {</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keyword">const</span> Attribute&amp; a = aa-&gt;GetBufferAttribute(i);</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        <span class="keywordflow">if</span> (BufferObject* bo =</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                a.GetValue&lt;BufferObjectElement&gt;().buffer_object.Get()) {</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;          <span class="keywordflow">if</span> (buffers.find(bo) == buffers.end()) {</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;            Operation::Process(rb, bo, gl_id);</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;            buffers.insert(bo);</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;          }</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        }</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      }</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      GraphicsManager* gm = rb-&gt;GetGraphicsManager().Get();</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572ae6f498655e1baed043a1de831359babd">GraphicsManager::kVertexArrays</a>))</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        Operation::Process(rb, aa, gl_id);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        Operation::Process(rb,</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;            reinterpret_cast&lt;const AttributeArrayEmulator*&gt;(aa), gl_id);</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    }</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  };</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Operation, <span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <span class="keywordtype">void</span> Process(<span class="keyword">const</span> HolderType* holder, GLuint gl_id) {</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    OperationImpl&lt;Operation, HolderType&gt;::Process(<span class="keyword">this</span>, holder, gl_id);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  }</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Operation&gt;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="keywordtype">void</span> Traverse(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a07b06fd55473ad00ef896315ae2f6c46">NodePtr</a>&amp; node, ShaderProgram* default_shader);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Operation&gt;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="keywordtype">void</span> VisitShape(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a5ea05e2485675977e0cae4041a0e6296">ShapePtr</a>&amp; shape);</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab61f4bba7cbdf899a630cb940b8c57ef">ProcessStateTable</a>(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a3f928207085cb6063e1a767e5a27f8f0">StateTablePtr</a>&amp; state_table);</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a16f48925c0fae133716a1644b0a41cf8">ReadImage</a>(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#ae3b184481b6c5ff2c600931a262210ac">math::Range2i</a>&amp; range, <a class="code" href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9e">Image::Format</a> format,</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                           <span class="keyword">const</span> <a class="code" href="namespaceion_1_1base.html#a43c6663b5bdd5e5839eba0729b613c28">base::AllocatorPtr</a>&amp; allocator);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  <span class="keywordtype">void</span> SendUniform(<span class="keyword">const</span> Uniform&amp; uniform, <span class="keywordtype">int</span> location, GraphicsManager* gm);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="keywordtype">void</span> PushUniforms(<span class="keyword">const</span> Node* node,</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;                    <span class="keyword">const</span> base::AllocVector&lt;Uniform&gt;&amp; uniforms);</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  <span class="keywordtype">void</span> PopUniforms(<span class="keyword">const</span> base::AllocVector&lt;Uniform&gt;&amp; uniforms);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  GLint* GetSavedId(<a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04">Renderer::Flag</a> flag) {</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <a class="code" href="base_2logging_8h.html#a4395e95bab44e222cb2e77251017a0e2">DCHECK_LE</a>(<a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a8cf00f1c00e22197c13282cd7b815ce7">kSaveActiveTexture</a>, flag);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <a class="code" href="base_2logging_8h.html#a4395e95bab44e222cb2e77251017a0e2">DCHECK_LE</a>(flag, <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ad8ee0fd1040ce90f36495c105ce299fc">kSaveVertexArray</a>);</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <span class="keywordflow">return</span> &amp;saved_ids_[flag - <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a8cf00f1c00e22197c13282cd7b815ce7">kSaveActiveTexture</a>];</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  }</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <span class="keywordtype">size_t</span> GetImageUnitCount()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> image_units_.size(); }</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="keywordtype">void</span> SetImageUnitRange(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a55c6c70c3e325850f7118620bcc879a2">Range1i</a>&amp; units) {</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> max_image_units = <a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">GetGraphicsManager</a>()-&gt;GetCapabilityValue&lt;<span class="keywordtype">int</span>&gt;(</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#a5739ea2401844cf4db67bf82349bc13daacf37b197f8db1eb8eb8633d34cf293f">GraphicsManager::kMaxTextureImageUnits</a>);</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keyword">const</span> GLuint count = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(GetImageUnitCount());</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordflow">for</span> (GLuint i = max_image_units; i &lt; count; ++i) {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      ClearTextureBinding(0U, i);</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    }</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    ClearSamplerBindings(0U);</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    texture_manager_-&gt;SetUnitRange(units);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  }</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a3294308f6647ada5a52464ed425ae421">MapBufferObjectDataRange</a>(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a461f30e6f866977271f2c9960237e30c">BufferObjectPtr</a>&amp; <a class="code" href="calltracemanager_8cc.html#ab3d71a3630661054e58116e2249c2e9e">buffer</a>,</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                                <a class="code" href="classion_1_1gfx_1_1_renderer.html#a374fccb25553f288d87f7a66f49cd045">BufferObjectDataMapMode</a> mode,</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                                <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">math::Range1ui</a>&amp; range_in);</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#aa683a2dcb3c87eb63815ddb3ee33bc88">UnmapBufferObjectData</a>(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a461f30e6f866977271f2c9960237e30c">BufferObjectPtr</a>&amp; <a class="code" href="calltracemanager_8cc.html#ab3d71a3630661054e58116e2249c2e9e">buffer</a>);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ac13a3bd2eb6fb1854ff2b1550c40dc54">DrawScene</a>(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a07b06fd55473ad00ef896315ae2f6c46">NodePtr</a>&amp; node, <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Flags</a>&amp; flags,</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                 ShaderProgram* default_shader);</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <span class="keywordtype">bool</span> IsProcessingInfoRequests()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> processing_info_requests_; }</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> GetVertexArrayKey() {</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="keyword">auto</span> key_iterator = vertex_array_keys_.find(GetActiveShaderProgram());</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="keywordflow">if</span> (key_iterator == vertex_array_keys_.end()) {</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;          &amp;*vertex_array_keys_.insert(GetActiveShaderProgram()).first);</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a><span class="keyword">&gt;</span>(&amp;*key_iterator);</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    }</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  }</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  std::vector&lt;ResourceKey&gt; GetAllVertexArrayKeys() {</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    std::vector&lt;ResourceKey&gt; keys;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;i : vertex_array_keys_) {</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      keys.push_back(reinterpret_cast&lt;ResourceKey&gt;(&amp;i));</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    }</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <span class="keywordflow">return</span> keys;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  }</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <span class="keywordtype">void</span> EraseVertexArrayKey(ShaderProgramResource *shader) {</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    vertex_array_keys_.erase(shader);</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  }</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="keywordtype">void</span> DrawNode(<span class="keyword">const</span> Node&amp; node, GraphicsManager* gm);</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="keywordtype">void</span> DrawShape(<span class="keyword">const</span> Shape&amp; shape, GraphicsManager* gm);</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="keywordtype">void</span> DrawIndexedShape(<span class="keyword">const</span> Shape&amp; shape, <span class="keyword">const</span> IndexBuffer&amp; ib,</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                        GraphicsManager* gm);</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="keywordtype">void</span> DrawNonindexedShape(<span class="keyword">const</span> Shape&amp; shape, <span class="keywordtype">size_t</span> <a class="code" href="gpuperformance_8cc.html#a72b34cdff63b637dbcd4849315a25601">vertex_count</a>,</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                           GraphicsManager* gm);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  <span class="keywordtype">void</span> MarkAttachmentImplicitlyChanged(</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="keyword">const</span> FramebufferObject::Attachment&amp; attachment);</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Operation&gt;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <span class="keywordtype">void</span> Visit(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a07b06fd55473ad00ef896315ae2f6c46">NodePtr</a>&amp; node);</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <a class="code" href="namespaceion_1_1gfx.html#a443fc9334fbde5d43d4df744d4d8a9f5">GraphicsManagerPtr</a> graphics_manager_;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  std::unique_ptr&lt;StreamAnnotator&gt; stream_annotator_;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  std::unique_ptr&lt;TextureManager&gt; texture_manager_;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  base::WeakReferentPtr&lt;FramebufferObject&gt; current_fbo_;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  base::AllocVector&lt;ImageUnit&gt; image_units_;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  base::AllocUnorderedMap&lt;TextureResource*, GLuint&gt; texture_last_bindings_;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  GLuint active_image_unit_;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  std::array&lt;BufferBinding, 4&gt; active_buffers_;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  GLuint active_framebuffer_;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  FramebufferResource* active_framebuffer_resource_;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  GLuint active_shader_id_;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  ShaderProgramResource* active_shader_resource_;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  GLuint active_vertex_array_;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  VertexArrayResource* active_vertex_array_resource_;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  GLint</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;      saved_ids_[<a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ad8ee0fd1040ce90f36495c105ce299fc">Renderer::kSaveVertexArray</a> - <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a8cf00f1c00e22197c13282cd7b815ce7">Renderer::kSaveActiveTexture</a> + 1];</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <a class="code" href="namespaceion_1_1gfx.html#a3f928207085cb6063e1a767e5a27f8f0">StateTablePtr</a> saved_state_table_;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  ResourceManager* resource_manager_;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  ShaderProgram* current_shader_program_;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  base::AllocSet&lt;ShaderProgramResource*&gt; vertex_array_keys_;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  <a class="code" href="namespaceion_1_1gfx.html#a3f928207085cb6063e1a767e5a27f8f0">StateTablePtr</a> gl_state_table_;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;  <a class="code" href="namespaceion_1_1gfx.html#a3f928207085cb6063e1a767e5a27f8f0">StateTablePtr</a> client_state_table_;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  base::AllocVector&lt;StateTablePtr&gt; traversal_state_tables_;</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <span class="keywordtype">size_t</span> current_traversal_index_;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="keywordtype">bool</span> processing_info_requests_;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span>InfoRequestGuard;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;};</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> Renderer::ResourceManager::GetResourceKey&lt;</div>
<div class="line"><a name="l01602"></a><span class="lineno"><a class="line" href="namespaceion_1_1gfx.html#a863c1ee9a223449a53f7cd9bf625589c"> 1602</a></span>&#160;    Renderer::VertexArrayResource&gt;(ResourceBinder* resource_binder,</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_resource_holder.html">ResourceHolder</a>* holder) {</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="keywordflow">return</span> resource_binder-&gt;GetVertexArrayKey();</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;}</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;std::vector&lt;ResourceKey&gt; Renderer::ResourceManager::GetAllResourceKeys&lt;</div>
<div class="line"><a name="l01608"></a><span class="lineno"><a class="line" href="namespaceion_1_1gfx.html#a6d313619211ed439921a22f3da61309a"> 1608</a></span>&#160;    Renderer::VertexArrayResource&gt;(ResourceBinder* resource_binder) {</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="keywordflow">return</span> resource_binder-&gt;GetAllVertexArrayKeys();</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;}</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> Renderer::ResourceManager::GetResourceKey&lt;</div>
<div class="line"><a name="l01614"></a><span class="lineno"><a class="line" href="namespaceion_1_1gfx.html#a8f9f438eeb2385221988bb8d135a23d1"> 1614</a></span>&#160;    Renderer::VertexArrayEmulatorResource&gt;(ResourceBinder* resource_binder,</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_resource_holder.html">ResourceHolder</a>* holder) {</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="keywordflow">return</span> resource_binder-&gt;GetVertexArrayKey();</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;}</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;std::vector&lt;ResourceKey&gt; Renderer::ResourceManager::GetAllResourceKeys&lt;</div>
<div class="line"><a name="l01620"></a><span class="lineno"><a class="line" href="namespaceion_1_1gfx.html#ad56db70738b3ac2abfd8e82d3e983eeb"> 1620</a></span>&#160;    Renderer::VertexArrayEmulatorResource&gt;(ResourceBinder* resource_binder) {</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  <span class="keywordflow">return</span> resource_binder-&gt;GetAllVertexArrayKeys();</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;}</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> Renderer::ResourceManager::GetResourceKey&lt;</div>
<div class="line"><a name="l01626"></a><span class="lineno"><a class="line" href="namespaceion_1_1gfx.html#aa8ae4d0f3fcffb169db7cd89acd91323"> 1626</a></span>&#160;    Renderer::ShaderInputRegistryResource&gt;(ResourceBinder* resource_binder,</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_resource_holder.html">ResourceHolder</a>* holder) {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a><span class="keyword">&gt;</span>(resource_binder);</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;}</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> Renderer::ResourceManager::GetResourceKey&lt;</div>
<div class="line"><a name="l01633"></a><span class="lineno"><a class="line" href="namespaceion_1_1gfx.html#a1ef90be974eed95397e7d6d9a5017b6c"> 1633</a></span>&#160;    Renderer::FramebufferResource&gt;(ResourceBinder* resource_binder,</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_resource_holder.html">ResourceHolder</a>* holder) {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a><span class="keyword">&gt;</span>(resource_binder);</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;}</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> Renderer::ResourceManager::GetResourceKey&lt;</div>
<div class="line"><a name="l01640"></a><span class="lineno"><a class="line" href="namespaceion_1_1gfx.html#a15f31305e05c3d136230c5aa8969d846"> 1640</a></span>&#160;    Renderer::ShaderProgramResource&gt;(ResourceBinder* resource_binder,</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_resource_holder.html">ResourceHolder</a>* holder) {</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>* program = <span class="keyword">const_cast&lt;</span><a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>*<span class="keyword">&gt;</span>(holder));</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  program-&gt;<a class="code" href="classion_1_1gfx_1_1_shader_program.html#a4849800659a6ac8aa0d1092becd2ead8">SetConcurrent</a>(program-&gt;<a class="code" href="classion_1_1gfx_1_1_shader_program.html#ae25945c249b76bd9da62b5132d140480">IsConcurrent</a>());</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  <span class="keywordflow">if</span> (program-&gt;<a class="code" href="classion_1_1gfx_1_1_shader_program.html#ae25945c249b76bd9da62b5132d140480">IsConcurrent</a>()) {</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a><span class="keyword">&gt;</span>(resource_binder);</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a><span class="keyword">&gt;</span>(<span class="keyword">this</span>);</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  }</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;}</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;std::vector&lt;ResourceKey&gt; Renderer::ResourceManager::GetAllResourceKeys&lt;</div>
<div class="line"><a name="l01655"></a><span class="lineno"><a class="line" href="namespaceion_1_1gfx.html#a1d545078405b761fc053182565a4c214"> 1655</a></span>&#160;    Renderer::ShaderProgramResource&gt;(ResourceBinder* resource_binder) {</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;  std::vector&lt;ResourceKey&gt; keys;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;  keys.push_back(reinterpret_cast&lt;ResourceKey&gt;(resource_binder));</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  keys.push_back(reinterpret_cast&lt;ResourceKey&gt;(<span class="keyword">this</span>));</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  <span class="keywordflow">return</span> keys;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;}</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceManager::ProcessResourceInfoRequests(</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    ResourceBinder* resource_binder) {</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  ResourceBinder::InfoRequestGuard guard(resource_binder);</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  ProcessInfoRequests&lt;AttributeArray, ArrayInfo&gt;(&amp;resources_[kAttributeArray],</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                                                 resource_binder);</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  ProcessInfoRequests&lt;BufferObject, BufferInfo&gt;(&amp;resources_[kBufferObject],</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                                                resource_binder);</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  ProcessInfoRequests&lt;FramebufferObject, FramebufferInfo&gt;(</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      &amp;resources_[kFramebufferObject], resource_binder);</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  ProcessInfoRequests&lt;Sampler, SamplerInfo&gt;(&amp;resources_[kSampler],</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                                            resource_binder);</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  ProcessInfoRequests&lt;ShaderProgram, ProgramInfo&gt;(&amp;resources_[kShaderProgram],</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                                                  resource_binder);</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  ProcessInfoRequests&lt;Shader, ShaderInfo&gt;(&amp;resources_[kShader],</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                                          resource_binder);</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  ProcessInfoRequests&lt;TextureBase, TextureInfo&gt;(&amp;resources_[kTexture],</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                                                resource_binder);</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  ProcessDataRequests&lt;PlatformInfo&gt;();</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  ProcessDataRequests&lt;TextureImageInfo&gt;();</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;}</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="preprocessor">#if ION_PRODUCTION</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="preprocessor"></span><span class="keyword">class </span>Renderer::ScopedLabel {</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  ScopedLabel(ResourceBinder* binder, <span class="keyword">const</span> <span class="keywordtype">void</span>* address,</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;              <span class="keyword">const</span> std::string&amp; label) {}</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;};</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="preprocessor"></span><span class="keyword">class </span>Renderer::ScopedLabel {</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  ScopedLabel(ResourceBinder* rb, <span class="keyword">const</span> <span class="keywordtype">void</span>* address,</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;              <span class="keyword">const</span> std::string&amp; label)</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      : annotator_(rb-&gt;GetStreamAnnotator()),</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        needs_pop_(false) {</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <span class="keywordflow">if</span> (rb-&gt;GetGraphicsManager()-&gt;GetTracingStream() &amp;&amp; label.length()) {</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;      annotator_-&gt;Push(label + <span class="stringliteral">&quot; [&quot;</span> + <a class="code" href="namespaceion_1_1base.html#a38945775ca691f4c7e2d186567037995">base::ValueToString</a>(address) + <span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      needs_pop_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  }</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  ~ScopedLabel() {</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="keywordflow">if</span> (needs_pop_)</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      annotator_-&gt;Pop();</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  }</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  ResourceBinder::StreamAnnotator* annotator_;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="keywordtype">bool</span> needs_pop_;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;};</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">int</span> NumModifiedBits&gt;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="keyword">class </span>Renderer::Resource : <span class="keyword">public</span> Renderer::ResourceManager::Resource {</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  <span class="keyword">class </span>ScopedResourceLabel : <span class="keyword">public</span> ScopedLabel {</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;   <span class="keyword">public</span>:</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    ScopedResourceLabel(Resource* resource, ResourceBinder* binder)</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        : ScopedLabel(binder, resource-&gt;GetHolder(),</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                      resource-&gt;GetHolder()-&gt;GetLabel()) {}</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  };</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  ~Resource()<span class="keyword"> override </span>{ DetachFromHolder(); }</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  <span class="keywordtype">bool</span> AnyModifiedBitsSet()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> modified_bits_.any(); }</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  <span class="keywordtype">void</span> OnDestroyed()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    DetachFromHolder();</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classion_1_1gfx_1_1_renderer.html#aa71c7f5c7a6cc8b71ab0a0d713a7781b">GetResourceManager</a>())</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;      <a class="code" href="classion_1_1gfx_1_1_renderer.html#aa71c7f5c7a6cc8b71ab0a0d713a7781b">GetResourceManager</a>()-&gt;MarkForRelease(<span class="keyword">this</span>);</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  }</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  GLuint GetId()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> id_; }</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160; <span class="keyword">protected</span>:</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  <span class="keyword">typedef</span> Renderer::Resource&lt;NumModifiedBits&gt; BaseResourceType;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;  Resource(ResourceManager* rm, <span class="keyword">const</span> ResourceHolder&amp; holder, <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key,</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;           GLuint <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      : <a class="code" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">Renderer</a>::ResourceManager::Resource(rm, &amp;holder, key),</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        id_(id),</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        resource_owns_gl_id_(id == 0U) {</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    SetModifiedBits();</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    modified_bits_.reset(<a class="code" href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488ea8cdf432d687b44c1099911986875a928">ResourceHolder::kResourceChanged</a>);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;  }</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  GraphicsManager* <a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">GetGraphicsManager</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#aa71c7f5c7a6cc8b71ab0a0d713a7781b">GetResourceManager</a>()-&gt;<a class="code" href="classion_1_1gfx_1_1_resource_manager.html#a9357c226471835187825fb01a38b121d">GetGraphicsManager</a>().<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>();</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  }</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="keywordtype">bool</span> HasHolder()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">GetHolder</a>() != <span class="keyword">nullptr</span>; }</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="keywordtype">void</span> Release(<span class="keywordtype">bool</span> can_make_gl_calls)<span class="keyword"> override </span>{ DetachFromHolder(); }</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="keywordtype">void</span> OnChanged(<span class="keyword">const</span> <span class="keywordtype">int</span> bit)<span class="keyword"> override </span>{ modified_bits_.set(bit); }</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;  <span class="keywordtype">void</span> ResetModifiedBit(<span class="keywordtype">int</span> bit) { modified_bits_.reset(bit); }</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  <span class="keywordtype">void</span> ResetModifiedBits() { modified_bits_.reset(); }</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;  <span class="keywordtype">void</span> SetModifiedBit(<span class="keywordtype">int</span> bit) { modified_bits_.set(bit); }</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;  <span class="keywordtype">void</span> SetModifiedBits() { modified_bits_.set(); }</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="keywordtype">bool</span> TestModifiedBit(<span class="keywordtype">int</span> bit)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> modified_bits_.test(bit); }</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  <span class="keywordtype">bool</span> TestModifiedBitRange(<span class="keywordtype">int</span> low_bit, <span class="keywordtype">int</span> high_bit)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    std::bitset&lt;NumModifiedBits&gt; mask;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    mask.set();</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    mask &lt;&lt;= high_bit + 1 - low_bit;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    mask.flip();</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    mask &lt;&lt;= low_bit;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    <span class="keywordflow">return</span> (mask &amp; modified_bits_).any();</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  }</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  <span class="keyword">const</span> std::bitset&lt;NumModifiedBits&gt;&amp; GetBits()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> modified_bits_; }</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span>ResourceBinder;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  GLuint id_;</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> resource_owns_gl_id_;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  <span class="keywordtype">void</span> DetachFromHolder() {</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="keywordflow">if</span> (HasHolder()) {</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;      <span class="keyword">const</span> ResourceHolder* holder = <a class="code" href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">GetHolder</a>();</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> index = <a class="code" href="classion_1_1gfx_1_1_renderer.html#aa71c7f5c7a6cc8b71ab0a0d713a7781b">GetResourceManager</a>()-&gt;GetResourceIndex();</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      <span class="keywordflow">if</span> (holder-&gt;GetResource(index, <a class="code" href="classion_1_1gfx_1_1_resource_base.html#a0d9bf78832568e9213031e611b535c97">GetKey</a>()) == <span class="keyword">this</span>) {</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        holder-&gt;Notify();</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        holder-&gt;SetResource(index, <a class="code" href="classion_1_1gfx_1_1_resource_base.html#a0d9bf78832568e9213031e611b535c97">GetKey</a>(), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;      }</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    }</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  }</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  std::bitset&lt;NumModifiedBits&gt; modified_bits_;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;};</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="keyword">class </span>Renderer::SamplerResource : <span class="keyword">public</span> Resource&lt;Sampler::kNumChanges&gt; {</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  SamplerResource(ResourceBinder* rb, ResourceManager* rm,</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                  <span class="keyword">const</span> Sampler&amp; sampler, <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key, GLuint <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      : <a class="code" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">Renderer</a>::Resource&lt;Sampler::kNumChanges&gt;(rm, sampler, key, id) {}</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  ~SamplerResource()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(id_ == 0U || !<a class="code" href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">portgfx::Visual::GetCurrent</a>());</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  }</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;  <span class="keywordtype">void</span> Release(<span class="keywordtype">bool</span> can_make_gl_calls) <span class="keyword">override</span>;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  <span class="keywordtype">void</span> Update(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  ResourceType GetType()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a2fc332037c1a96c6a14cf89e02c447b5">kSampler</a>; }</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;  <span class="keywordtype">void</span> Bind(ResourceBinder* rb) { Update(rb); }</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;  <span class="keywordtype">void</span> Unbind(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;  <span class="keywordtype">void</span> BindToUnit(GLuint unit, ResourceBinder* rb);</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;  <span class="keyword">const</span> Sampler&amp; GetSampler()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>Sampler&amp;<span class="keyword">&gt;</span>(*<a class="code" href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">GetHolder</a>());</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  }</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;};</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="keywordtype">void</span> Renderer::SamplerResource::Update(ResourceBinder* rb) {</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <span class="keywordflow">if</span> (GetGraphicsManager()-&gt;IsFunctionGroupAvailable(</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;          <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a07b147f33c44e20d5dd40cc1f6bc2a50">GraphicsManager::kSamplerObjects</a>)) {</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keyword">const</span> Sampler&amp; sampler = GetSampler();</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">if</span> (AnyModifiedBitsSet()) {</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(gm);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      <span class="keywordflow">if</span> (!id_) gm-&gt;GenSamplers(1, &amp;id_);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;      <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aa1792af985e2c2d88c5c8f2511c6f6526">Sampler::kMaxAnisotropyChanged</a>) &amp;&amp;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;            gm-&gt;IsExtensionSupported(<span class="stringliteral">&quot;texture_filter_anisotropic&quot;</span>)) {</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">float</span> aniso =</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;              std::min(sampler.GetMaxAnisotropy(),</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                       gm-&gt;GetCapabilityValue&lt;<span class="keywordtype">float</span>&gt;(</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                           <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#a5739ea2401844cf4db67bf82349bc13da5763ea143ebbfd5187a93a48c9d661c5">GraphicsManager::kMaxTextureMaxAnisotropy</a>));</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;          gm-&gt;SamplerParameterf(id_, GL_TEXTURE_MAX_ANISOTROPY_EXT, aniso);</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        }</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aae21b0caacd2741a67912b48db5409b6d">Sampler::kMinFilterChanged</a>))</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;          gm-&gt;SamplerParameteri(</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;              id_, GL_TEXTURE_MIN_FILTER,</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;              <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(sampler.GetMinFilter()));</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aa6d547faf33e0aa241660002fb4c66215">Sampler::kMagFilterChanged</a>))</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;          gm-&gt;SamplerParameteri(</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;              id_, GL_TEXTURE_MAG_FILTER,</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;              <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(sampler.GetMagFilter()));</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;        <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aada2a9ef47f612b9e93cbf314e3f50972">Sampler::kWrapSChanged</a>))</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;          gm-&gt;SamplerParameteri(</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;              id_, GL_TEXTURE_WRAP_S,</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;              <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(sampler.GetWrapS()));</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;        <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aa1a7551f99458ee42e54709da97e2a69f">Sampler::kWrapTChanged</a>))</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;          gm-&gt;SamplerParameteri(</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;              id_, GL_TEXTURE_WRAP_T,</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;              <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(sampler.GetWrapT()));</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aac50b144c1addf71ed56d8c9255731152">Sampler::kCompareFunctionChanged</a>))</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;          gm-&gt;SamplerParameteri(</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;              id_, GL_TEXTURE_COMPARE_FUNC,</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;              <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(sampler.GetCompareFunction()));</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aafd006a0aab90a09eabd6b3e19666cc89">Sampler::kCompareModeChanged</a>))</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;          gm-&gt;SamplerParameteri(</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;              id_, GL_TEXTURE_COMPARE_MODE,</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;              sampler.GetCompareMode() == <a class="code" href="classion_1_1gfx_1_1_sampler.html#a66ea175f8ffb788a442c1e745117d525a8007ffb0199f0de3bef90a8adfbecb67">Sampler::kCompareToTexture</a></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                  ? GL_COMPARE_REF_TO_TEXTURE</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                  : GL_NONE);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aa4d39a2a9567057640c0d0054285e4981">Sampler::kMaxLodChanged</a>))</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;          gm-&gt;SamplerParameterf(id_, GL_TEXTURE_MAX_LOD, sampler.GetMaxLod());</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aaeb7b75f1cde86f4f1c840229836ba3cc">Sampler::kMinLodChanged</a>))</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;          gm-&gt;SamplerParameterf(id_, GL_TEXTURE_MIN_LOD, sampler.GetMinLod());</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aaf1f212ba118bf0400c80645a71e4a64d">Sampler::kWrapRChanged</a>))</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;          gm-&gt;SamplerParameteri(</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;              id_, GL_TEXTURE_WRAP_R,</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;              <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(sampler.GetWrapR()));</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        ResetModifiedBits();</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to create sampler object&quot;</span>;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      }</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    }</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  }</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;}</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="keywordtype">void</span> Renderer::SamplerResource::BindToUnit(GLuint unit, ResourceBinder* rb) {</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;  Update(rb);</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  <span class="keywordflow">if</span> (id_)</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    rb-&gt;BindSamplerToUnit(id_, unit);</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;}</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="keywordtype">void</span> Renderer::SamplerResource::Unbind(ResourceBinder* rb) {</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <span class="keywordflow">if</span> (id_ &amp;&amp; rb)</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    rb-&gt;ClearSamplerBindings(id_);</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;}</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="keywordtype">void</span> Renderer::SamplerResource::Release(<span class="keywordtype">bool</span> can_make_gl_calls) {</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  BaseResourceType::Release(can_make_gl_calls);</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    UnbindAll();</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <span class="keywordflow">if</span> (resource_owns_gl_id_ &amp;&amp; can_make_gl_calls)</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;      GetGraphicsManager()-&gt;DeleteSamplers(1, &amp;id_);</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    id_ = 0;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  }</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;}</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="keyword">class </span>Renderer::TextureResource : <span class="keyword">public</span> Resource&lt;CubeMapTexture::kNumChanges&gt; {</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;  TextureResource(ResourceBinder* rb, ResourceManager* rm,</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                  <span class="keyword">const</span> TextureBase&amp; <a class="code" href="fontimage_8cc.html#a05732ec89e3a90546399c62f2c7d90ac">texture</a>, <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key, GLuint <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      : <a class="code" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">Renderer</a>::Resource&lt;CubeMapTexture::kNumChanges&gt;(rm, texture, key, id),</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;        gl_target_(0),</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        last_uploaded_components_(0U),</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        auto_mipmapping_enabled_(false),</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        max_anisotropy_(0.f),</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        min_lod_(0.f),</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        max_lod_(0.f),</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        compare_function_(base::<a class="code" href="namespaceion_1_1base.html#a12d3865496a66b90d413b60dadc40407">InvalidEnumValue</a>&lt;Sampler::CompareFunction&gt;()),</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        compare_mode_(base::<a class="code" href="namespaceion_1_1base.html#a12d3865496a66b90d413b60dadc40407">InvalidEnumValue</a>&lt;Sampler::CompareMode&gt;()),</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;        min_filter_(base::<a class="code" href="namespaceion_1_1base.html#a12d3865496a66b90d413b60dadc40407">InvalidEnumValue</a>&lt;Sampler::FilterMode&gt;()),</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        mag_filter_(base::<a class="code" href="namespaceion_1_1base.html#a12d3865496a66b90d413b60dadc40407">InvalidEnumValue</a>&lt;Sampler::FilterMode&gt;()),</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        wrap_r_(base::<a class="code" href="namespaceion_1_1base.html#a12d3865496a66b90d413b60dadc40407">InvalidEnumValue</a>&lt;Sampler::WrapMode&gt;()),</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        wrap_s_(base::<a class="code" href="namespaceion_1_1base.html#a12d3865496a66b90d413b60dadc40407">InvalidEnumValue</a>&lt;Sampler::WrapMode&gt;()),</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        wrap_t_(base::<a class="code" href="namespaceion_1_1base.html#a12d3865496a66b90d413b60dadc40407">InvalidEnumValue</a>&lt;Sampler::WrapMode&gt;()),</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;        multisample_enabled_by_renderer_(false) {</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <a class="code" href="base_2logging_8h.html#aae2dc65d9ea248d54bf39daa986dd295">DCHECK_GE</a>(static_cast&lt;int&gt;(<a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a3bc28b6f02de422506a28cf596b9cd02a3783fe228dcc998fb5869a27c1988eab">CubeMapTexture::kNumChanges</a>),</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;              static_cast&lt;int&gt;(<a class="code" href="classion_1_1gfx_1_1_texture.html#a56ef347565e68fec664f3b2d86fffd8fa9818e5a607070eef926b1f03db2d8a27">Texture::kNumChanges</a>));</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;  }</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;  ~TextureResource()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(id_ == 0U || !<a class="code" href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">portgfx::Visual::GetCurrent</a>());</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;  }</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  <span class="keywordtype">void</span> Update(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;  <span class="keywordtype">void</span> Release(<span class="keywordtype">bool</span> can_make_gl_calls) <span class="keyword">override</span>;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;  ResourceType GetType()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a4c2dda32f304492a88754518cf801811">kTexture</a>; }</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;  GLenum GetGlTarget()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> gl_target_; }</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">const</span> <a class="code" href="class_t.html">T</a>&amp; GetTexture()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="class_t.html">T</a>&amp;<span class="keyword">&gt;</span>(*(this-&gt;<a class="code" href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">GetHolder</a>()));</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  }</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;  <span class="keywordtype">void</span> Bind(ResourceBinder* rb);</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  <span class="keywordtype">void</span> BindToUnit(ResourceBinder* rb, GLuint unit);</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  <span class="keywordtype">void</span> Unbind(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;  <span class="keywordtype">void</span> OnDestroyed()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    UnbindAll();</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    Renderer::Resource&lt;CubeMapTexture::kNumChanges&gt;::OnDestroyed();</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;  }</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  GLuint ObtainImageUnit(ResourceBinder* rb, <span class="keyword">const</span> <span class="keywordtype">void</span>* assoc, <span class="keywordtype">int</span> old_unit) {</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> unit = rb-&gt;GetTextureManager()-&gt;GetUnit(assoc, old_unit);</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(unit);</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  }</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;  <span class="keywordtype">bool</span> SetMultisampleEnabledByRenderer(<span class="keywordtype">bool</span> multisample_enabled_by_renderer) {</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> changed = multisample_enabled_by_renderer_ !=</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        multisample_enabled_by_renderer;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    multisample_enabled_by_renderer_ = multisample_enabled_by_renderer;</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    <span class="keywordflow">return</span> changed;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  }</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160; <span class="keyword">protected</span>:</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <span class="keywordtype">bool</span> IsComplete() <span class="keyword">const</span>;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  <span class="keywordtype">void</span> UpdateCubeMapImageState(GraphicsManager* gm);</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  <span class="keywordtype">void</span> UpdateTextureImageState(GraphicsManager* gm, <span class="keywordtype">bool</span> multisample,</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;                               <span class="keywordtype">bool</span> multisample_changed);</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  <span class="keywordtype">void</span> CreateImmutableTexture(<span class="keyword">const</span> Image&amp; image, <span class="keyword">const</span> <span class="keywordtype">bool</span> multisample,</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;                              <span class="keyword">const</span> <span class="keywordtype">size_t</span> samples,</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;                              <span class="keyword">const</span> <span class="keywordtype">bool</span> fixed_sample_locations, <span class="keywordtype">size_t</span> levels,</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                              GraphicsManager* gm);</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;  <span class="keywordtype">bool</span> CheckImage(<span class="keyword">const</span> Image&amp; image, <span class="keyword">const</span> TextureBase&amp; texture);</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  <span class="keywordtype">void</span> UploadImage(<span class="keyword">const</span> Image&amp; image, GLenum target, GLint <a class="code" href="tracinghandler_8cc.html#acf4d33ee4cff36f69b924471174dcb11">level</a>,</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                   <span class="keywordtype">int</span> samples, <span class="keywordtype">bool</span> fixed_sample_locations,</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                   <span class="keywordtype">bool</span> is_full_image, <span class="keyword">const</span> Point3ui&amp; <a class="code" href="calltracemanager_8cc.html#aa5e5dc1547f4c4f7f4c114b0c856f344">offset</a>,</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;                   GraphicsManager* gm);</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;  <span class="keywordtype">void</span> UpdateMemoryUsage(<a class="code" href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641">TextureBase::TextureType</a> type);</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  <span class="keywordtype">void</span> UpdateMipmapGeneration(<span class="keyword">const</span> Sampler&amp; sampler, <span class="keywordtype">bool</span> image_has_changed,</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                              GraphicsManager* gm);</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;  <span class="keywordtype">bool</span> UpdateMipmap0Image(<span class="keyword">const</span> Image&amp; image, <span class="keyword">const</span> TextureBase&amp; texture,</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                          <span class="keyword">const</span> <span class="keywordtype">size_t</span> mipmap_count, GLenum target,</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;                          <span class="keywordtype">int</span> mipmap_changed_bit, GraphicsManager* gm,</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                          <span class="keywordtype">size_t</span>* required_levels, <span class="keywordtype">bool</span> multisample_changed);</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;  <span class="keywordtype">bool</span> UpdateImage(<span class="keyword">const</span> Image&amp; image0, <span class="keyword">const</span> Image&amp; image,</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                         <span class="keyword">const</span> TextureBase&amp; texture, GLenum target, <span class="keywordtype">int</span> <a class="code" href="tracinghandler_8cc.html#acf4d33ee4cff36f69b924471174dcb11">level</a>,</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                         GraphicsManager* gm);</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  <span class="keywordtype">void</span> UpdateState(<span class="keyword">const</span> TextureBase&amp; texture, ResourceBinder* rb, GLuint unit);</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  <span class="keywordtype">void</span> UpdateSamplerState(<span class="keyword">const</span> Sampler&amp; sampler, GraphicsManager* gm);</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  <span class="keywordtype">void</span> UpdateSubImages(<span class="keyword">const</span> base::AllocVector&lt;Texture::SubImage&gt;&amp; images,</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;                       GLenum target, GraphicsManager* gm);</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  <span class="keywordtype">void</span> UpdateTextureState(<span class="keyword">const</span> TextureBase&amp; texture, GraphicsManager* gm);</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;  GLenum gl_target_;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;  <span class="keywordtype">int</span> last_uploaded_components_;</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  <span class="keywordtype">bool</span> auto_mipmapping_enabled_;</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  <span class="keywordtype">float</span> max_anisotropy_;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;  <span class="keywordtype">float</span> min_lod_;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;  <span class="keywordtype">float</span> max_lod_;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_sampler.html#a8af3dbd386f605c5275a40c38196be43">Sampler::CompareFunction</a> compare_function_;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_sampler.html#a66ea175f8ffb788a442c1e745117d525">Sampler::CompareMode</a> compare_mode_;</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_sampler.html#a717de862b7059b46a9cf72ddca101fd0">Sampler::FilterMode</a> min_filter_;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_sampler.html#a717de862b7059b46a9cf72ddca101fd0">Sampler::FilterMode</a> mag_filter_;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_sampler.html#a0ba5458a2c1cfe30bd1347b50e3790db">Sampler::WrapMode</a> wrap_r_;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_sampler.html#a0ba5458a2c1cfe30bd1347b50e3790db">Sampler::WrapMode</a> wrap_s_;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_sampler.html#a0ba5458a2c1cfe30bd1347b50e3790db">Sampler::WrapMode</a> wrap_t_;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  <span class="keywordtype">bool</span> multisample_enabled_by_renderer_;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;  <span class="keywordtype">void</span> UpdateWithUnit(ResourceBinder* rb, GLuint unit);</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;  <span class="keywordtype">void</span> UpdateTextureTarget(GraphicsManager* gm, <span class="keyword">const</span> <span class="keywordtype">bool</span> multisample) {</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="keyword">const</span> TextureBase&amp; base = GetTexture&lt;TextureBase&gt;();</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;    Image* image = base.GetImmutableImage().Get();</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    <span class="keywordflow">if</span> (base.GetTextureType() == <a class="code" href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641a12fb9394b1d08b479b17543a57756cce">TextureBase::kCubeMapTexture</a>) {</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      <span class="keywordflow">if</span> (image) {</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        UpdateCubeMapTextureTypeFromImage(*image);</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        <span class="keyword">const</span> CubeMapTexture&amp; texture = GetTexture&lt;CubeMapTexture&gt;();</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;        <span class="keywordflow">if</span> (texture.HasImage(<a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90ca241349e2e204554569f4b98a25cb876c">CubeMapTexture::kNegativeX</a>, 0U)) {</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;          UpdateCubeMapTextureTypeFromImage(</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;              *texture.GetImage(<a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90ca241349e2e204554569f4b98a25cb876c">CubeMapTexture::kNegativeX</a>, 0U));</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;        }</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      }</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      <span class="keywordflow">if</span> (image) {</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        UpdateTextureTypeFromImage(*image, multisample);</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;        <span class="keyword">const</span> Texture&amp; texture = GetTexture&lt;Texture&gt;();</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        <span class="keywordflow">if</span> (texture.HasImage(0U))</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;          UpdateTextureTypeFromImage(*texture.GetImage(0U), multisample);</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;      }</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    }</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  }</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;  <span class="keywordtype">void</span> UpdateTextureTypeFromImage(<span class="keyword">const</span> Image&amp; image, <span class="keywordtype">bool</span> multisample) {</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    <span class="keywordflow">if</span> (image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa51d8ace449d1c8620c488a90c08d765a">Image::kEgl</a>) {</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;      gl_target_ = GL_TEXTURE_2D;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa6cd47172001c514d63abd9a72c9a08c7">Image::kExternalEgl</a>) {</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      gl_target_ = <a class="code" href="glheaders_8h.html#adb7e71e2c7c36c9788223afed8c27d61">GL_TEXTURE_EXTERNAL_OES</a>;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;      <span class="keywordflow">if</span> (image.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a3afa465d455ff97efe617f46a648940b">Image::k2d</a>) {</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        <span class="keywordflow">if</span> (image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa77863e88e84916287a7d296f364d74b2">Image::kArray</a>) {</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;          gl_target_ = GL_TEXTURE_1D_ARRAY;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa65531a6320eed60063cfa290d49babe7">Image::kDense</a>) {</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;          <span class="keywordflow">if</span> (multisample) {</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;            gl_target_ = GL_TEXTURE_2D_MULTISAMPLE;</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;            gl_target_ = GL_TEXTURE_2D;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;          }</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        }</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (image.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a4f15255e18cf8038ebd2ea1337fe36c9">Image::k3d</a>) {</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        <span class="keywordflow">if</span> (image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa77863e88e84916287a7d296f364d74b2">Image::kArray</a>) {</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;          <span class="keywordflow">if</span> (multisample) {</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;            gl_target_ = GL_TEXTURE_2D_MULTISAMPLE_ARRAY;</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            gl_target_ = GL_TEXTURE_2D_ARRAY;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;          }</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa65531a6320eed60063cfa290d49babe7">Image::kDense</a>) {</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;          gl_target_ = GL_TEXTURE_3D;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        }</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;      }</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    }</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;  }</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  <span class="keywordtype">void</span> UpdateCubeMapTextureTypeFromImage(<span class="keyword">const</span> Image&amp; image) {</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;    <span class="keywordflow">if</span> (image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa51d8ace449d1c8620c488a90c08d765a">Image::kEgl</a>) {</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;      gl_target_ = GL_TEXTURE_2D;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa6cd47172001c514d63abd9a72c9a08c7">Image::kExternalEgl</a>) {</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      gl_target_ = <a class="code" href="glheaders_8h.html#adb7e71e2c7c36c9788223afed8c27d61">GL_TEXTURE_EXTERNAL_OES</a>;</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      <span class="keywordflow">if</span> (image.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a4f15255e18cf8038ebd2ea1337fe36c9">Image::k3d</a> ||</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;          image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa77863e88e84916287a7d296f364d74b2">Image::kArray</a>) {</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        gl_target_ = GL_TEXTURE_CUBE_MAP_ARRAY;</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa65531a6320eed60063cfa290d49babe7">Image::kDense</a>) {</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;        gl_target_ = GL_TEXTURE_CUBE_MAP;</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      }</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    }</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;  }</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;};</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::Bind(ResourceBinder* rb) {</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;  <span class="keyword">const</span> GLuint unit = ObtainImageUnit(rb, <span class="keyword">this</span>, rb-&gt;GetLastBoundUnit(<span class="keyword">this</span>));</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  BindToUnit(rb, unit);</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;}</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::BindToUnit(ResourceBinder* rb, GLuint unit) {</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;  UpdateWithUnit(rb, unit);</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;  <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    rb-&gt;BindTextureToUnit(<span class="keyword">this</span>, unit);</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    Sampler* sampler = GetTexture&lt;TextureBase&gt;().GetSampler().Get();</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="keywordflow">if</span> (sampler &amp;&amp;</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;        GetGraphicsManager()-&gt;IsFunctionGroupAvailable(</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;            <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a07b147f33c44e20d5dd40cc1f6bc2a50">GraphicsManager::kSamplerObjects</a>)) {</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;      SamplerResource* sr = GetResource(sampler, rb);</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(sr);</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;      sr-&gt;BindToUnit(unit, rb);</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    }</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  }</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;}</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::Update(ResourceBinder* rb) {</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  <span class="keywordflow">if</span> ((AnyModifiedBitsSet() || rb-&gt;WasTextureEvicted(<span class="keyword">this</span>)) &amp;&amp; IsComplete()) {</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    <span class="keyword">const</span> GLuint unit = ObtainImageUnit(rb, <span class="keyword">this</span>,</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                                        rb-&gt;GetLastBoundUnit(<span class="keyword">this</span>));</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    UpdateWithUnit(rb, unit);</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;  }</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;}</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::UpdateWithUnit(ResourceBinder* rb,</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                                               GLuint unit) {</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;  <span class="keywordflow">if</span> ((AnyModifiedBitsSet() || rb-&gt;WasTextureEvicted(<span class="keyword">this</span>)) &amp;&amp; IsComplete())</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    UpdateState(GetTexture&lt;TextureBase&gt;(), rb, unit);</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;}</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;<span class="keywordtype">bool</span> Renderer::TextureResource::CheckImage(<span class="keyword">const</span> Image&amp; image,</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                                           <span class="keyword">const</span> TextureBase&amp; texture) {</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;  <span class="keywordflow">if</span> (Sampler* sampler = texture.GetSampler().Get()) {</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespaceion_1_1math.html#a1fbc614275fefed32e6ebf43af56409a">math::IsPowerOfTwo</a>(image.GetWidth()) ||</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        !<a class="code" href="namespaceion_1_1math.html#a1fbc614275fefed32e6ebf43af56409a">math::IsPowerOfTwo</a>(image.GetHeight())) {</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      <span class="keywordflow">if</span> ((sampler-&gt;GetWrapS() == <a class="code" href="classion_1_1gfx_1_1_sampler.html#a0ba5458a2c1cfe30bd1347b50e3790dba20f4a4b5bbab9ff3a4ef3b9447d8f5f7">Sampler::kClampToEdge</a> ||</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;           sampler-&gt;GetWrapT() == <a class="code" href="classion_1_1gfx_1_1_sampler.html#a0ba5458a2c1cfe30bd1347b50e3790dba20f4a4b5bbab9ff3a4ef3b9447d8f5f7">Sampler::kClampToEdge</a>) &amp;&amp;</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;          (sampler-&gt;GetMinFilter() &gt;= <a class="code" href="classion_1_1gfx_1_1_sampler.html#a717de862b7059b46a9cf72ddca101fd0a9fd76cf5dc9b8c76ecdda014595e47b6">Sampler::kNearestMipmapNearest</a>)) {</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>)</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;***ION: Non-power-of-two textures using wrap mode &quot;</span></div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;CLAMP_TO_EDGE must use either NEAREST or LINEAR minification &quot;</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;filter modes, use Texture::SetMinFilter(Sampler::kNearest) &quot;</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;or Texture::SetMinFilter(Sampler::kLinear) to fix this&quot;</span>;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      }</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    }</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;  }</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;}</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::UploadImage(<span class="keyword">const</span> Image&amp; image, GLenum target,</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                                            GLint <a class="code" href="tracinghandler_8cc.html#acf4d33ee4cff36f69b924471174dcb11">level</a>, <span class="keywordtype">int</span> samples,</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                                            <span class="keywordtype">bool</span> fixed_sample_locations,</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                                            <span class="keywordtype">bool</span> is_full_image,</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                                            <span class="keyword">const</span> Point3ui&amp; <a class="code" href="calltracemanager_8cc.html#aa5e5dc1547f4c4f7f4c114b0c856f344">offset</a>,</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                                            GraphicsManager* gm) {</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;  <span class="keyword">const</span> Image::PixelFormat pf =</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      GetCompatiblePixelFormat(<a class="code" href="classion_1_1gfx_1_1_image.html#a7a06522e42b8521c6a9875a74d9b96c1">Image::GetPixelFormat</a>(image.GetFormat()), gm);</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> component_count =</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      <a class="code" href="classion_1_1gfx_1_1_image.html#a55ee90f1349e66a144b38b6932cff2aa">Image::GetNumComponentsForFormat</a>(image.GetFormat());</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  <span class="keywordflow">if</span> (last_uploaded_components_ &amp;&amp;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;      component_count &lt; last_uploaded_components_) {</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>)</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;While uploading image data for texture \&quot;&quot;</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        &lt;&lt; GetTexture&lt;TextureBase&gt;().GetLabel()</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;\&quot;, the number of components for this upload is &quot;</span> &lt;&lt; component_count</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; but was &quot;</span> &lt;&lt; last_uploaded_components_</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; the last time data was uploaded. This is likely not what you want &quot;</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;           <span class="stringliteral">&quot;as GL implementations are not guaranteed to provide particular &quot;</span></div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;           <span class="stringliteral">&quot;values for the unset components.&quot;</span>;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  }</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  last_uploaded_components_ = component_count;</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespaceion_1_1base.html#a9aea056fa3b5c46e3182f5427fb5f010">DataContainerPtr</a>&amp; container = image.GetData();</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">void</span>* data = container.Get() ? container-&gt;GetData() : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  gm-&gt;PixelStorei(GL_UNPACK_ALIGNMENT, 1);</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> multisample = (samples &gt; 0) &amp;&amp;</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;      gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a621d8a2222a0c0bcfc612f1a6c030609">GraphicsManager::kTextureMultisample</a>);</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;  <span class="keywordflow">if</span> (image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa51d8ace449d1c8620c488a90c08d765a">Image::kEgl</a> ||</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;      image.GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa6cd47172001c514d63abd9a72c9a08c7">Image::kExternalEgl</a>) {</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;    <span class="keywordflow">if</span> (data &amp;&amp; gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a9c2699f8161b9670b16f330cf54ee671">GraphicsManager::kEglImage</a>)) {</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(gl_target_ == <a class="code" href="glheaders_8h.html#adb7e71e2c7c36c9788223afed8c27d61">GL_TEXTURE_EXTERNAL_OES</a> ||</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;             gl_target_ == GL_TEXTURE_2D);</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;      gm-&gt;EGLImageTargetTexture2DOES(gl_target_, const_cast&lt;void*&gt;(data));</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;    }</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (image.GetWidth() &gt; 0U &amp;&amp; image.GetHeight() &gt; 0U &amp;&amp;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;             image.GetDepth() &gt; 0U) {</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <span class="keywordflow">if</span> (image.IsCompressed() &amp;&amp; data) {</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;      <span class="keywordflow">if</span> (image.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a3afa465d455ff97efe617f46a648940b">Image::k2d</a>) {</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">size_t</span> data_size = <a class="code" href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">Image::ComputeDataSize</a>(</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;            image.GetFormat(), image.GetWidth(), image.GetHeight());</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        <span class="keywordflow">if</span> (is_full_image) {</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;          gm-&gt;CompressedTexImage2D(target, level, pf.internal_format,</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                                   image.GetWidth(), image.GetHeight(), 0,</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                                   <span class="keyword">static_cast&lt;</span>GLsizei<span class="keyword">&gt;</span>(data_size), data);</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;          gm-&gt;CompressedTexSubImage2D(target, level, offset[0], offset[1],</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;                                      image.GetWidth(), image.GetHeight(),</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;                                      pf.internal_format,</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                                      <span class="keyword">static_cast&lt;</span>GLsizei<span class="keyword">&gt;</span>(data_size), data);</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        }</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (image.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a4f15255e18cf8038ebd2ea1337fe36c9">Image::k3d</a>) {</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">size_t</span> data_size =</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;            <a class="code" href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">Image::ComputeDataSize</a>(image.GetFormat(), image.GetWidth(),</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                                   image.GetHeight(), image.GetDepth());</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a112409cde13470d53088b409f456bc2a">GraphicsManager::kTexture3d</a>)) {</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;          <span class="keywordflow">if</span> (is_full_image) {</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;            gm-&gt;CompressedTexImage3D(target, level, pf.internal_format,</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                                     image.GetWidth(), image.GetHeight(),</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                                     image.GetDepth(), 0,</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                                     <span class="keyword">static_cast&lt;</span>GLsizei<span class="keyword">&gt;</span>(data_size), data);</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;            gm-&gt;CompressedTexSubImage3D(</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                target, level, offset[0], offset[1], offset[2],</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                image.GetWidth(), image.GetHeight(), image.GetDepth(),</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                pf.internal_format, <span class="keyword">static_cast&lt;</span>GLsizei<span class="keyword">&gt;</span>(data_size), data);</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;          }</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;          <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: 3D texturing is not supported by the local &quot;</span></div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;OpenGL implementation, but Texture \&quot;&quot;</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                     &lt;&lt; GetTexture&lt;TextureBase&gt;().GetLabel()</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;\&quot; contains a 3D Image.&quot;</span>;</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;        }</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;      }</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      <span class="keywordflow">if</span> (image.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a3afa465d455ff97efe617f46a648940b">Image::k2d</a>) {</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        <span class="keywordflow">if</span> (is_full_image) {</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;          <span class="keywordflow">if</span> (multisample) {</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;            gm-&gt;TexImage2DMultisample(target, samples, pf.internal_format,</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                                      image.GetWidth(), image.GetHeight(),</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                                      fixed_sample_locations);</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;            gm-&gt;TexImage2D(target, level, pf.internal_format, image.GetWidth(),</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;                           image.GetHeight(), 0, pf.format, pf.type, data);</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;          }</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;          gm-&gt;TexSubImage2D(target, level, offset[0], offset[1],</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                            image.GetWidth(), image.GetHeight(), pf.format,</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                            pf.type, data);</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        }</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (image.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a4f15255e18cf8038ebd2ea1337fe36c9">Image::k3d</a>) {</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;        <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a112409cde13470d53088b409f456bc2a">GraphicsManager::kTexture3d</a>)) {</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;          <span class="keywordflow">if</span> (is_full_image) {</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;            <span class="keywordflow">if</span> (multisample) {</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;              gm-&gt;TexImage3DMultisample(</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                  target, samples, pf.internal_format, image.GetWidth(),</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                  image.GetHeight(), image.GetDepth(), fixed_sample_locations);</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;              gm-&gt;TexImage3D(target, level, pf.internal_format,</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                             image.GetWidth(), image.GetHeight(),</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                             image.GetDepth(), 0, pf.format, pf.type, data);</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;            }</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;            gm-&gt;TexSubImage3D(target, level, offset[0], offset[1], offset[2],</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                              image.GetWidth(), image.GetHeight(),</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                              image.GetDepth(), pf.format, pf.type, data);</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;          }</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;          <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: 3D texturing is not supported by the local &quot;</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;OpenGL implementation, but Texture \&quot;&quot;</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                     &lt;&lt; GetTexture&lt;TextureBase&gt;().GetLabel()</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;\&quot; contains a 3D Image.&quot;</span>;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;        }</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      }</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    }</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  }</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  <span class="keywordflow">if</span> (data)</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    container-&gt;WipeData();</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;}</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::UpdateMipmapGeneration(<span class="keyword">const</span> Sampler&amp; sampler,</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                                                       <span class="keywordtype">bool</span> image_has_changed,</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                                                       GraphicsManager* gm) {</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> is_auto_mipmapping_enabled =</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;      sampler.IsAutogenerateMipmapsEnabled();</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> auto_mipmapping_changed =</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      auto_mipmapping_enabled_ != is_auto_mipmapping_enabled;</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <span class="keywordflow">if</span> (auto_mipmapping_changed)</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    auto_mipmapping_enabled_ = is_auto_mipmapping_enabled;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <span class="keywordflow">if</span> ((image_has_changed || auto_mipmapping_changed ||</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;       TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3ad84f5f896ca7c5b1022457e6033924cf">TextureBase::kContentsImplicitlyChanged</a>)) &amp;&amp;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      auto_mipmapping_enabled_)</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    gm-&gt;GenerateMipmap(gl_target_);</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;}</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::UpdateState(<span class="keyword">const</span> TextureBase&amp; texture,</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                                            ResourceBinder* rb, GLuint unit) {</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(gm);</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> multisample = (texture.GetMultisampleSamples() &gt; 0) &amp;&amp;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;      gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a621d8a2222a0c0bcfc612f1a6c030609">GraphicsManager::kTextureMultisample</a>);</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> multisample_changed = SetMultisampleEnabledByRenderer(multisample);</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  <span class="keywordflow">if</span> (!id_ || AnyModifiedBitsSet()) {</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    <span class="keywordflow">if</span> (!id_)</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      gm-&gt;GenTextures(1, &amp;id_);</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;      UpdateTextureTarget(gm, multisample);</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488ea8cdf432d687b44c1099911986875a928">ResourceHolder::kResourceChanged</a>))</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;        rb-&gt;ClearTextureBinding(id_, unit);</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;      rb-&gt;ActivateUnit(unit);</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      rb-&gt;BindTextureToUnit(<span class="keyword">this</span>, unit);</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;      <span class="keywordflow">if</span> (multisample_changed ||</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;          TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3ac6e62a27783d2827c6536406617fc4c9">TextureBase::kImmutableImageChanged</a>)) {</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;        <span class="keywordflow">if</span> (Image* image = texture.GetImmutableImage().Get())</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;          CreateImmutableTexture(*image, multisample,</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                                 texture.GetMultisampleSamples(),</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                                 texture.IsMultisampleFixedSampleLocations(),</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                                 texture.GetImmutableLevels(), gm);</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      }</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;      <span class="keywordflow">if</span> (texture.GetTextureType() == <a class="code" href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641a12fb9394b1d08b479b17543a57756cce">TextureBase::kCubeMapTexture</a>)</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;        UpdateCubeMapImageState(gm);</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        UpdateTextureImageState(gm, multisample, multisample_changed);</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      UpdateMemoryUsage(texture.GetTextureType());</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3ac6670a1b84fd5ed564eade86f1dec1d8">TextureBase::kSamplerChanged</a>) &amp;&amp;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;          !GetGraphicsManager()-&gt;IsFunctionGroupAvailable(</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;              <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a07b147f33c44e20d5dd40cc1f6bc2a50">GraphicsManager::kSamplerObjects</a>))</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        <span class="keywordflow">if</span> (Sampler* sampler = GetTexture&lt;TextureBase&gt;().GetSampler().Get())</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;          UpdateSamplerState(*sampler, gm);</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;      UpdateTextureState(texture, gm);</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      SetObjectLabel(gm, GL_TEXTURE, id_, texture.GetLabel());</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;      ResetModifiedBits();</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to create texture object&quot;</span>;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;    }</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;  }</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;}</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::UpdateSamplerState(<span class="keyword">const</span> Sampler&amp; sampler,</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;                                                   GraphicsManager* gm) {</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;  <span class="keywordflow">if</span> (max_anisotropy_ != sampler.GetMaxAnisotropy() &amp;&amp;</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      gm-&gt;IsExtensionSupported(<span class="stringliteral">&quot;texture_filter_anisotropic&quot;</span>)) {</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;    max_anisotropy_ = sampler.GetMaxAnisotropy();</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> aniso = std::min(</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        max_anisotropy_, GetGraphicsManager()-&gt;GetCapabilityValue&lt;float&gt;(</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;                             <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#a5739ea2401844cf4db67bf82349bc13da5763ea143ebbfd5187a93a48c9d661c5">GraphicsManager::kMaxTextureMaxAnisotropy</a>));</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    gm-&gt;TexParameterf(gl_target_, GL_TEXTURE_MAX_ANISOTROPY_EXT, aniso);</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;  }</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;  <span class="keywordflow">if</span> (min_filter_ != sampler.GetMinFilter()) {</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    min_filter_ = sampler.GetMinFilter();</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;    gm-&gt;TexParameteri(gl_target_, GL_TEXTURE_MIN_FILTER,</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                      <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(min_filter_));</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;  }</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;  <span class="keywordflow">if</span> (mag_filter_ != sampler.GetMagFilter()) {</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    mag_filter_ = sampler.GetMagFilter();</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;    gm-&gt;TexParameteri(gl_target_, GL_TEXTURE_MAG_FILTER,</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                      <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(mag_filter_));</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  }</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;  <span class="keywordflow">if</span> (wrap_s_ != sampler.GetWrapS()) {</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    wrap_s_ = sampler.GetWrapS();</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    gm-&gt;TexParameteri(gl_target_, GL_TEXTURE_WRAP_S,</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                      <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(wrap_s_));</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;  }</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <span class="keywordflow">if</span> (wrap_t_ != sampler.GetWrapT()) {</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;    wrap_t_ = sampler.GetWrapT();</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;    gm-&gt;TexParameteri(gl_target_, GL_TEXTURE_WRAP_T,</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                      <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(wrap_t_));</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  }</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  <span class="keywordflow">if</span> (gm-&gt;GetGlVersion() &gt; 20) {</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    <span class="keywordflow">if</span> (compare_function_ != sampler.GetCompareFunction()) {</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;      compare_function_ = sampler.GetCompareFunction();</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;      gm-&gt;TexParameteri(gl_target_, GL_TEXTURE_COMPARE_FUNC,</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                        <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(compare_function_));</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    }</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    <span class="keywordflow">if</span> (compare_mode_ != sampler.GetCompareMode()) {</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;      compare_mode_ = sampler.GetCompareMode();</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;      gm-&gt;TexParameteri(gl_target_, GL_TEXTURE_COMPARE_MODE,</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                        compare_mode_ == <a class="code" href="classion_1_1gfx_1_1_sampler.html#a66ea175f8ffb788a442c1e745117d525a8007ffb0199f0de3bef90a8adfbecb67">Sampler::kCompareToTexture</a></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                            ? GL_COMPARE_REF_TO_TEXTURE</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;                            : GL_NONE);</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;    }</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    <span class="keywordflow">if</span> (max_lod_ != sampler.GetMaxLod()) {</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;      max_lod_ = sampler.GetMaxLod();</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;      gm-&gt;TexParameterf(gl_target_, GL_TEXTURE_MAX_LOD, max_lod_);</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;    }</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;    <span class="keywordflow">if</span> (min_lod_ != sampler.GetMinLod()) {</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;      min_lod_ = sampler.GetMinLod();</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;      gm-&gt;TexParameterf(gl_target_, GL_TEXTURE_MIN_LOD, min_lod_);</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;    }</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;    <span class="keywordflow">if</span> (wrap_r_ != sampler.GetWrapR()) {</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;      wrap_r_ = sampler.GetWrapR();</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;      gm-&gt;TexParameteri(gl_target_, GL_TEXTURE_WRAP_R,</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;                        <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(wrap_r_));</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    }</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;  }</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;}</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::UpdateTextureState(<span class="keyword">const</span> TextureBase&amp; texture,</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                                                   GraphicsManager* gm) {</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;  <span class="keywordflow">if</span> (gm-&gt;GetGlVersion() &gt; 20) {</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;    <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3a9ebb538e101ef75f2eca721d9cc7e513">TextureBase::kBaseLevelChanged</a>))</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;      gm-&gt;TexParameteri(gl_target_, GL_TEXTURE_BASE_LEVEL,</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;                        texture.GetBaseLevel());</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;    <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3a90551e8df3b0dc7664670fbd32b8242a">TextureBase::kMaxLevelChanged</a>))</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;      gm-&gt;TexParameteri(gl_target_, GL_TEXTURE_MAX_LEVEL,</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                        texture.GetMaxLevel());</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;    <span class="keywordflow">if</span> ((gm-&gt;GetGlApiStandard() == <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#afe483c6cc2e75618b57e9269e5cd7628a2641041b6785a83379197dcfaeb9ef4d">GraphicsManager::kEs</a> &amp;&amp;</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;         gm-&gt;GetGlVersion() &gt;= 30) ||</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;        (gm-&gt;GetGlApiStandard() == <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#afe483c6cc2e75618b57e9269e5cd7628a3c9133c01de9c071adfb3db11f38b1d3">GraphicsManager::kDesktop</a> &amp;&amp;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;         gm-&gt;GetGlVersion() &gt;= 33)) {</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3aa49f1bea3bea576290c86469ac5c4cef">TextureBase::kSwizzleRedChanged</a>))</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;        gm-&gt;TexParameteri(</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;            gl_target_, GL_TEXTURE_SWIZZLE_R,</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;            <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(texture.GetSwizzleRed()));</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3a9248861d30631e8ce0dcd1d1a665bf40">TextureBase::kSwizzleGreenChanged</a>))</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        gm-&gt;TexParameteri(</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;            gl_target_, GL_TEXTURE_SWIZZLE_G,</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(texture.GetSwizzleGreen()));</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3a5e27029436ae6cc69f3a91384e74a167">TextureBase::kSwizzleBlueChanged</a>))</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        gm-&gt;TexParameteri(</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;            gl_target_, GL_TEXTURE_SWIZZLE_B,</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;            <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(texture.GetSwizzleBlue()));</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3a1dbd7e254864bd8b42489c350b971fc3">TextureBase::kSwizzleAlphaChanged</a>))</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;        gm-&gt;TexParameteri(</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;            gl_target_, GL_TEXTURE_SWIZZLE_A,</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;            <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(texture.GetSwizzleAlpha()));</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    }</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;  }</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;}</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::Unbind(ResourceBinder* rb) {</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  <span class="keywordflow">if</span> (rb) {</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="keyword">const</span> GLuint count = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(rb-&gt;GetImageUnitCount());</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keywordflow">for</span> (GLuint i = 0U; i &lt; count; ++i)</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      rb-&gt;ClearTextureBinding(id_, i);</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;  }</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;}</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::Release(<span class="keywordtype">bool</span> can_make_gl_calls) {</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;  BaseResourceType::Release(can_make_gl_calls);</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;    base::ReadLock read_lock(GetResourceBinderLock());</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    <a class="code" href="namespaceion_1_1base.html#ab470a11cceef7441df42bf6f489a69e5">base::ReadGuard</a> read_guard(&amp;read_lock);</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    ResourceBinderMap&amp; binders = GetResourceBinderMap();</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="keywordflow">for</span> (ResourceBinderMap::iterator it = binders.begin();</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;         it != binders.end();</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;         ++it) {</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      Unbind(it-&gt;second.get());</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;      it-&gt;second-&gt;ClearAssignedImageUnit(<span class="keyword">this</span>);</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    }</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="keywordflow">if</span> (resource_owns_gl_id_ &amp;&amp; can_make_gl_calls)</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      GetGraphicsManager()-&gt;DeleteTextures(1, &amp;id_);</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    SetUsedGpuMemory(0U);</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;    id_ = 0;</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;  }</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;}</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;<span class="keywordtype">bool</span> Renderer::TextureResource::IsComplete()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  <span class="keyword">const</span> TextureBase&amp; base = GetTexture&lt;TextureBase&gt;();</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;  <span class="keywordflow">if</span> (!base.GetSampler().Get()) {</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Texture \&quot;&quot;</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;                 &lt;&lt; GetTexture&lt;TextureBase&gt;().GetLabel()</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;\&quot; has no Sampler! It will likely appear black.&quot;</span>;</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;  }</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;  <span class="keywordflow">if</span> (base.GetImmutableImage().Get())</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;  <span class="keywordflow">if</span> (base.GetTextureType() == <a class="code" href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641a12fb9394b1d08b479b17543a57756cce">TextureBase::kCubeMapTexture</a>) {</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;    <span class="keyword">const</span> CubeMapTexture&amp; texture = GetTexture&lt;CubeMapTexture&gt;();</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;    <span class="keywordtype">bool</span> valid = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 6; ++i) {</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90c">CubeMapTexture::CubeFace</a> face =</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;          <span class="keyword">static_cast&lt;</span><a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90c">CubeMapTexture::CubeFace</a><span class="keyword">&gt;</span>(i);</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;      <span class="keywordflow">if</span> (!texture.HasImage(face, 0U)) {</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Cubemap texture face &quot;</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                     &lt;&lt; <a class="code" href="classion_1_1base_1_1_enum_helper.html#a6825259ec168f1dd2639a194f543997b">base::EnumHelper::GetString</a>(face)</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot; has no level 0 mipmap.&quot;</span>;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;      }</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;    }</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    <span class="keywordflow">return</span> valid;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;    <span class="keyword">const</span> Texture&amp; texture = GetTexture&lt;Texture&gt;();</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    <span class="keywordflow">if</span> (!texture.HasImage(0U)) {</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;      <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Texture \&quot;&quot;</span> &lt;&lt; texture.GetLabel()</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;\&quot; has no level 0 mipmap&quot;</span>;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;    }</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;  }</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;}</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;<span class="keywordtype">bool</span> Renderer::TextureResource::UpdateMipmap0Image(</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    <span class="keyword">const</span> Image&amp; image, <span class="keyword">const</span> TextureBase&amp; texture, <span class="keyword">const</span> <span class="keywordtype">size_t</span> mipmap_count,</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;    GLenum target, <span class="keywordtype">int</span> mipmap_changed_bit, GraphicsManager* gm,</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    <span class="keywordtype">size_t</span>* required_levels, <span class="keywordtype">bool</span> multisample_changed) {</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;  <span class="keyword">const</span> uint32 <a class="code" href="benchmarkutils_8cc.html#a2474a5474cbff19523a51eb1de01cda4">width</a> = image.GetWidth();</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;  <span class="keyword">const</span> uint32 height = image.GetHeight();</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> mipmap_changed = TestModifiedBit(mipmap_changed_bit);</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;  <span class="keywordflow">if</span> ((mipmap_changed || multisample_changed) &amp;&amp; CheckImage(image, texture)) {</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> samples = texture.GetMultisampleSamples();</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> fixed_sample_locations =</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;        texture.IsMultisampleFixedSampleLocations();</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;    UploadImage(image, target, 0, samples, fixed_sample_locations, <span class="keyword">true</span>,</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;                Point3ui(), gm);</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;  }</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;  *required_levels = std::max(<a class="code" href="namespaceion_1_1math.html#ad64502bbc12e4cb9a825c303c2567043">math::Log2</a>(width), <a class="code" href="namespaceion_1_1math.html#ad64502bbc12e4cb9a825c303c2567043">math::Log2</a>(height)) + 1;</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;  <span class="keywordflow">return</span> mipmap_count &lt; *required_levels &amp;&amp; mipmap_count &gt; 1U;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;}</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;<span class="keywordtype">bool</span> Renderer::TextureResource::UpdateImage(<span class="keyword">const</span> Image&amp; image0,</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                                            <span class="keyword">const</span> Image&amp; mipmap,</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                                            <span class="keyword">const</span> TextureBase&amp; texture,</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                                            GLenum target,</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                                            <span class="keywordtype">int</span> level,</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;                                            GraphicsManager* gm) {</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9e">Image::Format</a>&amp; format = image0.GetFormat();</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  uint32 expected_width = 0;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;  uint32 expected_height = 0;</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;  <span class="keywordflow">if</span> (mipmap.GetFormat() != format) {</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Mipmap level &quot;</span> &lt;&lt; level &lt;&lt; <span class="stringliteral">&quot; has different&quot;</span></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; format [&quot;</span> &lt;&lt; mipmap.GetFormat() &lt;&lt; <span class="stringliteral">&quot;] from level 0&#39;s [&quot;</span></div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;               &lt;&lt; format &lt;&lt; <span class="stringliteral">&quot;], ignoring&quot;</span>;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classion_1_1gfx_1_1_texture.html#aca9140cab5ea349eeb2da728c92e3e6a">Texture::ExpectedDimensionsForMipmap</a>(mipmap.GetWidth(),</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                                                  mipmap.GetHeight(),</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                                                  <a class="code" href="tracinghandler_8cc.html#acf4d33ee4cff36f69b924471174dcb11">level</a>,</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                                                  image0.GetWidth(),</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;                                                  image0.GetHeight(),</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                                                  &amp;expected_width,</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;                                                  &amp;expected_height)) {</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    UploadImage(mipmap, target, level, 0, <span class="keyword">false</span>, <span class="keyword">true</span>, Point3ui(), gm);</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;  }</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;}</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::UpdateSubImages(</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;    <span class="keyword">const</span> base::AllocVector&lt;Texture::SubImage&gt;&amp; images, GLenum target,</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    GraphicsManager* gm) {</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> count = images.size();</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    <span class="keyword">const</span> Image&amp; image = *images[i].image.Get();</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    UploadImage(image, target, static_cast&lt;GLint&gt;(images[i].level), 0, <span class="keyword">false</span>,</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                <span class="keyword">false</span>, images[i].offset, gm);</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;  }</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;}</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::UpdateMemoryUsage(</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641">TextureBase::TextureType</a> type) {</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;  <span class="keywordtype">size_t</span> data_size = 0U;</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;  <span class="keywordflow">if</span> (type == <a class="code" href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641af1bcdfd8248162a189e68a21d4725a2b">TextureBase::kTexture</a>) {</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;    <span class="keyword">const</span> Texture&amp; tex = GetTexture&lt;Texture&gt;();</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    <span class="keywordflow">if</span> (tex.HasImage(0)) {</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;      <span class="keyword">const</span> Image&amp; image = *tex.GetImage(0);</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;      <span class="keyword">const</span> Sampler* samp = tex.GetSampler().Get();</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">bool</span> auto_mipmap = samp &amp;&amp; samp-&gt;IsAutogenerateMipmapsEnabled();</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;      <span class="keywordflow">if</span> (tex.GetImageCount() &gt; 1 || auto_mipmap) {</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        data_size = <a class="code" href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">Image::ComputeDataSize</a>(image.GetFormat(), image.GetWidth(),</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                                           image.GetHeight());</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        data_size = (data_size * 4) / 3;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;        data_size = <a class="code" href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">Image::ComputeDataSize</a>(image.GetFormat(), image.GetWidth(),</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;                                                 image.GetHeight());</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;      }</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    }</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;  } <span class="keywordflow">else</span> {  <span class="comment">// kCubeMapTexture.</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    <span class="keyword">const</span> CubeMapTexture&amp; tex = GetTexture&lt;CubeMapTexture&gt;();</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;    <span class="keywordflow">if</span> (tex.HasImage(<a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90ca241349e2e204554569f4b98a25cb876c">CubeMapTexture::kNegativeX</a>, 0)) {</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;      <span class="keyword">const</span> Image&amp; image = *tex.GetImage(<a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90ca241349e2e204554569f4b98a25cb876c">CubeMapTexture::kNegativeX</a>, 0);</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;      <span class="keyword">const</span> Sampler* samp = tex.GetSampler().Get();</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">bool</span> auto_mipmap = samp &amp;&amp; samp-&gt;IsAutogenerateMipmapsEnabled();</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;      <span class="keywordflow">if</span> (tex.GetImageCount(<a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90ca241349e2e204554569f4b98a25cb876c">CubeMapTexture::kNegativeX</a>) &gt; 1 || auto_mipmap) {</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;        data_size = <a class="code" href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">Image::ComputeDataSize</a>(image.GetFormat(), image.GetWidth(),</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                                           image.GetHeight());</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;        data_size = data_size * 8;</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;        data_size = <a class="code" href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">Image::ComputeDataSize</a>(image.GetFormat(), image.GetWidth(),</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;                                           image.GetHeight());</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        data_size *= 6;</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;      }</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    }</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;  }</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  SetUsedGpuMemory(data_size);</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;}</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::UpdateTextureImageState(</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    GraphicsManager* gm, <span class="keyword">const</span> <span class="keywordtype">bool</span> multisample,</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> multisample_changed) {</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;  <span class="keyword">const</span> Texture&amp; texture = GetTexture&lt;Texture&gt;();</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> mipmap_changed = TestModifiedBitRange(</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;      <a class="code" href="classion_1_1gfx_1_1_texture.html#a56ef347565e68fec664f3b2d86fffd8fa7897839473df0b2d619f0aa8266f398f">Texture::kMipmapChanged</a>, <a class="code" href="classion_1_1gfx_1_1_texture.html#a56ef347565e68fec664f3b2d86fffd8fa7897839473df0b2d619f0aa8266f398f">Texture::kMipmapChanged</a> + kMipmapSlotCount);</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;  <span class="keywordflow">if</span> ((mipmap_changed || multisample_changed) &amp;&amp; texture.HasImage(0)) {</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    <span class="keywordflow">if</span> (multisample) {</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;      <span class="keyword">const</span> Image&amp; image0 = *texture.GetImage(0);</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;      <span class="keywordtype">size_t</span> required_levels = 0U;</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;      UpdateMipmap0Image(image0, texture, texture.GetImageCount(), gl_target_,</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;                         <a class="code" href="classion_1_1gfx_1_1_texture.html#a56ef347565e68fec664f3b2d86fffd8fa7897839473df0b2d619f0aa8266f398f">Texture::kMipmapChanged</a>, gm, &amp;required_levels,</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;                         multisample_changed);</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;      <span class="keyword">const</span> Image&amp; image0 = *texture.GetImage(0);</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;      <span class="keywordtype">size_t</span> required_levels = 0U;</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">bool</span> generate_mipmaps = UpdateMipmap0Image(</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;          image0, texture, texture.GetImageCount(), gl_target_,</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;          <a class="code" href="classion_1_1gfx_1_1_texture.html#a56ef347565e68fec664f3b2d86fffd8fa7897839473df0b2d619f0aa8266f398f">Texture::kMipmapChanged</a>, gm, &amp;required_levels, multisample_changed);</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      <span class="keywordflow">if</span> (generate_mipmaps || multisample_changed)</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        gm-&gt;GenerateMipmap(gl_target_);</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 1; i &lt; required_levels; ++i) {</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;        <span class="keywordflow">if</span> (texture.HasImage(i) &amp;&amp;</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;            CheckImage(*texture.GetImage(i), <a class="code" href="fontimage_8cc.html#a05732ec89e3a90546399c62f2c7d90ac">texture</a>) &amp;&amp;</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;            (generate_mipmaps || multisample_changed ||</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;                TestModifiedBit(static_cast&lt;Texture::Changes&gt;(</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;                    Texture::kMipmapChanged + i)))) {</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;          UpdateImage(image0, *texture.GetImage(i), <a class="code" href="fontimage_8cc.html#a05732ec89e3a90546399c62f2c7d90ac">texture</a>, gl_target_,</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                      <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(i), gm);</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;        }</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;      }</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;    }</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;  }</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;  <span class="keywordflow">if</span> (!multisample) {</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;    <span class="keywordflow">if</span> (multisample_changed || TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_texture.html#a56ef347565e68fec664f3b2d86fffd8fa7727a96a81578545ce60bb32b0b18269">Texture::kSubImageChanged</a>)) {</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;      UpdateSubImages(texture.GetSubImages(), gl_target_, gm);</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      texture.ClearSubImages();</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    }</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    <span class="keywordflow">if</span> (Sampler* sampler = texture.GetSampler().Get()) {</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;      <span class="keywordflow">if</span> (texture.HasImage(0U))</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;        UpdateMipmapGeneration(*sampler, multisample_changed ||</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                               TestModifiedBit(Texture::kMipmapChanged), gm);</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;    }</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;  }</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;}</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::CreateImmutableTexture(</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    <span class="keyword">const</span> Image&amp; image, <span class="keyword">const</span> <span class="keywordtype">bool</span> multisample, <span class="keyword">const</span> <span class="keywordtype">size_t</span> samples,</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> fixed_sample_locations, <span class="keywordtype">size_t</span> levels, GraphicsManager* gm) {</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;  Image::PixelFormat pf =</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;      GetCompatiblePixelFormat(<a class="code" href="classion_1_1gfx_1_1_image.html#a7a06522e42b8521c6a9875a74d9b96c1">Image::GetPixelFormat</a>(image.GetFormat()), gm);</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;  <span class="keywordflow">if</span> (image.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a3afa465d455ff97efe617f46a648940b">Image::k2d</a>) {</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    <span class="keywordflow">if</span> (multisample) {</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;      gm-&gt;TexStorage2DMultisample(gl_target_, static_cast&lt;GLsizei&gt;(samples),</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;                                  pf.internal_format, image.GetWidth(),</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;                                  image.GetHeight(),</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;                                  <span class="keyword">static_cast&lt;</span>GLboolean<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;                                      fixed_sample_locations));</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;      gm-&gt;TexStorage2D(gl_target_, static_cast&lt;GLsizei&gt;(levels),</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                       pf.internal_format, image.GetWidth(),</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                       image.GetHeight());</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    }</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (image.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a4f15255e18cf8038ebd2ea1337fe36c9">Image::k3d</a>) {</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    <span class="keywordflow">if</span> (multisample) {</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;      gm-&gt;TexStorage3DMultisample(gl_target_, static_cast&lt;GLsizei&gt;(samples),</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;                                  pf.internal_format, image.GetWidth(),</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;                                  image.GetHeight(), image.GetDepth(),</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                                  <span class="keyword">static_cast&lt;</span>GLboolean<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;                                      fixed_sample_locations));</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;      gm-&gt;TexStorage3D(gl_target_, static_cast&lt;GLsizei&gt;(levels),</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;                       pf.internal_format, image.GetWidth(), image.GetHeight(),</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                       image.GetDepth());</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;    }</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;  }</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;}</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="keywordtype">void</span> Renderer::TextureResource::UpdateCubeMapImageState(GraphicsManager* gm) {</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;  <span class="keyword">const</span> CubeMapTexture&amp; texture = GetTexture&lt;CubeMapTexture&gt;();</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kSlotCount = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(kMipmapSlotCount);</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;  <span class="keywordtype">bool</span> images_have_changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;  <span class="keywordtype">bool</span> need_to_generate_mipmaps = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;  <span class="keywordtype">size_t</span> required_levels[6];</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 6; ++i) {</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90c">CubeMapTexture::CubeFace</a> face =</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;        <span class="keyword">static_cast&lt;</span><a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90c">CubeMapTexture::CubeFace</a><span class="keyword">&gt;</span>(i);</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> base_mipmap_bit =</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;        <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a3bc28b6f02de422506a28cf596b9cd02ad8eeadd01252aeaccd97f6c0abaa4752">CubeMapTexture::kNegativeXMipmapChanged</a> + i * kSlotCount;</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    required_levels[i] = 0U;</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    <span class="keywordflow">if</span> (TestModifiedBitRange(base_mipmap_bit, base_mipmap_bit + kSlotCount) &amp;&amp;</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;        texture.HasImage(face, 0U)) {</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;      <span class="keyword">const</span> Image&amp; image = *texture.GetImage(face, 0U);</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;      <span class="keyword">const</span> GLenum target = image.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a4f15255e18cf8038ebd2ea1337fe36c9">Image::k3d</a></div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;                                ? gl_target_</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                                : <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(face);</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;      <span class="keywordflow">if</span> (image.GetWidth() == image.GetHeight()) {</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;        <span class="keywordflow">if</span> (UpdateMipmap0Image(image, texture, texture.GetImageCount(face),</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                               target, base_mipmap_bit, gm, &amp;required_levels[i],</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;                               <span class="keyword">false</span>)) {</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;          need_to_generate_mipmaps = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;          images_have_changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;        }</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;Level 0 mimpap for face &quot;</span></div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;                   &lt;&lt; <a class="code" href="classion_1_1base_1_1_enum_helper.html#a6825259ec168f1dd2639a194f543997b">base::EnumHelper::GetString</a>(face) &lt;&lt; <span class="stringliteral">&quot; of cubemap \&quot;&quot;</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;                   &lt;&lt; texture.GetLabel()</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;\&quot; does not have square dimensions. OpenGL requires &quot;</span></div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;cubemap faces to have square dimensions&quot;</span>;</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;      }</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    }</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;  }</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;  <span class="keywordflow">if</span> (need_to_generate_mipmaps)</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    gm-&gt;GenerateMipmap(gl_target_);</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 6; ++j) {</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90c">CubeMapTexture::CubeFace</a> face =</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;        <span class="keyword">static_cast&lt;</span><a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90c">CubeMapTexture::CubeFace</a><span class="keyword">&gt;</span>(j);</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> base_subimage_bit = <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a3bc28b6f02de422506a28cf596b9cd02aa2656a15be36cab8225fd55f5f543c9d">CubeMapTexture::kNegativeXSubImageChanged</a>;</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> base_mipmap_bit =</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;        <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a3bc28b6f02de422506a28cf596b9cd02ad8eeadd01252aeaccd97f6c0abaa4752">CubeMapTexture::kNegativeXMipmapChanged</a> + j * kSlotCount;</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    <span class="keywordflow">if</span> (TestModifiedBitRange(base_mipmap_bit, base_mipmap_bit + kSlotCount) &amp;&amp;</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;        texture.HasImage(face, 0U)) {</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;      <span class="keyword">const</span> Image&amp; image0 = *texture.GetImage(face, 0U);</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;      <span class="keyword">const</span> GLenum target = image0.GetDimensions() == <a class="code" href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a4f15255e18cf8038ebd2ea1337fe36c9">Image::k3d</a></div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;                                ? gl_target_</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;                                : <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(face);</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 1; i &lt; required_levels[j]; ++i) {</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;        <span class="keywordflow">if</span> (texture.HasImage(face, i) &amp;&amp;</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;            CheckImage(*texture.GetImage(face, i), <a class="code" href="fontimage_8cc.html#a05732ec89e3a90546399c62f2c7d90ac">texture</a>) &amp;&amp;</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;            (need_to_generate_mipmaps ||</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;             TestModifiedBit(static_cast&lt;int&gt;(base_mipmap_bit + i)))) {</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;          <span class="keywordflow">if</span> (!UpdateImage(image0, *texture.GetImage(face, i), <a class="code" href="fontimage_8cc.html#a05732ec89e3a90546399c62f2c7d90ac">texture</a>, target,</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;                           <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(i), gm)) {</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;            images_have_changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;          }</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        }</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;      }</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;    }</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;    <span class="keywordflow">if</span> (TestModifiedBit(base_subimage_bit + j)) {</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;      <span class="keyword">const</span> GLenum target = <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(face);</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;      UpdateSubImages(texture.GetSubImages(face), target, gm);</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;      texture.ClearSubImages(face);</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    }</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;  }</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  <span class="keywordflow">if</span> (Sampler* sampler = texture.GetSampler().Get())</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    UpdateMipmapGeneration(*sampler, images_have_changed, gm);</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;}</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;<span class="keyword">class </span>Renderer::ShaderResource : <span class="keyword">public</span> Resource&lt;Shader::kNumChanges&gt; {</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;  ShaderResource(ResourceBinder* rb, ResourceManager* rm, <span class="keyword">const</span> Shader&amp; shader,</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;                 <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key, GLuint <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;      : <a class="code" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">Renderer</a>::Resource&lt;Shader::kNumChanges&gt;(rm, shader, key, id),</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;        shader_type_(GL_INVALID_ENUM) {}</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;  ~ShaderResource()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(id_ == 0U || !<a class="code" href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">portgfx::Visual::GetCurrent</a>());</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  }</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> UpdateShader(ResourceBinder* rb);</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;  <span class="keywordtype">void</span> Release(<span class="keywordtype">bool</span> can_make_gl_calls) <span class="keyword">override</span>;</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;  ResourceType GetType()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a813a96489fc6982cfca789dae313c193">kShader</a>; }</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;  <span class="keywordtype">void</span> SetShaderType(GLenum type) { shader_type_ = <a class="code" href="printer_8cc.html#a75b160f574a0be26114bae2c7686a5e1">type</a>; }</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;  <span class="keyword">const</span> Shader&amp; GetShader()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>Shader&amp;<span class="keyword">&gt;</span>(*<a class="code" href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">GetHolder</a>());</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;  }</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;  <span class="keywordtype">void</span> Bind(ResourceBinder* rb) {}</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;  <span class="keywordtype">void</span> Unbind(ResourceBinder* rb)<span class="keyword"> override </span>{}</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;  <span class="keywordtype">void</span> Update(ResourceBinder* rb)<span class="keyword"> override </span>{}</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;  GLenum shader_type_;</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;};</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;<span class="keywordtype">bool</span> Renderer::ShaderResource::UpdateShader(ResourceBinder* rb) {</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;  <span class="keywordflow">if</span> (AnyModifiedBitsSet()) {</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;    Update(rb);</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    <span class="keyword">const</span> Shader&amp; shader = GetShader();</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;    <span class="keyword">const</span> std::string&amp; id_string = shader.GetLabel();</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    std::string info_log = shader.GetInfoLog();</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    <span class="keywordtype">bool</span> need_to_update_label = TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488eafbaf96637df1fba193f735aa8689222c">ResourceHolder::kLabelChanged</a>);</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;    <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_shader.html#aecfb1ee58b3530a2b745a2a654202ceeaf8e0be2c28c08d7e1949a3b1d474cf4b">Shader::kSourceChanged</a>)) {</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;      GLuint <span class="keywordtype">id</span> = CompileShader(id_string, shader_type_, shader.GetSource(),</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;                                &amp;info_log, gm);</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;      <span class="keywordflow">if</span> (<span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;        id_ = <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>;</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;        need_to_update_label = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;      }</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;    }</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    <span class="keywordflow">if</span> (need_to_update_label)</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;      SetObjectLabel(gm, <a class="code" href="glheaders_8h.html#a5d386805398c2f55ae253acecb38089e">GL_SHADER_OBJECT</a>, id_, id_string);</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    shader.SetInfoLog(info_log);</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;    ResetModifiedBits();</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;  }</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;}</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;<span class="keywordtype">void</span> Renderer::ShaderResource::Release(<span class="keywordtype">bool</span> can_make_gl_calls) {</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  BaseResourceType::Release(can_make_gl_calls);</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;  GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;  <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <span class="keywordflow">if</span> (resource_owns_gl_id_ &amp;&amp; can_make_gl_calls)</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;      gm-&gt;DeleteShader(id_);</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    id_ = 0;</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;  }</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;}</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;<span class="keyword">class </span>Renderer::ShaderInputRegistryResource</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;    : <span class="keyword">public</span> Resource&lt;ShaderInputRegistry::kNumChanges&gt; {</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;  ShaderInputRegistryResource(ResourceBinder* rb, ResourceManager* rm,</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;                              <span class="keyword">const</span> ShaderInputRegistry&amp; reg,</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;                              <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key, GLuint <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      : <a class="code" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">Renderer</a>::Resource&lt;ShaderInputRegistry::kNumChanges&gt;(rm, reg, key, id),</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;        uniform_stacks_(reg.<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()) {</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;    uniform_stacks_.reserve(reg.GetSpecs&lt;Uniform&gt;().size());</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;  }</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;  ~ShaderInputRegistryResource()<span class="keyword"> override </span>{}</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;  ResourceType GetType()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a85ad8164455e6994e3304e287c9df6bc">kShaderInputRegistry</a>; }</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;  <span class="keywordtype">void</span> Unbind(ResourceBinder* rb)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; stack : uniform_stacks_)</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;      stack-&gt;Clear();</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;  }</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;  <span class="keyword">const</span> Uniform&amp; GetUniform(<span class="keywordtype">size_t</span> index)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(index, uniform_stacks_.size());</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    <span class="keywordflow">return</span> *uniform_stacks_[index]-&gt;GetTop();</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;  }</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;  <span class="keywordtype">void</span> SetInitialValue(<span class="keyword">const</span> Uniform&amp; u) {</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(&amp;u.GetRegistry(), &amp;GetRegistry());</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(u.GetIndexInRegistry(), uniform_stacks_.size());</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    UniformStack&amp; uis = *uniform_stacks_[u.GetIndexInRegistry()];</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    uis.SetBottom(u);</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;  }</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;  <span class="keywordtype">void</span> PushUniform(<span class="keyword">const</span> Uniform&amp; u) {</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(&amp;u.GetRegistry(), &amp;GetRegistry());</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;    <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(u.GetIndexInRegistry(), uniform_stacks_.size());</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(u.IsValid());</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    UniformStack&amp; uis = *uniform_stacks_[u.GetIndexInRegistry()];</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;    <span class="keyword">const</span> ShaderInputRegistry::CombineFunction&lt;Uniform&gt;::Type&amp; combine_func =</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#a6938655fdb469df98f180e73711ffb74">ShaderInputRegistry::GetSpec</a>(u)-&gt;combine_function;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;    <span class="keyword">const</span> ShaderInputRegistry::GenerateFunction&lt;Uniform&gt;::Type&amp; generate_func =</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;        <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#a6938655fdb469df98f180e73711ffb74">ShaderInputRegistry::GetSpec</a>(u)-&gt;generate_function;</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;    <span class="keyword">const</span> Uniform&amp; top = *uis.GetTop();</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    Uniform* temp = uis.GetTopTempUniform();</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;    <span class="keywordflow">if</span> (combine_func &amp;&amp; top.IsValid()) {</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      *temp = combine_func(top, u);</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;      uis.PushTempUniform(temp);</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classion_1_1gfx_1_1_uniform.html#a14c139d65a99c87b788bcb38cf4ecaf8">Uniform::GetMerged</a>(top, u, temp)) {</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;      uis.PushTempUniform(temp);</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;      uis.Push(&amp;u);</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    }</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;    <span class="keywordflow">if</span> (generate_func) {</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;      std::vector&lt;Uniform&gt; generated = generate_func(*uis.GetTop());</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> count = generated.size();</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;        <span class="keyword">const</span> Uniform&amp; gen = generated[i];</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;        <span class="keywordflow">if</span> (gen.IsValid()) {</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;          <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(&amp;u.GetRegistry(), &amp;GetRegistry());</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;          <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(gen.GetIndexInRegistry(), uniform_stacks_.size());</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;          UniformStack&amp; uis = *uniform_stacks_[gen.GetIndexInRegistry()];</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;          Uniform* temp = uis.GetTopTempUniform();</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;          *temp = gen;</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;          uis.PushTempUniform(temp);</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;        }</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;      }</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;    }</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  }</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;  <span class="keywordtype">void</span> PopUniform(<span class="keyword">const</span> Uniform&amp; u) {</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(&amp;u.GetRegistry(), &amp;GetRegistry());</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;    <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(u.GetIndexInRegistry(), uniform_stacks_.size());</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    uniform_stacks_[u.GetIndexInRegistry()]-&gt;Pop();</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;  }</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;  <span class="keywordtype">void</span> Update(ResourceBinder* rb)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;    <span class="keywordflow">if</span> (AnyModifiedBitsSet()) {</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> size = GetRegistry().GetSpecs&lt;Uniform&gt;().size();</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = uniform_stacks_.size(); i &lt; size; ++i) {</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;        uniform_stacks_.push_back(std::unique_ptr&lt;UniformStack&gt;(</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;            <span class="keyword">new</span>(uniform_stacks_.get_allocator().GetAllocator()) UniformStack));</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;      }</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;      ResetModifiedBits();</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    }</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;  }</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;  <span class="keyword">class </span>UniformStack : <span class="keyword">public</span> <a class="code" href="classion_1_1base_1_1_allocatable.html#a1b65140be876e9bb2e7bba08ed3b69b4">Allocatable</a> {</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;   <span class="keyword">public</span>:</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;    UniformStack()</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;        : uniform_stack_(</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;            base::AllocationManager::GetDefaultAllocatorForLifetime(</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;                base::<a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757ca0e572cccc7b2f48ced01134b3acc3396">kShortTerm</a>)),</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;          temp_stack_(base::AllocationManager::GetDefaultAllocatorForLifetime(</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;              base::<a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757ca0e572cccc7b2f48ced01134b3acc3396">kShortTerm</a>)),</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;          pristine_(true) {</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;      Init();</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;    }</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;    Uniform* GetTopTempUniform() {</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      <a class="code" href="base_2logging_8h.html#ab4f56aa24c4c9cddc47a6abd2d747f9a">DCHECK_GT</a>(temp_stack_.size(), 1U);</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;      <span class="keywordflow">return</span> &amp;temp_stack_.back();</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;    }</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;    <span class="keyword">const</span> Uniform* GetTop()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!uniform_stack_.empty());</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;      <span class="keywordflow">return</span> uniform_stack_.back();</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;    }</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;    <span class="keywordtype">void</span> Pop() {</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!temp_stack_.empty());</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!uniform_stack_.empty());</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;      <span class="keywordflow">if</span> (IsTopATempUniform())</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        temp_stack_.pop_back();</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;      uniform_stack_.pop_back();</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;      pristine_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    }</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;    <span class="keywordtype">void</span> PushTempUniform(Uniform* temp) {</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!uniform_stack_.empty());</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!temp_stack_.empty());</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(temp == GetTopTempUniform());</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;      temp_stack_.push_back(Uniform());</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;      uniform_stack_.push_back(temp);</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;      pristine_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;    }</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    <span class="keywordtype">void</span> Push(<span class="keyword">const</span> Uniform* uniform) {</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!uniform_stack_.empty());</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(uniform != GetTopTempUniform());</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;      uniform_stack_.push_back(uniform);</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;      pristine_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;    }</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    <span class="keywordtype">void</span> SetBottom(<span class="keyword">const</span> Uniform&amp; uniform) {</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!uniform_stack_.empty());</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!temp_stack_.empty());</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;      temp_stack_[0] = uniform;</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;      uniform_stack_[0] = &amp;temp_stack_[0];</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;      pristine_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    }</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <span class="keywordtype">void</span> Clear() {</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;      <span class="keywordflow">if</span> (!pristine_) {</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;        uniform_stack_.clear();</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;        temp_stack_.clear();</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;        Init();</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;        pristine_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;      }</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;    }</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;    <span class="keywordtype">size_t</span> Size()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> uniform_stack_.size(); }</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;   <span class="keyword">private</span>:</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;    <span class="keywordtype">void</span> Init() {</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      temp_stack_.push_back(Uniform());</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;      uniform_stack_.push_back(&amp;temp_stack_.back());</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;      temp_stack_.push_back(Uniform());</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;    }</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    <span class="keywordtype">bool</span> IsTopATempUniform() {</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> size = temp_stack_.size();</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;      <span class="keywordflow">return</span> (size &gt; 1U &amp;&amp;</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;              uniform_stack_.back() == &amp;temp_stack_[size - 2]);</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;    }</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    base::AllocVector&lt;const Uniform*&gt; uniform_stack_;</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;    base::AllocDeque&lt;Uniform&gt; temp_stack_;</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    <span class="keywordtype">bool</span> pristine_;</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;  };</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;  <span class="keyword">const</span> ShaderInputRegistry&amp; GetRegistry()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>ShaderInputRegistry&amp;<span class="keyword">&gt;</span>(*<a class="code" href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">GetHolder</a>());</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;  }</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;  base::AllocVector&lt;std::unique_ptr&lt;UniformStack&gt;&gt; uniform_stacks_;</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;};</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;<span class="keyword">class </span>Renderer::ShaderProgramResource</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    : <span class="keyword">public</span> Resource&lt;ShaderProgram::kNumChanges&gt; {</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;  ShaderProgramResource(ResourceBinder* rb, ResourceManager* rm,</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;                        <span class="keyword">const</span> ShaderProgram&amp; shader_program, <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key,</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;                        GLuint <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;      : <a class="code" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">Renderer</a>::Resource&lt;ShaderProgram::kNumChanges&gt;(rm, shader_program, key,</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;                                                       id),</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;        attribute_index_map_(shader_program.<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()),</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;        uniforms_(shader_program.<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()),</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;        vertex_resource_(nullptr),</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        fragment_resource_(nullptr) {}</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;  GLint GetAttributeIndex(</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;      <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#ad8794cffdad6b1ae0846e189d5cbb1eb">ShaderInputRegistry::AttributeSpec</a>* spec)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;    AttributeIndexMap::const_iterator it = attribute_index_map_.find(spec);</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    <span class="keywordflow">return</span> it == attribute_index_map_.end() ? -1 : it-&gt;second;</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;  }</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;  ~ShaderProgramResource()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(id_ == 0U || !<a class="code" href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">portgfx::Visual::GetCurrent</a>());</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;  }</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;  <span class="keywordtype">void</span> Release(<span class="keywordtype">bool</span> can_make_gl_calls) <span class="keyword">override</span>;</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;  <span class="keywordtype">void</span> Update(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;  ResourceType GetType()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a8e60defeac9388416b220d35aa41f750">kShaderProgram</a>; }</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;  <span class="keywordtype">void</span> Bind(ResourceBinder* rb);</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;  <span class="keywordtype">void</span> Unbind(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;  <span class="keyword">const</span> ShaderProgram&amp; GetShaderProgram()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>ShaderProgram&amp;<span class="keyword">&gt;</span>(*<a class="code" href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">GetHolder</a>());</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;  }</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;  ShaderResource* GetVertexResource()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> vertex_resource_; }</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;  ShaderResource* GetFragmentResource()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> fragment_resource_; }</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;  <span class="keyword">struct </span>UniformCacheEntry {</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;    UniformCacheEntry()</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;        : location(-1),</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;          spec(nullptr),</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;          uniform_stamp(base::<a class="code" href="namespaceion_1_1base.html#a4608f8e50b0898594bbef71d8a9a4ac5">kInvalidIndex</a>),</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;          unit_associations(</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;              base::AllocationManager::GetDefaultAllocatorForLifetime(</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;                  base::<a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757caf03f24745ec5729b9c4ba500f7ff654d">kMediumTerm</a>)) {}</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    UniformCacheEntry(GLint location_in, GLint array_size,</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;                      <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#ac0343455043934c00898cad8f018704f">ShaderInputRegistry::UniformSpec</a>* spec_in)</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;        : location(location_in),</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;          spec(spec_in),</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;          uniform_stamp(base::<a class="code" href="namespaceion_1_1base.html#a4608f8e50b0898594bbef71d8a9a4ac5">kInvalidIndex</a>),</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;          unit_associations(</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;              base::AllocationManager::GetDefaultAllocatorForLifetime(</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;                  base::<a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757caf03f24745ec5729b9c4ba500f7ff654d">kMediumTerm</a>),</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;              array_size, -1) {}</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; GetUnit(<span class="keywordtype">size_t</span> index) {</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(index, unit_associations.size());</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;      <span class="keywordflow">return</span> unit_associations[index];</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    }</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    <span class="keywordtype">void</span> SetUnit(<span class="keywordtype">size_t</span> index, <span class="keywordtype">int</span> unit) {</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;      <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(index, unit_associations.size());</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;      unit_associations[index] = unit;</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    }</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    GLint location;  <span class="comment">// If location is -1 then the value is not valid.</span></div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#ac0343455043934c00898cad8f018704f">ShaderInputRegistry::UniformSpec</a>* spec;</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;    <a class="code" href="classuint64.html">uint64</a> uniform_stamp;</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    base::AllocVector&lt;int&gt; unit_associations;</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;  };</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;  <span class="keyword">typedef</span> base::AllocUnorderedMap&lt;<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#ad8794cffdad6b1ae0846e189d5cbb1eb">ShaderInputRegistry::AttributeSpec</a>*,</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;                                  GLint&gt; AttributeIndexMap;</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;  <span class="keywordtype">void</span> PopulateAttributeCache(GLuint <span class="keywordtype">id</span>, <span class="keyword">const</span> std::string&amp; id_string,</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;                              <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a8890095cb957be1d882f4bcf4a7befdd">ShaderInputRegistryPtr</a>&amp; reg,</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;                              GraphicsManager* gm);</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;  <span class="keywordtype">void</span> PopulateUniformCache();</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;  <span class="keywordtype">void</span> UpdateUniformValues(ResourceBinder* rb);</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;  <span class="keywordtype">bool</span> UpdateUnitAssociations(UniformCacheEntry* entry,</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;                              ResourceBinder* rb,</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;                              <span class="keyword">const</span> Uniform&amp; new_uniform);</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;  <span class="keywordtype">bool</span> UpdateUnitAssociationAndBind(TextureResource* txr,</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;                                    UniformCacheEntry* entry,</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;                                    ResourceBinder* rb,</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;                                    <span class="keywordtype">size_t</span> array_index);</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;  <span class="keywordtype">bool</span> ContainsAnEvictedTexture(<span class="keyword">const</span> Uniform&amp; uniform, ResourceBinder* rb);</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;  AttributeIndexMap attribute_index_map_;</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;  base::AllocVector&lt;UniformCacheEntry&gt; uniforms_;</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;  ShaderResource* vertex_resource_;</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;  ShaderResource* fragment_resource_;</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;};</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;<span class="keywordtype">void</span> Renderer::ShaderProgramResource::PopulateAttributeCache(</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;    GLuint <span class="keywordtype">id</span>, <span class="keyword">const</span> std::string&amp; id_string, <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a8890095cb957be1d882f4bcf4a7befdd">ShaderInputRegistryPtr</a>&amp; reg,</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    GraphicsManager* gm) {</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;  GLint max_length = 0;</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;  GLint attribute_count = 0;</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;  gm-&gt;GetProgramiv(<span class="keywordtype">id</span>, GL_ACTIVE_ATTRIBUTES, &amp;attribute_count);</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;  <span class="keywordflow">if</span> (attribute_count) {</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;    attribute_index_map_.clear();</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;    gm-&gt;GetProgramiv(<span class="keywordtype">id</span>, GL_ACTIVE_ATTRIBUTE_MAX_LENGTH, &amp;max_length);</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> GLint kMaxNameLength = 4096;</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;    <span class="keywordtype">char</span> name[kMaxNameLength];</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;    max_length =</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;        std::min(kMaxNameLength, max_length == 0 ? kMaxNameLength : max_length);</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;    GLsizei <a class="code" href="calltracemanager_8cc.html#ae4f719e9aed394c364b0e8c7dbb2e67a">length</a>;</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;    GLint size;</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;    GLuint <a class="code" href="printer_8cc.html#a75b160f574a0be26114bae2c7686a5e1">type</a>;</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceion_1_1base.html#a43c6663b5bdd5e5839eba0729b613c28">base::AllocatorPtr</a>&amp; allocator =</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;        GetShaderProgram().GetAllocator()-&gt;<a class="code" href="classion_1_1base_1_1_allocator.html#a923668f6616963795194b86411b14c3f">GetAllocatorForLifetime</a>(</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;            <a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757ca0e572cccc7b2f48ced01134b3acc3396">base::kShortTerm</a>);</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;    base::AllocVector&lt;GLenum&gt; buffer_types(allocator);</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;    base::AllocVector&lt;GLenum&gt; simple_types(allocator);</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;    base::AllocVector&lt;const ShaderInputRegistry::AttributeSpec*&gt;</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;        buffer_attributes(allocator);</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;    base::AllocVector&lt;const ShaderInputRegistry::AttributeSpec*&gt;</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;        simple_attributes(allocator);</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;    <span class="keywordflow">for</span> (GLint i = 0; i &lt; attribute_count; ++i) {</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;      name[0] = 0;</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;      gm-&gt;GetActiveAttrib(<span class="keywordtype">id</span>, i, max_length, &amp;length, &amp;size, &amp;type, name);</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#ad8794cffdad6b1ae0846e189d5cbb1eb">ShaderInputRegistry::AttributeSpec</a>* spec =</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;              reg-&gt;Find&lt;Attribute&gt;(name)) {</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;        <span class="keywordflow">if</span> (spec-&gt;value_type == <a class="code" href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a67b53e83d15820215144663e1d0d7d31">kBufferObjectElementAttribute</a>) {</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;          buffer_attributes.push_back(spec);</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;          buffer_types.push_back(type);</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;          simple_attributes.push_back(spec);</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;          simple_types.push_back(type);</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;        }</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;        <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;gl_InstanceID&quot;</span>) != 0) {</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;          <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Attribute &#39;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;&#39; used in shader &#39;&quot;</span></div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;                       &lt;&lt; GetShaderProgram().GetLabel()</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot;&#39; does not have a registry entry&quot;</span>;</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;        }</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;      }</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;    }</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;    GLuint attribute_index = 0;</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    GLuint count = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(buffer_attributes.size());</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;    <span class="keywordflow">for</span> (GLuint i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      attribute_index_map_[buffer_attributes[i]] =</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;          <span class="keyword">static_cast&lt;</span>GLint<span class="keyword">&gt;</span>(attribute_index);</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;      gm-&gt;BindAttribLocation(<span class="keywordtype">id</span>, attribute_index,</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;                             buffer_attributes[i]-&gt;name.c_str());</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;      attribute_index += GetAttributeSlotCountByGlType(buffer_types[i]);</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;    }</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;    count = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(simple_attributes.size());</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;    <span class="keywordflow">for</span> (GLuint i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;      attribute_index_map_[simple_attributes[i]] =</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;          <span class="keyword">static_cast&lt;</span>GLint<span class="keyword">&gt;</span>(attribute_index);</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;      gm-&gt;BindAttribLocation(<span class="keywordtype">id</span>, attribute_index,</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;                             simple_attributes[i]-&gt;name.c_str());</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;      attribute_index += GetAttributeSlotCountByGlType(simple_types[i]);</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;    }</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;  }</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;}</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;<span class="keywordtype">void</span> Renderer::ShaderProgramResource::PopulateUniformCache() {</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;  <span class="keyword">const</span> ShaderProgram&amp; shader_program = GetShaderProgram();</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a8890095cb957be1d882f4bcf4a7befdd">ShaderInputRegistryPtr</a>&amp; reg = shader_program.GetRegistry();</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;  GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;  GLint max_length = 0;</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;  GLuint uniform_count = 0;</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;  gm-&gt;GetProgramiv(id_, GL_ACTIVE_UNIFORMS,</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;                   reinterpret_cast&lt;GLint*&gt;(&amp;uniform_count));</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;  uniforms_.clear();</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;  <span class="keywordflow">if</span> (uniform_count) {</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;    gm-&gt;GetProgramiv(id_, GL_ACTIVE_UNIFORM_MAX_LENGTH, &amp;max_length);</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> GLint kMaxNameLength = 4096;</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;    <span class="keywordtype">char</span> name[kMaxNameLength];</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;    max_length =</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;        std::min(kMaxNameLength, max_length == 0 ? kMaxNameLength : max_length);</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;    GLsizei <a class="code" href="calltracemanager_8cc.html#ae4f719e9aed394c364b0e8c7dbb2e67a">length</a>;</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    GLint size;</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    uniforms_.reserve(uniform_count);</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;    <span class="keywordflow">for</span> (GLuint i = 0; i &lt; uniform_count; ++i) {</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;      name[0] = 0;</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;      GLenum <a class="code" href="printer_8cc.html#a75b160f574a0be26114bae2c7686a5e1">type</a>;</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;      gm-&gt;GetActiveUniform(id_, i, max_length, &amp;length, &amp;size, &amp;type, name);</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; kMaxNameLength; i++) {</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;        <span class="keywordflow">if</span> (name[i] == <span class="charliteral">&#39;[&#39;</span> || name[i] == 0) {</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;          name[i] = 0;</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;        }</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;      }</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#ac0343455043934c00898cad8f018704f">ShaderInputRegistry::UniformSpec</a>* spec =</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;              reg-&gt;Find&lt;Uniform&gt;(name)) {</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;        <span class="keywordflow">if</span> (!ValidateUniformType(name, spec-&gt;value_type, type)) {</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;          TracingHelper helper;</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;          <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Uniform &#39;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;&#39; has a&quot;</span></div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot; different type from its spec: spec type: &quot;</span></div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;                       &lt;&lt; spec-&gt;value_type</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot;, uniform type: &quot;</span> &lt;&lt; helper.ToString(<span class="stringliteral">&quot;GLenum&quot;</span>, type);</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;        }</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> location = gm-&gt;GetUniformLocation(id_, name);</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;        uniforms_.push_back(UniformCacheEntry(location, size, spec));</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Uniform &#39;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;&#39; used in shader &#39;&quot;</span></div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;                     &lt;&lt; shader_program.GetLabel()</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;&#39; does not have a registry entry&quot;</span>;</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;      }</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;    }</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;  }</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;}</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;<span class="keywordtype">bool</span> Renderer::ShaderProgramResource::ContainsAnEvictedTexture(</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;    <span class="keyword">const</span> Uniform&amp; uniform, ResourceBinder* rb) {</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;  <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;  <span class="keywordflow">if</span> (uniform.IsValid()) {</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;    <span class="keywordflow">if</span> (uniform.GetType() == <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a81b379b9dc3585ac8815021f56f90c41">kCubeMapTextureUniform</a>) {</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">size_t</span> count = uniform.GetCount()) {</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;          <span class="keywordflow">if</span> (TextureResource* txr = GetResource(</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;                  uniform.GetValueAt&lt;<a class="code" href="namespaceion_1_1gfx.html#a81b2f5774e09c716e183034bc2b6aeab">CubeMapTexturePtr</a>&gt;(i).Get(), rb)) {</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;            <span class="keywordflow">if</span> (rb-&gt;WasTextureEvicted(txr)) {</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;              ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;            }</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;          }</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;        }</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (TextureResource* txr = GetResource(</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;                     uniform.GetValue&lt;<a class="code" href="namespaceion_1_1gfx.html#a81b2f5774e09c716e183034bc2b6aeab">CubeMapTexturePtr</a>&gt;().Get(), rb)) {</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;        ret = rb-&gt;WasTextureEvicted(txr);</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;      }</div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uniform.GetType() == <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1fb38ca96a9985f325f838de5757e95d">kTextureUniform</a>) {</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">size_t</span> count = uniform.GetCount()) {</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;          <span class="keywordflow">if</span> (TextureResource* txr =</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;                  GetResource(uniform.GetValueAt&lt;<a class="code" href="namespaceion_1_1gfx.html#a898ebd00d721a2589edc7d818ff17533">TexturePtr</a>&gt;(i).Get(), rb)) {</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;            <span class="keywordflow">if</span> (rb-&gt;WasTextureEvicted(txr)) {</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;              ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;            }</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;          }</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;        }</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (TextureResource* txr =</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;                     GetResource(uniform.GetValue&lt;<a class="code" href="namespaceion_1_1gfx.html#a898ebd00d721a2589edc7d818ff17533">TexturePtr</a>&gt;().Get(), rb)) {</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;        ret = rb-&gt;WasTextureEvicted(txr);</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;      }</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;    }</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;  }</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;  <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;}</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;<span class="keywordtype">bool</span> Renderer::ShaderProgramResource::UpdateUnitAssociations(</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;    UniformCacheEntry* entry, ResourceBinder* rb, <span class="keyword">const</span> Uniform&amp; u) {</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;  <span class="keywordtype">bool</span> changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;  <span class="keywordflow">if</span> (u.GetType() == <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a81b379b9dc3585ac8815021f56f90c41">kCubeMapTextureUniform</a>) {</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">size_t</span> count = u.GetCount()) {</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;        <span class="keywordflow">if</span> (TextureResource* txr =</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;                GetResource(u.GetValueAt&lt;<a class="code" href="namespaceion_1_1gfx.html#a81b2f5774e09c716e183034bc2b6aeab">CubeMapTexturePtr</a>&gt;(i).Get(), rb)) {</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;          changed = UpdateUnitAssociationAndBind(txr, entry, rb, i) || changed;</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;        }</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;      }</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (TextureResource* txr =</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;                   GetResource(u.GetValue&lt;<a class="code" href="namespaceion_1_1gfx.html#a81b2f5774e09c716e183034bc2b6aeab">CubeMapTexturePtr</a>&gt;().Get(), rb)) {</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;      changed = UpdateUnitAssociationAndBind(txr, entry, rb, 0);</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;    }</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (u.GetType() == <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1fb38ca96a9985f325f838de5757e95d">kTextureUniform</a>) {</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">size_t</span> count = u.GetCount()) {</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;        <span class="keywordflow">if</span> (TextureResource* txr =</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;                GetResource(u.GetValueAt&lt;<a class="code" href="namespaceion_1_1gfx.html#a898ebd00d721a2589edc7d818ff17533">TexturePtr</a>&gt;(i).Get(), rb)) {</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;          changed = UpdateUnitAssociationAndBind(txr, entry, rb, i) || changed;</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;        }</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;      }</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (TextureResource* txr =</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;                   GetResource(u.GetValue&lt;<a class="code" href="namespaceion_1_1gfx.html#a898ebd00d721a2589edc7d818ff17533">TexturePtr</a>&gt;().Get(), rb)) {</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;      changed = UpdateUnitAssociationAndBind(txr, entry, rb, 0);</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;    }</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;  }</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;  <span class="keywordflow">return</span> changed;</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;}</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;<span class="keywordtype">bool</span> Renderer::ShaderProgramResource::UpdateUnitAssociationAndBind(</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;    TextureResource* txr, UniformCacheEntry* entry, ResourceBinder* rb,</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;    <span class="keywordtype">size_t</span> array_index) {</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; cached_unit = entry-&gt;GetUnit(array_index);</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> last_unit_sent = cached_unit;</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> new_unit =</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;      <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(txr-&gt;ObtainImageUnit(rb, &amp;cached_unit, cached_unit));</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;  txr-&gt;BindToUnit(rb, new_unit);</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;  entry-&gt;SetUnit(array_index, new_unit);</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;  <span class="keywordflow">return</span> cached_unit != last_unit_sent;</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;}</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;<span class="keywordtype">void</span> Renderer::ShaderProgramResource::UpdateUniformValues(ResourceBinder* rb) {</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;  GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> uniform_count = uniforms_.size();</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; uniform_count; ++i) {</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;    UniformCacheEntry&amp; entry = uniforms_[i];</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    ShaderInputRegistryResource* sirr = GetResource(entry.spec-&gt;registry, rb);</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;    sirr-&gt;Update(rb);</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;    <span class="keyword">const</span> Uniform&amp; uniform = sirr-&gt;GetUniform(entry.spec-&gt;index);</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;    <span class="keywordflow">if</span> (!uniform.IsValid()) {</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;      <span class="keywordflow">if</span> (!rb-&gt;IsProcessingInfoRequests()) {</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: There is no value set for uniform &#39;&quot;</span></div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;                     &lt;&lt; entry.spec-&gt;name &lt;&lt; <span class="stringliteral">&quot;&#39; for shader program &#39;&quot;</span></div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;                     &lt;&lt; GetShaderProgram().GetLabel() &lt;&lt; <span class="stringliteral">&quot;&#39;, rendering&quot;</span></div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot; results may be unexpected&quot;</span>;</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;      }</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;    }</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;    <span class="keywordtype">bool</span> skip_sending_uniform = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;    <span class="keywordtype">bool</span> unit_changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;    <span class="keywordflow">if</span> (uniform.GetType() == <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1fb38ca96a9985f325f838de5757e95d">kTextureUniform</a> ||</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;        uniform.GetType() == <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a81b379b9dc3585ac8815021f56f90c41">kCubeMapTextureUniform</a>) {</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;      unit_changed = UpdateUnitAssociations(&amp;entry, rb, uniform);</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;      skip_sending_uniform = !unit_changed;</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;    }</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;    <span class="keywordflow">if</span> (unit_changed ||  <span class="comment">// Texture unit changed.</span></div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;        entry.uniform_stamp != uniform.GetStamp() ||</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;        ContainsAnEvictedTexture(uniform, rb)) {</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;      entry.uniform_stamp = uniform.GetStamp();</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;      ScopedLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(rb, &amp;uniform, entry.spec-&gt;name);</div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;      <span class="keywordflow">if</span> (!skip_sending_uniform) {</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;        rb-&gt;SendUniform(uniform, entry.location, gm);</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;      }</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;    }</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;  }</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;}</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;<span class="keywordtype">void</span> Renderer::ShaderProgramResource::Update(ResourceBinder* rb) {</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;  <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_shader_program.html#a99706705feda117b2c04b0453451c2adaac532cb5d784e09e0ef8aaffc24388c6">ShaderProgram::kVertexShaderChanged</a>))</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;    vertex_resource_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;  <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_shader_program.html#a99706705feda117b2c04b0453451c2ada1ac0292458617f7813813f080155fadb">ShaderProgram::kFragmentShaderChanged</a>))</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;    fragment_resource_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> vertex_updated =</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;      vertex_resource_ &amp;&amp; vertex_resource_-&gt;UpdateShader(rb);</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> fragment_updated =</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;      fragment_resource_ &amp;&amp; fragment_resource_-&gt;UpdateShader(rb);</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;  <span class="keywordflow">if</span> (vertex_updated || fragment_updated || AnyModifiedBitsSet()) {</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;    ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;    <span class="keyword">const</span> ShaderProgram&amp; shader_program = GetShaderProgram();</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;    <span class="keywordflow">if</span> (!vertex_resource_) {</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;      <span class="keywordflow">if</span> (Shader* shader = shader_program.GetVertexShader().Get()) {</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;        <span class="keywordflow">if</span> ((vertex_resource_ = GetResource(shader, rb), rb)) {</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;          vertex_resource_-&gt;SetShaderType(GL_VERTEX_SHADER);</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;          vertex_resource_-&gt;UpdateShader(rb);</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;        }</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;      }</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;    }</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;    <span class="keywordflow">if</span> (!fragment_resource_) {</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;      <span class="keywordflow">if</span> (Shader* shader = shader_program.GetFragmentShader().Get()) {</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;        <span class="keywordflow">if</span> ((fragment_resource_ = GetResource(shader, rb))) {</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;          fragment_resource_-&gt;SetShaderType(GL_FRAGMENT_SHADER);</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;          fragment_resource_-&gt;UpdateShader(rb);</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;        }</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;      }</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;    }</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;    <span class="keyword">const</span> GLuint vertex_shader_id =</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;        vertex_resource_ ? vertex_resource_-&gt;GetId() : 0;</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;    <span class="keyword">const</span> GLuint fragment_shader_id =</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;        fragment_resource_ ? fragment_resource_-&gt;GetId() : 0;</div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;    <span class="keyword">const</span> std::string&amp; id_string = shader_program.GetLabel();</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;    GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;    std::string info_log = shader_program.GetInfoLog();</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;    GLuint <span class="keywordtype">id</span> = LinkShaderProgram(id_string, vertex_shader_id,</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;                                  fragment_shader_id, &amp;info_log, gm);</div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> != 0) {</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a8890095cb957be1d882f4bcf4a7befdd">ShaderInputRegistryPtr</a>&amp; reg = shader_program.GetRegistry();</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;      <span class="keywordflow">if</span> (!reg-&gt;CheckInputsAreUnique()) {</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Registry &#39;&quot;</span> &lt;&lt; reg-&gt;GetId() &lt;&lt; <span class="stringliteral">&quot; contains&quot;</span></div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot; multiple definitions of some inputs, rendering&quot;</span></div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot; results may be unexpected&quot;</span>;</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;      }</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;      PopulateAttributeCache(<span class="keywordtype">id</span>, id_string, reg, gm);</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;      <span class="keywordtype">id</span> = RelinkShaderProgram(id_string, <span class="keywordtype">id</span>, vertex_shader_id,</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;                               fragment_shader_id, &amp;info_log, gm);</div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;      <span class="keywordtype">bool</span> need_to_update_label =</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;          vertex_updated || fragment_updated ||</div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;          TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488eafbaf96637df1fba193f735aa8689222c">ResourceHolder::kLabelChanged</a>);</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;      <span class="keywordflow">if</span> (<span class="keywordtype">id</span> != 0) {</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;        id_ = <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>;</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;        need_to_update_label = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;      }</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;      PopulateUniformCache();</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;      <span class="keywordflow">if</span> (need_to_update_label)</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;        SetObjectLabel(gm, <a class="code" href="glheaders_8h.html#ad23474d5b9f69e723740279f19668a0b">GL_PROGRAM_OBJECT</a>, id_, shader_program.GetLabel());</div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;    }</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;    shader_program.SetInfoLog(info_log);</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;    ResetModifiedBits();</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;  }</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;}</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;<span class="keywordtype">void</span> Renderer::ShaderProgramResource::Bind(ResourceBinder* rb) {</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;  Update(rb);</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;  <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;    ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;    rb-&gt;BindProgram(id_, <span class="keyword">this</span>);</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;    UpdateUniformValues(rb);</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;  }</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;}</div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;<span class="keywordtype">void</span> Renderer::ShaderProgramResource::Unbind(ResourceBinder* rb) {</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;  <span class="keywordflow">if</span> (rb)</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;    rb-&gt;ClearProgramBinding(id_);</div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;}</div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;<span class="keywordtype">void</span> Renderer::ShaderProgramResource::Release(<span class="keywordtype">bool</span> can_make_gl_calls) {</div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;  BaseResourceType::Release(can_make_gl_calls);</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;  <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;    base::ReadLock read_lock(GetResourceBinderLock());</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;    <a class="code" href="namespaceion_1_1base.html#ab470a11cceef7441df42bf6f489a69e5">base::ReadGuard</a> read_guard(&amp;read_lock);</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;    ResourceBinderMap&amp; binders = GetResourceBinderMap();</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;    <span class="keywordflow">for</span> (ResourceBinderMap::iterator it = binders.begin();</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;         it != binders.end();</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;         ++it) {</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;      Unbind(it-&gt;second.get());</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;      it-&gt;second-&gt;EraseVertexArrayKey(<span class="keyword">this</span>);</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;    }</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;    <span class="keywordflow">if</span> (resource_owns_gl_id_ &amp;&amp; can_make_gl_calls)</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;      GetGraphicsManager()-&gt;DeleteProgram(id_);</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;    id_ = 0;</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;  }</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;}</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;<span class="keyword">class </span>Renderer::BufferResource : <span class="keyword">public</span> Resource&lt;BufferObject::kNumChanges&gt; {</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;  BufferResource(ResourceBinder* rb, ResourceManager* rm,</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;                 <span class="keyword">const</span> BufferObject&amp; buffer_object, <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key, GLuint <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      : <a class="code" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">Renderer</a>::Resource&lt;BufferObject::kNumChanges&gt;(rm, buffer_object, key,</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;                                                      id),</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;        target_(buffer_object.GetTarget()),</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;        gl_target_(base::EnumHelper::GetConstant(target_)) {}</div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;</div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;  ~BufferResource()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(id_ == 0U || !<a class="code" href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">portgfx::Visual::GetCurrent</a>());</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;  }</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;  <span class="keywordtype">void</span> Release(<span class="keywordtype">bool</span> can_make_gl_calls) <span class="keyword">override</span>;</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;  <span class="keywordtype">void</span> Update(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;  ResourceType GetType()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48af218895b0ea64fb55e541c7a266d3b89">kBufferObject</a>; }</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;  <span class="keywordtype">void</span> Bind(ResourceBinder* rb);</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;  <span class="keywordtype">void</span> Unbind(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;</div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;  GLuint GetGlTarget()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> gl_target_; }</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;</div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;  <span class="keywordtype">void</span> UploadData();</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;  <span class="keywordtype">void</span> UploadSubData(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a>&amp; range, <span class="keyword">const</span> <span class="keywordtype">void</span>* data) <span class="keyword">const</span>;</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;  <span class="keywordtype">void</span> CopySubData(ResourceBinder* rb,</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;                   BufferResource* src_resource,</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a>&amp; range,</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;                   uint32 read_offset);</div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;  <span class="keywordtype">void</span> OnDestroyed()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;    <span class="keywordflow">if</span> (target_ == <a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521ad4c833c4af4b6e7e3d67173d7185ef38">BufferObject::kElementBuffer</a>)</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;      <a class="code" href="classion_1_1gfx_1_1_renderer.html#aa71c7f5c7a6cc8b71ab0a0d713a7781b">GetResourceManager</a>()-&gt;DisassociateElementBufferFromArrays(<span class="keyword">this</span>);</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;    UnbindAll();</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;    Renderer::Resource&lt;BufferObject::kNumChanges&gt;::OnDestroyed();</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;  }</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;  <span class="keyword">const</span> BufferObject&amp; GetBufferObject()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>BufferObject&amp;<span class="keyword">&gt;</span>(*<a class="code" href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">GetHolder</a>());</div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;  }</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521">BufferObject::Target</a> target_;</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;  GLuint gl_target_;</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;};</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;<span class="keywordtype">void</span> Renderer::BufferResource::Bind(ResourceBinder* rb) {</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;  Update(rb);</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;  <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;    ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;    rb-&gt;BindBuffer(target_, id_, <span class="keyword">this</span>);</div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;  }</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;}</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;<span class="keywordtype">void</span> Renderer::BufferResource::UploadData() {</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;  <span class="keyword">const</span> BufferObject&amp; bo = GetBufferObject();</div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> size = bo.GetStructSize() * bo.GetCount();</div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;  SetUsedGpuMemory(size);</div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;  GetGraphicsManager()-&gt;BufferData(</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;      gl_target_, size, bo.GetData().Get() ? bo.GetData()-&gt;GetData() : <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;      <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(bo.GetUsageMode()));</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;}</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;<span class="keywordtype">void</span> Renderer::BufferResource::UploadSubData(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a>&amp; range,</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;                                             <span class="keyword">const</span> <span class="keywordtype">void</span>* data)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;  GetGraphicsManager()-&gt;BufferSubData(</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;      gl_target_, range.GetMinPoint(), range.GetSize(), data);</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;}</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;<span class="keywordtype">void</span> Renderer::BufferResource::CopySubData(ResourceBinder* rb,</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;                                           BufferResource* src_resource,</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a>&amp; range,</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;                                           uint32 read_offset) {</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;  <span class="keywordflow">if</span> (!src_resource || src_resource == <span class="keyword">this</span>) {</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;    GetGraphicsManager()-&gt;CopyBufferSubData(</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;        gl_target_, gl_target_, read_offset, range.GetMinPoint(),</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;        range.GetSize());</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;    GLuint src_id = src_resource-&gt;GetId();</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;    rb-&gt;BindBuffer(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521aadb6589be4886447f64f949106500e76">BufferObject::kCopyReadBuffer</a>, src_id, src_resource);</div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;    rb-&gt;BindBuffer(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521a41e32311e2fcf193026c56555079f9ca">BufferObject::kCopyWriteBuffer</a>, id_, <span class="keyword">this</span>);</div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;    GetGraphicsManager()-&gt;CopyBufferSubData(</div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;        GL_COPY_READ_BUFFER, GL_COPY_WRITE_BUFFER,</div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;        read_offset, range.GetMinPoint(), range.GetSize());</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;  }</div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;}</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;<span class="keywordtype">void</span> Renderer::BufferResource::Update(ResourceBinder* rb) {</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;  <span class="keywordflow">if</span> (!AnyModifiedBitsSet()) {</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;  }</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;  ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;  GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(gm);</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;  <span class="keywordflow">if</span> (!id_)</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;    gm-&gt;GenBuffers(1, &amp;id_);</div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;  <span class="keywordflow">if</span> (!id_) {</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to create buffer object&quot;</span>;</div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;  }</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;  <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488ea8cdf432d687b44c1099911986875a928">ResourceHolder::kResourceChanged</a>))</div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;    rb-&gt;ClearBufferBinding(target_, id_);</div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;  <span class="keyword">const</span> BufferObject&amp; bo = GetBufferObject();</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;  <span class="keywordflow">if</span> (!bo.GetStructSize()) {</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to update buffer object \&quot;&quot;</span></div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;                 &lt;&lt; bo.GetLabel() &lt;&lt; <span class="stringliteral">&quot;\&quot;: BufferObject&#39;s&quot;</span></div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; struct size is 0&quot;</span>;</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;  }</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;  <span class="keywordflow">if</span> (!bo.GetCount()) {</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to update buffer object \&quot;&quot;</span></div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;                 &lt;&lt; bo.GetLabel() &lt;&lt; <span class="stringliteral">&quot;\&quot;: BufferObject&#39;s&quot;</span></div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; struct count is 0&quot;</span>;</div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;  }</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;  <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(0U, bo.GetCount());</div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;  rb-&gt;BindBuffer(target_, id_, <span class="keyword">this</span>);</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> data_changed = TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a8ffc9c987048f92d603de7f0dd184f38a25829d1a8f040958b322fce457451521">BufferObject::kDataChanged</a>);</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> label_changed = TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488eafbaf96637df1fba193f735aa8689222c">ResourceHolder::kLabelChanged</a>);</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> subdata_changed = TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a8ffc9c987048f92d603de7f0dd184f38ac9799113262a90b484d7071d2cdfa221">BufferObject::kSubDataChanged</a>);</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;  ResetModifiedBits();</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;  <span class="keywordflow">if</span> (data_changed) {</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;    UploadData();</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;    <span class="keywordflow">if</span> (bo.GetData().Get())</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;      bo.GetData()-&gt;WipeData();</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;  }</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;  <span class="keywordflow">if</span> (label_changed)</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;    SetObjectLabel(gm, <a class="code" href="glheaders_8h.html#acd944484891101148770857ce47b2e0e">GL_BUFFER_OBJECT</a>, id_, bo.GetLabel());</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;  <span class="keywordflow">if</span> (subdata_changed) {</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;    <span class="keyword">const</span> base::AllocVector&lt;BufferObject::BufferSubData&gt;&amp; sub_data =</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;        bo.GetSubData();</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> count = sub_data.size();</div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;      <span class="keyword">const</span> BufferObject::BufferSubData&amp; sdata = sub_data[i];</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;      <span class="keywordflow">if</span> (sdata.data.Get() &amp;&amp; sdata.data-&gt;GetData()) {</div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;        UploadSubData(</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;            sdata.range, sdata.data-&gt;GetData&lt;uint8&gt;() + sdata.read_offset);</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;        sdata.data-&gt;WipeData();</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;      }</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;      BufferResource* src_resource = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;      <span class="keywordflow">if</span> (sdata.src.Get()) {</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;        src_resource = GetResource(sdata.src.Get(), rb);</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;        <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(src_resource);</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;        src_resource-&gt;Update(rb);</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;      }</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;      <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a7e4d2216509d272e94aa14114d31a669">GraphicsManager::kCopyBufferSubData</a>)) {</div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;        CopySubData(rb, src_resource, sdata.range, sdata.read_offset);</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;      }</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;      <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a> read_range;</div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;      read_range.SetWithSize(sdata.read_offset, sdata.range.GetSize());</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a>&amp; write_range = sdata.range;</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;      <a class="code" href="namespaceion_1_1gfx.html#a461f30e6f866977271f2c9960237e30c">BufferObjectPtr</a> dst(const_cast&lt;BufferObject*&gt;(&amp;bo));</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;      <a class="code" href="namespaceion_1_1gfx.html#a461f30e6f866977271f2c9960237e30c">BufferObjectPtr</a> src(sdata.src.Get() ? sdata.src : dst);</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;      <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a> union_range;</div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;      <span class="keywordflow">if</span> (src == dst) {</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;        union_range = read_range;</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;        union_range.ExtendByRange(write_range);</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;        rb-&gt;MapBufferObjectDataRange(src, kReadWrite, union_range);</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;        rb-&gt;MapBufferObjectDataRange(src, kReadOnly, read_range);</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;      }</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;      <span class="keywordflow">switch</span> (src-&gt;GetMappedData().data_source) {</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;        <span class="keywordflow">case</span> BufferObject::MappedBufferData::kGpuMapped:</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;        <span class="keywordflow">case</span> BufferObject::MappedBufferData::kDataContainer:</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;          <span class="keywordflow">if</span> (src == dst) {</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;            uint8* data = <span class="keyword">static_cast&lt;</span>uint8*<span class="keyword">&gt;</span>(src-&gt;GetMappedPointer());</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;            memcpy(data +</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;                   write_range.GetMinPoint() - union_range.GetMinPoint(),</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;                   data +</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;                   read_range.GetMinPoint() - union_range.GetMinPoint(),</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;                   write_range.GetSize());</div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;            rb-&gt;MapBufferObjectDataRange(dst, kWriteOnly, write_range);</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;            memcpy(dst-&gt;GetMappedPointer(), src-&gt;GetMappedPointer(),</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;                   write_range.GetSize());</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;            rb-&gt;UnmapBufferObjectData(dst);</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;          }</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;        <span class="keywordflow">case</span> BufferObject::MappedBufferData::kAllocated:</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;          <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to copy buffer object \&quot;&quot;</span></div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;                       &lt;&lt; src-&gt;GetLabel() &lt;&lt; <span class="stringliteral">&quot;\&quot;: BufferObject&#39;s&quot;</span></div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot; DataContainer has been wiped and &quot;</span></div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot; glCopyBufferSubData is not supported.&quot;</span>;</div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;          <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a0ae9c6ad40506517346789803b6c79c8">FATAL</a>) &lt;&lt; <a class="code" href="macros_8h.html#a0687ad8a544bc4ce58b34f03f07a32c6">ION_PRETTY_FUNCTION</a> &lt;&lt;</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;              <span class="stringliteral">&quot;Invalid source for mapped BufferObject data&quot;</span>;</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;      }</div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;      rb-&gt;UnmapBufferObjectData(src);</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;    }</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;    bo.ClearSubData();</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;  }</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;}</div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;<span class="keywordtype">void</span> Renderer::BufferResource::Unbind(ResourceBinder* rb) {</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;  <span class="keywordflow">if</span> (rb)</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;    rb-&gt;ClearBufferBinding(target_, id_);</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;}</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;<span class="keywordtype">void</span> Renderer::BufferResource::Release(<span class="keywordtype">bool</span> can_make_gl_calls) {</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;  BaseResourceType::Release(can_make_gl_calls);</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;  <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;    UnbindAll();</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;    <span class="keywordflow">if</span> (resource_owns_gl_id_ &amp;&amp; can_make_gl_calls)</div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;      GetGraphicsManager()-&gt;DeleteBuffers(1, &amp;id_);</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;    SetUsedGpuMemory(0U);</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;    id_ = 0;</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;  }</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;}</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;</div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;<span class="keyword">class </span>Renderer::FramebufferResource</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;    : <span class="keyword">public</span> Resource&lt;FramebufferObject::kNumChanges&gt; {</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;  FramebufferResource(ResourceBinder* rb, ResourceManager* rm,</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;                      <span class="keyword">const</span> FramebufferObject&amp; fbo, <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key, GLuint <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;      : <a class="code" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">Renderer</a>::Resource&lt;FramebufferObject::kNumChanges&gt;(rm, fbo, key, id),</div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;        color0_id_(0U),</div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;        depth_id_(0U),</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;        stencil_id_(0U) {}</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;  ~FramebufferResource()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>((id_ == 0U &amp;&amp; color0_id_ == 0U &amp;&amp;</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;            depth_id_ == 0U &amp;&amp; stencil_id_ == 0U) ||</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;           !<a class="code" href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">portgfx::Visual::GetCurrent</a>());</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;  }</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;  <span class="keywordtype">void</span> Release(<span class="keywordtype">bool</span> can_make_gl_calls) <span class="keyword">override</span>;</div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;  <span class="keywordtype">void</span> Update(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;  ResourceType GetType()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a5541dbcaa8a562a504dff0b911fee221">kFramebufferObject</a>; }</div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;</div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> Bind(ResourceBinder* rb);</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;  <span class="keywordtype">void</span> Unbind(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;  <span class="keywordtype">void</span> OnDestroyed()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;    Resource&lt;FramebufferObject::kNumChanges&gt;::OnDestroyed();</div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;    UnbindAll();</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;  }</div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;</div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;  GLuint GetColor0Id()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> color0_id_; }</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;  GLuint GetDepthId()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> depth_id_; }</div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;  GLuint GetStencilId()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> stencil_id_; }</div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;</div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;  <span class="keyword">const</span> FramebufferObject&amp; GetFramebufferObject()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>FramebufferObject&amp;<span class="keyword">&gt;</span>(*<a class="code" href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">GetHolder</a>());</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;  }</div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;  <span class="keywordtype">void</span> UpdateAttachment(GraphicsManager* gm, ResourceBinder* rb, GLuint* <span class="keywordtype">id</span>,</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;                        GLenum target, <span class="keyword">const</span> FramebufferObject&amp; fbo,</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;                        <span class="keyword">const</span> FramebufferObject::Attachment&amp; attachment);</div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;  <span class="keywordtype">void</span> UpdateMemoryUsage(<span class="keyword">const</span> FramebufferObject&amp; fbo);</div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;  GLuint color0_id_;</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;  GLuint depth_id_;</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;  GLuint stencil_id_;</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;};</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;</div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;<span class="keywordtype">void</span> Renderer::FramebufferResource::Bind(ResourceBinder* rb) {</div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;  Update(rb);</div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;  ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;  rb-&gt;BindFramebuffer(id_, <span class="keyword">this</span>);</div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;}</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;</div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;<span class="keywordtype">void</span> Renderer::FramebufferResource::UpdateAttachment(</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;    GraphicsManager* gm, ResourceBinder* rb, GLuint* <span class="keywordtype">id</span>, GLenum target,</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;    <span class="keyword">const</span> FramebufferObject&amp; fbo,</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;    <span class="keyword">const</span> FramebufferObject::Attachment&amp; attachment) {</div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;  <span class="keywordflow">if</span> (attachment.GetBinding() == <a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a7930e32a5573b4c03bde1847cb681933a2f3722b93d55e71736055df30d1bc489">FramebufferObject::kUnbound</a>) {</div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;    gm-&gt;FramebufferRenderbuffer(GL_FRAMEBUFFER, target, GL_RENDERBUFFER, 0);</div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (attachment.GetBinding() == <a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a7930e32a5573b4c03bde1847cb681933a4101520f7be4eee5bb6c3237171a3d5e">FramebufferObject::kRenderbuffer</a>) {</div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;    <span class="keywordflow">if</span> (!*<span class="keywordtype">id</span>)</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;      gm-&gt;GenRenderbuffers(1, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;    <span class="keywordflow">if</span> (*<span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;      gm-&gt;BindRenderbuffer(GL_RENDERBUFFER, *<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;      <span class="keywordflow">if</span> (attachment.GetSamples() &gt; 0) {</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;        gm-&gt;RenderbufferStorageMultisample(</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;            GL_RENDERBUFFER,</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;            static_cast&lt;GLsizei&gt;(attachment.GetSamples()),</div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;            <a class="code" href="classion_1_1gfx_1_1_image.html#a7a06522e42b8521c6a9875a74d9b96c1">Image::GetPixelFormat</a>(attachment.GetFormat()).internal_format,</div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;            fbo.GetWidth(), fbo.GetHeight());</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;        <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a> image = attachment.GetImage();</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;        <span class="keywordflow">if</span> (image.Get() &amp;&amp; (image-&gt;GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa51d8ace449d1c8620c488a90c08d765a">Image::kEgl</a> ||</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;            image-&gt;GetType() == <a class="code" href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa6cd47172001c514d63abd9a72c9a08c7">Image::kExternalEgl</a>)) {</div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespaceion_1_1base.html#a9aea056fa3b5c46e3182f5427fb5f010">DataContainerPtr</a>&amp; container = image-&gt;GetData();</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">void</span>* data = container.Get() ? container-&gt;GetData() : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;          <span class="keywordflow">if</span> (data &amp;&amp;</div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;              gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a9c2699f8161b9670b16f330cf54ee671">GraphicsManager::kEglImage</a>)) {</div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;            gm-&gt;EGLImageTargetRenderbufferStorageOES(GL_RENDERBUFFER,</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;                                                     const_cast&lt;void*&gt;(data));</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;          }</div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;          gm-&gt;RenderbufferStorage(</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;            GL_RENDERBUFFER,</div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;            <a class="code" href="classion_1_1gfx_1_1_image.html#a7a06522e42b8521c6a9875a74d9b96c1">Image::GetPixelFormat</a>(attachment.GetFormat()).internal_format,</div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;            fbo.GetWidth(), fbo.GetHeight());</div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;        }</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;      }</div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;      <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to create renderbuffer object.&quot;</span>;</div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;    }</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;    gm-&gt;FramebufferRenderbuffer(GL_FRAMEBUFFER, target, GL_RENDERBUFFER, *<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (attachment.GetBinding() == <a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a7930e32a5573b4c03bde1847cb681933a704ea2cbabd14075e10a36bdebd41791">FramebufferObject::kCubeMapTexture</a>) {</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;    <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(<a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a7930e32a5573b4c03bde1847cb681933a704ea2cbabd14075e10a36bdebd41791">FramebufferObject::kCubeMapTexture</a>, attachment.GetBinding());</div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(attachment.GetCubeMapTexture().Get());</div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;    CubeMapTexture* tex = attachment.GetCubeMapTexture().Get();</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;    TextureResource* tr = GetResource(tex, rb);</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(tr);</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90c">CubeMapTexture::CubeFace</a> face = attachment.GetCubeMapFace();</div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9e">Image::Format</a> format = <a class="code" href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9ea98272f25e8247cf217e5002b62da09c0">Image::kRgba8888</a>;</div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> mip_level = attachment.GetMipLevel();</div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;    <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a> image = tex-&gt;GetImage(face, mip_level);</div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;    <span class="keywordflow">if</span> (image.Get()) {</div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;      format = image-&gt;GetFormat();</div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;      <span class="keywordflow">if</span> (format != <a class="code" href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9ea92410ce017939c741b135249977360c4">Image::kEglImage</a> &amp;&amp;</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;          (image-&gt;GetWidth() != fbo.GetWidth() ||</div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;           image-&gt;GetHeight() != fbo.GetHeight())) {</div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Mismatched CubeMapTexture and FBO dimensions: &quot;</span></div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;                   &lt;&lt; image-&gt;GetWidth() &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; image-&gt;GetHeight()</div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span></div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;                   &lt;&lt; fbo.GetWidth() &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; fbo.GetHeight();</div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;      }</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;      image = <span class="keyword">new</span>(GetAllocatorForLifetime(<a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757caf03f24745ec5729b9c4ba500f7ff654d">base::kMediumTerm</a>)) Image;</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;      image-&gt;Set(format, fbo.GetWidth(), fbo.GetHeight(),</div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;                 <a class="code" href="namespaceion_1_1base.html#a9aea056fa3b5c46e3182f5427fb5f010">DataContainerPtr</a>(<span class="keyword">nullptr</span>));</div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;      tex-&gt;SetImage(face, mip_level, image);</div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;    }</div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;    tr-&gt;Bind(rb);</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;    gm-&gt;FramebufferTexture2D(GL_FRAMEBUFFER, target,</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;                             <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(face), tr-&gt;GetId(),</div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;                             <span class="keyword">static_cast&lt;</span>GLint<span class="keyword">&gt;</span>(mip_level));</div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;    <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(<a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a7930e32a5573b4c03bde1847cb681933ab0fa18121f7fe0c0aec46385103c7149">FramebufferObject::kTexture</a>, attachment.GetBinding());</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(attachment.GetTexture().Get());</div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;</div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;    Texture* tex = attachment.GetTexture().Get();</div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;    TextureResource* tr = GetResource(tex, rb);</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(tr);</div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9e">Image::Format</a> format = <a class="code" href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9ea98272f25e8247cf217e5002b62da09c0">Image::kRgba8888</a>;</div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> mip_level = attachment.GetMipLevel();</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;    <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a> image = tex-&gt;GetImage(mip_level);</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;    <span class="keywordflow">if</span> (image.Get()) {</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;      format = image-&gt;GetFormat();</div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;      <span class="keywordflow">if</span> (format != <a class="code" href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9ea92410ce017939c741b135249977360c4">Image::kEglImage</a> &amp;&amp;</div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;          (image-&gt;GetWidth() != fbo.GetWidth() ||</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;           image-&gt;GetHeight() != fbo.GetHeight())) {</div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Mismatched Texture and FBO dimensions: &quot;</span></div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;                   &lt;&lt; image-&gt;GetWidth() &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; image-&gt;GetHeight()</div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span></div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;                   &lt;&lt; fbo.GetWidth() &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; fbo.GetHeight();</div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;      }</div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;      image = <span class="keyword">new</span>(GetAllocatorForLifetime(<a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757caf03f24745ec5729b9c4ba500f7ff654d">base::kMediumTerm</a>)) Image;</div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;      image-&gt;Set(format, fbo.GetWidth(), fbo.GetHeight(),</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;                 <a class="code" href="namespaceion_1_1base.html#a9aea056fa3b5c46e3182f5427fb5f010">DataContainerPtr</a>(<span class="keyword">nullptr</span>));</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;      tex-&gt;SetImage(mip_level, image);</div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;    }</div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;    tr-&gt;Bind(rb);</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;    gm-&gt;FramebufferTexture2D(GL_FRAMEBUFFER, target, tr-&gt;GetGlTarget(),</div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;                             tr-&gt;GetId(), <span class="keyword">static_cast&lt;</span>GLint<span class="keyword">&gt;</span>(mip_level));</div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;  }</div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;}</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;</div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;<span class="keywordtype">void</span> Renderer::FramebufferResource::UpdateMemoryUsage(</div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;    <span class="keyword">const</span> FramebufferObject&amp; fbo) {</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;  <span class="keywordtype">size_t</span> data_size = 0U;</div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;  <span class="keywordflow">if</span> (color0_id_)</div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;    data_size += <a class="code" href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">Image::ComputeDataSize</a>(fbo.GetColorAttachment(0U).GetFormat(),</div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;                                        fbo.GetWidth(), fbo.GetHeight());</div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;  <span class="keywordflow">if</span> (depth_id_)</div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;    data_size += <a class="code" href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">Image::ComputeDataSize</a>(fbo.GetDepthAttachment().GetFormat(),</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;                                        fbo.GetWidth(), fbo.GetHeight());</div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;  <span class="keywordflow">if</span> (stencil_id_)</div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;    data_size += <a class="code" href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">Image::ComputeDataSize</a>(fbo.GetStencilAttachment().GetFormat(),</div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;                                        fbo.GetWidth(), fbo.GetHeight());</div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;  SetUsedGpuMemory(data_size);</div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;}</div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;</div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;<span class="keywordtype">void</span> Renderer::FramebufferResource::Update(ResourceBinder* rb) {</div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;  <span class="keywordflow">if</span> (AnyModifiedBitsSet()) {</div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;    ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;</div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;    GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(gm);</div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;    <span class="keywordflow">if</span> (!id_) gm-&gt;GenFramebuffers(1, &amp;id_);</div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;    <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;      <span class="keyword">const</span> FramebufferObject&amp; fbo = GetFramebufferObject();</div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;</div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;      rb-&gt;BindFramebuffer(id_, <span class="keyword">this</span>);</div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a129bb303640f34e71c22e8564c7d7fcba640ae637f48f3cf45e3e7e00372491c5">FramebufferObject::kColorAttachmentChanged</a>) ||</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;          TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a129bb303640f34e71c22e8564c7d7fcbaff8702df884fc430161492cfd970ebb4">FramebufferObject::kDimensionsChanged</a>))</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;        UpdateAttachment(gm, rb, &amp;color0_id_, GL_COLOR_ATTACHMENT0, fbo,</div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;                         fbo.GetColorAttachment(0U));</div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a129bb303640f34e71c22e8564c7d7fcbaa8e20dbda2069df4f41f80b2c17584cb">FramebufferObject::kDepthAttachmentChanged</a>) ||</div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;          TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a129bb303640f34e71c22e8564c7d7fcbaff8702df884fc430161492cfd970ebb4">FramebufferObject::kDimensionsChanged</a>))</div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;        UpdateAttachment(gm, rb, &amp;depth_id_, GL_DEPTH_ATTACHMENT, fbo,</div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;                         fbo.GetDepthAttachment());</div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a129bb303640f34e71c22e8564c7d7fcba6ea0a87dc5ac8b995daf29ff06e75818">FramebufferObject::kStencilAttachmentChanged</a>) ||</div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;          TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html#a129bb303640f34e71c22e8564c7d7fcbaff8702df884fc430161492cfd970ebb4">FramebufferObject::kDimensionsChanged</a>))</div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;        UpdateAttachment(gm, rb, &amp;stencil_id_, GL_STENCIL_ATTACHMENT, fbo,</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;                         fbo.GetStencilAttachment());</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;      UpdateMemoryUsage(fbo);</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;</div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488eafbaf96637df1fba193f735aa8689222c">ResourceHolder::kLabelChanged</a>))</div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;        SetObjectLabel(gm, GL_FRAMEBUFFER, id_, fbo.GetLabel());</div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;</div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;      <span class="keyword">const</span> GLenum status = gm-&gt;CheckFramebufferStatus(GL_FRAMEBUFFER);</div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;      <span class="keywordflow">if</span> (status != GL_FRAMEBUFFER_COMPLETE) {</div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>)</div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;***ION: Framebuffer is not complete (error code: 0x&quot;</span></div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;            &lt;&lt; std::hex &lt;&lt; status</div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;)! One of the attachments might have a zero width or &quot;</span></div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;               <span class="stringliteral">&quot;height or a non-drawable format for that attachment type. It &quot;</span></div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;               <span class="stringliteral">&quot;is also possible that a texture attachment violates some &quot;</span></div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;               <span class="stringliteral">&quot;GL-implementation specific set of constraints. Check the FBO &quot;</span></div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;               <span class="stringliteral">&quot;dimensions and try changing the texture state of texture &quot;</span></div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;               <span class="stringliteral">&quot;attachments (e.g. try kNearest or kLinear filtering, don&#39;t use &quot;</span></div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;               <span class="stringliteral">&quot;kRepeat wrapping, etc.).&quot;</span>;</div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;      }</div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;      ResetModifiedBits();</div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;      <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to create framebuffer object.&quot;</span>;</div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;    }</div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;  }</div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;}</div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;</div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;<span class="keywordtype">void</span> Renderer::FramebufferResource::Unbind(ResourceBinder* rb) {</div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;  <span class="keywordflow">if</span> (rb)</div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;    rb-&gt;ClearFramebufferBinding(id_);</div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;}</div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;</div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;<span class="keywordtype">void</span> Renderer::FramebufferResource::Release(<span class="keywordtype">bool</span> can_make_gl_calls) {</div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;  BaseResourceType::Release(can_make_gl_calls);</div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;  <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;    UnbindAll();</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;    <span class="keywordflow">if</span> (can_make_gl_calls) {</div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;      <span class="keywordflow">if</span> (color0_id_ )</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;        GetGraphicsManager()-&gt;DeleteRenderbuffers(1, &amp;color0_id_);</div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;      <span class="keywordflow">if</span> (depth_id_)</div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;        GetGraphicsManager()-&gt;DeleteRenderbuffers(1, &amp;depth_id_);</div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;      <span class="keywordflow">if</span> (stencil_id_)</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;        GetGraphicsManager()-&gt;DeleteRenderbuffers(1, &amp;stencil_id_);</div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;      <span class="keywordflow">if</span> (resource_owns_gl_id_)</div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;        GetGraphicsManager()-&gt;DeleteFramebuffers(1, &amp;id_);</div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;    }</div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;    SetUsedGpuMemory(0U);</div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;    color0_id_ = depth_id_ = stencil_id_ = id_ = 0;</div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;  }</div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;}</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;</div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;</div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;</div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;</div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;<span class="keyword">class </span>Renderer::VertexArrayResource</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;    : <span class="keyword">public</span> Resource&lt;AttributeArray::kNumChanges&gt; {</div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;  VertexArrayResource(ResourceBinder* rb, ResourceManager* rm,</div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;                      <span class="keyword">const</span> AttributeArray&amp; attribute_array, <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key,</div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;                      GLuint <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;      : <a class="code" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">Renderer</a>::Resource&lt;AttributeArray::kNumChanges&gt;(rm, attribute_array,</div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;                                                        key, id),</div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;        buffer_attribute_infos_(attribute_array.<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()),</div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;        simple_attribute_indices_(attribute_array.<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()),</div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;        vertex_count_(0U) {</div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;    PopulateAttributeIndices(rb);</div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;  }</div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;</div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;  ~VertexArrayResource()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(id_ == 0U || !<a class="code" href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">portgfx::Visual::GetCurrent</a>());</div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;  }</div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;</div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;  <span class="keywordtype">void</span> Release(<span class="keywordtype">bool</span> can_make_gl_calls) <span class="keyword">override</span>;</div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;  ResourceType GetType()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a984a3857aee726e827404bd6bf6acf0f">kAttributeArray</a>; }</div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;</div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> BindAndCheckBuffers(<span class="keywordtype">bool</span> force_bind, ResourceBinder* rb);</div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;  <span class="keywordtype">void</span> Unbind(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;</div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;  <span class="keywordtype">size_t</span> GetVertexCount()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> vertex_count_; }</div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;  <span class="keyword">const</span> ResourceBinder::BufferBinding&amp; GetElementArrayBinding()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;    <span class="keywordflow">return</span> element_array_binding_;</div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;  }</div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;  <span class="keywordtype">void</span> SetElementArrayBinding(GLuint <span class="keywordtype">id</span>, BufferResource* resource) {</div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;    element_array_binding_.buffer = <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>;</div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;    element_array_binding_.resource = resource;</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;  }</div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;</div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160; <span class="keyword">protected</span>:</div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;  <span class="keyword">const</span> AttributeArray&amp; GetAttributeArray()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>AttributeArray&amp;<span class="keyword">&gt;</span>(*<a class="code" href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">GetHolder</a>());</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;  }</div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;</div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> UpdateAndCheckBuffers(ResourceBinder* rb);</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;</div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;  <span class="keywordtype">void</span> BindSimpleAttributes();</div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;</div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;  <span class="keywordtype">bool</span> BindBufferObjectElementAttribute(GLuint attribute_index,</div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;                                        <span class="keyword">const</span> Attribute&amp; a, GLuint* slots,</div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;                                        ResourceBinder* rb);</div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;</div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;  <span class="keywordtype">void</span> ResetVertexCount() {</div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;    vertex_count_ = std::numeric_limits&lt;std::size_t&gt;::max();</div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;  }</div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;</div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;  <span class="keywordtype">void</span> UpdateVertexCount(<span class="keyword">const</span> Attribute&amp; a) {</div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a461f30e6f866977271f2c9960237e30c">BufferObjectPtr</a>&amp; bo = a.GetValue&lt;BufferObjectElement&gt;().buffer_object;</div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;    <span class="keywordflow">if</span> (bo.Get()) {</div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;      <span class="keywordflow">if</span> (!a.GetDivisor() ||</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;          !<a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">GetGraphicsManager</a>()-&gt;IsFunctionGroupAvailable(</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;              <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a4af48b30c3a8560da50e555ae2ff928c">GraphicsManager::kInstancedDrawing</a>)) {</div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;        vertex_count_ = std::min(vertex_count_, bo-&gt;GetCount());</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;      }</div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;    }</div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;  }</div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;</div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160; <span class="keyword">protected</span>:</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;  <span class="keyword">struct </span>BufferAttributeInfo {</div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;    BufferAttributeInfo() : index(kInvalidGluint), slots(0U), enabled(false) {}</div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;    GLuint index;</div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;    GLuint slots;</div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;    <span class="keywordtype">bool</span> enabled;</div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;  };</div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;  base::AllocVector&lt;BufferAttributeInfo&gt; buffer_attribute_infos_;</div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;  base::AllocVector&lt;GLuint&gt; simple_attribute_indices_;</div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;</div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> Bind(ResourceBinder* rb) {</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;    Update(rb);</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;    BindAndCheckBuffers(<span class="keyword">true</span>, rb);</div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;  }</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;  <span class="keywordtype">void</span> Update(ResourceBinder* rb)<span class="keyword"> override </span>{}</div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;</div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;  <span class="keywordtype">void</span> PopulateAttributeIndices(ResourceBinder* rb);</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;</div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;  <span class="keywordtype">size_t</span> vertex_count_;</div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;  ResourceBinder::BufferBinding element_array_binding_;</div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;</div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span>ResourceBinder;</div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span>ResourceManager;</div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;};</div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;</div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;<span class="keywordtype">void</span> Renderer::VertexArrayResource::BindSimpleAttributes() {</div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;  GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;  <span class="keyword">const</span> AttributeArray&amp; aa = GetAttributeArray();</div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> attribute_count = aa.GetSimpleAttributeCount();</div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;  <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(attribute_count, simple_attribute_indices_.size());</div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; attribute_count; ++i) {</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;    <span class="keyword">const</span> Attribute&amp; a = aa.GetSimpleAttribute(i);</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(a.IsValid());</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;    <span class="keyword">const</span> GLuint&amp; attribute_index = simple_attribute_indices_[i];</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;    <span class="keywordflow">if</span> (attribute_index != static_cast&lt;GLuint&gt;(<a class="code" href="namespaceion_1_1base.html#a4608f8e50b0898594bbef71d8a9a4ac5">base::kInvalidIndex</a>)) {</div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;      <span class="keywordflow">switch</span> (a.GetType()) {</div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a14ed49fd56755b8a81ce368ebedbd51e">kFloatAttribute</a>:</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;          gm-&gt;VertexAttrib1fv(attribute_index, &amp;a.GetValue&lt;<span class="keywordtype">float</span>&gt;());</div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a3126c9a68bc64edfa62623be936a6b61">kFloatVector2Attribute</a>:</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;          gm-&gt;VertexAttrib2fv(attribute_index,</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;                              a.GetValue&lt;math::VectorBase2f&gt;().Data());</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a3cb7a3cbcffcdcbd4a5baef157b7929f">kFloatVector3Attribute</a>:</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;          gm-&gt;VertexAttrib3fv(attribute_index,</div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;                              a.GetValue&lt;math::VectorBase3f&gt;().Data());</div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2af14a2e530e088bd732d6558c920564a0">kFloatVector4Attribute</a>:</div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;          gm-&gt;VertexAttrib4fv(attribute_index,</div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;                              a.GetValue&lt;math::VectorBase4f&gt;().Data());</div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a1c713b71c7f9f3acbbd776640afa5cb2">kFloatMatrix2x2Attribute</a>: {</div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#acd13d99102242a27840615752a2bb7e2">math::Matrix2f</a> mat =</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;              <a class="code" href="namespaceion_1_1math.html#a249c32950a150c8cf5d7f8b80292ce21">math::Transpose</a>(a.GetValue&lt;<a class="code" href="namespaceion_1_1math.html#acd13d99102242a27840615752a2bb7e2">math::Matrix2f</a>&gt;());</div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;          gm-&gt;VertexAttrib2fv(attribute_index, mat.Data());</div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;          gm-&gt;VertexAttrib2fv(attribute_index + 1, &amp;mat.Data()[2]);</div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;        }</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a3f9d9dfa59b8a4253cc4355a8446aef1">kFloatMatrix3x3Attribute</a>: {</div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a5a1199a3501b10b203686f3eca9a49fa">math::Matrix3f</a> mat =</div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;              <a class="code" href="namespaceion_1_1math.html#a249c32950a150c8cf5d7f8b80292ce21">math::Transpose</a>(a.GetValue&lt;<a class="code" href="namespaceion_1_1math.html#a5a1199a3501b10b203686f3eca9a49fa">math::Matrix3f</a>&gt;());</div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;          gm-&gt;VertexAttrib3fv(attribute_index, mat.Data());</div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;          gm-&gt;VertexAttrib3fv(attribute_index + 1, &amp;mat.Data()[3]);</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;          gm-&gt;VertexAttrib3fv(attribute_index + 2, &amp;mat.Data()[6]);</div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;        }</div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2aac8212e922ee7b440e71e7e689cc814c">kFloatMatrix4x4Attribute</a>: {</div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#ac94084c89a7a56ce378c40a8bebd7c53">math::Matrix4f</a> mat =</div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;              <a class="code" href="namespaceion_1_1math.html#a249c32950a150c8cf5d7f8b80292ce21">math::Transpose</a>(a.GetValue&lt;<a class="code" href="namespaceion_1_1math.html#ac94084c89a7a56ce378c40a8bebd7c53">math::Matrix4f</a>&gt;());</div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;          gm-&gt;VertexAttrib4fv(attribute_index, mat.Data());</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;          gm-&gt;VertexAttrib4fv(attribute_index + 1, &amp;mat.Data()[4]);</div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;          gm-&gt;VertexAttrib4fv(attribute_index + 2, &amp;mat.Data()[8]);</div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;          gm-&gt;VertexAttrib4fv(attribute_index + 3, &amp;mat.Data()[12]);</div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;        }</div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;      }</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;    }</div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;  }</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;}</div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;<span class="keywordtype">bool</span> Renderer::VertexArrayResource::BindBufferObjectElementAttribute(</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;    GLuint attribute_index, <span class="keyword">const</span> Attribute&amp; a, GLuint* slots,</div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;    ResourceBinder* rb) {</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(a.IsValid());</div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;  GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(gm);</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;</div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a461f30e6f866977271f2c9960237e30c">BufferObjectPtr</a>&amp; bo = a.GetValue&lt;BufferObjectElement&gt;().buffer_object;</div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;  <span class="keywordflow">if</span> (!bo.Get()) {</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to draw shape: &quot;</span></div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;BufferObject or BufferObject DataContainer is nullptr&quot;</span>;</div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;  }</div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;</div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;  BufferResource* vbo = GetResource(bo.Get(), rb);</div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(vbo);</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;  vbo-&gt;Bind(rb);</div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;</div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> spec_index = a.GetValue&lt;BufferObjectElement&gt;().spec_index;</div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;  <span class="keyword">const</span> BufferObject::Spec&amp; spec = bo-&gt;GetSpec(spec_index);</div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!<a class="code" href="namespaceion_1_1base.html#a62eaa5f45ca6b9f446ca128679860ead">base::IsInvalidReference</a>(spec));</div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;  <span class="keyword">const</span> GLenum type = <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(spec.type);</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;  GLuint stride = 0U;</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;  GetAttributeSlotCountAndStride(spec.type, &amp;stride, slots);</div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;  <span class="keywordflow">for</span> (GLuint i = 0; i &lt; *slots; ++i) {</div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;    gm-&gt;VertexAttribPointer(</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;        attribute_index + i, static_cast&lt;GLuint&gt;(spec.component_count), type,</div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;        a.IsFixedPointNormalized() ? GL_TRUE : GL_FALSE,</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;        <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(bo-&gt;GetStructSize()),</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;        reinterpret_cast&lt;const void*&gt;(spec.byte_offset + i * stride));</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;    <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a4af48b30c3a8560da50e555ae2ff928c">GraphicsManager::kInstancedDrawing</a>)) {</div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;      gm-&gt;VertexAttribDivisor(attribute_index + i, a.GetDivisor());</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;    }</div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;  }</div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;}</div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;</div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;<span class="keywordtype">void</span> Renderer::VertexArrayResource::PopulateAttributeIndices(</div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;    ResourceBinder* rb) {</div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;  <span class="keyword">const</span> AttributeArray&amp; aa = GetAttributeArray();</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> buffer_attribute_count = aa.GetBufferAttributeCount();</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> simple_attribute_count = aa.GetSimpleAttributeCount();</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;  buffer_attribute_infos_.resize(buffer_attribute_count);</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;  simple_attribute_indices_.resize(simple_attribute_count, kInvalidGluint);</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;  <span class="keywordflow">if</span> (ShaderProgramResource* spr = rb-&gt;GetActiveShaderProgram()) {</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(spr);</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; buffer_attribute_count; ++i) {</div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;      <span class="keyword">const</span> Attribute&amp; a = aa.GetBufferAttribute(i);</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(a.IsValid());</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;      <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#ad8794cffdad6b1ae0846e189d5cbb1eb">ShaderInputRegistry::AttributeSpec</a>* spec =</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;          <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#a6938655fdb469df98f180e73711ffb74">ShaderInputRegistry::GetSpec</a>(a);</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;      <span class="keyword">const</span> GLint index = spr-&gt;GetAttributeIndex(spec);</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;      <span class="keywordflow">if</span> (index &gt;= 0) {</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;        buffer_attribute_infos_[i].index = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(index);</div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aa.IsBufferAttributeEnabled(i)) {</div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;        <a class="code" href="base_2logging_8h.html#ab8493891cf64850ba3b3a95626938207">LOG_ONCE</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>)</div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;***ION: Attribute array contains buffer attribute &#39;&quot;</span></div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;            &lt;&lt; spec-&gt;name &lt;&lt; <span class="stringliteral">&quot;&#39; but the current shader program &#39;&quot;</span></div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;            &lt;&lt; spr-&gt;GetShaderProgram().GetLabel() &lt;&lt; <span class="stringliteral">&quot;&#39; does not&quot;</span></div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; declare or use it&quot;</span>;</div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;      }</div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;    }</div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;</div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; simple_attribute_count; ++i) {</div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;      <span class="keyword">const</span> Attribute&amp; a = aa.GetSimpleAttribute(i);</div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(a.IsValid());</div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;      <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#ad8794cffdad6b1ae0846e189d5cbb1eb">ShaderInputRegistry::AttributeSpec</a>* spec =</div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;          <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html#a6938655fdb469df98f180e73711ffb74">ShaderInputRegistry::GetSpec</a>(a);</div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;      <span class="keyword">const</span> GLint index = spr-&gt;GetAttributeIndex(spec);</div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;      <span class="keywordflow">if</span> (index &gt;= 0) {</div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;        simple_attribute_indices_[i] = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(index);</div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;        <a class="code" href="base_2logging_8h.html#ab8493891cf64850ba3b3a95626938207">LOG_ONCE</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>)</div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;***ION: Attribute array contains simple attribute &#39;&quot;</span></div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;            &lt;&lt; spec-&gt;name &lt;&lt; <span class="stringliteral">&quot;&#39; but the current shader program &#39;&quot;</span></div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;            &lt;&lt; spr-&gt;GetShaderProgram().GetLabel() &lt;&lt; <span class="stringliteral">&quot;&#39; does not&quot;</span></div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; declare or use it&quot;</span>;</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;      }</div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;    }</div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;  }</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;}</div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;</div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;<span class="keywordtype">bool</span> Renderer::VertexArrayResource::UpdateAndCheckBuffers(ResourceBinder* rb) {</div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;  <span class="keywordflow">if</span> (AnyModifiedBitsSet()) {</div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;    ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;    GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(gm);</div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;    <span class="keywordflow">if</span> (!id_) gm-&gt;GenVertexArrays(1, &amp;id_);</div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;    <span class="keyword">const</span> AttributeArray&amp; aa = GetAttributeArray();</div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;    <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(aa.GetBufferAttributeCount(), buffer_attribute_infos_.size());</div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;    <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(aa.GetSimpleAttributeCount(), simple_attribute_indices_.size());</div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;</div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;    ResetVertexCount();</div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;</div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;    <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488ea8cdf432d687b44c1099911986875a928">ResourceHolder::kResourceChanged</a>))</div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;        rb-&gt;ClearVertexArrayBinding(id_);</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;</div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;      rb-&gt;BindVertexArray(id_, <span class="keyword">this</span>);</div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> buffer_attribute_count = aa.GetBufferAttributeCount();</div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;      <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(buffer_attribute_count, buffer_attribute_infos_.size());</div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; buffer_attribute_count; ++i) {</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;        <span class="keyword">const</span> Attribute&amp; a = aa.GetBufferAttribute(i);</div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;        UpdateVertexCount(a);</div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;        BufferAttributeInfo&amp; info = buffer_attribute_infos_[i];</div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;        <span class="keywordflow">if</span> (info.index != static_cast&lt;GLuint&gt;(<a class="code" href="namespaceion_1_1base.html#a4608f8e50b0898594bbef71d8a9a4ac5">base::kInvalidIndex</a>)) {</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;          <span class="keywordflow">if</span> (TestModifiedBit(</div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;                  static_cast&lt;int&gt;(<a class="code" href="classion_1_1gfx_1_1_attribute_array.html#abcccfb5627ac2b2f56e944ff9609a3fea57fc67716e2c90c6b4907bf304aadacf">AttributeArray::kAttributeChanged</a> + i)) &amp;&amp;</div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;              !BindBufferObjectElementAttribute(info.index, a, &amp;info.slots, rb))</div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;          <span class="keywordflow">if</span> (TestModifiedBit(static_cast&lt;int&gt;(</div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;                  <a class="code" href="classion_1_1gfx_1_1_attribute_array.html#abcccfb5627ac2b2f56e944ff9609a3fea85840a7a363b540924838b2804639d23">AttributeArray::kAttributeEnabledChanged</a> + i))) {</div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;            <a class="code" href="base_2logging_8h.html#ab4f56aa24c4c9cddc47a6abd2d747f9a">DCHECK_GT</a>(info.slots, 0U);</div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;            <span class="keywordflow">if</span> (aa.IsBufferAttributeEnabled(i)) {</div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;              <span class="keywordflow">for</span> (GLuint j = 0; j &lt; info.slots; ++j)</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;                gm-&gt;EnableVertexAttribArray(info.index + j);</div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;              info.enabled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;              <span class="keywordflow">for</span> (GLuint j = 0; j &lt; info.slots; ++j)</div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;                gm-&gt;DisableVertexAttribArray(info.index + j);</div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;              info.enabled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;            }</div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;          }</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;        }</div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;      }</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;      <span class="keywordflow">if</span> (TestModifiedBit(<a class="code" href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488eafbaf96637df1fba193f735aa8689222c">ResourceHolder::kLabelChanged</a>))</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;        SetObjectLabel(gm, <a class="code" href="glheaders_8h.html#a9e49f916b21619b15ba482318b30656f">GL_VERTEX_ARRAY_OBJECT</a>, id_, aa.GetLabel());</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;      ResetModifiedBits();</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;      <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to create vertex array&quot;</span>;</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;    }</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;  }</div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;  rb-&gt;BindVertexArray(id_, <span class="keyword">this</span>);</div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;  BindSimpleAttributes();</div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;}</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;</div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;<span class="keywordtype">bool</span> Renderer::VertexArrayResource::BindAndCheckBuffers(<span class="keywordtype">bool</span> force_bind,</div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;                                                        ResourceBinder* rb) {</div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;  <span class="keywordflow">if</span> ((UpdateAndCheckBuffers(rb) || force_bind) &amp;&amp; id_) {</div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;    ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;    rb-&gt;BindVertexArray(id_, <span class="keyword">this</span>);</div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;  }</div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;}</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;</div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;<span class="keywordtype">void</span> Renderer::VertexArrayResource::Unbind(ResourceBinder* rb) {</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;  <span class="keywordflow">if</span> (rb)</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;    rb-&gt;ClearVertexArrayBinding(id_);</div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;}</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;</div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;<span class="keywordtype">void</span> Renderer::VertexArrayResource::Release(<span class="keywordtype">bool</span> can_make_gl_calls) {</div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;  BaseResourceType::Release(can_make_gl_calls);</div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;  <span class="keywordflow">if</span> (id_) {</div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;    UnbindAll();</div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;    <span class="keywordflow">if</span> (resource_owns_gl_id_ &amp;&amp; can_make_gl_calls)</div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;      GetGraphicsManager()-&gt;DeleteVertexArrays(1, &amp;id_);</div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;    id_ = 0;</div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;  }</div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;}</div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;</div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;</div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;</div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;</div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;<span class="keyword">class </span>Renderer::VertexArrayEmulatorResource</div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;    : <span class="keyword">public</span> Renderer::VertexArrayResource {</div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;  VertexArrayEmulatorResource(ResourceBinder* rb, ResourceManager* rm,</div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;                              <span class="keyword">const</span> AttributeArray&amp; attribute_array,</div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;                              <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key, GLuint <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;      : VertexArrayResource(rb, rm, attribute_array, key, id) {}</div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;  ~VertexArrayEmulatorResource()<span class="keyword"> override </span>{}</div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;</div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;  <span class="keywordtype">void</span> Release(<span class="keywordtype">bool</span> can_make_gl_calls) <span class="keyword">override</span>;</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;  <span class="keywordtype">bool</span> UpdateAndCheckBuffers(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;</div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;  <span class="keywordtype">bool</span> BindAndCheckBuffers(<span class="keywordtype">bool</span> force_bind, ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;  <span class="keywordtype">void</span> Unbind(ResourceBinder* rb) <span class="keyword">override</span>;</div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;};</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;</div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;<span class="keywordtype">bool</span> Renderer::VertexArrayEmulatorResource::UpdateAndCheckBuffers(</div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;    ResourceBinder* rb) {</div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;  <span class="keywordflow">if</span> (rb-&gt;GetActiveVertexArray() != <span class="keyword">this</span> || AnyModifiedBitsSet()) {</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;    ResetModifiedBits();</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;    ScopedResourceLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, rb);</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    rb-&gt;SetActiveVertexArray(<span class="keyword">this</span>);</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;    BindSimpleAttributes();</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;    ResetVertexCount();</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;</div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;    GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    <span class="keyword">const</span> AttributeArray&amp; aa = GetAttributeArray();</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> buffer_attribute_count = aa.GetBufferAttributeCount();</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;    <a class="code" href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a>(buffer_attribute_count, buffer_attribute_infos_.size());</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; buffer_attribute_count; ++i) {</div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;      <span class="keywordflow">if</span> (aa.IsBufferAttributeEnabled(i)) {</div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;        <span class="keyword">const</span> Attribute&amp; a = aa.GetBufferAttribute(i);</div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;        UpdateVertexCount(a);</div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;        BufferAttributeInfo&amp; info = buffer_attribute_infos_[i];</div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;        <span class="keywordflow">if</span> (info.index != static_cast&lt;GLuint&gt;(<a class="code" href="namespaceion_1_1base.html#a4608f8e50b0898594bbef71d8a9a4ac5">base::kInvalidIndex</a>)) {</div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;          <span class="keywordflow">if</span> (!BindBufferObjectElementAttribute(info.index, a, &amp;info.slots, rb))</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;          <a class="code" href="base_2logging_8h.html#ab4f56aa24c4c9cddc47a6abd2d747f9a">DCHECK_GT</a>(info.slots, 0U);</div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;          <span class="keywordflow">for</span> (GLuint j = 0; j &lt; info.slots; ++j)</div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;            gm-&gt;EnableVertexAttribArray(info.index);</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;          info.enabled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;        }</div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;      }</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;    }</div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;  }</div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;}</div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;</div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;<span class="keywordtype">bool</span> Renderer::VertexArrayEmulatorResource::BindAndCheckBuffers(</div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;    <span class="keywordtype">bool</span> force_bind, ResourceBinder* rb) {</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;  <span class="keywordflow">return</span> UpdateAndCheckBuffers(rb);</div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;}</div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;<span class="keywordtype">void</span> Renderer::VertexArrayEmulatorResource::Unbind(ResourceBinder* rb) {</div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> can_make_gl_calls = <a class="code" href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">portgfx::Visual::GetCurrent</a>() != <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;  <span class="keywordflow">if</span> (rb &amp;&amp; rb-&gt;GetActiveVertexArray() == <span class="keyword">this</span>) {</div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;    GraphicsManager* gm = GetGraphicsManager();</div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> buffer_attribute_count = buffer_attribute_infos_.size();</div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; buffer_attribute_count; ++i) {</div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;      BufferAttributeInfo&amp; info = buffer_attribute_infos_[i];</div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;      <span class="keywordflow">if</span> (info.enabled &amp;&amp;</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;          info.index != static_cast&lt;GLuint&gt;(<a class="code" href="namespaceion_1_1base.html#a4608f8e50b0898594bbef71d8a9a4ac5">base::kInvalidIndex</a>)) {</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;        <span class="keywordflow">if</span> (can_make_gl_calls) {</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;          <span class="keywordflow">for</span> (GLuint j = 0; j &lt; info.slots; ++j)</div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;            gm-&gt;DisableVertexAttribArray(info.index);</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;        }</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;        info.enabled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;      }</div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;    }</div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;    rb-&gt;SetActiveVertexArray(<span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;  }</div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;}</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;</div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;<span class="keywordtype">void</span> Renderer::VertexArrayEmulatorResource::Release(<span class="keywordtype">bool</span> can_make_gl_calls) {</div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;  BaseResourceType::Release(can_make_gl_calls);</div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;  UnbindAll();</div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;}</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;</div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;</div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;</div>
<div class="line"><a name="l04694"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada"> 4694</a></span>&#160;<a class="code" href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">Renderer::Renderer</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">GraphicsManagerPtr</a>&amp; gm)</div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;    : flags_(AllProcessFlags()),</div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;      resource_manager_(new (GetAllocator()) <a class="code" href="classion_1_1gfx_1_1_resource_manager.html">ResourceManager</a>(gm)) {</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(gm.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>());</div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;</div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;  default_shader_ =</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;      CreateDefaultShaderProgram(<a class="code" href="classion_1_1base_1_1_allocatable.html#a0682f27004c4f1a332360d7878b351a7">GetAllocatorForLifetime</a>(<a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757cae13e720cb817ed225d324290a0acd4f0">base::kLongTerm</a>));</div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;}</div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;</div>
<div class="line"><a name="l04704"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#aa35e221419284321cf545e74e5deb2cf"> 4704</a></span>&#160;<a class="code" href="classion_1_1gfx_1_1_renderer.html#aa35e221419284321cf545e74e5deb2cf">Renderer::~Renderer</a>() {</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;  <span class="keywordtype">size_t</span> visual_id;</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;  ResourceBinder* resource_binder = GetInternalResourceBinder(&amp;visual_id);</div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;  <span class="keywordflow">if</span> (visual_id == 0) {</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: renderer.cc: ~Renderer&quot;</span></div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;: No Visual ID (invalid GL Context?)&quot;</span>;</div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;  }</div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;  resource_manager_-&gt;DestroyAllResources();</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;    resource_binder-&gt;SetCurrentFramebuffer(<a class="code" href="namespaceion_1_1gfx.html#a4394f60096b9d80558dd2cf5c32433bb">FramebufferObjectPtr</a>());</div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;}</div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;</div>
<div class="line"><a name="l04716"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#ae2017d3beff202d8715bccf00a10a4ba"> 4716</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Renderer::Flags</a>&amp; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae2017d3beff202d8715bccf00a10a4ba">Renderer::AllFlags</a>() {</div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Flags</a> flags(<a class="code" href="classion_1_1gfx_1_1_renderer.html#a408735143bf7dcb58f2ed547940c337a">AllClearFlags</a>() | <a class="code" href="classion_1_1gfx_1_1_renderer.html#a064df8a40551ea50cc5e3aa2e6460932">AllProcessFlags</a>() |</div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;                           <a class="code" href="classion_1_1gfx_1_1_renderer.html#a57380b7aaee938babb09391306324320">AllRestoreFlags</a>() | <a class="code" href="classion_1_1gfx_1_1_renderer.html#a21a9d90fde655b0de5251c03bad7db75">AllSaveFlags</a>());</div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;  <span class="keywordflow">return</span> flags;</div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;}</div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;</div>
<div class="line"><a name="l04722"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a408735143bf7dcb58f2ed547940c337a"> 4722</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Renderer::Flags</a>&amp; <a class="code" href="classion_1_1gfx_1_1_renderer.html#a408735143bf7dcb58f2ed547940c337a">Renderer::AllClearFlags</a>() {</div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Flags</a> flags((1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ac00cfea6d548231a819c5f8016922abe">kClearActiveTexture</a>) |</div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a0a4bdde528e8eb0612e1883267fa5d7c">kClearArrayBuffer</a>) |</div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ade24445f53b286877a58b538b4d7bb24">kClearCubemaps</a>) |</div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ac6cc1e8e361a70a5db1de8c30a3b3b4b">kClearElementArrayBuffer</a>) |</div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04aa1b8fa14097b0b8f0df80fda39598120">kClearFramebuffer</a>) |</div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a81dcc03f6636c61953c85481f2c899a0">kClearShaderProgram</a>) |</div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04acaba63e5bb38117a91f17cff263612d8">kClearSamplers</a>) |</div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04abd27fe560c136c36aadbcfea54785552">kClearTextures</a>) |</div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a34d1c8be9d95ebc1cd7c04db6f3ab212">kClearVertexArray</a>));</div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;  <span class="keywordflow">return</span> flags;</div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;}</div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;</div>
<div class="line"><a name="l04735"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a064df8a40551ea50cc5e3aa2e6460932"> 4735</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Renderer::Flags</a>&amp; <a class="code" href="classion_1_1gfx_1_1_renderer.html#a064df8a40551ea50cc5e3aa2e6460932">Renderer::AllProcessFlags</a>() {</div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Flags</a> flags((1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04aa5938f9a83e1d9719d363b94533ef9d3">Renderer::kProcessInfoRequests</a>) |</div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a341f85419db9e48a4e93fbb1ef10e128">Renderer::kProcessReleases</a>));</div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;  <span class="keywordflow">return</span> flags;</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;}</div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;</div>
<div class="line"><a name="l04741"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a57380b7aaee938babb09391306324320"> 4741</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Renderer::Flags</a>&amp; <a class="code" href="classion_1_1gfx_1_1_renderer.html#a57380b7aaee938babb09391306324320">Renderer::AllRestoreFlags</a>() {</div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Flags</a> flags((1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ab6e5d3c9cad6f2d9094c9f86eb22fdf6">kRestoreActiveTexture</a>) |</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ae849f42d833e99960d1199c3a51354e8">kRestoreArrayBuffer</a>) |</div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a547a17d7047237044795b075ed98e1dc">kRestoreElementArrayBuffer</a>) |</div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a99a031ce6f76f20c980b33ae5f6c1955">kRestoreFramebuffer</a>) |</div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a3b33f2c3538d70af07d779c12227c535">kRestoreShaderProgram</a>) |</div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04abc5ff2f816decc196291f40bdefccdb6">kRestoreStateTable</a>) |</div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a7b66885ac31e9a56ca30cf359f897938">kRestoreVertexArray</a>));</div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;  <span class="keywordflow">return</span> flags;</div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;}</div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;</div>
<div class="line"><a name="l04752"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a21a9d90fde655b0de5251c03bad7db75"> 4752</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Renderer::Flags</a>&amp; <a class="code" href="classion_1_1gfx_1_1_renderer.html#a21a9d90fde655b0de5251c03bad7db75">Renderer::AllSaveFlags</a>() {</div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">Flags</a> flags((1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a8cf00f1c00e22197c13282cd7b815ce7">kSaveActiveTexture</a>) |</div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ade89d15e01bb88183983f50dcb40d077">kSaveArrayBuffer</a>) |</div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ac8c4e51ffc220c5f7d25b999f98c67b0">kSaveElementArrayBuffer</a>) |</div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04add695796ee0afeb78859849f893278ac">kSaveFramebuffer</a>) |</div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a5fcadf03d8aca7b620f6574694b5ff0b">kSaveShaderProgram</a>) |</div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a8b1d7c24c12bc798aa9997f79f2013b2">kSaveStateTable</a>) |</div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;                           (1 &lt;&lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ad8ee0fd1040ce90f36495c105ce299fc">kSaveVertexArray</a>));</div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;  <span class="keywordflow">return</span> flags;</div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;}</div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;</div>
<div class="line"><a name="l04763"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451"> 4763</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">GraphicsManagerPtr</a>&amp; <a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">Renderer::GetGraphicsManager</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;  <span class="keywordflow">return</span> resource_manager_-&gt;GetGraphicsManager();</div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;}</div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;</div>
<div class="line"><a name="l04767"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#aa71c7f5c7a6cc8b71ab0a0d713a7781b"> 4767</a></span>&#160;<a class="code" href="classion_1_1gfx_1_1_resource_manager.html">gfx::ResourceManager</a>* <a class="code" href="classion_1_1gfx_1_1_renderer.html#aa71c7f5c7a6cc8b71ab0a0d713a7781b">Renderer::GetResourceManager</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;  <span class="keywordflow">return</span> resource_manager_.get();</div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;}</div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;</div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;<a class="code" href="classion_1_1base_1_1_alloc_unordered_map.html">Renderer::ResourceBinderMap</a>&amp; Renderer::GetResourceBinderMap() {</div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;  <a class="code" href="staticsafedeclare_8h.html#a09452e33f7fe6f55ae0bc4ca75152dac">ION_DECLARE_SAFE_STATIC_POINTER_WITH_CONSTRUCTOR</a>(</div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;      ResourceBinderMap, binders,</div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;      <span class="keyword">new</span> ResourceBinderMap(</div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;          <a class="code" href="classion_1_1base_1_1_allocation_manager.html#a026c479373cc9b9d16738cbaf86d49f1">base::AllocationManager::GetDefaultAllocatorForLifetime</a>(</div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;              <a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757cae13e720cb817ed225d324290a0acd4f0">base::kLongTerm</a>)));</div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;  <span class="keywordflow">return</span> *binders;</div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;}</div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;</div>
<div class="line"><a name="l04780"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a7b4d7146a5c0c8e5bef7e720f423eefd"> 4780</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a7b4d7146a5c0c8e5bef7e720f423eefd">Renderer::DestroyStateCache</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1portgfx_1_1_visual.html">portgfx::Visual</a>* visual) {</div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;  <span class="keywordflow">if</span> (visual) {</div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = visual-&gt;<a class="code" href="classion_1_1portgfx_1_1_visual.html#a5ffcc5e79f1b2c7cf122a14e3213368b">GetId</a>();</div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;    <a class="code" href="classion_1_1base_1_1_alloc_unordered_map.html">ResourceBinderMap</a>&amp; binders = GetResourceBinderMap();</div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;    <a class="code" href="classion_1_1base_1_1_write_lock.html">base::WriteLock</a> write_lock(GetResourceBinderLock());</div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;    <a class="code" href="classion_1_1base_1_1_generic_lock_guard.html">base::WriteGuard</a> write_guard(&amp;write_lock);</div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;    binders.erase(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;  }</div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;}</div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;</div>
<div class="line"><a name="l04790"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a4954d3e28d7f7988556bf16dd97ac4bf"> 4790</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a4954d3e28d7f7988556bf16dd97ac4bf">Renderer::DestroyCurrentStateCache</a>() {</div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = <a class="code" href="classion_1_1portgfx_1_1_visual.html#a049883136a6bbb2149eb3a3541f87199">portgfx::Visual::GetCurrentId</a>();</div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;  <a class="code" href="classion_1_1base_1_1_alloc_unordered_map.html">ResourceBinderMap</a>&amp; binders = GetResourceBinderMap();</div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;  <a class="code" href="classion_1_1base_1_1_write_lock.html">base::WriteLock</a> write_lock(GetResourceBinderLock());</div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;  <a class="code" href="classion_1_1base_1_1_generic_lock_guard.html">base::WriteGuard</a> write_guard(&amp;write_lock);</div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;  binders.erase(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;}</div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;</div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;Renderer::ResourceBinder* Renderer::GetInternalResourceBinder(</div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;    <span class="keywordtype">size_t</span>* visual_id)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;  <a class="code" href="classion_1_1base_1_1_read_lock.html">base::ReadLock</a> read_lock(GetResourceBinderLock());</div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;  <a class="code" href="classion_1_1base_1_1_generic_lock_guard.html">base::ReadGuard</a> read_guard(&amp;read_lock);</div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;  *visual_id = <a class="code" href="classion_1_1portgfx_1_1_visual.html#a049883136a6bbb2149eb3a3541f87199">portgfx::Visual::GetCurrentId</a>();</div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;  ResourceBinderMap&amp; binders = GetResourceBinderMap();</div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;  ResourceBinderMap::iterator it = binders.find(*visual_id);</div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;</div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;  <span class="keywordflow">if</span> (it == binders.end())</div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;</div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;  ResourceBinder* rb = it-&gt;second.get();</div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(rb);</div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;  rb-&gt;SetResourceManager(resource_manager_.get());</div>
<div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;  <span class="keywordflow">return</span> rb;</div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;}</div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;</div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;Renderer::ResourceBinder*</div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;Renderer::GetOrCreateInternalResourceBinder(<span class="keywordtype">int</span> line)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;  <span class="keywordtype">size_t</span> visual_id = 0;</div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;  ResourceBinder* rb = GetInternalResourceBinder(&amp;visual_id);</div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;  <span class="keywordflow">if</span> (visual_id == 0) {</div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: renderer.cc:&quot;</span> &lt;&lt; line</div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;: No Visual ID (invalid GL Context?)&quot;</span>;</div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!rb) &lt;&lt; <span class="stringliteral">&quot;Unexpected ResourceBinder for visual 0.&quot;</span>;</div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;  }</div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;  <span class="keywordflow">if</span> (!rb) {</div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;    ResourceBinderMap&amp; binders = GetResourceBinderMap();</div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;    rb = <span class="keyword">new</span>(<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()) ResourceBinder(<a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">GetGraphicsManager</a>());</div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;    base::WriteLock write_lock(GetResourceBinderLock());</div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;    <a class="code" href="namespaceion_1_1base.html#aa710835f4c8519208e8640e83e9a95db">base::WriteGuard</a> write_guard(&amp;write_lock);</div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(binders.find(visual_id) == binders.end())</div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Two threads tried to create ResourceBinders for the same Visual!&quot;</span>;</div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;    binders[visual_id].reset(rb);</div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;  }</div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(rb);</div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;  rb-&gt;SetResourceManager(resource_manager_.get());</div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;  <span class="keywordflow">return</span> rb;</div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;}</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;</div>
<div class="line"><a name="l04839"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a2d8dcaec87d0c04f51726301060fcfd5"> 4839</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a2d8dcaec87d0c04f51726301060fcfd5">Renderer::BindFramebuffer</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">FramebufferObjectPtr</a>&amp; fbo) {</div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;</div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;  <span class="keywordflow">if</span> (resource_binder) {</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;    resource_binder-&gt;ClearNonFramebufferCachedBindings();</div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;    <span class="keywordflow">if</span> (!fbo.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>() || fbo-&gt;GetWidth() == 0 || fbo-&gt;GetHeight() == 0) {</div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;      resource_binder-&gt;BindFramebuffer(</div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;          *resource_binder-&gt;GetSavedId(<a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04add695796ee0afeb78859849f893278ac">kSaveFramebuffer</a>), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;      FramebufferResource* fbr =</div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;          resource_manager_-&gt;GetResource(fbo.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>(), resource_binder);</div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;      <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(fbr);</div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;      fbr-&gt;Bind(resource_binder);</div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;    }</div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;    resource_binder-&gt;SetCurrentFramebuffer(fbo);</div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;  }</div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;}</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;</div>
<div class="line"><a name="l04857"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a31b7860918be8b91265255f0bbad4d64"> 4857</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">FramebufferObjectPtr</a> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a31b7860918be8b91265255f0bbad4d64">Renderer::GetCurrentFramebuffer</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;    <span class="keywordflow">return</span> resource_binder ?</div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;        resource_binder-&gt;GetCurrentFramebuffer() : <a class="code" href="namespaceion_1_1gfx.html#a4394f60096b9d80558dd2cf5c32433bb">FramebufferObjectPtr</a>();</div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;}</div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;</div>
<div class="line"><a name="l04863"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#ac1c04abbc2f2b2a68d8c5a37ac55b392"> 4863</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ac1c04abbc2f2b2a68d8c5a37ac55b392">Renderer::UpdateDefaultFramebufferFromOpenGL</a>() {</div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;    resource_binder-&gt;UpdateDefaultFramebufferFromOpenGL();</div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;}</div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;</div>
<div class="line"><a name="l04869"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a575e5076307b4bc22ce115baa0372f77"> 4869</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a575e5076307b4bc22ce115baa0372f77">Renderer::ClearCachedBindings</a>() {</div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;  <span class="keywordflow">if</span> (resource_binder) {</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;    resource_binder-&gt;ClearNonFramebufferCachedBindings();</div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;    resource_binder-&gt;ClearFramebufferBinding(0U);</div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;  }</div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;}</div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;</div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l04878"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a2729fb91463cffe0eb82b60aaf97eefb"> 4878</a></span>&#160;ION_API <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#afae611dad38f36622bdd0a672624ee65">Renderer::BindResource</a>(<a class="code" href="class_t.html">T</a>* holder) {</div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;    resource_binder-&gt;BindResource(holder);</div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;}</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;</div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::BindResource&lt;BufferObject&gt;(</div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_buffer_object.html">BufferObject</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::BindResource&lt;CubeMapTexture&gt;(</div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html">CubeMapTexture</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::BindResource&lt;FramebufferObject&gt;(</div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html">FramebufferObject</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::BindResource&lt;IndexBuffer&gt;(</div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_index_buffer.html">IndexBuffer</a>*);                                                <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::BindResource&lt;Sampler&gt;(<a class="code" href="classion_1_1gfx_1_1_sampler.html">Sampler</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::BindResource&lt;ShaderProgram&gt;(</div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>*);                                              <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::BindResource&lt;Texture&gt;(<a class="code" href="classion_1_1gfx_1_1_texture.html">Texture</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;</div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l04899"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#aa3d8b831c4fb21f09b8829f8509f102d"> 4899</a></span>&#160;ION_API <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ad81c99d1363b2f5b19c67238f12c0dea">Renderer::CreateOrUpdateResource</a>(<a class="code" href="class_t.html">T</a>* holder) {</div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;    resource_binder-&gt;Process&lt;ResourceBinder::CreateOrUpdateOp&gt;(holder, 0U);</div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;}</div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;</div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::CreateOrUpdateResource&lt;AttributeArray&gt;(</div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_attribute_array.html">AttributeArray</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::CreateOrUpdateResource&lt;BufferObject&gt;(</div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_buffer_object.html">BufferObject</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::CreateOrUpdateResource&lt;CubeMapTexture&gt;(</div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html">CubeMapTexture</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::CreateOrUpdateResource&lt;FramebufferObject&gt;(</div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html">FramebufferObject</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::CreateOrUpdateResource&lt;IndexBuffer&gt;(</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_index_buffer.html">IndexBuffer</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::CreateOrUpdateResource&lt;Sampler&gt;(</div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_sampler.html">Sampler</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::CreateOrUpdateResource&lt;ShaderInputRegistry&gt;(</div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html">ShaderInputRegistry</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::CreateOrUpdateResource&lt;ShaderProgram&gt;(</div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::CreateOrUpdateResource&lt;Texture&gt;(</div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_texture.html">Texture</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;</div>
<div class="line"><a name="l04925"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#ab61f4bba7cbdf899a630cb940b8c57ef"> 4925</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ab61f4bba7cbdf899a630cb940b8c57ef">Renderer::ProcessStateTable</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">StateTablePtr</a>&amp; state_table) {</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;    resource_binder-&gt;ProcessStateTable(state_table);</div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;}</div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;</div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l04932"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a690cf18a5fd5dfa276c3250f5ac348d7"> 4932</a></span>&#160;ION_API <span class="keywordtype">void</span> Renderer::CreateResourceWithExternallyManagedId&lt;BufferObject&gt;(</div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_buffer_object.html">BufferObject</a>* holder, uint32 gl_id) {</div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;  <span class="keywordflow">if</span> (resource_binder &amp;&amp; resource_binder-&gt;GetGraphicsManager()-&gt;IsBuffer(gl_id))</div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;    resource_binder-&gt;Process&lt;ResourceBinder::CreateOrUpdateOp&gt;(holder, gl_id);</div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;}</div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;</div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l04940"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#aa2a3bf0e377914596d168141b67fcab1"> 4940</a></span>&#160;ION_API <span class="keywordtype">void</span> Renderer::CreateResourceWithExternallyManagedId&lt;IndexBuffer&gt;(</div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_index_buffer.html">IndexBuffer</a>* holder, uint32 gl_id) {</div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;  <span class="keywordflow">if</span> (resource_binder &amp;&amp; resource_binder-&gt;GetGraphicsManager()-&gt;IsBuffer(gl_id))</div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;    resource_binder-&gt;Process&lt;ResourceBinder::CreateOrUpdateOp&gt;(holder, gl_id);</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;}</div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;</div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l04948"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a3297b95f6d795539dadf2cbd9694908d"> 4948</a></span>&#160;ION_API <span class="keywordtype">void</span> Renderer::CreateResourceWithExternallyManagedId&lt;Texture&gt;(</div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_texture.html">Texture</a>* holder, uint32 gl_id) {</div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;  <span class="keywordflow">if</span> (resource_binder &amp;&amp;</div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;      resource_binder-&gt;GetGraphicsManager()-&gt;IsTexture(gl_id))</div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;    resource_binder-&gt;Process&lt;ResourceBinder::CreateOrUpdateOp&gt;(holder, gl_id);</div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;}</div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;</div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l04957"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#ae3f912848ab2cd672142bad7202e2734"> 4957</a></span>&#160;ION_API <span class="keywordtype">void</span> Renderer::CreateResourceWithExternallyManagedId&lt;CubeMapTexture&gt;(</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html">CubeMapTexture</a>* holder, uint32 gl_id) {</div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;  <span class="keywordflow">if</span> (resource_binder &amp;&amp;</div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;      resource_binder-&gt;GetGraphicsManager()-&gt;IsTexture(gl_id))</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;    resource_binder-&gt;Process&lt;ResourceBinder::CreateOrUpdateOp&gt;(holder, gl_id);</div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;}</div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;</div>
<div class="line"><a name="l04965"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a0b00a6356aa38324ab35bcd554ff8eb0"> 4965</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a0b00a6356aa38324ab35bcd554ff8eb0">Renderer::CreateOrUpdateResources</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">NodePtr</a>&amp; node) {</div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;  <span class="keywordflow">if</span> (!node.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>() || !node-&gt;IsEnabled())</div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;</div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;    resource_binder-&gt;Traverse&lt;ResourceBinder::CreateOrUpdateOp&gt;(node,</div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;        default_shader_.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>());</div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;}</div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;</div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Operation&gt;</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::Traverse(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">NodePtr</a>&amp; node,</div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;                                        <a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>* default_shader) {</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>* saved_current_program = current_shader_program_;</div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;  ShaderProgramResource* saved_active_resource = active_shader_resource_;</div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;  current_shader_program_ = default_shader;</div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;</div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;  Visit&lt;Operation&gt;(node);</div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;</div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;  current_shader_program_ = saved_current_program;</div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;  active_shader_resource_ = saved_active_resource;</div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;}</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Operation&gt;</div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::Visit(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a07b06fd55473ad00ef896315ae2f6c46">NodePtr</a>&amp; node) {</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;  <span class="keywordflow">if</span> (!node.Get() || !node-&gt;IsEnabled())</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;</div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;  <span class="keywordflow">if</span> (ShaderProgram* shader = node-&gt;GetShaderProgram().Get()) {</div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;    Process&lt;Operation&gt;(shader, 0U);</div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;    current_shader_program_ = shader;</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;  }</div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;</div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;  active_shader_resource_ = resource_manager_-&gt;<a class="code" href="classion_1_1gfx_1_1_resource_holder.html#ad5d5ff5af566f7bc7082050f4d4dc6d3">GetResource</a>(</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;      current_shader_program_, <span class="keyword">this</span>);</div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;</div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;  <span class="keyword">const</span> base::AllocVector&lt;Uniform&gt;&amp; uniforms = node-&gt;GetUniforms();</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_uniforms = uniforms.size();</div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_uniforms; ++i) {</div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;    Process&lt;Operation&gt;(&amp;uniforms[i].GetRegistry(), 0U);</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;    <span class="keywordflow">if</span> (uniforms[i].GetType() == <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1fb38ca96a9985f325f838de5757e95d">kTextureUniform</a>)</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;      Process&lt;Operation&gt;(uniforms[i].GetValue&lt;TexturePtr&gt;().Get(), 0U);</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uniforms[i].GetType() == <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a81b379b9dc3585ac8815021f56f90c41">kCubeMapTextureUniform</a>)</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;      Process&lt;Operation&gt;(uniforms[i].GetValue&lt;CubeMapTexturePtr&gt;().Get(), 0U);</div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;  }</div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;</div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;  <span class="keyword">const</span> base::AllocVector&lt;UniformBlockPtr&gt;&amp; uniform_blocks =</div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;      node-&gt;GetUniformBlocks();</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_uniform_blocks = uniform_blocks.size();</div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_uniform_blocks; ++i) {</div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;    <span class="keywordflow">if</span> (uniform_blocks[i]-&gt;IsEnabled()) {</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;      <span class="keyword">const</span> base::AllocVector&lt;Uniform&gt;&amp; uniforms =</div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;          uniform_blocks[i]-&gt;GetUniforms();</div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_uniforms = uniforms.size();</div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_uniforms; ++i) {</div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;        Process&lt;Operation&gt;(&amp;uniforms[i].GetRegistry(), 0U);</div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;        <span class="keywordflow">if</span> (uniforms[i].GetType() == <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1fb38ca96a9985f325f838de5757e95d">kTextureUniform</a>)</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;          Process&lt;Operation&gt;(uniforms[i].GetValue&lt;TexturePtr&gt;().Get(), 0U);</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uniforms[i].GetType() == <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a81b379b9dc3585ac8815021f56f90c41">kCubeMapTextureUniform</a>)</div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;          Process&lt;Operation&gt;(</div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;              uniforms[i].GetValue&lt;CubeMapTexturePtr&gt;().Get(), 0U);</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;      }</div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;    }</div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;  }</div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;</div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;  <span class="keyword">const</span> base::AllocVector&lt;ShapePtr&gt;&amp; shapes = node-&gt;GetShapes();</div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_shapes = shapes.size();</div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_shapes; ++i)</div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;    VisitShape&lt;Operation&gt;(shapes[i]);</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;</div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;  ShaderProgram* saved_program = current_shader_program_;</div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;</div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;  <span class="keyword">const</span> base::AllocVector&lt;NodePtr&gt;&amp; children = node-&gt;GetChildren();</div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_children = children.size();</div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_children; ++i) {</div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;    Visit&lt;Operation&gt;(children[i]);</div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;    current_shader_program_ = saved_program;</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;  }</div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;}</div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Operation&gt;</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::VisitShape(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a5ea05e2485675977e0cae4041a0e6296">ShapePtr</a>&amp; shape) {</div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;  Process&lt;Operation&gt;(shape-&gt;GetIndexBuffer().Get(), 0U);</div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;  Process&lt;Operation&gt;(shape-&gt;GetAttributeArray().Get(), 0U);</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;}</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;</div>
<div class="line"><a name="l05059"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a9fa2acc9f24c0a4ad6c03a108af8591e"> 5059</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a9fa2acc9f24c0a4ad6c03a108af8591e">Renderer::CreateOrUpdateShapeResources</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">ShapePtr</a>&amp; shape) {</div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;  <span class="keywordflow">if</span> (shape.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>()) {</div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;    ResourceBinder* resource_binder =</div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;        GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;    <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;      resource_binder-&gt;VisitShape&lt;ResourceBinder::CreateOrUpdateOp&gt;(shape);</div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;  }</div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;}</div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;</div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l05069"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#ab0bbd52079838cdf882c9fd1a32f6676"> 5069</a></span>&#160;ION_API <span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#aa47b150027479bdf7b7f158a1827d60f">Renderer::RequestForcedUpdate</a>(<a class="code" href="class_t.html">T</a>* holder) {</div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;    resource_binder-&gt;Process&lt;ResourceBinder::RequestUpdateOp&gt;(holder, 0U);</div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;}</div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;</div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::RequestForcedUpdate&lt;AttributeArray&gt;(</div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_attribute_array.html">AttributeArray</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::RequestForcedUpdate&lt;BufferObject&gt;(</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_buffer_object.html">BufferObject</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::RequestForcedUpdate&lt;CubeMapTexture&gt;(</div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html">CubeMapTexture</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::RequestForcedUpdate&lt;FramebufferObject&gt;(</div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html">FramebufferObject</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::RequestForcedUpdate&lt;IndexBuffer&gt;(</div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_index_buffer.html">IndexBuffer</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::RequestForcedUpdate&lt;Sampler&gt;(</div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_sampler.html">Sampler</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::RequestForcedUpdate&lt;ShaderProgram&gt;(</div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::RequestForcedUpdate&lt;ShaderInputRegistry&gt;(</div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html">ShaderInputRegistry</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::RequestForcedUpdate&lt;Texture&gt;(</div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_texture.html">Texture</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;</div>
<div class="line"><a name="l05095"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a2e31f6e6cc5ea7d9d39ed93bfe12ee0a"> 5095</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a2e31f6e6cc5ea7d9d39ed93bfe12ee0a">Renderer::RequestForcedUpdates</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">NodePtr</a>&amp; node) {</div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;  <span class="keywordflow">if</span> (!node.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>() || !node-&gt;IsEnabled())</div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;</div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;    resource_binder-&gt;Traverse&lt;ResourceBinder::RequestUpdateOp&gt;(node,</div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;        default_shader_.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>());</div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;}</div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;</div>
<div class="line"><a name="l05105"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a3fe146eb5ffef79479ee4d40034f8459"> 5105</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a3fe146eb5ffef79479ee4d40034f8459">Renderer::RequestForcedShapeUpdates</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">ShapePtr</a>&amp; shape) {</div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;  <span class="keywordflow">if</span> (shape.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>()) {</div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;    ResourceBinder* resource_binder =</div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;        GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;    <span class="keywordflow">if</span> (resource_binder) {</div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;      resource_binder-&gt;VisitShape&lt;ResourceBinder::RequestUpdateOp&gt;(shape);</div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;    }</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;  }</div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;}</div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;</div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::ProcessStateTable(</div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">StateTablePtr</a>&amp; state_table) {</div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_state_table.html">StateTable</a>* st = state_table.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>()) {</div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html">GraphicsManager</a>* gm = GetGraphicsManager().Get();</div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;</div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;    client_state_table_-&gt;MergeValuesFrom(*st, *st);</div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;    <a class="code" href="namespaceion_1_1gfx.html#aa6d4e016481ce0d624a98789018f8c49">ClearFromStateTable</a>(*st, gl_state_table_.Get(), gm);</div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;    <a class="code" href="namespaceion_1_1gfx.html#a91d3c0a06913e26e0d0767e16ef201f6">UpdateFromStateTable</a>(*st, gl_state_table_.Get(), gm);</div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;    gl_state_table_-&gt;MergeNonClearValuesFrom(*st, *st);</div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;  }</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;}</div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;</div>
<div class="line"><a name="l05129"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a177ee09712d9fac84668cbb7fa1b7de9"> 5129</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a177ee09712d9fac84668cbb7fa1b7de9">Renderer::SetInitialUniformValue</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_uniform.html">Uniform</a>&amp; u) {</div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;  <span class="keywordflow">if</span> (u.<a class="code" href="classion_1_1gfx_1_1_shader_input.html#afe4dcdd379cb2619fa5ee30dcd0d11d5">IsValid</a>()) {</div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;    ResourceBinder* resource_binder =</div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;        GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;    <span class="keywordflow">if</span> (resource_binder) {</div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;      ShaderInputRegistryResource* sirr = resource_manager_-&gt;GetResource(</div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;          &amp;u.<a class="code" href="classion_1_1gfx_1_1_shader_input.html#a533a21e6a809db26af80262011ec53f7">GetRegistry</a>(), resource_binder);</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;      sirr-&gt;Update(resource_binder);</div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;      sirr-&gt;SetInitialValue(u);</div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;    }</div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;  }</div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;}</div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;</div>
<div class="line"><a name="l05142"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a64e1a7c9754d8f0317a8b559496c91df"> 5142</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a64e1a7c9754d8f0317a8b559496c91df">Renderer::ResolveMultisampleFramebuffer</a>(</div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">FramebufferObjectPtr</a>&amp; ms_fbo, <span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">FramebufferObjectPtr</a>&amp; dest_fbo) {</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;  <span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">GraphicsManagerPtr</a>&amp; gm = <a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">GetGraphicsManager</a>();</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;  <span class="keywordflow">if</span> (!gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a3bf4859e11913a8f2731e285e9a40307">GraphicsManager::kFramebufferBlit</a>) &amp;&amp;</div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;      !gm-&gt;IsFunctionGroupAvailable(</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;          <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a7024a09f1ab72f45c9eb7039dce1dd15">GraphicsManager::kMultisampleFramebufferResolve</a>)) {</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;No multisampled frambuffer functions available.&quot;</span>;</div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;  }</div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;  GLuint ms_fbo_id = <a class="code" href="classion_1_1gfx_1_1_renderer.html#a8dfa8e46df4b9e8366cc4fccb5bcfc57">GetResourceGlId</a>(ms_fbo.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>());</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;  GLuint dest_fbo_id = <a class="code" href="classion_1_1gfx_1_1_renderer.html#a8dfa8e46df4b9e8366cc4fccb5bcfc57">GetResourceGlId</a>(dest_fbo.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>());</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;</div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;  <span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">FramebufferObjectPtr</a> previous_fbo = <a class="code" href="classion_1_1gfx_1_1_renderer.html#a31b7860918be8b91265255f0bbad4d64">GetCurrentFramebuffer</a>();</div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;  gm-&gt;BindFramebuffer(GL_READ_FRAMEBUFFER, ms_fbo_id);</div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;  gm-&gt;BindFramebuffer(GL_DRAW_FRAMEBUFFER, dest_fbo_id);</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;</div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;  <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a3bf4859e11913a8f2731e285e9a40307">GraphicsManager::kFramebufferBlit</a>)) {</div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;    gm-&gt;BlitFramebuffer(0, 0, ms_fbo-&gt;GetWidth(), ms_fbo-&gt;GetHeight(), 0, 0,</div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;                        dest_fbo-&gt;GetWidth(), dest_fbo-&gt;GetHeight(),</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;                        GL_COLOR_BUFFER_BIT, GL_NEAREST);</div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;                 <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a7024a09f1ab72f45c9eb7039dce1dd15">GraphicsManager::kMultisampleFramebufferResolve</a>)) {</div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;    gm-&gt;ResolveMultisampleFramebuffer();</div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;  }</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;</div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;  resource_binder-&gt;ClearFramebufferBinding(0);</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_renderer.html#a2d8dcaec87d0c04f51726301060fcfd5">BindFramebuffer</a>(previous_fbo);</div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;}</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;</div>
<div class="line"><a name="l05181"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#ac13a3bd2eb6fb1854ff2b1550c40dc54"> 5181</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ac13a3bd2eb6fb1854ff2b1550c40dc54">Renderer::DrawScene</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">NodePtr</a>&amp; node) {</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;  <span class="keywordflow">if</span> (resource_binder) {</div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;    resource_binder-&gt;DrawScene(node, flags_, default_shader_.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>());</div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;    <span class="keywordflow">if</span> (flags_.test(<a class="code" href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04aa5938f9a83e1d9719d363b94533ef9d3">kProcessInfoRequests</a>))</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;      resource_manager_-&gt;ProcessResourceInfoRequests(resource_binder);</div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;  }</div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;}</div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;</div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::MarkAttachmentImplicitlyChanged(</div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_framebuffer_object_1_1_attachment.html">FramebufferObject::Attachment</a>&amp; attachment) {</div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classion_1_1gfx_1_1_texture.html">Texture</a>* tex = attachment.<a class="code" href="classion_1_1gfx_1_1_framebuffer_object_1_1_attachment.html#ab49f51304110b216005b55210a845eeb">GetTexture</a>().<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>()) {</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;    Renderer::SetResourceHolderBit(tex, <a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3ad84f5f896ca7c5b1022457e6033924cf">Texture::kContentsImplicitlyChanged</a>);</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;  }</div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;  <span class="keywordflow">if</span> (CubeMapTexture* tex = attachment.<a class="code" href="classion_1_1gfx_1_1_framebuffer_object_1_1_attachment.html#a42cb01d8ac2a84821225bfb2fee47469">GetCubeMapTexture</a>().<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>()) {</div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;    Renderer::SetResourceHolderBit(tex,</div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;                                   <a class="code" href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3ad84f5f896ca7c5b1022457e6033924cf">CubeMapTexture::kContentsImplicitlyChanged</a>);</div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;  }</div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;}</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;</div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::MapBufferObjectDataRange(</div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a461f30e6f866977271f2c9960237e30c">BufferObjectPtr</a>&amp; <a class="code" href="calltracemanager_8cc.html#ab3d71a3630661054e58116e2249c2e9e">buffer</a>,</div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;    BufferObjectDataMapMode mode,</div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">math::Range1ui</a>&amp; range_in) {</div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;  BufferObject* bo = buffer.Get();</div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;  <span class="keywordflow">if</span> (!bo)</div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;  <span class="keywordflow">if</span> (bo-&gt;GetMappedPointer()) {</div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;A buffer that is already mapped was passed to&quot;</span></div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;                 &lt;&lt; <a class="code" href="macros_8h.html#a0687ad8a544bc4ce58b34f03f07a32c6">ION_PRETTY_FUNCTION</a>;</div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;  }</div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;  <span class="keywordflow">if</span> (range_in.IsEmpty()) {</div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;Ignoring empty range passed to&quot;</span></div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;                 &lt;&lt; <a class="code" href="macros_8h.html#a0687ad8a544bc4ce58b34f03f07a32c6">ION_PRETTY_FUNCTION</a> &lt;&lt; <span class="stringliteral">&quot;, nothing will be mapped&quot;</span>;</div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;  }</div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a> entire_range(</div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;      0U, static_cast&lt;uint32&gt;(bo-&gt;GetStructSize() * bo-&gt;GetCount()));</div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;  <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a> range = range_in;</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;  <span class="keywordtype">void</span>* data = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;  BufferObject::MappedBufferData::DataSource data_source =</div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;      BufferObject::MappedBufferData::kGpuMapped;</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;  GraphicsManager* gm = GetGraphicsManager().Get();</div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;  <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a7eb28f6f9082fff57244f204bc9c73e3">GraphicsManager::kMapBufferRange</a>)) {</div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;    BufferResource* br = resource_manager_-&gt;GetResource(bo, <span class="keyword">this</span>);</div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;    br-&gt;Bind(<span class="keyword">this</span>);</div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;    GLenum access_mode;</div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;    <span class="keywordflow">if</span> (mode == kReadOnly)</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;      access_mode = GL_MAP_READ_BIT;</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == kWriteOnly)</div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;      access_mode = GL_MAP_WRITE_BIT;</div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;      access_mode = GL_MAP_READ_BIT | GL_MAP_WRITE_BIT;</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;    data = gm-&gt;MapBufferRange(br-&gt;GetGlTarget(), range.GetMinPoint(),</div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;                              range.GetSize(), access_mode);</div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572aec856693e4b1f2cfceec7fc9b3dc711c">GraphicsManager::kMapBuffer</a>) &amp;&amp;</div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;             range == entire_range) {</div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;    BufferResource* br = resource_manager_-&gt;GetResource(bo, <span class="keyword">this</span>);</div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;    br-&gt;Bind(<span class="keyword">this</span>);</div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;    GLenum access_mode;</div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;    <span class="keywordflow">if</span> (mode == kReadOnly)</div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;      access_mode = GL_READ_ONLY;</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == kWriteOnly)</div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;      access_mode = GL_WRITE_ONLY;</div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;      access_mode = GL_READ_WRITE;</div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;    data = gm-&gt;MapBuffer(br-&gt;GetGlTarget(), access_mode);</div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (range.GetSize() &lt;= entire_range.GetSize()) {</div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;    <span class="keywordflow">if</span> (bo-&gt;GetData().Get() &amp;&amp; bo-&gt;GetData()-&gt;GetData() &amp;&amp;</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;        bo-&gt;GetCount() * bo-&gt;GetStructSize() &gt;= range_in.GetMaxPoint()) {</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;      data = <span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;          bo-&gt;GetData()-&gt;GetMutableData&lt;uint8&gt;() + range_in.GetMinPoint());</div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;      data_source = BufferObject::MappedBufferData::kDataContainer;</div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;      data = bo-&gt;<a class="code" href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">GetAllocator</a>()-&gt;<a class="code" href="classion_1_1base_1_1_allocator.html#a910d1c7bdc8220ec9b7322ed0392e2cc">AllocateMemory</a>(range.GetSize());</div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;      data_source = BufferObject::MappedBufferData::kAllocated;</div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;      <span class="keywordflow">if</span> (mode != kWriteOnly) {</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;        <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;MapBufferObjectDataRange() glMapBufferRange not &quot;</span></div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;            <span class="stringliteral">&quot;supported and BufferObject&#39;s DataContainer has been wiped so &quot;</span></div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;            <span class="stringliteral">&quot;mapped bytes are uninitialized, i.e., garbage.&quot;</span>;</div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;      }</div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;    }</div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;  }</div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;  <span class="keywordflow">if</span> (data)</div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;    bo-&gt;SetMappedData(range, data, data_source, mode == kReadOnly);</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;Failed to allocate data for &quot;</span></div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;               &lt;&lt; <a class="code" href="macros_8h.html#a0687ad8a544bc4ce58b34f03f07a32c6">ION_PRETTY_FUNCTION</a>;</div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;}</div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;</div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::UnmapBufferObjectData(</div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a461f30e6f866977271f2c9960237e30c">BufferObjectPtr</a>&amp; buffer) {</div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;  BufferObject* bo = buffer.Get();</div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;  <span class="keywordflow">if</span> (!bo)</div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">void</span>* ptr = bo-&gt;GetMappedPointer()) {</div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;    BufferResource* br = resource_manager_-&gt;GetResource(bo, <span class="keyword">this</span>);</div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;    br-&gt;Bind(<span class="keyword">this</span>);</div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;    <span class="keywordflow">if</span> (bo-&gt;GetMappedData().data_source ==</div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;        BufferObject::MappedBufferData::kGpuMapped &amp;&amp;</div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;        graphics_manager_-&gt;IsFunctionGroupAvailable(</div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;            <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a78d8b60d2cf25fe80e7ecc47b7a78ec3">GraphicsManager::kMapBufferBase</a>)) {</div>
<div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;      graphics_manager_-&gt;UnmapBuffer(br-&gt;GetGlTarget());</div>
<div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;      <span class="keywordflow">if</span> (!bo-&gt;GetMappedData().read_only)</div>
<div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;        br-&gt;UploadSubData(bo-&gt;GetMappedData().range, ptr);</div>
<div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;      <span class="keywordflow">if</span> (bo-&gt;GetMappedData().data_source ==</div>
<div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;          BufferObject::MappedBufferData::kAllocated) {</div>
<div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;        bo-&gt;GetAllocator()-&gt;DeallocateMemory(ptr);</div>
<div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;      }</div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;    }</div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;    bo-&gt;SetMappedData(</div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;        <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a>(),</div>
<div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;        <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;        base::InvalidEnumValue&lt;BufferObject::MappedBufferData::DataSource&gt;(),</div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;        <span class="keyword">true</span>);</div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;An unmapped BufferObject was passed to&quot;</span></div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;                 &lt;&lt; <a class="code" href="macros_8h.html#a0687ad8a544bc4ce58b34f03f07a32c6">ION_PRETTY_FUNCTION</a>;</div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;  }</div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;}</div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;</div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::DrawScene(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a07b06fd55473ad00ef896315ae2f6c46">NodePtr</a>&amp; node,</div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;                                         <span class="keyword">const</span> Flags&amp; flags,</div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;                                         ShaderProgram* default_shader) {</div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;  GraphicsManager* gm = GetGraphicsManager().Get();</div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(gm);</div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;</div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;  <span class="keywordflow">if</span> ((flags &amp; AllSaveFlags()).any()) {</div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;    <span class="keywordflow">if</span> (flags.test(kSaveActiveTexture))</div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;      gm-&gt;GetIntegerv(GL_ACTIVE_TEXTURE, GetSavedId(kSaveActiveTexture));</div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;    <span class="keywordflow">if</span> (flags.test(kSaveArrayBuffer))</div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;      gm-&gt;GetIntegerv(GL_ARRAY_BUFFER_BINDING, GetSavedId(kSaveArrayBuffer));</div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;    <span class="keywordflow">if</span> (flags.test(kSaveElementArrayBuffer))</div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;      gm-&gt;GetIntegerv(GL_ELEMENT_ARRAY_BUFFER_BINDING,</div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;                      GetSavedId(kSaveElementArrayBuffer));</div>
<div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;    <span class="keywordflow">if</span> (flags.test(kSaveFramebuffer))</div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;      gm-&gt;GetIntegerv(GL_FRAMEBUFFER_BINDING, GetSavedId(kSaveFramebuffer));</div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;    <span class="keywordflow">if</span> (flags.test(kSaveStateTable)) {</div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;      <a class="code" href="namespaceion_1_1gfx.html#a81379daab6f9c58a8db84411efc85113">UpdateStateTable</a>(0, 0, gm, saved_state_table_.Get());</div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;      <span class="keyword">const</span> base::IndexMap&lt;StateTable::Capability, GLenum&gt; capability_map =</div>
<div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;          base::EnumHelper::GetIndexMap&lt;StateTable::Capability&gt;();</div>
<div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_capabilities = capability_map.GetCount();</div>
<div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_capabilities; ++i) {</div>
<div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;        <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_state_table.html#ae6f345fc251ac53d5797d6300859d665">StateTable::Capability</a> st_cap =</div>
<div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;            <span class="keyword">static_cast&lt;</span><a class="code" href="classion_1_1gfx_1_1_state_table.html#ae6f345fc251ac53d5797d6300859d665">StateTable::Capability</a><span class="keyword">&gt;</span>(i);</div>
<div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;        <span class="keywordflow">if</span> (!saved_state_table_-&gt;IsCapabilitySet(st_cap))</div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;          saved_state_table_-&gt;Enable(st_cap, st_cap == <a class="code" href="classion_1_1gfx_1_1_state_table.html#ae6f345fc251ac53d5797d6300859d665a1a0753a214b1ec21abb3865c3f27ea3f">StateTable::kDither</a>);</div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;      }</div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;    }</div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;    <span class="keywordflow">if</span> (flags.test(kSaveShaderProgram))</div>
<div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;      gm-&gt;GetIntegerv(GL_CURRENT_PROGRAM, GetSavedId(kSaveShaderProgram));</div>
<div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;    <span class="keywordflow">if</span> (flags.test(kSaveVertexArray) &amp;&amp;</div>
<div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;        gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572ae6f498655e1baed043a1de831359babd">GraphicsManager::kVertexArrays</a>))</div>
<div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;      gm-&gt;GetIntegerv(GL_VERTEX_ARRAY_BINDING, GetSavedId(kSaveVertexArray));</div>
<div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;  }</div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;</div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;  <span class="keywordflow">if</span> (FramebufferResource* fbr = GetActiveFramebuffer()) fbr-&gt;Bind(<span class="keyword">this</span>);</div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;</div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;  <span class="keywordflow">if</span> (flags.test(kProcessReleases)) resource_manager_-&gt;ReleaseAll(<span class="keyword">this</span>);</div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;</div>
<div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;  current_shader_program_ = default_shader;</div>
<div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;</div>
<div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;  current_traversal_index_ = 0;</div>
<div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;  <span class="keywordflow">if</span> (node.Get()) {</div>
<div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;    DrawNode(*node, gm);</div>
<div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;    <span class="keywordflow">if</span> (FramebufferObject* fbo = GetCurrentFramebuffer().Get()) {</div>
<div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;      MarkAttachmentImplicitlyChanged(fbo-&gt;GetColorAttachment(0U));</div>
<div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;      MarkAttachmentImplicitlyChanged(fbo-&gt;GetDepthAttachment());</div>
<div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;      MarkAttachmentImplicitlyChanged(fbo-&gt;GetStencilAttachment());</div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;    }</div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;  }</div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;</div>
<div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;  <span class="keywordflow">if</span> ((flags &amp; (AllRestoreFlags() | AllClearFlags())).any()) {</div>
<div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;    <span class="keywordflow">if</span> (flags.test(kRestoreArrayBuffer))</div>
<div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;      BindBuffer(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521aa83c4353d5167f06dba7580fd5c1244f">BufferObject::kArrayBuffer</a>, *GetSavedId(kSaveArrayBuffer),</div>
<div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;                 <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags.test(kClearArrayBuffer))</div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;      BindBuffer(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521aa83c4353d5167f06dba7580fd5c1244f">BufferObject::kArrayBuffer</a>, 0U, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;    <span class="keywordflow">if</span> (flags.test(kRestoreElementArrayBuffer))</div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;      BindBuffer(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521ad4c833c4af4b6e7e3d67173d7185ef38">BufferObject::kElementBuffer</a>,</div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;                 *GetSavedId(kSaveElementArrayBuffer), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags.test(kClearElementArrayBuffer))</div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;      BindBuffer(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521ad4c833c4af4b6e7e3d67173d7185ef38">BufferObject::kElementBuffer</a>, 0U, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;    <span class="keywordflow">if</span> (flags.test(kRestoreFramebuffer)) {</div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;      BindFramebuffer(*GetSavedId(kSaveFramebuffer), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;      SetCurrentFramebuffer(<a class="code" href="namespaceion_1_1gfx.html#a4394f60096b9d80558dd2cf5c32433bb">FramebufferObjectPtr</a>());</div>
<div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags.test(kClearFramebuffer)) {</div>
<div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;      BindFramebuffer(0U, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;      SetCurrentFramebuffer(<a class="code" href="namespaceion_1_1gfx.html#a4394f60096b9d80558dd2cf5c32433bb">FramebufferObjectPtr</a>());</div>
<div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;    }</div>
<div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;    <span class="keywordflow">if</span> (flags.test(kRestoreShaderProgram))</div>
<div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;      BindProgram(*GetSavedId(kSaveShaderProgram), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags.test(kClearShaderProgram))</div>
<div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;      BindProgram(0U, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;    <span class="keywordflow">if</span> (flags.test(kRestoreStateTable)) {</div>
<div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;      <a class="code" href="namespaceion_1_1gfx.html#a91d3c0a06913e26e0d0767e16ef201f6">UpdateFromStateTable</a>(*saved_state_table_, gl_state_table_.Get(), gm);</div>
<div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;      gl_state_table_-&gt;MergeNonClearValuesFrom(*saved_state_table_,</div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;                                               *saved_state_table_);</div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;    }</div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;    <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572ae6f498655e1baed043a1de831359babd">GraphicsManager::kVertexArrays</a>)) {</div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;      <span class="keywordflow">if</span> (flags.test(kRestoreVertexArray))</div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;        BindVertexArray(*GetSavedId(kSaveVertexArray), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags.test(kClearVertexArray))</div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;        BindVertexArray(0U, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;    }</div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;</div>
<div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;    <span class="keywordflow">if</span> (flags.test(kClearCubemaps)) {</div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;      <span class="keyword">const</span> GLuint count = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(image_units_.size());</div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;      <span class="keywordflow">for</span> (GLuint i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;        ActivateUnit(i);</div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;        gm-&gt;BindTexture(GL_TEXTURE_CUBE_MAP, 0);</div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;        ClearTextureBinding(0U, i);</div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;        <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a112409cde13470d53088b409f456bc2a">GraphicsManager::kTexture3d</a>)) {</div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;          gm-&gt;BindTexture(GL_TEXTURE_CUBE_MAP_ARRAY, 0);</div>
<div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;          ClearTextureBinding(0U, i);</div>
<div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;        }</div>
<div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;      }</div>
<div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;    }</div>
<div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;    <span class="keywordflow">if</span> (flags.test(kClearTextures)) {</div>
<div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;      <span class="keyword">const</span> GLuint count = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(image_units_.size());</div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;      <span class="keywordflow">for</span> (GLuint i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;        ActivateUnit(i);</div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;        gm-&gt;BindTexture(GL_TEXTURE_2D, 0);</div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;        ClearTextureBinding(0U, i);</div>
<div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;        <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a112409cde13470d53088b409f456bc2a">GraphicsManager::kTexture3d</a>)) {</div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;          gm-&gt;BindTexture(GL_TEXTURE_1D_ARRAY, 0);</div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;          gm-&gt;BindTexture(GL_TEXTURE_2D_ARRAY, 0);</div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;          gm-&gt;BindTexture(GL_TEXTURE_3D, 0);</div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;        }</div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;        <span class="keywordflow">if</span> (gm-&gt;IsExtensionSupported(<span class="stringliteral">&quot;image_external&quot;</span>)) {</div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;          gm-&gt;BindTexture(<a class="code" href="glheaders_8h.html#adb7e71e2c7c36c9788223afed8c27d61">GL_TEXTURE_EXTERNAL_OES</a>, 0);</div>
<div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;        }</div>
<div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;      }</div>
<div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;    }</div>
<div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;    <span class="keywordflow">if</span> (flags.test(kClearSamplers)) {</div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;      <span class="keyword">const</span> GLuint count = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(image_units_.size());</div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;      <span class="keywordflow">for</span> (GLuint i = 0; i &lt; count; ++i)</div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;        BindSamplerToUnit(0U, i);</div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;    }</div>
<div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;    <span class="keywordflow">if</span> (flags.test(kRestoreActiveTexture))</div>
<div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;      ActivateUnit(*GetSavedId(kSaveActiveTexture) - GL_TEXTURE0);</div>
<div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags.test(kClearActiveTexture))</div>
<div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;      ActivateUnit(0U);</div>
<div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;  }</div>
<div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;}</div>
<div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;</div>
<div class="line"><a name="l05454"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#aed5eca10b4c97950bf65af9b88414b4f"> 5454</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#aed5eca10b4c97950bf65af9b88414b4f">Renderer::ProcessResourceInfoRequests</a>() {</div>
<div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;    resource_manager_-&gt;ProcessResourceInfoRequests(resource_binder);</div>
<div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;}</div>
<div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;</div>
<div class="line"><a name="l05460"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#ad5cbcd5a8af5ad48fed21f7df97411b2"> 5460</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ad5cbcd5a8af5ad48fed21f7df97411b2">Renderer::UpdateStateFromOpenGL</a>(<span class="keywordtype">int</span> window_width, <span class="keywordtype">int</span> window_height) {</div>
<div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;    <a class="code" href="namespaceion_1_1gfx.html#a81379daab6f9c58a8db84411efc85113">UpdateStateTable</a>(window_width, window_height, <a class="code" href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">GetGraphicsManager</a>().Get(),</div>
<div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;                     resource_binder-&gt;GetStateTable());</div>
<div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;}</div>
<div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;</div>
<div class="line"><a name="l05467"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#aefd5770da601a22d4c9c729c22300feb"> 5467</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#aefd5770da601a22d4c9c729c22300feb">Renderer::UpdateStateFromStateTable</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">StateTablePtr</a>&amp; state_table) {</div>
<div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;    resource_binder-&gt;GetStateTable()-&gt;CopyFrom(*state_table);</div>
<div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;}</div>
<div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;</div>
<div class="line"><a name="l05473"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a0f79fd68a46a70be60799714f1213365"> 5473</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_state_table.html">StateTable</a>&amp; <a class="code" href="classion_1_1gfx_1_1_renderer.html#a0f79fd68a46a70be60799714f1213365">Renderer::GetStateTable</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;  <span class="keywordflow">if</span> (!resource_binder) {</div>
<div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;    <a class="code" href="staticsafedeclare_8h.html#a09452e33f7fe6f55ae0bc4ca75152dac">ION_DECLARE_SAFE_STATIC_POINTER_WITH_CONSTRUCTOR</a>(</div>
<div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;        <a class="code" href="classion_1_1base_1_1_shared_ptr.html">StateTablePtr</a>, kDefaultStateTable, (<span class="keyword">new</span> <a class="code" href="namespaceion_1_1gfx.html#a3f928207085cb6063e1a767e5a27f8f0">StateTablePtr</a>(<span class="keyword">new</span> <a class="code" href="classion_1_1gfx_1_1_state_table.html">StateTable</a>)));</div>
<div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: No ResourceBinder (invalid GL Context?): &quot;</span></div>
<div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; using default StateTable&quot;</span>;</div>
<div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;    <span class="keywordflow">return</span> *kDefaultStateTable-&gt;Get();</div>
<div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;  }</div>
<div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;  <span class="keywordflow">return</span> *resource_binder-&gt;GetStateTable();</div>
<div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;}</div>
<div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;</div>
<div class="line"><a name="l05485"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a9ce2e112ba103677976ede3e20593c8b"> 5485</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a9ce2e112ba103677976ede3e20593c8b">Renderer::MapBufferObjectData</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">BufferObjectPtr</a>&amp; buffer,</div>
<div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;                                   <a class="code" href="classion_1_1gfx_1_1_renderer.html#a374fccb25553f288d87f7a66f49cd045">BufferObjectDataMapMode</a> mode) {</div>
<div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classion_1_1gfx_1_1_buffer_object.html">BufferObject</a>* bo = buffer.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>()) {</div>
<div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">Range1ui</a> range(</div>
<div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;        0U, static_cast&lt;uint32&gt;(bo-&gt;GetStructSize() * bo-&gt;GetCount()));</div>
<div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;    <a class="code" href="classion_1_1gfx_1_1_renderer.html#a3294308f6647ada5a52464ed425ae421">MapBufferObjectDataRange</a>(buffer, mode, range);</div>
<div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;A NULL BufferObject was passed to&quot;</span></div>
<div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;                 &lt;&lt; <a class="code" href="macros_8h.html#a0687ad8a544bc4ce58b34f03f07a32c6">ION_PRETTY_FUNCTION</a>;</div>
<div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;  }</div>
<div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;}</div>
<div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;</div>
<div class="line"><a name="l05498"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a3294308f6647ada5a52464ed425ae421"> 5498</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a3294308f6647ada5a52464ed425ae421">Renderer::MapBufferObjectDataRange</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">BufferObjectPtr</a>&amp; buffer,</div>
<div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;                                        <a class="code" href="classion_1_1gfx_1_1_renderer.html#a374fccb25553f288d87f7a66f49cd045">BufferObjectDataMapMode</a> mode,</div>
<div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;                                        <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">math::Range1ui</a>&amp; range_in) {</div>
<div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;  <span class="keywordflow">if</span> (buffer.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>()) {</div>
<div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;    <span class="keywordflow">if</span> (ResourceBinder* resource_binder =</div>
<div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;        GetOrCreateInternalResourceBinder(__LINE__)) {</div>
<div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;      resource_binder-&gt;MapBufferObjectDataRange(buffer, mode, range_in);</div>
<div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;    }</div>
<div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;A NULL BufferObject was passed to&quot;</span></div>
<div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;                 &lt;&lt; <a class="code" href="macros_8h.html#a0687ad8a544bc4ce58b34f03f07a32c6">ION_PRETTY_FUNCTION</a>;</div>
<div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;  }</div>
<div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;}</div>
<div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;</div>
<div class="line"><a name="l05512"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#aa683a2dcb3c87eb63815ddb3ee33bc88"> 5512</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#aa683a2dcb3c87eb63815ddb3ee33bc88">Renderer::UnmapBufferObjectData</a>(<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">BufferObjectPtr</a>&amp; buffer) {</div>
<div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;  <span class="keywordflow">if</span> (buffer.<a class="code" href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">Get</a>()) {</div>
<div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;    <span class="keywordflow">if</span> (ResourceBinder* resource_binder =</div>
<div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;        GetOrCreateInternalResourceBinder(__LINE__)) {</div>
<div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;      resource_binder-&gt;UnmapBufferObjectData(buffer);</div>
<div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;    }</div>
<div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;A NULL BufferObject was passed to&quot;</span></div>
<div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;                 &lt;&lt; <a class="code" href="macros_8h.html#a0687ad8a544bc4ce58b34f03f07a32c6">ION_PRETTY_FUNCTION</a>;</div>
<div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;  }</div>
<div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;}</div>
<div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;</div>
<div class="line"><a name="l05524"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a16f48925c0fae133716a1644b0a41cf8"> 5524</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">ImagePtr</a> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a16f48925c0fae133716a1644b0a41cf8">Renderer::ReadImage</a>(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#ae3b184481b6c5ff2c600931a262210ac">math::Range2i</a>&amp; range,</div>
<div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;                                   <a class="code" href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9e">Image::Format</a> format,</div>
<div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">base::AllocatorPtr</a>&amp; allocator) {</div>
<div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;  <span class="keywordflow">return</span> resource_binder ?</div>
<div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;      resource_binder-&gt;ReadImage(range, format, allocator) : <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a>();</div>
<div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;}</div>
<div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;</div>
<div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;<span class="preprocessor">#if ION_PRODUCTION</span></div>
<div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;<span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ad8bc3aa52a0fda49a820724427948df7">Renderer::PushDebugMarker</a>(<span class="keyword">const</span> std::string&amp; label) {}</div>
<div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a748e81d1f2c217516396e95228858144">Renderer::PopDebugMarker</a>() {}</div>
<div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l05536"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#ad8bc3aa52a0fda49a820724427948df7"> 5536</a></span>&#160;<span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ad8bc3aa52a0fda49a820724427948df7">Renderer::PushDebugMarker</a>(<span class="keyword">const</span> std::string&amp; marker) {</div>
<div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;    resource_binder-&gt;GetStreamAnnotator()-&gt;Push(marker);</div>
<div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;}</div>
<div class="line"><a name="l05541"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a748e81d1f2c217516396e95228858144"> 5541</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a748e81d1f2c217516396e95228858144">Renderer::PopDebugMarker</a>() {</div>
<div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;    resource_binder-&gt;GetStreamAnnotator()-&gt;Pop();</div>
<div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;}</div>
<div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l05549"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a8dfa8e46df4b9e8366cc4fccb5bcfc57"> 5549</a></span>&#160;uint32 <a class="code" href="classion_1_1gfx_1_1_renderer.html#a8dfa8e46df4b9e8366cc4fccb5bcfc57">Renderer::GetResourceGlId</a>(<a class="code" href="class_t.html">T</a>* holder) {</div>
<div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;  uint32 <span class="keywordtype">id</span> = 0U;</div>
<div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;  <span class="keywordflow">if</span> (holder) {</div>
<div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;    <span class="keyword">typedef</span> <span class="keyword">typename</span> HolderToResource&lt;T&gt;::ResourceType <a class="code" href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ResourceType</a>;</div>
<div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;    ResourceBinder* resource_binder =</div>
<div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;        GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;    <span class="keywordflow">if</span> (resource_binder) {</div>
<div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;      resource_binder-&gt;BindResource(holder);</div>
<div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;      ResourceType* resource =</div>
<div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;          resource_manager_-&gt;GetResource(holder, resource_binder);</div>
<div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;      <span class="keywordtype">id</span> = resource-&gt;GetId();</div>
<div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;    }</div>
<div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;  }</div>
<div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>;</div>
<div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;}</div>
<div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;</div>
<div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;<span class="keyword">template</span> ION_API uint32</div>
<div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;Renderer::GetResourceGlId&lt;BufferObject&gt;(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html">BufferObject</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;<span class="keyword">template</span> ION_API uint32</div>
<div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;Renderer::GetResourceGlId&lt;CubeMapTexture&gt;(<a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html">CubeMapTexture</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;<span class="keyword">template</span> ION_API uint32</div>
<div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;Renderer::GetResourceGlId&lt;FramebufferObject&gt;(<a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html">FramebufferObject</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;<span class="keyword">template</span> ION_API uint32</div>
<div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;Renderer::GetResourceGlId&lt;IndexBuffer&gt;(<a class="code" href="classion_1_1gfx_1_1_index_buffer.html">IndexBuffer</a>*);                  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;<span class="keyword">template</span> ION_API uint32 Renderer::GetResourceGlId&lt;Sampler&gt;(<a class="code" href="classion_1_1gfx_1_1_sampler.html">Sampler</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;<span class="keyword">template</span> ION_API uint32 Renderer::GetResourceGlId&lt;Shader&gt;(<a class="code" href="classion_1_1gfx_1_1_shader.html">Shader</a>*);    <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;<span class="keyword">template</span> ION_API uint32</div>
<div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;Renderer::GetResourceGlId&lt;ShaderProgram&gt;(<a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>*);              <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;<span class="keyword">template</span> ION_API uint32 Renderer::GetResourceGlId&lt;Texture&gt;(<a class="code" href="classion_1_1gfx_1_1_texture.html">Texture</a>*);  <span class="comment">// NOLINT</span></div>
<div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;</div>
<div class="line"><a name="l05580"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#aba06e33a9a020bd7cc1f1f986ee8c52c"> 5580</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#aba06e33a9a020bd7cc1f1f986ee8c52c">Renderer::SetTextureImageUnitRange</a>(<span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a55c6c70c3e325850f7118620bcc879a2">Range1i</a>&amp; units) {</div>
<div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;    resource_binder-&gt;SetImageUnitRange(units);</div>
<div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;}</div>
<div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;</div>
<div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l05587"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#ae0dfa7b8c09b0b095e3ccabe6b4927c5"> 5587</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#ac67e2272996e330180142aafd48db43a">Renderer::ClearResources</a>(<span class="keyword">const</span> <a class="code" href="class_t.html">T</a>* holder) {</div>
<div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;    resource_manager_-&gt;ReleaseResources(holder, resource_binder);</div>
<div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;}</div>
<div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;</div>
<div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::ClearResources&lt;AttributeArray&gt;(</div>
<div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_attribute_array.html">AttributeArray</a>*);</div>
<div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::ClearResources&lt;BufferObject&gt;(</div>
<div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_buffer_object.html">BufferObject</a>*);</div>
<div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::ClearResources&lt;CubeMapTexture&gt;(</div>
<div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html">CubeMapTexture</a>*);</div>
<div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::ClearResources&lt;FramebufferObject&gt;(</div>
<div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_framebuffer_object.html">FramebufferObject</a>*);</div>
<div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::ClearResources&lt;Sampler&gt;(<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_sampler.html">Sampler</a>*);</div>
<div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::ClearResources&lt;Shader&gt;(<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader.html">Shader</a>*);</div>
<div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::ClearResources&lt;ShaderProgram&gt;(</div>
<div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>*);</div>
<div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;<span class="keyword">template</span> ION_API <span class="keywordtype">void</span> Renderer::ClearResources&lt;Texture&gt;(<span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_texture.html">Texture</a>*);</div>
<div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;</div>
<div class="line"><a name="l05608"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a4764fdcb75dbfe4f3521cd85fd55ff38"> 5608</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a4764fdcb75dbfe4f3521cd85fd55ff38">Renderer::ClearAllResources</a>() {</div>
<div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classion_1_1gfx_1_1_renderer.html#ac114f7e665e2dc43ae183edae3f684ce">kNumResourceTypes</a>; ++i)</div>
<div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;    resource_manager_-&gt;ReleaseTypedResources(static_cast&lt;ResourceType&gt;(i));</div>
<div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_renderer.html#a461f0570b14d2a978dcb90b9434abe32">ReleaseResources</a>();</div>
<div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;}</div>
<div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;</div>
<div class="line"><a name="l05614"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a730d3d3b0175b0cb7056ce8abba53383"> 5614</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a730d3d3b0175b0cb7056ce8abba53383">Renderer::ClearTypedResources</a>(ResourceType type) {</div>
<div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;  resource_manager_-&gt;ReleaseTypedResources(type);</div>
<div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;  <a class="code" href="classion_1_1gfx_1_1_renderer.html#a461f0570b14d2a978dcb90b9434abe32">ReleaseResources</a>();</div>
<div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;}</div>
<div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;</div>
<div class="line"><a name="l05619"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a461f0570b14d2a978dcb90b9434abe32"> 5619</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a461f0570b14d2a978dcb90b9434abe32">Renderer::ReleaseResources</a>() {</div>
<div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;  ResourceBinder* resource_binder = GetOrCreateInternalResourceBinder(__LINE__);</div>
<div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;  <span class="keywordflow">if</span> (resource_binder)</div>
<div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;    resource_manager_-&gt;ReleaseAll(resource_binder);</div>
<div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;}</div>
<div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;</div>
<div class="line"><a name="l05625"></a><span class="lineno"><a class="line" href="classion_1_1gfx_1_1_renderer.html#a6f54e85cc8adc7230686c24b81f6cfce"> 5625</a></span>&#160;<span class="keywordtype">size_t</span> <a class="code" href="classion_1_1gfx_1_1_renderer.html#a6f54e85cc8adc7230686c24b81f6cfce">Renderer::GetGpuMemoryUsage</a>(ResourceType type)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;  <span class="keywordflow">return</span> resource_manager_-&gt;GetGpuMemoryUsage(type);</div>
<div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;}</div>
<div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;</div>
<div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;<span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">ShaderProgramPtr</a> Renderer::CreateDefaultShaderProgram(</div>
<div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;    <span class="keyword">const</span> <a class="code" href="classion_1_1base_1_1_shared_ptr.html">base::AllocatorPtr</a>&amp; allocator) {</div>
<div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* kDefaultVertexShaderString =</div>
<div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;      <span class="stringliteral">&quot;uniform mat4 uProjectionMatrix;\n&quot;</span></div>
<div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;      <span class="stringliteral">&quot;uniform mat4 uModelviewMatrix;\n&quot;</span></div>
<div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;      <span class="stringliteral">&quot;attribute vec3 aVertex;\n&quot;</span></div>
<div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;      <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;      <span class="stringliteral">&quot;void main(void) {\n&quot;</span></div>
<div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;      <span class="stringliteral">&quot;  gl_Position = uProjectionMatrix * uModelviewMatrix *\n&quot;</span></div>
<div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;      <span class="stringliteral">&quot;      vec4(aVertex, 1.);\n&quot;</span></div>
<div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;      <span class="stringliteral">&quot;}\n&quot;</span>;</div>
<div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;</div>
<div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* kDefaultFragmentShaderString =</div>
<div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;      <span class="stringliteral">&quot;#ifdef GL_ES\n&quot;</span></div>
<div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;      <span class="stringliteral">&quot;precision mediump float;\n&quot;</span></div>
<div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;      <span class="stringliteral">&quot;#endif\n&quot;</span></div>
<div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;      <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;      <span class="stringliteral">&quot;uniform vec4 uBaseColor;\n&quot;</span></div>
<div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;      <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;      <span class="stringliteral">&quot;void main(void) {\n&quot;</span></div>
<div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;      <span class="stringliteral">&quot;  gl_FragColor = uBaseColor;\n&quot;</span></div>
<div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;      <span class="stringliteral">&quot;}\n&quot;</span>;</div>
<div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;</div>
<div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;  <a class="code" href="classion_1_1base_1_1_shared_ptr.html">ShaderInputRegistryPtr</a> empty_registry(<span class="keyword">new</span>(allocator) <a class="code" href="classion_1_1gfx_1_1_shader_input_registry.html">ShaderInputRegistry</a>);</div>
<div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;  empty_registry-&gt;IncludeGlobalRegistry();</div>
<div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;</div>
<div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;  <a class="code" href="classion_1_1base_1_1_shared_ptr.html">ShaderProgramPtr</a> program(<span class="keyword">new</span>(allocator) <a class="code" href="classion_1_1gfx_1_1_shader_program.html">ShaderProgram</a>(empty_registry));</div>
<div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;  program-&gt;SetLabel(<span class="stringliteral">&quot;Default Renderer shader&quot;</span>);</div>
<div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;  program-&gt;SetVertexShader(</div>
<div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;      <a class="code" href="namespaceion_1_1gfx.html#a3cdd7323c1a3246f97b79277b3845054">ShaderPtr</a>(<span class="keyword">new</span>(allocator) <a class="code" href="classion_1_1gfx_1_1_shader.html">Shader</a>(kDefaultVertexShaderString)));</div>
<div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;  program-&gt;SetFragmentShader(</div>
<div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;      <a class="code" href="namespaceion_1_1gfx.html#a3cdd7323c1a3246f97b79277b3845054">ShaderPtr</a>(<span class="keyword">new</span>(allocator) <a class="code" href="classion_1_1gfx_1_1_shader.html">Shader</a>(kDefaultFragmentShaderString)));</div>
<div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;  program-&gt;GetVertexShader()-&gt;SetLabel(<span class="stringliteral">&quot;Default Renderer vertex shader&quot;</span>);</div>
<div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;  program-&gt;GetFragmentShader()-&gt;SetLabel(<span class="stringliteral">&quot;Default Renderer fragment shader&quot;</span>);</div>
<div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;  <span class="keywordflow">return</span> program;</div>
<div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;}</div>
<div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;</div>
<div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;<span class="keywordtype">void</span> Renderer::SetResourceHolderBit(<span class="keyword">const</span> ResourceHolder* holder, <span class="keywordtype">int</span> bit) {</div>
<div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;  holder-&gt;OnChanged(bit);</div>
<div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;}</div>
<div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;</div>
<div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::DrawNode(<span class="keyword">const</span> Node&amp; node, GraphicsManager* gm) {</div>
<div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;  <span class="keywordflow">if</span> (!node.IsEnabled())</div>
<div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;</div>
<div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;  ScopedLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, &amp;node, node.GetLabel());</div>
<div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;</div>
<div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> StateTable* st = node.GetStateTable().Get()) {</div>
<div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;    traversal_state_tables_[current_traversal_index_]-&gt;CopyFrom(</div>
<div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;        *client_state_table_.Get());</div>
<div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;    <span class="keywordflow">if</span> (++current_traversal_index_ &gt;= traversal_state_tables_.size())</div>
<div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;      traversal_state_tables_.push_back(<a class="code" href="namespaceion_1_1gfx.html#a3f928207085cb6063e1a767e5a27f8f0">StateTablePtr</a>(<span class="keyword">new</span> StateTable));</div>
<div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;</div>
<div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;    client_state_table_-&gt;MergeValuesFrom(*st, *st);</div>
<div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;    <a class="code" href="namespaceion_1_1gfx.html#aa6d4e016481ce0d624a98789018f8c49">ClearFromStateTable</a>(*st, gl_state_table_.Get(), gm);</div>
<div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;    <span class="keywordflow">if</span> (st-&gt;AreSettingsEnforced()) {</div>
<div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;      <a class="code" href="namespaceion_1_1gfx.html#a91d3c0a06913e26e0d0767e16ef201f6">UpdateFromStateTable</a>(*st, gl_state_table_.Get(), gm);</div>
<div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;      gl_state_table_-&gt;MergeNonClearValuesFrom(*st, *st);</div>
<div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;    }</div>
<div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;  }</div>
<div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;</div>
<div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;  <span class="keywordflow">if</span> (ShaderProgram* shader = node.GetShaderProgram().Get())</div>
<div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;    current_shader_program_ = shader;</div>
<div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(current_shader_program_);</div>
<div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;</div>
<div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;  PushUniforms(&amp;node, node.GetUniforms());</div>
<div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;  <span class="keyword">const</span> base::AllocVector&lt;UniformBlockPtr&gt;&amp; uniform_blocks =</div>
<div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;      node.GetUniformBlocks();</div>
<div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_uniform_blocks = uniform_blocks.size();</div>
<div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_uniform_blocks; ++i)</div>
<div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;    <span class="keywordflow">if</span> (uniform_blocks[i]-&gt;IsEnabled())</div>
<div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;      PushUniforms(&amp;node, uniform_blocks[i]-&gt;GetUniforms());</div>
<div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;</div>
<div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;  <span class="keyword">const</span> base::AllocVector&lt;ShapePtr&gt;&amp; shapes = node.GetShapes();</div>
<div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">size_t</span> num_shapes = shapes.size()) {</div>
<div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;    <a class="code" href="namespaceion_1_1gfx.html#a91d3c0a06913e26e0d0767e16ef201f6">UpdateFromStateTable</a>(*client_state_table_, gl_state_table_.Get(), gm);</div>
<div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;</div>
<div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;    resource_manager_-&gt;GetResource(current_shader_program_, <span class="keyword">this</span>)-&gt;Bind(<span class="keyword">this</span>);</div>
<div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;</div>
<div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_shapes; ++i)</div>
<div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;      DrawShape(*shapes[i], gm);</div>
<div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;</div>
<div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;    gl_state_table_-&gt;MergeNonClearValuesFrom(*client_state_table_,</div>
<div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;                                             *client_state_table_);</div>
<div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;  }</div>
<div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;</div>
<div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;  ShaderProgram* saved_shader_program = current_shader_program_;</div>
<div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;</div>
<div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;  <span class="keyword">const</span> base::AllocVector&lt;NodePtr&gt;&amp; children = node.GetChildren();</div>
<div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_children = children.size();</div>
<div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_children; ++i) {</div>
<div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;    DrawNode(*children[i], gm);</div>
<div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;    current_shader_program_ = saved_shader_program;</div>
<div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;  }</div>
<div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;</div>
<div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> StateTable* st = node.GetStateTable().Get()) {</div>
<div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;    --current_traversal_index_;</div>
<div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;    client_state_table_-&gt;MergeNonClearValuesFrom(</div>
<div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;        *traversal_state_tables_[current_traversal_index_].Get(), *st);</div>
<div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;  }</div>
<div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;</div>
<div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;  PopUniforms(node.GetUniforms());</div>
<div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_uniform_blocks; ++i)</div>
<div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;    <span class="keywordflow">if</span> (uniform_blocks[i]-&gt;IsEnabled())</div>
<div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;      PopUniforms(uniform_blocks[i]-&gt;GetUniforms());</div>
<div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;}</div>
<div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;</div>
<div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::DrawShape(<span class="keyword">const</span> Shape&amp; shape,</div>
<div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;                                         GraphicsManager* gm) {</div>
<div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;  <span class="keywordflow">if</span> (!shape.GetAttributeArray().Get())</div>
<div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;  <span class="keyword">const</span> AttributeArray&amp; attribute_array = *shape.GetAttributeArray();</div>
<div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;  <span class="keywordflow">if</span> (attribute_array.GetAttributeCount() == 0U ||</div>
<div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;      (shape.GetIndexBuffer().Get() &amp;&amp; !shape.GetIndexBuffer()-&gt;GetCount()))</div>
<div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;</div>
<div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;  ScopedLabel <a class="code" href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a>(<span class="keyword">this</span>, &amp;shape, shape.GetLabel());</div>
<div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;</div>
<div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;  VertexArrayResource* var;</div>
<div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;  <span class="keywordflow">if</span> (gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572ae6f498655e1baed043a1de831359babd">GraphicsManager::kVertexArrays</a>))</div>
<div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;    var = resource_manager_-&gt;GetResource(&amp;attribute_array, <span class="keyword">this</span>);</div>
<div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;    var = resource_manager_-&gt;GetResource(</div>
<div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;        reinterpret_cast&lt;const AttributeArrayEmulator*&gt;(&amp;attribute_array),</div>
<div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;        <span class="keyword">this</span>);</div>
<div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(var);</div>
<div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;  <span class="keywordflow">if</span> (var &amp;&amp; !var-&gt;BindAndCheckBuffers(<span class="keyword">false</span>, <span class="keyword">this</span>))</div>
<div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;</div>
<div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;  <span class="keywordflow">if</span> (IndexBuffer* ib = shape.GetIndexBuffer().Get()) {</div>
<div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;    DrawIndexedShape(shape, *ib, gm);</div>
<div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;    DrawNonindexedShape(shape, var-&gt;GetVertexCount(), gm);</div>
<div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;  }</div>
<div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;}</div>
<div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;</div>
<div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::DrawIndexedShape(<span class="keyword">const</span> Shape&amp; shape,</div>
<div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;                                                <span class="keyword">const</span> IndexBuffer&amp; ib,</div>
<div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;                                                GraphicsManager* gm) {</div>
<div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;  BufferResource* br = resource_manager_-&gt;GetResource(&amp;ib, <span class="keyword">this</span>);</div>
<div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(br);</div>
<div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;  br-&gt;Bind(<span class="keyword">this</span>);</div>
<div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;</div>
<div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;  <span class="keyword">const</span> BufferObject::Spec&amp; spec = ib.GetSpec(0);</div>
<div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!<a class="code" href="namespaceion_1_1base.html#a62eaa5f45ca6b9f446ca128679860ead">base::IsInvalidReference</a>(spec));</div>
<div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;  <span class="keyword">const</span> GLenum data_type = <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(spec.type);</div>
<div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;  <span class="keywordflow">if</span> (gm-&gt;GetGlApiStandard() == <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#afe483c6cc2e75618b57e9269e5cd7628a2641041b6785a83379197dcfaeb9ef4d">GraphicsManager::kEs</a> &amp;&amp;</div>
<div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;      gm-&gt;GetGlVersion() &lt; 30 &amp;&amp;</div>
<div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;      (data_type == GL_INT || data_type == GL_UNSIGNED_INT)) {</div>
<div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;    <a class="code" href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Unable to draw shape &quot;</span> &lt;&lt; shape.GetLabel()</div>
<div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; using index buffer: &quot;</span></div>
<div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;The component type is not supported on this platform&quot;</span>;</div>
<div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;  }</div>
<div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;  <span class="keyword">const</span> GLenum prim_type =</div>
<div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;      <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(shape.GetPrimitiveType());</div>
<div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">size_t</span> range_count = shape.GetVertexRangeCount()) {</div>
<div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; range_count; ++i) {</div>
<div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;      <span class="keywordflow">if</span> (shape.IsVertexRangeEnabled(i)) {</div>
<div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a55c6c70c3e325850f7118620bcc879a2">Range1i</a>&amp; range = shape.GetVertexRange(i);</div>
<div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> start_index = range.GetMinPoint()[0];</div>
<div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> count = range.GetSize();</div>
<div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;        <a class="code" href="base_2logging_8h.html#ab4f56aa24c4c9cddc47a6abd2d747f9a">DCHECK_GT</a>(count, 0);</div>
<div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> instance_count = shape.GetVertexRangeInstanceCount(i);</div>
<div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;        <span class="keywordflow">if</span> (instance_count &amp;&amp;</div>
<div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;            gm-&gt;IsFunctionGroupAvailable(</div>
<div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;                <a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a4af48b30c3a8560da50e555ae2ff928c">GraphicsManager::kInstancedDrawing</a>)) {</div>
<div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;          gm-&gt;DrawElementsInstanced(prim_type, count, data_type,</div>
<div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;                                    reinterpret_cast&lt;const GLvoid*&gt;(</div>
<div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;                                        start_index * ib.GetStructSize()),</div>
<div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;                                    instance_count);</div>
<div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;          <span class="keywordflow">if</span> (instance_count) {</div>
<div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;            <a class="code" href="base_2logging_8h.html#ab8493891cf64850ba3b3a95626938207">LOG_ONCE</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Instanced drawing is not &quot;</span></div>
<div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;                <span class="stringliteral">&quot;available. The vertex ranges in Shape: &quot;</span></div>
<div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;                              &lt;&lt; shape.GetLabel()</div>
<div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot; will be drawn only once.&quot;</span>;</div>
<div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;          }</div>
<div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;          gm-&gt;DrawElements(prim_type, count, data_type,</div>
<div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;                           reinterpret_cast&lt;const GLvoid*&gt;(</div>
<div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;                               start_index * ib.GetStructSize()));</div>
<div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;        }</div>
<div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;      }</div>
<div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;    }</div>
<div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> instance_count = shape.GetInstanceCount();</div>
<div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;    <span class="keywordflow">if</span> (instance_count &amp;&amp;</div>
<div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;        gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a4af48b30c3a8560da50e555ae2ff928c">GraphicsManager::kInstancedDrawing</a>)) {</div>
<div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;      gm-&gt;DrawElementsInstanced(</div>
<div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;          prim_type, static_cast&lt;GLsizei&gt;(ib.GetCount()), data_type,</div>
<div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;          reinterpret_cast&lt;const GLvoid*&gt;(0), instance_count);</div>
<div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;      <span class="keywordflow">if</span> (instance_count) {</div>
<div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;        <a class="code" href="base_2logging_8h.html#ab8493891cf64850ba3b3a95626938207">LOG_ONCE</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>)</div>
<div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;***ION: Instanced drawing is not available. Shape: &quot;</span></div>
<div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;            &lt;&lt; shape.GetLabel() &lt;&lt; <span class="stringliteral">&quot; will be drawn only once.&quot;</span>;</div>
<div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;      }</div>
<div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;      gm-&gt;DrawElements(prim_type, static_cast&lt;GLsizei&gt;(ib.GetCount()),</div>
<div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;                       data_type, reinterpret_cast&lt;const GLvoid*&gt;(0));</div>
<div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;    }</div>
<div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;  }</div>
<div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;}</div>
<div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;</div>
<div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::DrawNonindexedShape(<span class="keyword">const</span> Shape&amp; shape,</div>
<div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;                                                   <span class="keywordtype">size_t</span> <a class="code" href="gpuperformance_8cc.html#a72b34cdff63b637dbcd4849315a25601">vertex_count</a>,</div>
<div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;                                                   GraphicsManager* gm) {</div>
<div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;  <span class="keyword">const</span> GLenum prim_type =</div>
<div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;      <a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(shape.GetPrimitiveType());</div>
<div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">size_t</span> range_count = shape.GetVertexRangeCount()) {</div>
<div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; range_count; ++i) {</div>
<div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;      <span class="keywordflow">if</span> (shape.IsVertexRangeEnabled(i)) {</div>
<div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#a55c6c70c3e325850f7118620bcc879a2">Range1i</a>&amp; range = shape.GetVertexRange(i);</div>
<div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> start_index = range.GetMinPoint()[0];</div>
<div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> count = range.GetSize();</div>
<div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;        <a class="code" href="base_2logging_8h.html#ab4f56aa24c4c9cddc47a6abd2d747f9a">DCHECK_GT</a>(count, 0);</div>
<div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> instance_count = shape.GetVertexRangeInstanceCount(i);</div>
<div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;        <span class="keywordflow">if</span> (instance_count &amp;&amp;</div>
<div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;            gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a4af48b30c3a8560da50e555ae2ff928c">GraphicsManager::kInstancedDrawing</a>)) {</div>
<div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;          gm-&gt;DrawArraysInstanced(prim_type, start_index, count,</div>
<div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;                                  instance_count);</div>
<div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;          <span class="keywordflow">if</span> (instance_count) {</div>
<div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;            <a class="code" href="base_2logging_8h.html#ab8493891cf64850ba3b3a95626938207">LOG_ONCE</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;***ION: Instanced drawing is not available. &quot;</span></div>
<div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;                                 <span class="stringliteral">&quot;The vertex ranges in Shape: &quot;</span></div>
<div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;                              &lt;&lt; shape.GetLabel()</div>
<div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot; will be drawn only once.&quot;</span>;</div>
<div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;          }</div>
<div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;          gm-&gt;DrawArrays(prim_type, start_index, count);</div>
<div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;        }</div>
<div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;      }</div>
<div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;    }</div>
<div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> instance_count = shape.GetInstanceCount();</div>
<div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;    <span class="keywordflow">if</span> (instance_count &amp;&amp;</div>
<div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;        gm-&gt;IsFunctionGroupAvailable(<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a4af48b30c3a8560da50e555ae2ff928c">GraphicsManager::kInstancedDrawing</a>)) {</div>
<div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;      gm-&gt;DrawArraysInstanced(prim_type, 0, static_cast&lt;GLsizei&gt;(vertex_count),</div>
<div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;                              instance_count);</div>
<div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;      <span class="keywordflow">if</span> (instance_count) {</div>
<div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;        <a class="code" href="base_2logging_8h.html#ab8493891cf64850ba3b3a95626938207">LOG_ONCE</a>(<a class="code" href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">WARNING</a>)</div>
<div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;***ION: Instanced drawing is not available. Shape: &quot;</span></div>
<div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;            &lt;&lt; shape.GetLabel() &lt;&lt; <span class="stringliteral">&quot; will be drawn only once.&quot;</span>;</div>
<div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;      }</div>
<div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;      gm-&gt;DrawArrays(prim_type, 0, static_cast&lt;GLsizei&gt;(vertex_count));</div>
<div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;    }</div>
<div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;  }</div>
<div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;}</div>
<div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;</div>
<div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::BindBuffer(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521">BufferObject::Target</a> target,</div>
<div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;                                          GLuint <span class="keywordtype">id</span>, BufferResource* resource) {</div>
<div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">id</span> != active_buffers_[target].buffer) {</div>
<div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;    active_buffers_[target].buffer = <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>;</div>
<div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;    active_buffers_[target].resource = resource;</div>
<div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;    GetGraphicsManager()-&gt;BindBuffer(<a class="code" href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">base::EnumHelper::GetConstant</a>(target), <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;    <span class="keywordflow">if</span> (target == <a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521ad4c833c4af4b6e7e3d67173d7185ef38">BufferObject::kElementBuffer</a> &amp;&amp; active_vertex_array_resource_)</div>
<div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;      active_vertex_array_resource_-&gt;SetElementArrayBinding(<span class="keywordtype">id</span>, resource);</div>
<div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;  }</div>
<div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;}</div>
<div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;</div>
<div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::BindFramebuffer(GLuint <span class="keywordtype">id</span>,</div>
<div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;                                               FramebufferResource* fbo) {</div>
<div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">id</span> != active_framebuffer_) {</div>
<div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!fbo || <span class="keywordtype">id</span> == fbo-&gt;GetId());</div>
<div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;    active_framebuffer_ = <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>;</div>
<div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;    active_framebuffer_resource_ = fbo;</div>
<div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;    GetGraphicsManager()-&gt;BindFramebuffer(GL_FRAMEBUFFER, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;  }</div>
<div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;}</div>
<div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;</div>
<div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;<span class="keywordtype">bool</span> Renderer::ResourceBinder::BindProgram(GLuint <span class="keywordtype">id</span>,</div>
<div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;                                           ShaderProgramResource* resource) {</div>
<div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">id</span> != active_shader_id_) {</div>
<div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!resource || <span class="keywordtype">id</span> == resource-&gt;GetId());</div>
<div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;    active_shader_id_ = <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>;</div>
<div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;    GetGraphicsManager()-&gt;UseProgram(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;    active_shader_resource_ = resource;</div>
<div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;  }</div>
<div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;}</div>
<div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;</div>
<div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::BindVertexArray(GLuint <span class="keywordtype">id</span>,</div>
<div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;                                               VertexArrayResource* resource) {</div>
<div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">id</span> != active_vertex_array_) {</div>
<div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;    <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(!resource || <span class="keywordtype">id</span> == resource-&gt;GetId());</div>
<div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;    active_vertex_array_ = <a class="code" href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a>;</div>
<div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;    active_vertex_array_resource_ = resource;</div>
<div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;    ClearBufferBinding(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521ad4c833c4af4b6e7e3d67173d7185ef38">BufferObject::kElementBuffer</a>, 0U);</div>
<div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;    GetGraphicsManager()-&gt;BindVertexArray(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;  }</div>
<div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;}</div>
<div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;</div>
<div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::ActivateUnit(GLuint unit) {</div>
<div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;  <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(unit, static_cast&lt;GLuint&gt;(image_units_.size()));</div>
<div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;  <span class="keywordflow">if</span> (unit != active_image_unit_) {</div>
<div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;    active_image_unit_ = unit;</div>
<div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;    GetGraphicsManager()-&gt;ActiveTexture(GL_TEXTURE0 + unit);</div>
<div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;  }</div>
<div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;}</div>
<div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;</div>
<div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::BindTextureToUnit(TextureResource* resource,</div>
<div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;                                                 GLuint unit) {</div>
<div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;  <a class="code" href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a>(unit, image_units_.size());</div>
<div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;</div>
<div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;  TextureResource* current_resource = image_units_[unit].resource;</div>
<div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;  <span class="keywordflow">if</span> (current_resource != resource) {</div>
<div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;    ActivateUnit(unit);</div>
<div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;    <span class="keyword">const</span> GLuint <span class="keywordtype">id</span> = resource-&gt;GetId();</div>
<div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;    <span class="keyword">const</span> GLenum target = resource-&gt;GetGlTarget();</div>
<div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;    image_units_[unit].resource = resource;</div>
<div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;    texture_last_bindings_[resource] = unit;</div>
<div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;    GetGraphicsManager()-&gt;BindTexture(target, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;  }</div>
<div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;}</div>
<div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;</div>
<div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::ClearTextureBinding(GLuint <span class="keywordtype">id</span>, GLuint unit) {</div>
<div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;  TextureResource*&amp; resource = image_units_[unit].resource;</div>
<div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;  <span class="keywordflow">if</span> (!<span class="keywordtype">id</span> || (resource &amp;&amp; <span class="keywordtype">id</span> == resource-&gt;GetId())) {</div>
<div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;    resource = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;  }</div>
<div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;}</div>
<div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;</div>
<div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::ClearVertexArrayBinding(GLuint <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;  <span class="keywordflow">if</span> (!<span class="keywordtype">id</span> || <span class="keywordtype">id</span> == active_vertex_array_) {</div>
<div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;    active_vertex_array_ = 0;</div>
<div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;    <span class="keywordflow">if</span> (active_vertex_array_resource_ &amp;&amp;</div>
<div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;        active_vertex_array_resource_-&gt;GetElementArrayBinding().buffer) {</div>
<div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;      ClearBufferBinding(</div>
<div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;          <a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521ad4c833c4af4b6e7e3d67173d7185ef38">BufferObject::kElementBuffer</a>,</div>
<div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;          active_vertex_array_resource_-&gt;GetElementArrayBinding().buffer);</div>
<div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;    }</div>
<div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;    active_vertex_array_resource_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;  }</div>
<div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;}</div>
<div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;</div>
<div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::ClearNonFramebufferCachedBindings() {</div>
<div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;  ClearBufferBinding(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521aa83c4353d5167f06dba7580fd5c1244f">BufferObject::kArrayBuffer</a>, 0U);</div>
<div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;  ClearBufferBinding(<a class="code" href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521ad4c833c4af4b6e7e3d67173d7185ef38">BufferObject::kElementBuffer</a>, 0U);</div>
<div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;  ClearProgramBinding(0U);</div>
<div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;  <span class="keyword">const</span> GLuint count = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(GetImageUnitCount());</div>
<div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;  <span class="keywordflow">for</span> (GLuint i = 0U; i &lt; count; ++i) {</div>
<div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;    ClearTextureBinding(0U, i);</div>
<div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;    image_units_[i].sampler = 0;</div>
<div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;  }</div>
<div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;  active_image_unit_ = <span class="keyword">static_cast&lt;</span>GLuint<span class="keyword">&gt;</span>(image_units_.size() + 1U);</div>
<div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;  ClearVertexArrayBinding(0U);</div>
<div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;}</div>
<div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;</div>
<div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;<span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a> Renderer::ResourceBinder::ReadImage(</div>
<div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceion_1_1math.html#ae3b184481b6c5ff2c600931a262210ac">math::Range2i</a>&amp; range, <a class="code" href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9e">Image::Format</a> format,</div>
<div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceion_1_1base.html#a43c6663b5bdd5e5839eba0729b613c28">base::AllocatorPtr</a>&amp; allocator) {</div>
<div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;  <a class="code" href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ImagePtr</a> <a class="code" href="sdfutils_8cc.html#a3555e065e55befd710eaa182fcf387f5">image</a>(<span class="keyword">new</span>(allocator) Image());</div>
<div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> x = range.GetMinPoint()[0];</div>
<div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> y = range.GetMinPoint()[1];</div>
<div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> width = range.GetSize()[0];</div>
<div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> height = range.GetSize()[1];</div>
<div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;</div>
<div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;  GraphicsManager* gm = GetGraphicsManager().Get();</div>
<div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;  Image::PixelFormat pf =</div>
<div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;      GetCompatiblePixelFormat(<a class="code" href="classion_1_1gfx_1_1_image.html#a7a06522e42b8521c6a9875a74d9b96c1">Image::GetPixelFormat</a>(format), gm);</div>
<div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> data_size = <a class="code" href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">Image::ComputeDataSize</a>(format, width, height);</div>
<div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;  <a class="code" href="namespaceion_1_1base.html#a9aea056fa3b5c46e3182f5427fb5f010">DataContainerPtr</a> data = DataContainer::CreateOverAllocated&lt;uint8&gt;(</div>
<div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;      data_size, <span class="keyword">nullptr</span>, image-&gt;GetAllocator());</div>
<div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;  memset(data-&gt;GetMutableData&lt;uint8&gt;(), 0, data_size);</div>
<div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;</div>
<div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;  gm-&gt;PixelStorei(GL_PACK_ALIGNMENT, 1);</div>
<div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;  gm-&gt;ReadPixels(x, y, width, height, pf.format, pf.type,</div>
<div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;                 data-&gt;GetMutableData&lt;uint8&gt;());</div>
<div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;  image-&gt;Set(format, width, height, data);</div>
<div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;</div>
<div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="sdfutils_8cc.html#a3555e065e55befd710eaa182fcf387f5">image</a>;</div>
<div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;}</div>
<div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;</div>
<div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::SendUniform(<span class="keyword">const</span> Uniform&amp; uniform, <span class="keywordtype">int</span> location,</div>
<div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;                                           GraphicsManager* gm) {</div>
<div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;<span class="preprocessor">#define SEND_VECTOR_UNIFORM(type, elem_type, num_elements, setter)             \</span></div>
<div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;<span class="preprocessor">  if (uniform.IsArrayOf&lt;type&gt;()) {                                             \</span></div>
<div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;<span class="preprocessor">    </span><span class="comment">/* Check that the values are packed in the uniform data. */</span><span class="preprocessor">                \</span></div>
<div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;<span class="preprocessor">    if (uniform.GetCount() &gt; 1) {                                              \</span></div>
<div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;<span class="preprocessor">      DCHECK_EQ(                                                               \</span></div>
<div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;<span class="preprocessor">          reinterpret_cast&lt;const elem_type*&gt;(&amp;uniform.GetValueAt&lt;type&gt;(1)),    \</span></div>
<div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;<span class="preprocessor">          reinterpret_cast&lt;const elem_type*&gt;(&amp;uniform.GetValueAt&lt;type&gt;(0)) +   \</span></div>
<div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;<span class="preprocessor">              num_elements);                                                   \</span></div>
<div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;<span class="preprocessor">    }                                                                          \</span></div>
<div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;<span class="preprocessor">    gm-&gt;setter(                                                                \</span></div>
<div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;<span class="preprocessor">        location, static_cast&lt;GLsizei&gt;(uniform.GetCount()),                    \</span></div>
<div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;<span class="preprocessor">        reinterpret_cast&lt;const elem_type*&gt;(&amp;uniform.GetValueAt&lt;type&gt;(0)));     \</span></div>
<div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;<span class="preprocessor">  } else {                                                                     \</span></div>
<div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;<span class="preprocessor">    gm-&gt;setter(location, 1,                                                    \</span></div>
<div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;<span class="preprocessor">               reinterpret_cast&lt;const elem_type*&gt;(&amp;uniform.GetValue&lt;type&gt;())); \</span></div>
<div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;<span class="preprocessor">  }</span></div>
<div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;<span class="preprocessor">#define SEND_TEXTURE_UNIFORM(type)                                  \</span></div>
<div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;<span class="preprocessor">  </span><span class="comment">/* Get the texture resource from each holder. */</span><span class="preprocessor">                  \</span></div>
<div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;<span class="preprocessor">  if (uniform.IsArrayOf&lt;type##Ptr&gt;()) {                             \</span></div>
<div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;<span class="preprocessor">    const size_t count = uniform.GetCount();                        \</span></div>
<div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;<span class="preprocessor">    const base::AllocatorPtr&amp; allocator =                           \</span></div>
<div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;<span class="preprocessor">        base::AllocationManager::GetDefaultAllocatorForLifetime(    \</span></div>
<div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160;<span class="preprocessor">            base::kShortTerm);                                      \</span></div>
<div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;<span class="preprocessor">    base::AllocVector&lt;GLint&gt; ids(allocator);                        \</span></div>
<div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;<span class="preprocessor">    ids.reserve(count);                                             \</span></div>
<div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;<span class="preprocessor">    </span><span class="comment">/* Each resource holds its own id. */</span><span class="preprocessor">                           \</span></div>
<div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;<span class="preprocessor">    for (size_t i = 0; i &lt; count; ++i)                              \</span></div>
<div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;<span class="preprocessor">      if (TextureResource* txr = resource_manager_-&gt;GetResource(    \</span></div>
<div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;<span class="preprocessor">              uniform.GetValueAt&lt;type##Ptr&gt;(i).Get(), this))        \</span></div>
<div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;<span class="preprocessor">        ids.push_back(GetLastBoundUnit(txr));                       \</span></div>
<div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;<span class="preprocessor">    gm-&gt;Uniform1iv(location, static_cast&lt;GLsizei&gt;(count), &amp;ids[0]); \</span></div>
<div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;<span class="preprocessor">  } else if (TextureResource* txr = resource_manager_-&gt;GetResource( \</span></div>
<div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;<span class="preprocessor">                 uniform.GetValue&lt;type##Ptr&gt;().Get(), this)) {      \</span></div>
<div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;<span class="preprocessor">    gm-&gt;Uniform1i(location, GetLastBoundUnit(txr));                 \</span></div>
<div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;<span class="preprocessor">  }</span></div>
<div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;  <span class="keywordflow">switch</span> (uniform.GetType()) {</div>
<div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a5eec43d1921c8d1bad9bf03ecacebd22">kIntUniform</a>:</div>
<div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>, 1, Uniform1iv);</div>
<div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a08f89b65739f59e8d7ec80c6ba321108">kFloatUniform</a>:</div>
<div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(<span class="keywordtype">float</span>, <span class="keywordtype">float</span>, 1, Uniform1fv);</div>
<div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a54de8efde6ddd1e64bcef41ca8f9e902">kUnsignedIntUniform</a>:</div>
<div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(uint32, uint32, 1, Uniform1uiv);</div>
<div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a81b379b9dc3585ac8815021f56f90c41">kCubeMapTextureUniform</a>:</div>
<div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;      <a class="code" href="renderer_8cc.html#ab43288f4c6bea37ff32a6d51536cb120">SEND_TEXTURE_UNIFORM</a>(CubeMapTexture);</div>
<div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1fb38ca96a9985f325f838de5757e95d">kTextureUniform</a>:</div>
<div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;      <a class="code" href="renderer_8cc.html#ab43288f4c6bea37ff32a6d51536cb120">SEND_TEXTURE_UNIFORM</a>(Texture);</div>
<div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1be83413a343e7dc56d49bace786fa07">kFloatVector2Uniform</a>:</div>
<div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(math::VectorBase2f, <span class="keywordtype">float</span>, 2, Uniform2fv);</div>
<div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a68f812bcd8299939236e4cf49ed1806d">kFloatVector3Uniform</a>:</div>
<div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(math::VectorBase3f, <span class="keywordtype">float</span>, 3, Uniform3fv);</div>
<div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643ac4e47e833e681048f10c0fbd01932b06">kFloatVector4Uniform</a>:</div>
<div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(math::VectorBase4f, <span class="keywordtype">float</span>, 4, Uniform4fv);</div>
<div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643accab86be40af728bc046aefcd5be3251">kIntVector2Uniform</a>:</div>
<div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(math::VectorBase2i, <span class="keywordtype">int</span>, 2, Uniform2iv);</div>
<div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a6cc63466f4f1bfe9372c50399132a9c8">kIntVector3Uniform</a>:</div>
<div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(math::VectorBase3i, <span class="keywordtype">int</span>, 3, Uniform3iv);</div>
<div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643aac51fc132916cc16df51547ffe5071b7">kIntVector4Uniform</a>:</div>
<div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(math::VectorBase4i, <span class="keywordtype">int</span>, 4, Uniform4iv);</div>
<div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1f639abee657c971cd86c895ac9d52df">kUnsignedIntVector2Uniform</a>:</div>
<div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(math::VectorBase2ui, uint32, 2, Uniform2uiv);</div>
<div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1bd04e896509c052970b6238a1eb972a">kUnsignedIntVector3Uniform</a>:</div>
<div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(math::VectorBase3ui, uint32, 3, Uniform3uiv);</div>
<div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a827f2bfcad70a68aa5435e931fa18286">kUnsignedIntVector4Uniform</a>:</div>
<div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;      <a class="code" href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a>(math::VectorBase4ui, uint32, 4, Uniform4uiv);</div>
<div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a19e35e1961a97c1a02c045a721798df6">kMatrix2x2Uniform</a>:</div>
<div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;      SendMatrixUniform&lt;2&gt;(uniform, gm, location,</div>
<div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;                           &amp;<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#afe34751651cb11e58eeefad22bb65792">GraphicsManager::UniformMatrix2fv</a>);</div>
<div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a91294d85362f36dc0a5fb4a92c66294e">kMatrix3x3Uniform</a>:</div>
<div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;      SendMatrixUniform&lt;3&gt;(uniform, gm, location,</div>
<div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;                           &amp;GraphicsManager::UniformMatrix3fv);</div>
<div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a0525286b6d441457ee2d3cd1f1390f07">kMatrix4x4Uniform</a>: {</div>
<div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;      SendMatrixUniform&lt;4&gt;(uniform, gm, location,</div>
<div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;                           &amp;<a class="code" href="classion_1_1gfx_1_1_graphics_manager.html#a20c08d241ba265eee86df5535a669f1c">GraphicsManager::UniformMatrix4fv</a>);</div>
<div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;    }</div>
<div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;<span class="preprocessor">#if !defined(ION_COVERAGE)  // COV_NF_START</span></div>
<div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;<span class="preprocessor">#endif  // COV_NF_END</span></div>
<div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;<span class="preprocessor">#undef SEND_VECTOR_UNIFORM</span></div>
<div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#undef SEND_TEXTURE_UNIFORM</span></div>
<div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;</div>
<div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceManager::DisassociateElementBufferFromArrays(</div>
<div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;    BufferResource* resource) {</div>
<div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;  ResourceAccessor accessor(resources_[kAttributeArray]);</div>
<div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;  ResourceVector&amp; resources = accessor.GetResources();</div>
<div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> count = resources.size();</div>
<div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;    VertexArrayResource* res =</div>
<div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;        <span class="keyword">reinterpret_cast&lt;</span>VertexArrayResource*<span class="keyword">&gt;</span>(resources[i]);</div>
<div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;    <span class="keywordflow">if</span> (res-&gt;GetElementArrayBinding().resource == resource)</div>
<div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;      res-&gt;SetElementArrayBinding(0, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;  }</div>
<div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;}</div>
<div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;</div>
<div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::PushUniforms(</div>
<div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;    <span class="keyword">const</span> Node* node, <span class="keyword">const</span> base::AllocVector&lt;Uniform&gt;&amp; uniforms) {</div>
<div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_uniforms = uniforms.size();</div>
<div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_uniforms; ++i) {</div>
<div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;    ShaderInputRegistryResource* sirr =</div>
<div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;        resource_manager_-&gt;GetResource(&amp;uniforms[i].GetRegistry(), <span class="keyword">this</span>);</div>
<div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;    sirr-&gt;Update(<span class="keyword">this</span>);</div>
<div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;    sirr-&gt;PushUniform(uniforms[i]);</div>
<div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;  }</div>
<div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;}</div>
<div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;</div>
<div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceBinder::PopUniforms(</div>
<div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;    <span class="keyword">const</span> base::AllocVector&lt;Uniform&gt;&amp; uniforms) {</div>
<div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_uniforms = uniforms.size();</div>
<div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; num_uniforms; ++i) {</div>
<div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;    ShaderInputRegistryResource* sirr =</div>
<div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;        resource_manager_-&gt;GetResource(&amp;uniforms[i].GetRegistry(), <span class="keyword">this</span>);</div>
<div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;    sirr-&gt;PopUniform(uniforms[i]);</div>
<div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;  }</div>
<div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;}</div>
<div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;</div>
<div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;<span class="keyword">typename</span> Renderer::HolderToResource&lt;HolderType&gt;::ResourceType*</div>
<div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;Renderer::ResourceManager::CreateResource(<span class="keyword">const</span> HolderType* holder,</div>
<div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;                                          Renderer::ResourceBinder* binder,</div>
<div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;                                          <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key, GLuint gl_id) {</div>
<div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;  <span class="keyword">typedef</span> <span class="keyword">typename</span> HolderToResource&lt;HolderType&gt;::ResourceType ResourceType;</div>
<div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespaceion_1_1base.html#a43c6663b5bdd5e5839eba0729b613c28">base::AllocatorPtr</a>&amp; allocator =</div>
<div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;      holder-&gt;GetAllocator().Get() ? holder-&gt;GetAllocator()</div>
<div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;                                   : GetAllocatorForLifetime(<a class="code" href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757caf03f24745ec5729b9c4ba500f7ff654d">base::kMediumTerm</a>);</div>
<div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;  ResourceType* new_resource =</div>
<div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;      <span class="keyword">new</span> (allocator) ResourceType(binder, <span class="keyword">this</span>, *holder, key, gl_id);</div>
<div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;  AddResource(new_resource);</div>
<div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;  <span class="keywordflow">return</span> new_resource;</div>
<div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;}</div>
<div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;</div>
<div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> HolderType&gt;</div>
<div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;<span class="keyword">typename</span> Renderer::HolderToResource&lt;HolderType&gt;::ResourceType*</div>
<div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;Renderer::ResourceManager::GetResource(</div>
<div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;    <span class="keyword">const</span> HolderType* holder, Renderer::ResourceBinder* resource_binder,</div>
<div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160;    GLuint gl_id) {</div>
<div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;  <span class="keyword">typedef</span> <span class="keyword">typename</span> HolderToResource&lt;HolderType&gt;::ResourceType ResourceType;</div>
<div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160;</div>
<div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;  <a class="code" href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a>(holder);</div>
<div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;  ResourceType* resource = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;  <span class="keywordflow">if</span> (holder) {</div>
<div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ResourceKey</a> key =</div>
<div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;        GetResourceKey&lt;ResourceType&gt;(resource_binder, holder);</div>
<div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;    <span class="keywordflow">if</span> (Resource* holder_resource =</div>
<div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;            static_cast&lt;Resource*&gt;(holder-&gt;GetResource(resource_index_, key))) {</div>
<div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;      resource = <span class="keyword">static_cast&lt;</span>ResourceType*<span class="keyword">&gt;</span>(holder_resource);</div>
<div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;      resource = CreateResource(holder, resource_binder, key, gl_id);</div>
<div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;      holder-&gt;SetResource(resource_index_, key, resource);</div>
<div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;    }</div>
<div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;  }</div>
<div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;  <span class="keywordflow">return</span> resource;</div>
<div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;}</div>
<div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;</div>
<div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceManager::FillDataFromRenderer(GLuint <span class="keywordtype">id</span>,</div>
<div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;                                                     PlatformInfo* info) {}</div>
<div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;</div>
<div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceManager::FillDataFromRenderer(GLuint <span class="keywordtype">id</span>,</div>
<div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;                                                     TextureImageInfo* info) {</div>
<div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;  ResourceAccessor accessor(resources_[kTexture]);</div>
<div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;  ResourceVector&amp; resources = accessor.GetResources();</div>
<div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">size_t</span> count = resources.size()) {</div>
<div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;      TextureResource* tr = <span class="keyword">reinterpret_cast&lt;</span>TextureResource*<span class="keyword">&gt;</span>(resources[i]);</div>
<div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;      <span class="keywordflow">if</span> (static_cast&lt;GLuint&gt;(tr-&gt;GetId()) == <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;        info-&gt;texture.Reset(</div>
<div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;            const_cast&lt;TextureBase*&gt;(&amp;tr-&gt;GetTexture&lt;TextureBase&gt;()));</div>
<div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;        <span class="keywordflow">if</span> (info-&gt;texture-&gt;GetTextureType() == <a class="code" href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641a12fb9394b1d08b479b17543a57756cce">TextureBase::kCubeMapTexture</a>) {</div>
<div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;          <span class="keyword">const</span> CubeMapTexture&amp; tex = tr-&gt;GetTexture&lt;CubeMapTexture&gt;();</div>
<div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> f = 0; f &lt; 6; ++f) {</div>
<div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;            info-&gt;images.push_back(GetCubeMapTextureImageOrMipmap(</div>
<div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;                tex, static_cast&lt;CubeMapTexture::CubeFace&gt;(f)));</div>
<div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;          }</div>
<div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;          <span class="keyword">const</span> Texture&amp; tex = tr-&gt;GetTexture&lt;Texture&gt;();</div>
<div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;          info-&gt;images.push_back(GetTextureImageOrMipmap(tex));</div>
<div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;        }</div>
<div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;      }</div>
<div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;    }</div>
<div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;  }</div>
<div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;}</div>
<div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;</div>
<div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceManager::FillInfoFromResource(</div>
<div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;    ArrayInfo* info, VertexArrayResource* resource, ResourceBinder* rb) {</div>
<div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;  info-&gt;vertex_count = resource-&gt;GetVertexCount();</div>
<div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;}</div>
<div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;</div>
<div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceManager::FillInfoFromResource(BufferInfo* info,</div>
<div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;                                                     BufferResource* resource,</div>
<div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;                                                     ResourceBinder* rb) {</div>
<div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;  info-&gt;target = resource-&gt;GetGlTarget();</div>
<div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;}</div>
<div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;</div>
<div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceManager::FillInfoFromResource(</div>
<div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;    FramebufferInfo* info, FramebufferResource* resource, ResourceBinder* rb) {</div>
<div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;  info-&gt;color0_renderbuffer.id = resource-&gt;GetColor0Id();</div>
<div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;  info-&gt;depth_renderbuffer.id = resource-&gt;GetDepthId();</div>
<div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;  info-&gt;stencil_renderbuffer.id = resource-&gt;GetStencilId();</div>
<div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;}</div>
<div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;</div>
<div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceManager::FillInfoFromResource(</div>
<div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;    ProgramInfo* info, ShaderProgramResource* resource, ResourceBinder* rb) {</div>
<div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;  <span class="keywordflow">if</span> (ShaderResource* shader = resource-&gt;GetVertexResource())</div>
<div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;    info-&gt;vertex_shader = shader-&gt;GetId();</div>
<div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;  <span class="keywordflow">if</span> (ShaderResource* shader = resource-&gt;GetFragmentResource())</div>
<div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;    info-&gt;fragment_shader = shader-&gt;GetId();</div>
<div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;}</div>
<div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;</div>
<div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;<span class="keywordtype">void</span> Renderer::ResourceManager::FillInfoFromResource(</div>
<div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;    TextureInfo* info, TextureResource* resource, ResourceBinder* rb) {</div>
<div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;  info-&gt;unit = GL_TEXTURE0 + rb-&gt;GetLastBoundUnit(resource);</div>
<div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;  info-&gt;target = resource-&gt;GetGlTarget();</div>
<div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;  <span class="keyword">const</span> <a class="code" href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641">Texture::TextureType</a> type =</div>
<div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;      resource-&gt;GetTexture&lt;TextureBase&gt;().GetTextureType();</div>
<div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;  info-&gt;width = info-&gt;height = 0U;</div>
<div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;  info-&gt;format = base::InvalidEnumValue&lt;Image::Format&gt;();</div>
<div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;  Image* image = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;  <span class="keywordflow">if</span> (type == <a class="code" href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641af1bcdfd8248162a189e68a21d4725a2b">TextureBase::kTexture</a>) {</div>
<div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;    <span class="keyword">const</span> Texture&amp; tex = resource-&gt;GetTexture&lt;Texture&gt;();</div>
<div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;    <span class="keywordflow">if</span> (tex.HasImage(0U))</div>
<div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;      image = tex.GetImage(0U).Get();</div>
<div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;  } <span class="keywordflow">else</span> {  <span class="comment">// kCubeMapTexture.</span></div>
<div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;    <span class="keyword">const</span> CubeMapTexture&amp; tex = resource-&gt;GetTexture&lt;CubeMapTexture&gt;();</div>
<div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;    <span class="keywordflow">if</span> (tex.HasImage(<a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90ca241349e2e204554569f4b98a25cb876c">CubeMapTexture::kNegativeX</a>, 0))</div>
<div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;      image = tex.GetImage(<a class="code" href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90ca241349e2e204554569f4b98a25cb876c">CubeMapTexture::kNegativeX</a>, 0).Get();</div>
<div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;  }</div>
<div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;  <span class="keywordflow">if</span> (image) {</div>
<div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;    info-&gt;format = image-&gt;GetFormat();</div>
<div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;    info-&gt;width = image-&gt;GetWidth();</div>
<div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;    info-&gt;height = image-&gt;GetHeight();</div>
<div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;  }</div>
<div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;}</div>
<div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;</div>
<div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;<span class="keyword">template</span> Renderer::BufferResource* Renderer::ResourceManager::GetResource(</div>
<div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;    <span class="keyword">const</span> BufferObject*, Renderer::ResourceBinder*, GLuint);</div>
<div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;<span class="keyword">template</span> Renderer::TextureResource* Renderer::ResourceManager::GetResource(</div>
<div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;    <span class="keyword">const</span> CubeMapTexture*, Renderer::ResourceBinder*, GLuint);</div>
<div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;<span class="keyword">template</span> Renderer::FramebufferResource* Renderer::ResourceManager::GetResource(</div>
<div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;    <span class="keyword">const</span> FramebufferObject*, Renderer::ResourceBinder*, GLuint);</div>
<div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;<span class="keyword">template</span> Renderer::SamplerResource* Renderer::ResourceManager::GetResource(</div>
<div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;    <span class="keyword">const</span> Sampler*, Renderer::ResourceBinder*, GLuint);</div>
<div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;<span class="keyword">template</span> Renderer::ShaderResource* Renderer::ResourceManager::GetResource(</div>
<div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160;    <span class="keyword">const</span> Shader*, Renderer::ResourceBinder*, GLuint);</div>
<div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;<span class="keyword">template</span> Renderer::ShaderProgramResource*</div>
<div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;Renderer::ResourceManager::GetResource(<span class="keyword">const</span> ShaderProgram*,</div>
<div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;                                       Renderer::ResourceBinder*, GLuint);</div>
<div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;<span class="keyword">template</span> Renderer::TextureResource* Renderer::ResourceManager::GetResource(</div>
<div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160;    <span class="keyword">const</span> Texture*, Renderer::ResourceBinder*, GLuint);</div>
<div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;<span class="keyword">template</span> Renderer::VertexArrayResource* Renderer::ResourceManager::GetResource(</div>
<div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;    <span class="keyword">const</span> AttributeArray*, Renderer::ResourceBinder*, GLuint);</div>
<div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;</div>
<div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;}  <span class="comment">// namespace gfx</span></div>
<div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;}  <span class="comment">// namespace ion</span></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html">ion::gfx::GraphicsManager</a></div><div class="ttdoc">GraphicsManager manages the graphics library for an application. </div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00054">graphicsmanager.h:54</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_a62eaa5f45ca6b9f446ca128679860ead"><div class="ttname"><a href="namespaceion_1_1base.html#a62eaa5f45ca6b9f446ca128679860ead">ion::base::IsInvalidReference</a></div><div class="ttdeci">bool IsInvalidReference(const T &amp;value)</div><div class="ttdoc">IsInvalidReference() returns true if a passed const reference of type T has an address of InvalidRefe...</div><div class="ttdef"><b>Definition:</b> <a href="invalid_8h_source.html#l00041">invalid.h:41</a></div></div>
<div class="ttc" id="calltracemanager_8cc_html_ab3d71a3630661054e58116e2249c2e9e"><div class="ttname"><a href="calltracemanager_8cc.html#ab3d71a3630661054e58116e2249c2e9e">buffer</a></div><div class="ttdeci">std::string buffer</div><div class="ttdef"><b>Definition:</b> <a href="calltracemanager_8cc_source.html#l00211">calltracemanager.cc:211</a></div></div>
<div class="ttc" id="glheaders_8h_html_ad23474d5b9f69e723740279f19668a0b"><div class="ttname"><a href="glheaders_8h.html#ad23474d5b9f69e723740279f19668a0b">GL_PROGRAM_OBJECT</a></div><div class="ttdeci">#define GL_PROGRAM_OBJECT</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00624">glheaders.h:624</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a0f79fd68a46a70be60799714f1213365"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a0f79fd68a46a70be60799714f1213365">ion::gfx::Renderer::GetStateTable</a></div><div class="ttdeci">const StateTable &amp; GetStateTable() const </div><div class="ttdoc">Returns the StateTable that the Renderer believes to represent the current state of OpenGL...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05473">renderer.cc:5473</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ae983af9af643383c283e33038773fd48af218895b0ea64fb55e541c7a266d3b89"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48af218895b0ea64fb55e541c7a266d3b89">ion::gfx::Renderer::kBufferObject</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00103">renderer.h:103</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_a5fca7f9340dcefae18f258053de7757ca0e572cccc7b2f48ced01134b3acc3396"><div class="ttname"><a href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757ca0e572cccc7b2f48ced01134b3acc3396">ion::base::kShortTerm</a></div><div class="ttdoc">kShortTerm is used for objects that are very transient in nature, such as scratch memory used to comp...</div><div class="ttdef"><b>Definition:</b> <a href="allocator_8h_source.html#l00036">allocator.h:36</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ac13a3bd2eb6fb1854ff2b1550c40dc54"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ac13a3bd2eb6fb1854ff2b1550c40dc54">ion::gfx::Renderer::DrawScene</a></div><div class="ttdeci">virtual void DrawScene(const NodePtr &amp;node)</div><div class="ttdoc">Draws the scene rooted by the given node into the currently bound framebuffer. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05181">renderer.cc:5181</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572a7024a09f1ab72f45c9eb7039dce1dd15"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a7024a09f1ab72f45c9eb7039dce1dd15">ion::gfx::GraphicsManager::kMultisampleFramebufferResolve</a></div><div class="ttdoc">This is used for Apple devices running pre-es-3.0 device with the APPLE_framebuffer_multisample exten...</div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00136">graphicsmanager.h:136</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_allocator_html_a182a6de600883f0ad16ff31a537d8571"><div class="ttname"><a href="classion_1_1base_1_1_allocator.html#a182a6de600883f0ad16ff31a537d8571">ion::base::Allocator::GetTracker</a></div><div class="ttdeci">const AllocationTrackerPtr &amp; GetTracker() const </div><div class="ttdef"><b>Definition:</b> <a href="allocator_8h_source.html#l00082">allocator.h:82</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_aa4149d792923c0c5545b506339375ab3a1dbd7e254864bd8b42489c350b971fc3"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3a1dbd7e254864bd8b42489c350b971fc3">ion::gfx::TextureBase::kSwizzleAlphaChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00074">texture.h:74</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_enum_helper_html_add4cef50ed0082704f9bf082a004f6ef"><div class="ttname"><a href="classion_1_1base_1_1_enum_helper.html#add4cef50ed0082704f9bf082a004f6ef">ion::base::EnumHelper::GetConstant</a></div><div class="ttdeci">static uint32 GetConstant(EnumType e)</div><div class="ttdoc">Returns the constant value corresponding to an enum. </div><div class="ttdef"><b>Definition:</b> <a href="enumhelper_8h_source.html#l00080">enumhelper.h:80</a></div></div>
<div class="ttc" id="namespaceion_1_1math_html_ac94084c89a7a56ce378c40a8bebd7c53"><div class="ttname"><a href="namespaceion_1_1math.html#ac94084c89a7a56ce378c40a8bebd7c53">ion::math::Matrix4f</a></div><div class="ttdeci">Matrix&lt; 4, float &gt; Matrix4f</div><div class="ttdef"><b>Definition:</b> <a href="matrix_8h_source.html#l00371">matrix.h:371</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a07b06fd55473ad00ef896315ae2f6c46"><div class="ttname"><a href="namespaceion_1_1gfx.html#a07b06fd55473ad00ef896315ae2f6c46">ion::gfx::NodePtr</a></div><div class="ttdeci">base::ReferentPtr&lt; Node &gt;::Type NodePtr</div><div class="ttdef"><b>Definition:</b> <a href="node_8h_source.html#l00033">node.h:33</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_html_a56ef347565e68fec664f3b2d86fffd8fa7727a96a81578545ce60bb32b0b18269"><div class="ttname"><a href="classion_1_1gfx_1_1_texture.html#a56ef347565e68fec664f3b2d86fffd8fa7727a96a81578545ce60bb32b0b18269">ion::gfx::Texture::kSubImageChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00268">texture.h:268</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a4394f60096b9d80558dd2cf5c32433bb"><div class="ttname"><a href="namespaceion_1_1gfx.html#a4394f60096b9d80558dd2cf5c32433bb">ion::gfx::FramebufferObjectPtr</a></div><div class="ttdeci">base::ReferentPtr&lt; FramebufferObject &gt;::Type FramebufferObjectPtr</div><div class="ttdoc">Convenience typedef for shared pointer to a FramebufferObject. </div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00209">framebufferobject.h:209</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_a4380253b3f1f3f78c5739858f2d85641"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641">ion::gfx::TextureBase::TextureType</a></div><div class="ttdeci">TextureType</div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00085">texture.h:85</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_aa6d4e016481ce0d624a98789018f8c49"><div class="ttname"><a href="namespaceion_1_1gfx.html#aa6d4e016481ce0d624a98789018f8c49">ion::gfx::ClearFromStateTable</a></div><div class="ttdeci">void ClearFromStateTable(const StateTable &amp;new_state, StateTable *save_state, GraphicsManager *gm)</div><div class="ttdoc">This internal function can be used to update the Clear()-related OpenGL state (dithering, scissor test, write masks, scissor box, and clear values) managed by a GraphicsManager to match a StateTable, and updates save_state to contain the new state. </div><div class="ttdef"><b>Definition:</b> <a href="updatestatetable_8cc_source.html#l00714">updatestatetable.cc:714</a></div></div>
<div class="ttc" id="renderer_8cc_html_ab43288f4c6bea37ff32a6d51536cb120"><div class="ttname"><a href="renderer_8cc.html#ab43288f4c6bea37ff32a6d51536cb120">SEND_TEXTURE_UNIFORM</a></div><div class="ttdeci">#define SEND_TEXTURE_UNIFORM(type)</div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_html"><div class="ttname"><a href="classion_1_1gfx_1_1_texture.html">ion::gfx::Texture</a></div><div class="ttdoc">A Texture object represents the image data and mipmaps associated with a single texture. </div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00264">texture.h:264</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ae983af9af643383c283e33038773fd48a85ad8164455e6994e3304e287c9df6bc"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a85ad8164455e6994e3304e287c9df6bc">ion::gfx::Renderer::kShaderInputRegistry</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00106">renderer.h:106</a></div></div>
<div class="ttc" id="rangeutils_8h_html"><div class="ttname"><a href="rangeutils_8h.html">rangeutils.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_a20c08d241ba265eee86df5535a669f1c"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#a20c08d241ba265eee86df5535a669f1c">ion::gfx::GraphicsManager::UniformMatrix4fv</a></div><div class="ttdeci">framebuffer alpha dfactor const GLvoid usage alpha const GLvoid data border const GLuint buffers const GLuint renderbuffers count renderbuffer GLuint framebuffers GLsizei GLint GLenum GLchar name GLsizei GLuint shaders GLint data GLsizei GLchar info_log GLint params GLint GLint precision GLint params GLint params GLint params GLfloat params GLvoid pointer height height const GLchar const GLint length mask dppass param param const GLvoid data const GLint1 value const GLfloat2 value v2 v2 v3 v3 const GLmatrix2 value UniformMatrix4fv</div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00444">graphicsmanager.h:444</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_a2215e7db780801d0c47f9b4b2713db9e"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9e">ion::gfx::Image::Format</a></div><div class="ttdeci">Format</div><div class="ttdoc">Supported image formats. </div><div class="ttdef"><b>Definition:</b> <a href="image_8h_source.html#l00038">image.h:38</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04ac6cc1e8e361a70a5db1de8c30a3b3b4b"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ac6cc1e8e361a70a5db1de8c30a3b3b4b">ion::gfx::Renderer::kClearElementArrayBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00068">renderer.h:68</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04ade24445f53b286877a58b538b4d7bb24"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ade24445f53b286877a58b538b4d7bb24">ion::gfx::Renderer::kClearCubemaps</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00067">renderer.h:67</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_a4380253b3f1f3f78c5739858f2d85641a12fb9394b1d08b479b17543a57756cce"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641a12fb9394b1d08b479b17543a57756cce">ion::gfx::TextureBase::kCubeMapTexture</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00086">texture.h:86</a></div></div>
<div class="ttc" id="staticsafedeclare_8h_html_aa0c4d1e0fc76f7ea923240084c166b4c"><div class="ttname"><a href="staticsafedeclare_8h.html#aa0c4d1e0fc76f7ea923240084c166b4c">ION_DECLARE_SAFE_STATIC_POINTER</a></div><div class="ttdeci">#define ION_DECLARE_SAFE_STATIC_POINTER(type, variable)</div><div class="ttdoc">Declare a static non-array pointer and calls a default constructor. </div><div class="ttdef"><b>Definition:</b> <a href="staticsafedeclare_8h_source.html#l00111">staticsafedeclare.h:111</a></div></div>
<div class="ttc" id="tracinghandler_8cc_html_acf4d33ee4cff36f69b924471174dcb11"><div class="ttname"><a href="tracinghandler_8cc.html#acf4d33ee4cff36f69b924471174dcb11">level</a></div><div class="ttdeci">int level</div><div class="ttdef"><b>Definition:</b> <a href="tracinghandler_8cc_source.html#l00071">tracinghandler.cc:71</a></div></div>
<div class="ttc" id="namespaceion_1_1math_html_ad64502bbc12e4cb9a825c303c2567043"><div class="ttname"><a href="namespaceion_1_1math.html#ad64502bbc12e4cb9a825c303c2567043">ion::math::Log2</a></div><div class="ttdeci">T Log2(T n)</div><div class="ttdoc">Returns the base-2 logarithm of n. </div><div class="ttdef"><b>Definition:</b> <a href="utils_8h_source.html#l00148">utils.h:148</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a66ea175f8ffb788a442c1e745117d525"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a66ea175f8ffb788a442c1e745117d525">ion::gfx::Sampler::CompareMode</a></div><div class="ttdeci">CompareMode</div><div class="ttdoc">Texture comparison modes for depth textures. </div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00060">sampler.h:60</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a955ebbdc8a1b60161e621708351cc33aa6d547faf33e0aa241660002fb4c66215"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aa6d547faf33e0aa241660002fb4c66215">ion::gfx::Sampler::kMagFilterChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00036">sampler.h:36</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04abc5ff2f816decc196291f40bdefccdb6"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04abc5ff2f816decc196291f40bdefccdb6">ion::gfx::Renderer::kRestoreStateTable</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00083">renderer.h:83</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_a67f4d8fadb4e5118436683371d4f4fd5a3afa465d455ff97efe617f46a648940b"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a3afa465d455ff97efe617f46a648940b">ion::gfx::Image::k2d</a></div><div class="ttdef"><b>Definition:</b> <a href="image_8h_source.html#l00187">image.h:187</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a955ebbdc8a1b60161e621708351cc33aada2a9ef47f612b9e93cbf314e3f50972"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aada2a9ef47f612b9e93cbf314e3f50972">ion::gfx::Sampler::kWrapSChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00042">sampler.h:42</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_cube_map_texture_html_a6bfcdda0af2e9457d95a6fa3b2a1f90ca241349e2e204554569f4b98a25cb876c"><div class="ttname"><a href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90ca241349e2e204554569f4b98a25cb876c">ion::gfx::CubeMapTexture::kNegativeX</a></div><div class="ttdef"><b>Definition:</b> <a href="cubemaptexture_8h_source.html#l00050">cubemaptexture.h:50</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_holder_html_a1a5d4cc7445a7a36218519bbce5b488ea8cdf432d687b44c1099911986875a928"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488ea8cdf432d687b44c1099911986875a928">ion::gfx::ResourceHolder::kResourceChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="resourceholder_8h_source.html#l00058">resourceholder.h:58</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_ad2a5bbee7fd2c231589f603bfa5e1c2fa65531a6320eed60063cfa290d49babe7"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa65531a6320eed60063cfa290d49babe7">ion::gfx::Image::kDense</a></div><div class="ttdef"><b>Definition:</b> <a href="image_8h_source.html#l00179">image.h:179</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04">ion::gfx::Renderer::Flag</a></div><div class="ttdeci">Flag</div><div class="ttdoc">The below flags determine what operations will be performed in a call to DrawScene(). </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00054">renderer.h:54</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_alloc_unordered_map_html"><div class="ttname"><a href="classion_1_1base_1_1_alloc_unordered_map.html">ion::base::AllocUnorderedMap</a></div><div class="ttdoc">This class can be used in place of std::unordered_map to allow an Ion Allocator to be used for memory...</div><div class="ttdef"><b>Definition:</b> <a href="allocunorderedmap_8h_source.html#l00053">allocunorderedmap.h:53</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a2a99afbe15c085c3377c847faed47fa6"><div class="ttname"><a href="namespaceion_1_1gfx.html#a2a99afbe15c085c3377c847faed47fa6">ion::gfx::ImagePtr</a></div><div class="ttdeci">base::ReferentPtr&lt; Image &gt;::Type ImagePtr</div><div class="ttdef"><b>Definition:</b> <a href="image_8h_source.html#l00029">image.h:29</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04ade89d15e01bb88183983f50dcb40d077"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ade89d15e01bb88183983f50dcb40d077">ion::gfx::Renderer::kSaveArrayBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00090">renderer.h:90</a></div></div>
<div class="ttc" id="staticsafedeclare_8h_html_a09452e33f7fe6f55ae0bc4ca75152dac"><div class="ttname"><a href="staticsafedeclare_8h.html#a09452e33f7fe6f55ae0bc4ca75152dac">ION_DECLARE_SAFE_STATIC_POINTER_WITH_CONSTRUCTOR</a></div><div class="ttdeci">#define ION_DECLARE_SAFE_STATIC_POINTER_WITH_CONSTRUCTOR(type, variable, constructor)</div><div class="ttdoc">Declare a static non-array pointer and calls a non-default constructor. </div><div class="ttdef"><b>Definition:</b> <a href="staticsafedeclare_8h_source.html#l00122">staticsafedeclare.h:122</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_manager_html_ad9c0dafbfca720ab47ef9748c5452972"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_manager.html#ad9c0dafbfca720ab47ef9748c5452972">ion::gfx::ResourceManager::ResourceManager</a></div><div class="ttdeci">ResourceManager(const GraphicsManagerPtr &amp;gm)</div><div class="ttdoc">A valid GraphicsManagerPtr must be passed to the constructor. </div><div class="ttdef"><b>Definition:</b> <a href="resourcemanager_8cc_source.html#l00769">resourcemanager.cc:769</a></div></div>
<div class="ttc" id="framebufferobject_8h_html"><div class="ttname"><a href="framebufferobject_8h.html">framebufferobject.h</a></div></div>
<div class="ttc" id="printer_8cc_html_a75b160f574a0be26114bae2c7686a5e1"><div class="ttname"><a href="printer_8cc.html#a75b160f574a0be26114bae2c7686a5e1">type</a></div><div class="ttdeci">std::string type</div><div class="ttdef"><b>Definition:</b> <a href="printer_8cc_source.html#l00353">printer.cc:353</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_aa4149d792923c0c5545b506339375ab3ad84f5f896ca7c5b1022457e6033924cf"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3ad84f5f896ca7c5b1022457e6033924cf">ion::gfx::TextureBase::kContentsImplicitlyChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00066">texture.h:66</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_cube_map_texture_html_a3bc28b6f02de422506a28cf596b9cd02a3783fe228dcc998fb5869a27c1988eab"><div class="ttname"><a href="classion_1_1gfx_1_1_cube_map_texture.html#a3bc28b6f02de422506a28cf596b9cd02a3783fe228dcc998fb5869a27c1988eab">ion::gfx::CubeMapTexture::kNumChanges</a></div><div class="ttdef"><b>Definition:</b> <a href="cubemaptexture_8h_source.html#l00045">cubemaptexture.h:45</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_1_1_attachment_html_a42cb01d8ac2a84821225bfb2fee47469"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object_1_1_attachment.html#a42cb01d8ac2a84821225bfb2fee47469">ion::gfx::FramebufferObject::Attachment::GetCubeMapTexture</a></div><div class="ttdeci">const CubeMapTexturePtr &amp; GetCubeMapTexture() const </div><div class="ttdoc">Gets the cubemap of the attachment, if any. </div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00118">framebufferobject.h:118</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_aa4149d792923c0c5545b506339375ab3ac6e62a27783d2827c6536406617fc4c9"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3ac6e62a27783d2827c6536406617fc4c9">ion::gfx::TextureBase::kImmutableImageChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00067">texture.h:67</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ae983af9af643383c283e33038773fd48a2fc332037c1a96c6a14cf89e02c447b5"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a2fc332037c1a96c6a14cf89e02c447b5">ion::gfx::Renderer::kSampler</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00105">renderer.h:105</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_aa4149d792923c0c5545b506339375ab3aa49f1bea3bea576290c86469ac5c4cef"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3aa49f1bea3bea576290c86469ac5c4cef">ion::gfx::TextureBase::kSwizzleRedChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00071">texture.h:71</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_ab2c3e3e952284ecabd82c1e941c93f28"><div class="ttname"><a href="namespaceion_1_1base.html#ab2c3e3e952284ecabd82c1e941c93f28">ion::base::AllocationSizeTrackerPtr</a></div><div class="ttdeci">SharedPtr&lt; AllocationSizeTracker &gt; AllocationSizeTrackerPtr</div><div class="ttdoc">Convenience typedef for shared pointer to a AllocationSizeTracker. </div><div class="ttdef"><b>Definition:</b> <a href="allocationsizetracker_8h_source.html#l00042">allocationsizetracker.h:42</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_af20512ea9ca4ca9eaca3411f59bffe61aa0d790c20a0a9c6227b562b26ba37853"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#af20512ea9ca4ca9eaca3411f59bffe61aa0d790c20a0a9c6227b562b26ba37853">ion::gfx::GraphicsManager::kCoreProfile</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00172">graphicsmanager.h:172</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_input_html_a1ffe1d1593ef0ac8c0e9b7efa0cc73b6"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_input.html#a1ffe1d1593ef0ac8c0e9b7efa0cc73b6">ion::gfx::ShaderInput&lt; UniformValueType, UniformType &gt;::ValueType</a></div><div class="ttdeci">UniformType ValueType</div><div class="ttdef"><b>Definition:</b> <a href="shaderinput_8h_source.html#l00053">shaderinput.h:53</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a99a031ce6f76f20c980b33ae5f6c1955"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a99a031ce6f76f20c980b33ae5f6c1955">ion::gfx::Renderer::kRestoreFramebuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00081">renderer.h:81</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a1be83413a343e7dc56d49bace786fa07"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1be83413a343e7dc56d49bace786fa07">ion::gfx::kFloatVector2Uniform</a></div><div class="ttdoc">Vector types. </div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00048">uniform.h:48</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a1f4e6b4b4bd00e5536203e46bffe9521a41e32311e2fcf193026c56555079f9ca"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521a41e32311e2fcf193026c56555079f9ca">ion::gfx::BufferObject::kCopyWriteBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00097">bufferobject.h:97</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572a3bf4859e11913a8f2731e285e9a40307"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a3bf4859e11913a8f2731e285e9a40307">ion::gfx::GraphicsManager::kFramebufferBlit</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00130">graphicsmanager.h:130</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a5ea05e2485675977e0cae4041a0e6296"><div class="ttname"><a href="namespaceion_1_1gfx.html#a5ea05e2485675977e0cae4041a0e6296">ion::gfx::ShapePtr</a></div><div class="ttdeci">base::ReferentPtr&lt; Shape &gt;::Type ShapePtr</div><div class="ttdoc">Convenience typedef for shared pointer to a Shape. </div><div class="ttdef"><b>Definition:</b> <a href="shape_8h_source.html#l00167">shape.h:167</a></div></div>
<div class="ttc" id="allocunorderedset_8h_html"><div class="ttname"><a href="allocunorderedset_8h.html">allocunorderedset.h</a></div></div>
<div class="ttc" id="classion_1_1portgfx_1_1_visual_html_a049883136a6bbb2149eb3a3541f87199"><div class="ttname"><a href="classion_1_1portgfx_1_1_visual.html#a049883136a6bbb2149eb3a3541f87199">ion::portgfx::Visual::GetCurrentId</a></div><div class="ttdeci">static size_t GetCurrentId()</div><div class="ttdoc">Returns a unique ID for the currently bound Visual. </div><div class="ttdef"><b>Definition:</b> <a href="visual_8cc_source.html#l00313">visual.cc:313</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a6c1236c56d99c202b404c5f6166c85adae77299693d4d746b487bfa830ba4909d"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a6c1236c56d99c202b404c5f6166c85adae77299693d4d746b487bfa830ba4909d">ion::gfx::BufferObject::kFloatMatrixColumn3</a></div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00089">bufferobject.h:89</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_index_buffer_html"><div class="ttname"><a href="classion_1_1gfx_1_1_index_buffer.html">ion::gfx::IndexBuffer</a></div><div class="ttdoc">An IndexBuffer is a type of BufferObject that contains the element indices of an array, e.g., a vertex index array. </div><div class="ttdef"><b>Definition:</b> <a href="indexbuffer_8h_source.html#l00028">indexbuffer.h:28</a></div></div>
<div class="ttc" id="glheaders_8h_html_a40a697d91ac01487b948b83fab98d15a"><div class="ttname"><a href="glheaders_8h.html#a40a697d91ac01487b948b83fab98d15a">GL_LUMINANCE_ALPHA</a></div><div class="ttdeci">#define GL_LUMINANCE_ALPHA</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00468">glheaders.h:468</a></div></div>
<div class="ttc" id="namespaceion_1_1math_html_a55c6c70c3e325850f7118620bcc879a2"><div class="ttname"><a href="namespaceion_1_1math.html#a55c6c70c3e325850f7118620bcc879a2">ion::math::Range1i</a></div><div class="ttdeci">Range&lt; 1, int32 &gt; Range1i</div><div class="ttdef"><b>Definition:</b> <a href="range_8h_source.html#l00363">range.h:363</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a1f4e6b4b4bd00e5536203e46bffe9521aadb6589be4886447f64f949106500e76"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521aadb6589be4886447f64f949106500e76">ion::gfx::BufferObject::kCopyReadBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00096">bufferobject.h:96</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a955ebbdc8a1b60161e621708351cc33aa4d39a2a9567057640c0d0054285e4981"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aa4d39a2a9567057640c0d0054285e4981">ion::gfx::Sampler::kMaxLodChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00038">sampler.h:38</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04aa5938f9a83e1d9719d363b94533ef9d3"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04aa5938f9a83e1d9719d363b94533ef9d3">ion::gfx::Renderer::kProcessInfoRequests</a></div><div class="ttdoc">Process any outstanding requests for information about internal resources that have been made through...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00057">renderer.h:57</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_program_html"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_program.html">ion::gfx::ShaderProgram</a></div><div class="ttdoc">A ShaderProgram represents an OpenGL shader program that can be applied to shapes. </div><div class="ttdef"><b>Definition:</b> <a href="shaderprogram_8h_source.html#l00038">shaderprogram.h:38</a></div></div>
<div class="ttc" id="classion_1_1portgfx_1_1_visual_html_ac1f305aa9364f12a7396ea28dbd3ec45"><div class="ttname"><a href="classion_1_1portgfx_1_1_visual.html#ac1f305aa9364f12a7396ea28dbd3ec45">ion::portgfx::Visual::GetCurrent</a></div><div class="ttdeci">static const Visual * GetCurrent()</div><div class="ttdoc">Returns the Visual that is current for the calling thread. </div><div class="ttdef"><b>Definition:</b> <a href="visual_8cc_source.html#l00213">visual.cc:213</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ae983af9af643383c283e33038773fd48"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48">ion::gfx::Renderer::ResourceType</a></div><div class="ttdeci">ResourceType</div><div class="ttdoc">The types of resources created by the renderer. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00101">renderer.h:101</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_a4608f8e50b0898594bbef71d8a9a4ac5"><div class="ttname"><a href="namespaceion_1_1base.html#a4608f8e50b0898594bbef71d8a9a4ac5">ion::base::kInvalidIndex</a></div><div class="ttdeci">const size_t kInvalidIndex</div><div class="ttdoc">kInvalidIndex is a size_t value that is very unlikely to be a valid index. </div><div class="ttdef"><b>Definition:</b> <a href="invalid_8cc_source.html#l00023">invalid.cc:23</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a4764fdcb75dbfe4f3521cd85fd55ff38"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a4764fdcb75dbfe4f3521cd85fd55ff38">ion::gfx::Renderer::ClearAllResources</a></div><div class="ttdeci">void ClearAllResources()</div><div class="ttdoc">Immediately clears all internal resources of the Renderer. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05608">renderer.cc:5608</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a4954d3e28d7f7988556bf16dd97ac4bf"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a4954d3e28d7f7988556bf16dd97ac4bf">ion::gfx::Renderer::DestroyCurrentStateCache</a></div><div class="ttdeci">static void DestroyCurrentStateCache()</div><div class="ttdoc">Destroys the internal state cache associated with the current Visual or GL context. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04790">renderer.cc:4790</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a955ebbdc8a1b60161e621708351cc33aae21b0caacd2741a67912b48db5409b6d"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aae21b0caacd2741a67912b48db5409b6d">ion::gfx::Sampler::kMinFilterChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00039">sampler.h:39</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_ad2a5bbee7fd2c231589f603bfa5e1c2fa77863e88e84916287a7d296f364d74b2"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa77863e88e84916287a7d296f364d74b2">ion::gfx::Image::kArray</a></div><div class="ttdef"><b>Definition:</b> <a href="image_8h_source.html#l00178">image.h:178</a></div></div>
<div class="ttc" id="base_2logging_8h_html_a3b7d10ddea0bbcbabddb9a5d3625ecb9"><div class="ttname"><a href="base_2logging_8h.html#a3b7d10ddea0bbcbabddb9a5d3625ecb9">DCHECK</a></div><div class="ttdeci">#define DCHECK(expr)</div><div class="ttdef"><b>Definition:</b> <a href="base_2logging_8h_source.html#l00331">logging.h:331</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_aa3d42b89a77ac34d6dff5e676032778b"><div class="ttname"><a href="namespaceion_1_1base.html#aa3d42b89a77ac34d6dff5e676032778b">ion::base::LockGuard</a></div><div class="ttdeci">GenericLockGuard&lt; port::Mutex &gt; LockGuard</div><div class="ttdoc">Convenient typedefs for ion::port::Mutex. </div><div class="ttdef"><b>Definition:</b> <a href="lockguards_8h_source.html#l00192">lockguards.h:192</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_html_a129bb303640f34e71c22e8564c7d7fcba640ae637f48f3cf45e3e7e00372491c5"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object.html#a129bb303640f34e71c22e8564c7d7fcba640ae637f48f3cf45e3e7e00372491c5">ion::gfx::FramebufferObject::kColorAttachmentChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00058">framebufferobject.h:58</a></div></div>
<div class="ttc" id="benchmarkutils_8cc_html_aee90379adb0307effb138f4871edbc5c"><div class="ttname"><a href="benchmarkutils_8cc.html#aee90379adb0307effb138f4871edbc5c">value</a></div><div class="ttdeci">double value</div><div class="ttdef"><b>Definition:</b> <a href="benchmarkutils_8cc_source.html#l00063">benchmarkutils.cc:63</a></div></div>
<div class="ttc" id="renderer_8cc_html_a1b006715a4794326e4adb1681e78f1e1"><div class="ttname"><a href="renderer_8cc.html#a1b006715a4794326e4adb1681e78f1e1">SEND_VECTOR_UNIFORM</a></div><div class="ttdeci">#define SEND_VECTOR_UNIFORM(type, elem_type, num_elements, setter)</div></div>
<div class="ttc" id="bufferobject_8h_html"><div class="ttname"><a href="bufferobject_8h.html">bufferobject.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab61f4bba7cbdf899a630cb940b8c57ef"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab61f4bba7cbdf899a630cb940b8c57ef">ion::gfx::Renderer::ProcessStateTable</a></div><div class="ttdeci">void ProcessStateTable(const StateTablePtr &amp;state_table)</div><div class="ttdoc">Immediately updates OpenGL state with the settings in the passed StateTable. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04925">renderer.cc:4925</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a66ea175f8ffb788a442c1e745117d525a8007ffb0199f0de3bef90a8adfbecb67"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a66ea175f8ffb788a442c1e745117d525a8007ffb0199f0de3bef90a8adfbecb67">ion::gfx::Sampler::kCompareToTexture</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00061">sampler.h:61</a></div></div>
<div class="ttc" id="base_2logging_8h_html_accad43a85d781d53381cd53a9894b6ae"><div class="ttname"><a href="base_2logging_8h.html#accad43a85d781d53381cd53a9894b6ae">LOG</a></div><div class="ttdeci">#define LOG(severity)</div><div class="ttdoc">Logs the streamed message unconditionally with a severity of severity. </div><div class="ttdef"><b>Definition:</b> <a href="base_2logging_8h_source.html#l00216">logging.h:216</a></div></div>
<div class="ttc" id="enumhelper_8h_html"><div class="ttname"><a href="enumhelper_8h.html">enumhelper.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ae2017d3beff202d8715bccf00a10a4ba"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ae2017d3beff202d8715bccf00a10a4ba">ion::gfx::Renderer::AllFlags</a></div><div class="ttdeci">static const Flags &amp; AllFlags()</div><div class="ttdoc">Convenience functions that return std::bitsets of Flags. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04716">renderer.cc:4716</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_a2215e7db780801d0c47f9b4b2713db9ea98272f25e8247cf217e5002b62da09c0"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9ea98272f25e8247cf217e5002b62da09c0">ion::gfx::Image::kRgba8888</a></div><div class="ttdef"><b>Definition:</b> <a href="image_8h_source.html#l00044">image.h:44</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_afe34751651cb11e58eeefad22bb65792"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#afe34751651cb11e58eeefad22bb65792">ion::gfx::GraphicsManager::UniformMatrix2fv</a></div><div class="ttdeci">framebuffer alpha dfactor const GLvoid usage alpha const GLvoid data border const GLuint buffers const GLuint renderbuffers count renderbuffer GLuint framebuffers GLsizei GLint GLenum GLchar name GLsizei GLuint shaders GLint data GLsizei GLchar info_log GLint params GLint GLint precision GLint params GLint params GLint params GLfloat params GLvoid pointer height height const GLchar const GLint length mask dppass param param const GLvoid data const GLint1 value const GLfloat2 value v2 v2 v3 v3 UniformMatrix2fv</div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00440">graphicsmanager.h:440</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a1f4e6b4b4bd00e5536203e46bffe9521ad4c833c4af4b6e7e3d67173d7185ef38"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521ad4c833c4af4b6e7e3d67173d7185ef38">ion::gfx::BufferObject::kElementBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00095">bufferobject.h:95</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a81dcc03f6636c61953c85481f2c899a0"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a81dcc03f6636c61953c85481f2c899a0">ion::gfx::Renderer::kClearShaderProgram</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00071">renderer.h:71</a></div></div>
<div class="ttc" id="classuint64_html"><div class="ttname"><a href="classuint64.html">uint64</a></div></div>
<div class="ttc" id="namespaceion_1_1math_html_a5a1199a3501b10b203686f3eca9a49fa"><div class="ttname"><a href="namespaceion_1_1math.html#a5a1199a3501b10b203686f3eca9a49fa">ion::math::Matrix3f</a></div><div class="ttdeci">Matrix&lt; 3, float &gt; Matrix3f</div><div class="ttdef"><b>Definition:</b> <a href="matrix_8h_source.html#l00369">matrix.h:369</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a81b2f5774e09c716e183034bc2b6aeab"><div class="ttname"><a href="namespaceion_1_1gfx.html#a81b2f5774e09c716e183034bc2b6aeab">ion::gfx::CubeMapTexturePtr</a></div><div class="ttdeci">base::ReferentPtr&lt; CubeMapTexture &gt;::Type CubeMapTexturePtr</div><div class="ttdoc">Convenience typedef for shared pointer to a CubeMapTexture. </div><div class="ttdef"><b>Definition:</b> <a href="cubemaptexture_8h_source.html#l00115">cubemaptexture.h:115</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_manager_html_a9357c226471835187825fb01a38b121d"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_manager.html#a9357c226471835187825fb01a38b121d">ion::gfx::ResourceManager::GetGraphicsManager</a></div><div class="ttdeci">const GraphicsManagerPtr &amp; GetGraphicsManager() const </div><div class="ttdoc">Functions. </div><div class="ttdef"><b>Definition:</b> <a href="resourcemanager_8h_source.html#l00199">resourcemanager.h:199</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_html_a129bb303640f34e71c22e8564c7d7fcbaff8702df884fc430161492cfd970ebb4"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object.html#a129bb303640f34e71c22e8564c7d7fcbaff8702df884fc430161492cfd970ebb4">ion::gfx::FramebufferObject::kDimensionsChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00060">framebufferobject.h:60</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_1_1_attachment_html_ab49f51304110b216005b55210a845eeb"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object_1_1_attachment.html#ab49f51304110b216005b55210a845eeb">ion::gfx::FramebufferObject::Attachment::GetTexture</a></div><div class="ttdeci">const TexturePtr &amp; GetTexture() const </div><div class="ttdoc">Gets the texture of the attachment, if any. </div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00116">framebufferobject.h:116</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a8cf00f1c00e22197c13282cd7b815ce7"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a8cf00f1c00e22197c13282cd7b815ce7">ion::gfx::Renderer::kSaveActiveTexture</a></div><div class="ttdoc">Whether to query OpenGL for current states and save them, which can be restored using the above kRest...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00089">renderer.h:89</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_cube_map_texture_html_a6bfcdda0af2e9457d95a6fa3b2a1f90c"><div class="ttname"><a href="classion_1_1gfx_1_1_cube_map_texture.html#a6bfcdda0af2e9457d95a6fa3b2a1f90c">ion::gfx::CubeMapTexture::CubeFace</a></div><div class="ttdeci">CubeFace</div><div class="ttdoc">The names of faces of the cube map. </div><div class="ttdef"><b>Definition:</b> <a href="cubemaptexture_8h_source.html#l00049">cubemaptexture.h:49</a></div></div>
<div class="ttc" id="matrixutils_8h_html"><div class="ttname"><a href="matrixutils_8h.html">matrixutils.h</a></div></div>
<div class="ttc" id="base_2logging_8h_html_ab4f56aa24c4c9cddc47a6abd2d747f9a"><div class="ttname"><a href="base_2logging_8h.html#ab4f56aa24c4c9cddc47a6abd2d747f9a">DCHECK_GT</a></div><div class="ttdeci">#define DCHECK_GT(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="base_2logging_8h_source.html#l00337">logging.h:337</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_aa4149d792923c0c5545b506339375ab3a5e27029436ae6cc69f3a91384e74a167"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3a5e27029436ae6cc69f3a91384e74a167">ion::gfx::TextureBase::kSwizzleBlueChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00073">texture.h:73</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_input_html_a533a21e6a809db26af80262011ec53f7"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_input.html#a533a21e6a809db26af80262011ec53f7">ion::gfx::ShaderInput::GetRegistry</a></div><div class="ttdeci">const ShaderInputRegistry &amp; GetRegistry() const </div><div class="ttdoc">Returns the ShaderInputRegistry the shader input is defined in. </div><div class="ttdef"><b>Definition:</b> <a href="shaderinput_8h_source.html#l00063">shaderinput.h:63</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_ad9f0be4740e4ec6c2221726138cd69f2af14a2e530e088bd732d6558c920564a0"><div class="ttname"><a href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2af14a2e530e088bd732d6558c920564a0">ion::gfx::kFloatVector4Attribute</a></div><div class="ttdef"><b>Definition:</b> <a href="attribute_8h_source.html#l00040">attribute.h:40</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_uniform_html"><div class="ttname"><a href="classion_1_1gfx_1_1_uniform.html">ion::gfx::Uniform</a></div><div class="ttdoc">A Uniform instance represents a uniform shader argument. </div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00076">uniform.h:76</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04ac8c4e51ffc220c5f7d25b999f98c67b0"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ac8c4e51ffc220c5f7d25b999f98c67b0">ion::gfx::Renderer::kSaveElementArrayBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00091">renderer.h:91</a></div></div>
<div class="ttc" id="glheaders_8h_html_a4be001d607f5f1fa944db63aebb9593b"><div class="ttname"><a href="glheaders_8h.html#a4be001d607f5f1fa944db63aebb9593b">GL_SAMPLER_EXTERNAL_OES</a></div><div class="ttdeci">#define GL_SAMPLER_EXTERNAL_OES</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00912">glheaders.h:912</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_aed5eca10b4c97950bf65af9b88414b4f"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#aed5eca10b4c97950bf65af9b88414b4f">ion::gfx::Renderer::ProcessResourceInfoRequests</a></div><div class="ttdeci">void ProcessResourceInfoRequests()</div><div class="ttdoc">Process any outstanding requests for information about internal resources that have been made through...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05454">renderer.cc:5454</a></div></div>
<div class="ttc" id="attributearray_8h_html"><div class="ttname"><a href="attributearray_8h.html">attributearray.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a064df8a40551ea50cc5e3aa2e6460932"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a064df8a40551ea50cc5e3aa2e6460932">ion::gfx::Renderer::AllProcessFlags</a></div><div class="ttdeci">static const Flags &amp; AllProcessFlags()</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04735">renderer.cc:4735</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572afba40b4d0911b93123d0984538d3749f"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572afba40b4d0911b93123d0984538d3749f">ion::gfx::GraphicsManager::kDebugLabel</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00126">graphicsmanager.h:126</a></div></div>
<div class="ttc" id="calltracemanager_8cc_html_aa5e5dc1547f4c4f7f4c114b0c856f344"><div class="ttname"><a href="calltracemanager_8cc.html#aa5e5dc1547f4c4f7f4c114b0c856f344">offset</a></div><div class="ttdeci">uint32 offset</div><div class="ttdef"><b>Definition:</b> <a href="calltracemanager_8cc_source.html#l00052">calltracemanager.cc:52</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_allocator_html_a923668f6616963795194b86411b14c3f"><div class="ttname"><a href="classion_1_1base_1_1_allocator.html#a923668f6616963795194b86411b14c3f">ion::base::Allocator::GetAllocatorForLifetime</a></div><div class="ttdeci">virtual const AllocatorPtr &amp; GetAllocatorForLifetime(AllocationLifetime lifetime) const </div><div class="ttdoc">Returns the correct Allocator to use to allocate memory with a specific lifetime. ...</div><div class="ttdef"><b>Definition:</b> <a href="allocator_8cc_source.html#l00027">allocator.cc:27</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_aa35e221419284321cf545e74e5deb2cf"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#aa35e221419284321cf545e74e5deb2cf">ion::gfx::Renderer::~Renderer</a></div><div class="ttdeci">~Renderer() override</div><div class="ttdoc">The destructor is protected because all base::Referent classes must have protected or private destruc...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04704">renderer.cc:4704</a></div></div>
<div class="ttc" id="readwritelock_8h_html"><div class="ttname"><a href="readwritelock_8h.html">readwritelock.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ad5cbcd5a8af5ad48fed21f7df97411b2"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ad5cbcd5a8af5ad48fed21f7df97411b2">ion::gfx::Renderer::UpdateStateFromOpenGL</a></div><div class="ttdeci">void UpdateStateFromOpenGL(int window_width, int window_height)</div><div class="ttdoc">A Renderer manages graphics state using a StateTable. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05460">renderer.cc:5460</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_state_table_html_ae6f345fc251ac53d5797d6300859d665"><div class="ttname"><a href="classion_1_1gfx_1_1_state_table.html#ae6f345fc251ac53d5797d6300859d665">ion::gfx::StateTable::Capability</a></div><div class="ttdeci">Capability</div><div class="ttdoc">Enumerated types for StateTable items. </div><div class="ttdef"><b>Definition:</b> <a href="statetable_8h_source.html#l00055">statetable.h:55</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a955ebbdc8a1b60161e621708351cc33aaf1f212ba118bf0400c80645a71e4a64d"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aaf1f212ba118bf0400c80645a71e4a64d">ion::gfx::Sampler::kWrapRChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00041">sampler.h:41</a></div></div>
<div class="ttc" id="texture_8h_html"><div class="ttname"><a href="texture_8h.html">texture.h</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a1fb38ca96a9985f325f838de5757e95d"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1fb38ca96a9985f325f838de5757e95d">ion::gfx::kTextureUniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00045">uniform.h:45</a></div></div>
<div class="ttc" id="gpuperformance_8cc_html_a72b34cdff63b637dbcd4849315a25601"><div class="ttname"><a href="gpuperformance_8cc.html#a72b34cdff63b637dbcd4849315a25601">vertex_count</a></div><div class="ttdeci">size_t vertex_count</div><div class="ttdef"><b>Definition:</b> <a href="gpuperformance_8cc_source.html#l00369">gpuperformance.cc:369</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a64e1a7c9754d8f0317a8b559496c91df"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a64e1a7c9754d8f0317a8b559496c91df">ion::gfx::Renderer::ResolveMultisampleFramebuffer</a></div><div class="ttdeci">void ResolveMultisampleFramebuffer(const FramebufferObjectPtr &amp;ms_fbo, const FramebufferObjectPtr &amp;dest_fbo)</div><div class="ttdoc">Resolve a multisampled framebuffer &#39;ms_fbo&#39; into a single sampled framebuffer &#39;dest_fbo&#39;. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05142">renderer.cc:5142</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_html_aecfb1ee58b3530a2b745a2a654202ceeaf8e0be2c28c08d7e1949a3b1d474cf4b"><div class="ttname"><a href="classion_1_1gfx_1_1_shader.html#aecfb1ee58b3530a2b745a2a654202ceeaf8e0be2c28c08d7e1949a3b1d474cf4b">ion::gfx::Shader::kSourceChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="shader_8h_source.html#l00063">shader.h:63</a></div></div>
<div class="ttc" id="allocationsizetracker_8h_html"><div class="ttname"><a href="allocationsizetracker_8h.html">allocationsizetracker.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a5fcadf03d8aca7b620f6574694b5ff0b"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a5fcadf03d8aca7b620f6574694b5ff0b">ion::gfx::Renderer::kSaveShaderProgram</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00093">renderer.h:93</a></div></div>
<div class="ttc" id="namespaceion_1_1math_html_ae3b184481b6c5ff2c600931a262210ac"><div class="ttname"><a href="namespaceion_1_1math.html#ae3b184481b6c5ff2c600931a262210ac">ion::math::Range2i</a></div><div class="ttdeci">Range&lt; 2, int32 &gt; Range2i</div><div class="ttdef"><b>Definition:</b> <a href="range_8h_source.html#l00371">range.h:371</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a0ba5458a2c1cfe30bd1347b50e3790db"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a0ba5458a2c1cfe30bd1347b50e3790db">ion::gfx::Sampler::WrapMode</a></div><div class="ttdeci">WrapMode</div><div class="ttdoc">Texture filter modes. </div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00077">sampler.h:77</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_html"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object.html">ion::gfx::FramebufferObject</a></div><div class="ttdoc">A FramebufferObject describes an off-screen framebuffer that can be drawn to and read from like a reg...</div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00054">framebufferobject.h:54</a></div></div>
<div class="ttc" id="calltracemanager_8cc_html_ae4f719e9aed394c364b0e8c7dbb2e67a"><div class="ttname"><a href="calltracemanager_8cc.html#ae4f719e9aed394c364b0e8c7dbb2e67a">length</a></div><div class="ttdeci">uint32 length</div><div class="ttdef"><b>Definition:</b> <a href="calltracemanager_8cc_source.html#l00042">calltracemanager.cc:42</a></div></div>
<div class="ttc" id="allocvector_8h_html"><div class="ttname"><a href="allocvector_8h.html">allocvector.h</a></div></div>
<div class="ttc" id="glheaders_8h_html_acd944484891101148770857ce47b2e0e"><div class="ttname"><a href="glheaders_8h.html#acd944484891101148770857ce47b2e0e">GL_BUFFER_OBJECT</a></div><div class="ttdeci">#define GL_BUFFER_OBJECT</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00165">glheaders.h:165</a></div></div>
<div class="ttc" id="namespaceion_1_1math_html_a79c5031576849cbacd5fa4cdbf1f49a8"><div class="ttname"><a href="namespaceion_1_1math.html#a79c5031576849cbacd5fa4cdbf1f49a8">ion::math::Range1ui</a></div><div class="ttdeci">Range&lt; 1, uint32 &gt; Range1ui</div><div class="ttdef"><b>Definition:</b> <a href="range_8h_source.html#l00364">range.h:364</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a8ffc9c987048f92d603de7f0dd184f38ac9799113262a90b484d7071d2cdfa221"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a8ffc9c987048f92d603de7f0dd184f38ac9799113262a90b484d7071d2cdfa221">ion::gfx::BufferObject::kSubDataChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00072">bufferobject.h:72</a></div></div>
<div class="ttc" id="allocset_8h_html"><div class="ttname"><a href="allocset_8h.html">allocset.h</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a08f89b65739f59e8d7ec80c6ba321108"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a08f89b65739f59e8d7ec80c6ba321108">ion::gfx::kFloatUniform</a></div><div class="ttdoc">Scalar types. </div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00039">uniform.h:39</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a3f928207085cb6063e1a767e5a27f8f0"><div class="ttname"><a href="namespaceion_1_1gfx.html#a3f928207085cb6063e1a767e5a27f8f0">ion::gfx::StateTablePtr</a></div><div class="ttdeci">base::ReferentPtr&lt; StateTable &gt;::Type StateTablePtr</div><div class="ttdoc">Convenience typedef for shared pointer to a StateTable. </div><div class="ttdef"><b>Definition:</b> <a href="statetable_8h_source.html#l00705">statetable.h:705</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_a43c6663b5bdd5e5839eba0729b613c28"><div class="ttname"><a href="namespaceion_1_1base.html#a43c6663b5bdd5e5839eba0729b613c28">ion::base::AllocatorPtr</a></div><div class="ttdeci">SharedPtr&lt; Allocator &gt; AllocatorPtr</div><div class="ttdef"><b>Definition:</b> <a href="allocator_8h_source.html#l00051">allocator.h:51</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_ad9f0be4740e4ec6c2221726138cd69f2a67b53e83d15820215144663e1d0d7d31"><div class="ttname"><a href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a67b53e83d15820215144663e1d0d7d31">ion::gfx::kBufferObjectElementAttribute</a></div><div class="ttdoc">Vertex buffer element. </div><div class="ttdef"><b>Definition:</b> <a href="attribute_8h_source.html#l00048">attribute.h:48</a></div></div>
<div class="ttc" id="macros_8h_html"><div class="ttname"><a href="macros_8h.html">macros.h</a></div></div>
<div class="ttc" id="printer_8cc_html_a1dd28f5ea7b5b0780013e960944ddaa0"><div class="ttname"><a href="printer_8cc.html#a1dd28f5ea7b5b0780013e960944ddaa0">label</a></div><div class="ttdeci">std::string label</div><div class="ttdef"><b>Definition:</b> <a href="printer_8cc_source.html#l00354">printer.cc:354</a></div></div>
<div class="ttc" id="utils_8h_html"><div class="ttname"><a href="utils_8h.html">utils.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04ab6e5d3c9cad6f2d9094c9f86eb22fdf6"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ab6e5d3c9cad6f2d9094c9f86eb22fdf6">ion::gfx::Renderer::kRestoreActiveTexture</a></div><div class="ttdoc">Whether to restore certain GL state types when drawing is finished. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00078">renderer.h:78</a></div></div>
<div class="ttc" id="glheaders_8h_html"><div class="ttname"><a href="glheaders_8h.html">glheaders.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_aa47b150027479bdf7b7f158a1827d60f"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#aa47b150027479bdf7b7f158a1827d60f">ion::gfx::Renderer::RequestForcedUpdate</a></div><div class="ttdeci">void RequestForcedUpdate(T *holder)</div><div class="ttdoc">Mark an object for a forced update of GL resources. </div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ae983af9af643383c283e33038773fd48a5541dbcaa8a562a504dff0b911fee221"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a5541dbcaa8a562a504dff0b911fee221">ion::gfx::Renderer::kFramebufferObject</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00104">renderer.h:104</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_html_a129bb303640f34e71c22e8564c7d7fcbaa8e20dbda2069df4f41f80b2c17584cb"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object.html#a129bb303640f34e71c22e8564c7d7fcbaa8e20dbda2069df4f41f80b2c17584cb">ion::gfx::FramebufferObject::kDepthAttachmentChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00059">framebufferobject.h:59</a></div></div>
<div class="ttc" id="glheaders_8h_html_aa9c2d29fbaccd5badfc18959375c7d74"><div class="ttname"><a href="glheaders_8h.html#aa9c2d29fbaccd5badfc18959375c7d74">GL_POINT_SPRITE</a></div><div class="ttdeci">#define GL_POINT_SPRITE</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00618">glheaders.h:618</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a7b4d7146a5c0c8e5bef7e720f423eefd"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a7b4d7146a5c0c8e5bef7e720f423eefd">ion::gfx::Renderer::DestroyStateCache</a></div><div class="ttdeci">static void DestroyStateCache(const portgfx::Visual *visual)</div><div class="ttdoc">Destroys the internal state cache associated with the passed Visual. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04780">renderer.cc:4780</a></div></div>
<div class="ttc" id="calltracemanager_8cc_html_a3384d9640634d49e84776a97f3e2c241"><div class="ttname"><a href="calltracemanager_8cc.html#a3384d9640634d49e84776a97f3e2c241">id</a></div><div class="ttdeci">uint32 id</div><div class="ttdef"><b>Definition:</b> <a href="calltracemanager_8cc_source.html#l00040">calltracemanager.cc:40</a></div></div>
<div class="ttc" id="staticsafedeclare_8h_html"><div class="ttname"><a href="staticsafedeclare_8h.html">staticsafedeclare.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_base_html_abbe3d9b628a6cb216802a4440fcbb85a"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_base.html#abbe3d9b628a6cb216802a4440fcbb85a">ion::gfx::ResourceBase::GetHolder</a></div><div class="ttdeci">const ResourceHolder * GetHolder() const </div><div class="ttdoc">Retrieve the holder for which this resource was created. </div><div class="ttdef"><b>Definition:</b> <a href="resourcebase_8h_source.html#l00047">resourcebase.h:47</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_html_a7930e32a5573b4c03bde1847cb681933ab0fa18121f7fe0c0aec46385103c7149"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object.html#a7930e32a5573b4c03bde1847cb681933ab0fa18121f7fe0c0aec46385103c7149">ion::gfx::FramebufferObject::kTexture</a></div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00069">framebufferobject.h:69</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_allocatable_html_a0682f27004c4f1a332360d7878b351a7"><div class="ttname"><a href="classion_1_1base_1_1_allocatable.html#a0682f27004c4f1a332360d7878b351a7">ion::base::Allocatable::GetAllocatorForLifetime</a></div><div class="ttdeci">const AllocatorPtr &amp; GetAllocatorForLifetime(AllocationLifetime lifetime) const </div><div class="ttdoc">Convenience function that returns the Allocator to use to allocate an object with a specific lifetime...</div><div class="ttdef"><b>Definition:</b> <a href="allocatable_8h_source.html#l00078">allocatable.h:78</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a57380b7aaee938babb09391306324320"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a57380b7aaee938babb09391306324320">ion::gfx::Renderer::AllRestoreFlags</a></div><div class="ttdeci">static const Flags &amp; AllRestoreFlags()</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04741">renderer.cc:4741</a></div></div>
<div class="ttc" id="texturemanager_8h_html"><div class="ttname"><a href="texturemanager_8h.html">texturemanager.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04abd27fe560c136c36aadbcfea54785552"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04abd27fe560c136c36aadbcfea54785552">ion::gfx::Renderer::kClearTextures</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00072">renderer.h:72</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_input_registry_html_ac0343455043934c00898cad8f018704f"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_input_registry.html#ac0343455043934c00898cad8f018704f">ion::gfx::ShaderInputRegistry::UniformSpec</a></div><div class="ttdeci">Spec&lt; Uniform &gt; UniformSpec</div><div class="ttdef"><b>Definition:</b> <a href="shaderinputregistry_8h_source.html#l00163">shaderinputregistry.h:163</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643aac51fc132916cc16df51547ffe5071b7"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643aac51fc132916cc16df51547ffe5071b7">ion::gfx::kIntVector4Uniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00053">uniform.h:53</a></div></div>
<div class="ttc" id="image_8h_html"><div class="ttname"><a href="image_8h.html">image.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a547a17d7047237044795b075ed98e1dc"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a547a17d7047237044795b075ed98e1dc">ion::gfx::Renderer::kRestoreElementArrayBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00080">renderer.h:80</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_ad9f0be4740e4ec6c2221726138cd69f2a3126c9a68bc64edfa62623be936a6b61"><div class="ttname"><a href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a3126c9a68bc64edfa62623be936a6b61">ion::gfx::kFloatVector2Attribute</a></div><div class="ttdoc">Vector types. </div><div class="ttdef"><b>Definition:</b> <a href="attribute_8h_source.html#l00038">attribute.h:38</a></div></div>
<div class="ttc" id="range_8h_html"><div class="ttname"><a href="range_8h.html">range.h</a></div></div>
<div class="ttc" id="attribute_8h_html"><div class="ttname"><a href="attribute_8h.html">attribute.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_a83a672a54ef01b9ad0dc145976d59ce7"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#a83a672a54ef01b9ad0dc145976d59ce7">ion::gfx::Image::ComputeDataSize</a></div><div class="ttdeci">static size_t ComputeDataSize(Format format, uint32 width, uint32 height)</div><div class="ttdoc">Convenience functions that return the correct data size in bytes of an image having the given format ...</div><div class="ttdef"><b>Definition:</b> <a href="image_8cc_source.html#l00421">image.cc:421</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a81379daab6f9c58a8db84411efc85113"><div class="ttname"><a href="namespaceion_1_1gfx.html#a81379daab6f9c58a8db84411efc85113">ion::gfx::UpdateStateTable</a></div><div class="ttdeci">void UpdateStateTable(int default_width, int default_height, GraphicsManager *gm, StateTable *st)</div><div class="ttdoc">Public functions. </div><div class="ttdef"><b>Definition:</b> <a href="updatestatetable_8cc_source.html#l00683">updatestatetable.cc:683</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_shared_ptr_html_aa09fcc05a825d75554c9d1d484731f96"><div class="ttname"><a href="classion_1_1base_1_1_shared_ptr.html#aa09fcc05a825d75554c9d1d484731f96">ion::base::SharedPtr::Get</a></div><div class="ttdeci">T * Get() const </div><div class="ttdoc">Returns a raw pointer to the instance, which may be NULL. </div><div class="ttdef"><b>Definition:</b> <a href="sharedptr_8h_source.html#l00089">sharedptr.h:89</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572a07b147f33c44e20d5dd40cc1f6bc2a50"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a07b147f33c44e20d5dd40cc1f6bc2a50">ion::gfx::GraphicsManager::kSamplerObjects</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00148">graphicsmanager.h:148</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_ad2a5bbee7fd2c231589f603bfa5e1c2fa51d8ace449d1c8620c488a90c08d765a"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa51d8ace449d1c8620c488a90c08d765a">ion::gfx::Image::kEgl</a></div><div class="ttdef"><b>Definition:</b> <a href="image_8h_source.html#l00180">image.h:180</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_aa4149d792923c0c5545b506339375ab3ac6670a1b84fd5ed564eade86f1dec1d8"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3ac6670a1b84fd5ed564eade86f1dec1d8">ion::gfx::TextureBase::kSamplerChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00070">texture.h:70</a></div></div>
<div class="ttc" id="serialize_8h_html"><div class="ttname"><a href="serialize_8h.html">serialize.h</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_generic_lock_guard_html"><div class="ttname"><a href="classion_1_1base_1_1_generic_lock_guard.html">ion::base::GenericLockGuard</a></div><div class="ttdoc">A LockGuard locks a mutex when created, and unlocks it when destroyed. </div><div class="ttdef"><b>Definition:</b> <a href="lockguards_8h_source.html#l00090">lockguards.h:90</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a730d3d3b0175b0cb7056ce8abba53383"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a730d3d3b0175b0cb7056ce8abba53383">ion::gfx::Renderer::ClearTypedResources</a></div><div class="ttdeci">void ClearTypedResources(ResourceType type)</div><div class="ttdoc">Immediately clears the internal resources of all ResourceHolders of the passed type. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05614">renderer.cc:5614</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_a38945775ca691f4c7e2d186567037995"><div class="ttname"><a href="namespaceion_1_1base.html#a38945775ca691f4c7e2d186567037995">ion::base::ValueToString</a></div><div class="ttdeci">std::string ValueToString(const T &amp;val)</div><div class="ttdoc">ValueToString. </div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00209">serialize.h:209</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572aec856693e4b1f2cfceec7fc9b3dc711c"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572aec856693e4b1f2cfceec7fc9b3dc711c">ion::gfx::GraphicsManager::kMapBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00142">graphicsmanager.h:142</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a955ebbdc8a1b60161e621708351cc33aaeb7b75f1cde86f4f1c840229836ba3cc"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aaeb7b75f1cde86f4f1c840229836ba3cc">ion::gfx::Sampler::kMinLodChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00040">sampler.h:40</a></div></div>
<div class="ttc" id="allocationmanager_8h_html"><div class="ttname"><a href="allocationmanager_8h.html">allocationmanager.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04add695796ee0afeb78859849f893278ac"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04add695796ee0afeb78859849f893278ac">ion::gfx::Renderer::kSaveFramebuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00092">renderer.h:92</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_input_registry_html"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_input_registry.html">ion::gfx::ShaderInputRegistry</a></div><div class="ttdoc">A ShaderInputRegistry is used to manage a collection of shader inputs to a specific ShaderProgram (bo...</div><div class="ttdef"><b>Definition:</b> <a href="shaderinputregistry_8h_source.html#l00088">shaderinputregistry.h:88</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_aa4149d792923c0c5545b506339375ab3a9248861d30631e8ce0dcd1d1a665bf40"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3a9248861d30631e8ce0dcd1d1a665bf40">ion::gfx::TextureBase::kSwizzleGreenChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00072">texture.h:72</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_abc5a7904fc62731598ec5a59296782a8"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#abc5a7904fc62731598ec5a59296782a8">ion::gfx::Renderer::Flags</a></div><div class="ttdeci">std::bitset&lt; kNumFlags &gt; Flags</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00098">renderer.h:98</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html">ion::gfx::BufferObject</a></div><div class="ttdoc">A BufferObject describes a generic array of data used, for example, to describe the vertices in a Sha...</div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00067">bufferobject.h:67</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a341f85419db9e48a4e93fbb1ef10e128"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a341f85419db9e48a4e93fbb1ef10e128">ion::gfx::Renderer::kProcessReleases</a></div><div class="ttdoc">Release any internal resources that have been marked for destruction, including OpenGL objects...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00060">renderer.h:60</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a21a9d90fde655b0de5251c03bad7db75"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a21a9d90fde655b0de5251c03bad7db75">ion::gfx::Renderer::AllSaveFlags</a></div><div class="ttdeci">static const Flags &amp; AllSaveFlags()</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04752">renderer.cc:4752</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_uniform_html_a14c139d65a99c87b788bcb38cf4ecaf8"><div class="ttname"><a href="classion_1_1gfx_1_1_uniform.html#a14c139d65a99c87b788bcb38cf4ecaf8">ion::gfx::Uniform::GetMerged</a></div><div class="ttdeci">static bool GetMerged(const Uniform &amp;base, const Uniform &amp;replacement, Uniform *merged)</div><div class="ttdoc">Merges replacement and base into merged. </div><div class="ttdef"><b>Definition:</b> <a href="uniform_8cc_source.html#l00225">uniform.cc:225</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_html_a7930e32a5573b4c03bde1847cb681933a2f3722b93d55e71736055df30d1bc489"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object.html#a7930e32a5573b4c03bde1847cb681933a2f3722b93d55e71736055df30d1bc489">ion::gfx::FramebufferObject::kUnbound</a></div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00070">framebufferobject.h:70</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_afe483c6cc2e75618b57e9269e5cd7628a3c9133c01de9c071adfb3db11f38b1d3"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#afe483c6cc2e75618b57e9269e5cd7628a3c9133c01de9c071adfb3db11f38b1d3">ion::gfx::GraphicsManager::kDesktop</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00162">graphicsmanager.h:162</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_manager_html_a392a07a92965295fa8ebd714f27fb4a4"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_manager.html#a392a07a92965295fa8ebd714f27fb4a4">ion::gfx::ResourceManager::FillInfoFromOpenGL</a></div><div class="ttdeci">void FillInfoFromOpenGL(InfoType *info)</div><div class="ttdoc">Performs OpenGL calls to fill in info details, specialized for each type derived from ResourceInfo...</div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_a7a06522e42b8521c6a9875a74d9b96c1"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#a7a06522e42b8521c6a9875a74d9b96c1">ion::gfx::Image::GetPixelFormat</a></div><div class="ttdeci">static const PixelFormat &amp; GetPixelFormat(Format format)</div><div class="ttdoc">Convenience function that returns a PixelFormat given a Format. </div><div class="ttdef"><b>Definition:</b> <a href="image_8cc_source.html#l00076">image.cc:76</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ae983af9af643383c283e33038773fd48a4c2dda32f304492a88754518cf801811"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a4c2dda32f304492a88754518cf801811">ion::gfx::Renderer::kTexture</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00109">renderer.h:109</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_html_a7930e32a5573b4c03bde1847cb681933a4101520f7be4eee5bb6c3237171a3d5e"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object.html#a7930e32a5573b4c03bde1847cb681933a4101520f7be4eee5bb6c3237171a3d5e">ion::gfx::FramebufferObject::kRenderbuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00068">framebufferobject.h:68</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a1f4e6b4b4bd00e5536203e46bffe9521aa83c4353d5167f06dba7580fd5c1244f"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521aa83c4353d5167f06dba7580fd5c1244f">ion::gfx::BufferObject::kArrayBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00094">bufferobject.h:94</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ac67e2272996e330180142aafd48db43a"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ac67e2272996e330180142aafd48db43a">ion::gfx::Renderer::ClearResources</a></div><div class="ttdeci">void ClearResources(const HolderType *holder)</div><div class="ttdoc">Immediately clears the internal resources of the passed ResourceHolder. </div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a71d9220193422655e49e90016b487451"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a71d9220193422655e49e90016b487451">ion::gfx::Renderer::GetGraphicsManager</a></div><div class="ttdeci">const GraphicsManagerPtr &amp; GetGraphicsManager() const </div><div class="ttdoc">Returns the GraphicsManager passed to the constructor. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04763">renderer.cc:4763</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a6c1236c56d99c202b404c5f6166c85adad8f12f1bc152a2823f548ef1c9140bb3"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a6c1236c56d99c202b404c5f6166c85adad8f12f1bc152a2823f548ef1c9140bb3">ion::gfx::BufferObject::kFloatMatrixColumn2</a></div><div class="ttdoc">These are necessary since each column of a matrix must be sent to OpenGL separately and we must know ...</div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00088">bufferobject.h:88</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a68f812bcd8299939236e4cf49ed1806d"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a68f812bcd8299939236e4cf49ed1806d">ion::gfx::kFloatVector3Uniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00049">uniform.h:49</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_program_html_a99706705feda117b2c04b0453451c2ada1ac0292458617f7813813f080155fadb"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_program.html#a99706705feda117b2c04b0453451c2ada1ac0292458617f7813813f080155fadb">ion::gfx::ShaderProgram::kFragmentShaderChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="shaderprogram_8h_source.html#l00043">shaderprogram.h:43</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a81b379b9dc3585ac8815021f56f90c41"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a81b379b9dc3585ac8815021f56f90c41">ion::gfx::kCubeMapTextureUniform</a></div><div class="ttdoc">Texture types. </div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00044">uniform.h:44</a></div></div>
<div class="ttc" id="namespaceion_1_1port_html_ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116"><div class="ttname"><a href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a662bb163f898e8df1cb67b1d72b87116">ion::port::ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="port_2logging_8h_source.html#l00029">logging.h:29</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_input_registry_html_a6938655fdb469df98f180e73711ffb74"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_input_registry.html#a6938655fdb469df98f180e73711ffb74">ion::gfx::ShaderInputRegistry::GetSpec</a></div><div class="ttdeci">static const Spec&lt; T &gt; * GetSpec(const T &amp;input)</div><div class="ttdoc">Convenience function that returns a pointer to the Spec associated with an Attribute or Uniform insta...</div><div class="ttdef"><b>Definition:</b> <a href="shaderinputregistry_8h_source.html#l00350">shaderinputregistry.h:350</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_aa683a2dcb3c87eb63815ddb3ee33bc88"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#aa683a2dcb3c87eb63815ddb3ee33bc88">ion::gfx::Renderer::UnmapBufferObjectData</a></div><div class="ttdeci">void UnmapBufferObjectData(const BufferObjectPtr &amp;buffer)</div><div class="ttdoc">Unmaps a previously mapped BufferObject and makes the data available to the graphics hardware...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05512">renderer.cc:5512</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a748e81d1f2c217516396e95228858144"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a748e81d1f2c217516396e95228858144">ion::gfx::Renderer::PopDebugMarker</a></div><div class="ttdeci">void PopDebugMarker()</div><div class="ttdoc">In non-production builds, pops a label off of the Renderer&#39;s tracing stream marker stack...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05541">renderer.cc:5541</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_attribute_array_html_abcccfb5627ac2b2f56e944ff9609a3fea85840a7a363b540924838b2804639d23"><div class="ttname"><a href="classion_1_1gfx_1_1_attribute_array.html#abcccfb5627ac2b2f56e944ff9609a3fea85840a7a363b540924838b2804639d23">ion::gfx::AttributeArray::kAttributeEnabledChanged</a></div><div class="ttdoc">The entries between kAttributeChanged and kAttributeEnabledChanged are reserved for determining which...</div><div class="ttdef"><b>Definition:</b> <a href="attributearray_8h_source.html#l00043">attributearray.h:43</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_program_html_a4849800659a6ac8aa0d1092becd2ead8"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_program.html#a4849800659a6ac8aa0d1092becd2ead8">ion::gfx::ShaderProgram::SetConcurrent</a></div><div class="ttdeci">void SetConcurrent(bool value)</div><div class="ttdoc">Sets/returns whether this shader program should have per-thread state. </div><div class="ttdef"><b>Definition:</b> <a href="shaderprogram_8cc_source.html#l00067">shaderprogram.cc:67</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643accab86be40af728bc046aefcd5be3251"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643accab86be40af728bc046aefcd5be3251">ion::gfx::kIntVector2Uniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00051">uniform.h:51</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_enum_helper_html_a6825259ec168f1dd2639a194f543997b"><div class="ttname"><a href="classion_1_1base_1_1_enum_helper.html#a6825259ec168f1dd2639a194f543997b">ion::base::EnumHelper::GetString</a></div><div class="ttdeci">static const char * GetString(EnumType e)</div><div class="ttdoc">Returns a string corresponding to an enum. </div><div class="ttdef"><b>Definition:</b> <a href="enumhelper_8h_source.html#l00059">enumhelper.h:59</a></div></div>
<div class="ttc" id="printer_8cc_html_a9b45b3e13bd9167aab02e17e08916231"><div class="ttname"><a href="printer_8cc.html#a9b45b3e13bd9167aab02e17e08916231">name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="printer_8cc_source.html#l00324">printer.cc:324</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a0525286b6d441457ee2d3cd1f1390f07"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a0525286b6d441457ee2d3cd1f1390f07">ion::gfx::kMatrix4x4Uniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00061">uniform.h:61</a></div></div>
<div class="ttc" id="invalid_8h_html"><div class="ttname"><a href="invalid_8h.html">invalid.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_html_a129bb303640f34e71c22e8564c7d7fcba6ea0a87dc5ac8b995daf29ff06e75818"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object.html#a129bb303640f34e71c22e8564c7d7fcba6ea0a87dc5ac8b995daf29ff06e75818">ion::gfx::FramebufferObject::kStencilAttachmentChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00061">framebufferobject.h:61</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_program_html_a99706705feda117b2c04b0453451c2adaac532cb5d784e09e0ef8aaffc24388c6"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_program.html#a99706705feda117b2c04b0453451c2adaac532cb5d784e09e0ef8aaffc24388c6">ion::gfx::ShaderProgram::kVertexShaderChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="shaderprogram_8h_source.html#l00042">shaderprogram.h:42</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a374fccb25553f288d87f7a66f49cd045"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a374fccb25553f288d87f7a66f49cd045">ion::gfx::Renderer::BufferObjectDataMapMode</a></div><div class="ttdeci">BufferObjectDataMapMode</div><div class="ttdoc">The possible ways a BufferObject&#39;s data can be mapped. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00117">renderer.h:117</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_aa4149d792923c0c5545b506339375ab3a90551e8df3b0dc7664670fbd32b8242a"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3a90551e8df3b0dc7664670fbd32b8242a">ion::gfx::TextureBase::kMaxLevelChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00068">texture.h:68</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_allocatable_html_a1b65140be876e9bb2e7bba08ed3b69b4"><div class="ttname"><a href="classion_1_1base_1_1_allocatable.html#a1b65140be876e9bb2e7bba08ed3b69b4">ion::base::Allocatable::Allocatable</a></div><div class="ttdeci">Allocatable()</div><div class="ttdoc">This constructor sets up the Allocator pointer. </div><div class="ttdef"><b>Definition:</b> <a href="allocatable_8cc_source.html#l00253">allocatable.cc:253</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_afae611dad38f36622bdd0a672624ee65"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#afae611dad38f36622bdd0a672624ee65">ion::gfx::Renderer::BindResource</a></div><div class="ttdeci">void BindResource(T *holder)</div><div class="ttdoc">Immediately creates internal GL resources for the passed holder, uploading any data and binding the r...</div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a31b7860918be8b91265255f0bbad4d64"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a31b7860918be8b91265255f0bbad4d64">ion::gfx::Renderer::GetCurrentFramebuffer</a></div><div class="ttdeci">const FramebufferObjectPtr GetCurrentFramebuffer() const </div><div class="ttdoc">Returns the currently bound FramebufferObject. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04857">renderer.cc:4857</a></div></div>
<div class="ttc" id="matrix_8h_html"><div class="ttname"><a href="matrix_8h.html">matrix.h</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_ad9f0be4740e4ec6c2221726138cd69f2a3cb7a3cbcffcdcbd4a5baef157b7929f"><div class="ttname"><a href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a3cb7a3cbcffcdcbd4a5baef157b7929f">ion::gfx::kFloatVector3Attribute</a></div><div class="ttdef"><b>Definition:</b> <a href="attribute_8h_source.html#l00039">attribute.h:39</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a8b1d7c24c12bc798aa9997f79f2013b2"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a8b1d7c24c12bc798aa9997f79f2013b2">ion::gfx::Renderer::kSaveStateTable</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00094">renderer.h:94</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_attribute_array_html"><div class="ttname"><a href="classion_1_1gfx_1_1_attribute_array.html">ion::gfx::AttributeArray</a></div><div class="ttdoc">An AttributeArray represents a collection of Attributes used to describe the vertices of a Shape...</div><div class="ttdef"><b>Definition:</b> <a href="attributearray_8h_source.html#l00036">attributearray.h:36</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_ad9f0be4740e4ec6c2221726138cd69f2a3f9d9dfa59b8a4253cc4355a8446aef1"><div class="ttname"><a href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a3f9d9dfa59b8a4253cc4355a8446aef1">ion::gfx::kFloatMatrix3x3Attribute</a></div><div class="ttdef"><b>Definition:</b> <a href="attribute_8h_source.html#l00044">attribute.h:44</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ad81c99d1363b2f5b19c67238f12c0dea"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ad81c99d1363b2f5b19c67238f12c0dea">ion::gfx::Renderer::CreateOrUpdateResource</a></div><div class="ttdeci">void CreateOrUpdateResource(T *holder)</div><div class="ttdoc">This function is useful for uploading data to the hardware at a time convenient to the caller when us...</div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_a2215e7db780801d0c47f9b4b2713db9ea92410ce017939c741b135249977360c4"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#a2215e7db780801d0c47f9b4b2713db9ea92410ce017939c741b135249977360c4">ion::gfx::Image::kEglImage</a></div><div class="ttdoc">4444 uint16 data. </div><div class="ttdef"><b>Definition:</b> <a href="image_8h_source.html#l00166">image.h:166</a></div></div>
<div class="ttc" id="glheaders_8h_html_a5d386805398c2f55ae253acecb38089e"><div class="ttname"><a href="glheaders_8h.html#a5d386805398c2f55ae253acecb38089e">GL_SHADER_OBJECT</a></div><div class="ttdeci">#define GL_SHADER_OBJECT</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00924">glheaders.h:924</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ae983af9af643383c283e33038773fd48a813a96489fc6982cfca789dae313c193"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a813a96489fc6982cfca789dae313c193">ion::gfx::Renderer::kShader</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00108">renderer.h:108</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a6c1236c56d99c202b404c5f6166c85ad"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a6c1236c56d99c202b404c5f6166c85ad">ion::gfx::BufferObject::ComponentType</a></div><div class="ttdeci">ComponentType</div><div class="ttdoc">The type of the components of a spec. </div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00077">bufferobject.h:77</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a177ee09712d9fac84668cbb7fa1b7de9"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a177ee09712d9fac84668cbb7fa1b7de9">ion::gfx::Renderer::SetInitialUniformValue</a></div><div class="ttdeci">void SetInitialUniformValue(const Uniform &amp;u)</div><div class="ttdoc">Sets the initial value of a Uniform to the passed value. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05129">renderer.cc:5129</a></div></div>
<div class="ttc" id="sdfutils_8cc_html_a3555e065e55befd710eaa182fcf387f5"><div class="ttname"><a href="sdfutils_8cc.html#a3555e065e55befd710eaa182fcf387f5">image</a></div><div class="ttdeci">const Grid &amp; image</div><div class="ttdoc">The original monochrome image data, as doubles (0 - 1). </div><div class="ttdef"><b>Definition:</b> <a href="sdfutils_8cc_source.html#l00090">sdfutils.cc:90</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572a7e4d2216509d272e94aa14114d31a669"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a7e4d2216509d272e94aa14114d31a669">ion::gfx::GraphicsManager::kCopyBufferSubData</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00145">graphicsmanager.h:145</a></div></div>
<div class="ttc" id="base_2logging_8h_html_aae2dc65d9ea248d54bf39daa986dd295"><div class="ttname"><a href="base_2logging_8h.html#aae2dc65d9ea248d54bf39daa986dd295">DCHECK_GE</a></div><div class="ttdeci">#define DCHECK_GE(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="base_2logging_8h_source.html#l00336">logging.h:336</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572a7eb28f6f9082fff57244f204bc9c73e3"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a7eb28f6f9082fff57244f204bc9c73e3">ion::gfx::GraphicsManager::kMapBufferRange</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00144">graphicsmanager.h:144</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_ad9f0be4740e4ec6c2221726138cd69f2a1c713b71c7f9f3acbbd776640afa5cb2"><div class="ttname"><a href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a1c713b71c7f9f3acbbd776640afa5cb2">ion::gfx::kFloatMatrix2x2Attribute</a></div><div class="ttdoc">Matrix types. </div><div class="ttdef"><b>Definition:</b> <a href="attribute_8h_source.html#l00043">attribute.h:43</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a1f639abee657c971cd86c895ac9d52df"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1f639abee657c971cd86c895ac9d52df">ion::gfx::kUnsignedIntVector2Uniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00054">uniform.h:54</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a3cdd7323c1a3246f97b79277b3845054"><div class="ttname"><a href="namespaceion_1_1gfx.html#a3cdd7323c1a3246f97b79277b3845054">ion::gfx::ShaderPtr</a></div><div class="ttdeci">base::ReferentPtr&lt; Shader &gt;::Type ShaderPtr</div><div class="ttdoc">Convenience typedef for shared pointers to Shaders. </div><div class="ttdef"><b>Definition:</b> <a href="resourcemanager_8h_source.html#l00049">resourcemanager.h:49</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_html_a7930e32a5573b4c03bde1847cb681933a704ea2cbabd14075e10a36bdebd41791"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object.html#a7930e32a5573b4c03bde1847cb681933a704ea2cbabd14075e10a36bdebd41791">ion::gfx::FramebufferObject::kCubeMapTexture</a></div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00067">framebufferobject.h:67</a></div></div>
<div class="ttc" id="atomic_8h_html"><div class="ttname"><a href="atomic_8h.html">atomic.h</a></div></div>
<div class="ttc" id="base_2logging_8h_html_ab8493891cf64850ba3b3a95626938207"><div class="ttname"><a href="base_2logging_8h.html#ab8493891cf64850ba3b3a95626938207">LOG_ONCE</a></div><div class="ttdeci">#define LOG_ONCE(severity)</div><div class="ttdoc">Logs the streamed message once per process run with a severity of severity. </div><div class="ttdef"><b>Definition:</b> <a href="base_2logging_8h_source.html#l00219">logging.h:219</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a3fe146eb5ffef79479ee4d40034f8459"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a3fe146eb5ffef79479ee4d40034f8459">ion::gfx::Renderer::RequestForcedShapeUpdates</a></div><div class="ttdeci">void RequestForcedShapeUpdates(const ShapePtr &amp;shape)</div><div class="ttdoc">Mark a shape&#39;s resources for a forced update the next time CreateOrUpdateResources or DrawScene is ca...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05105">renderer.cc:5105</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_a12d3865496a66b90d413b60dadc40407"><div class="ttname"><a href="namespaceion_1_1base.html#a12d3865496a66b90d413b60dadc40407">ion::base::InvalidEnumValue</a></div><div class="ttdeci">EnumType InvalidEnumValue()</div><div class="ttdoc">InvalidEnumValue() returns an invalid enum value, assuming that -1 is not a valid value...</div><div class="ttdef"><b>Definition:</b> <a href="invalid_8h_source.html#l00047">invalid.h:47</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572a9c2699f8161b9670b16f330cf54ee671"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a9c2699f8161b9670b16f330cf54ee671">ion::gfx::GraphicsManager::kEglImage</a></div><div class="ttdoc">This covers both OES_EGL_image and OES_EGL_image_external. </div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00138">graphicsmanager.h:138</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a0a4bdde528e8eb0612e1883267fa5d7c"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a0a4bdde528e8eb0612e1883267fa5d7c">ion::gfx::Renderer::kClearArrayBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00066">renderer.h:66</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_a4380253b3f1f3f78c5739858f2d85641af1bcdfd8248162a189e68a21d4725a2b"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#a4380253b3f1f3f78c5739858f2d85641af1bcdfd8248162a189e68a21d4725a2b">ion::gfx::TextureBase::kTexture</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00087">texture.h:87</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_ab470a11cceef7441df42bf6f489a69e5"><div class="ttname"><a href="namespaceion_1_1base.html#ab470a11cceef7441df42bf6f489a69e5">ion::base::ReadGuard</a></div><div class="ttdeci">GenericLockGuard&lt; ReadLock &gt; ReadGuard</div><div class="ttdoc">Convenient typedefs for ReadWriteLock. </div><div class="ttdef"><b>Definition:</b> <a href="lockguards_8h_source.html#l00202">lockguards.h:202</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_a5739ea2401844cf4db67bf82349bc13da5763ea143ebbfd5187a93a48c9d661c5"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#a5739ea2401844cf4db67bf82349bc13da5763ea143ebbfd5187a93a48c9d661c5">ion::gfx::GraphicsManager::kMaxTextureMaxAnisotropy</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00091">graphicsmanager.h:91</a></div></div>
<div class="ttc" id="classion_1_1portgfx_1_1_visual_html_a5ffcc5e79f1b2c7cf122a14e3213368b"><div class="ttname"><a href="classion_1_1portgfx_1_1_visual.html#a5ffcc5e79f1b2c7cf122a14e3213368b">ion::portgfx::Visual::GetId</a></div><div class="ttdeci">size_t GetId() const </div><div class="ttdoc">Returns the ID associated with this Visual. </div><div class="ttdef"><b>Definition:</b> <a href="visual_8h_source.html#l00054">visual.h:54</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a408735143bf7dcb58f2ed547940c337a"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a408735143bf7dcb58f2ed547940c337a">ion::gfx::Renderer::AllClearFlags</a></div><div class="ttdeci">static const Flags &amp; AllClearFlags()</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04722">renderer.cc:4722</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_base_html_a0d9bf78832568e9213031e611b535c97"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_base.html#a0d9bf78832568e9213031e611b535c97">ion::gfx::ResourceBase::GetKey</a></div><div class="ttdeci">ResourceKey GetKey() const </div><div class="ttdoc">Retrieve a key that disambiguates between multiple resources created for the same holder by the same ...</div><div class="ttdef"><b>Definition:</b> <a href="resourcebase_8h_source.html#l00051">resourcebase.h:51</a></div></div>
<div class="ttc" id="mutex_8h_html"><div class="ttname"><a href="mutex_8h.html">mutex.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04ac00cfea6d548231a819c5f8016922abe"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ac00cfea6d548231a819c5f8016922abe">ion::gfx::Renderer::kClearActiveTexture</a></div><div class="ttdoc">Whether to clear (set to 0) certain GL objects when drawing is finished. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00065">renderer.h:65</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_manager_html"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_manager.html">ion::gfx::ResourceManager</a></div><div class="ttdoc">A ResourceManager is an interface for getting information about a Renderer&#39;s internal resources...</div><div class="ttdef"><b>Definition:</b> <a href="resourcemanager_8h_source.html#l00069">resourcemanager.h:69</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a6f54e85cc8adc7230686c24b81f6cfce"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a6f54e85cc8adc7230686c24b81f6cfce">ion::gfx::Renderer::GetGpuMemoryUsage</a></div><div class="ttdeci">size_t GetGpuMemoryUsage(ResourceType type) const </div><div class="ttdoc">Returns the amount of GPU memory used by the passed resource type. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05625">renderer.cc:5625</a></div></div>
<div class="ttc" id="base_2logging_8h_html"><div class="ttname"><a href="base_2logging_8h.html">logging.h</a></div><div class="ttdoc">Copyright 2016 Google Inc. </div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a8dfa8e46df4b9e8366cc4fccb5bcfc57"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a8dfa8e46df4b9e8366cc4fccb5bcfc57">ion::gfx::Renderer::GetResourceGlId</a></div><div class="ttdeci">uint32 GetResourceGlId(T *holder)</div><div class="ttdoc">Returns the OpenGL ID for the passed resource. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05549">renderer.cc:5549</a></div></div>
<div class="ttc" id="updatestatetable_8h_html"><div class="ttname"><a href="updatestatetable_8h.html">updatestatetable.h</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a19e35e1961a97c1a02c045a721798df6"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a19e35e1961a97c1a02c045a721798df6">ion::gfx::kMatrix2x2Uniform</a></div><div class="ttdoc">Matrix types. </div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00059">uniform.h:59</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a91294d85362f36dc0a5fb4a92c66294e"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a91294d85362f36dc0a5fb4a92c66294e">ion::gfx::kMatrix3x3Uniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00060">uniform.h:60</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572a78d8b60d2cf25fe80e7ecc47b7a78ec3"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a78d8b60d2cf25fe80e7ecc47b7a78ec3">ion::gfx::GraphicsManager::kMapBufferBase</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00143">graphicsmanager.h:143</a></div></div>
<div class="ttc" id="resourcehandler_8cc_html_a3999ffc0ef0ce38e233111591785f7d9"><div class="ttname"><a href="resourcehandler_8cc.html#a3999ffc0ef0ce38e233111591785f7d9">indent_</a></div><div class="ttdeci">const std::string indent_</div><div class="ttdef"><b>Definition:</b> <a href="resourcehandler_8cc_source.html#l00108">resourcehandler.cc:108</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a2e31f6e6cc5ea7d9d39ed93bfe12ee0a"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a2e31f6e6cc5ea7d9d39ed93bfe12ee0a">ion::gfx::Renderer::RequestForcedUpdates</a></div><div class="ttdeci">void RequestForcedUpdates(const NodePtr &amp;node)</div><div class="ttdoc">Mark the passed object and its descendants for a forced resource update the next time CreateOrUpdateR...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05095">renderer.cc:5095</a></div></div>
<div class="ttc" id="classion_1_1portgfx_1_1_visual_html"><div class="ttname"><a href="classion_1_1portgfx_1_1_visual.html">ion::portgfx::Visual</a></div><div class="ttdoc">Opaque class that sets up an offscreen OpenGL context/surface/visual in a platform-specific way to al...</div><div class="ttdef"><b>Definition:</b> <a href="visual_8h_source.html#l00040">visual.h:40</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a8ffc9c987048f92d603de7f0dd184f38a25829d1a8f040958b322fce457451521"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a8ffc9c987048f92d603de7f0dd184f38a25829d1a8f040958b322fce457451521">ion::gfx::BufferObject::kDataChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00071">bufferobject.h:71</a></div></div>
<div class="ttc" id="benchmarkutils_8cc_html_a2474a5474cbff19523a51eb1de01cda4"><div class="ttname"><a href="benchmarkutils_8cc.html#a2474a5474cbff19523a51eb1de01cda4">width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="benchmarkutils_8cc_source.html#l00050">benchmarkutils.cc:50</a></div></div>
<div class="ttc" id="namespaceion_1_1math_html_acd13d99102242a27840615752a2bb7e2"><div class="ttname"><a href="namespaceion_1_1math.html#acd13d99102242a27840615752a2bb7e2">ion::math::Matrix2f</a></div><div class="ttdeci">Matrix&lt; 2, float &gt; Matrix2f</div><div class="ttdoc">Dimension- and type-specific typedefs. </div><div class="ttdef"><b>Definition:</b> <a href="matrix_8h_source.html#l00367">matrix.h:367</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_a55ee90f1349e66a144b38b6932cff2aa"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#a55ee90f1349e66a144b38b6932cff2aa">ion::gfx::Image::GetNumComponentsForFormat</a></div><div class="ttdeci">static int GetNumComponentsForFormat(Format format)</div><div class="ttdoc">Convenience function that returns the number of components for a given format. </div><div class="ttdef"><b>Definition:</b> <a href="image_8cc_source.html#l00315">image.cc:315</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_ad9f0be4740e4ec6c2221726138cd69f2aac8212e922ee7b440e71e7e689cc814c"><div class="ttname"><a href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2aac8212e922ee7b440e71e7e689cc814c">ion::gfx::kFloatMatrix4x4Attribute</a></div><div class="ttdef"><b>Definition:</b> <a href="attribute_8h_source.html#l00045">attribute.h:45</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_write_lock_html"><div class="ttname"><a href="classion_1_1base_1_1_write_lock.html">ion::base::WriteLock</a></div><div class="ttdoc">A WriteLock obtains a write lock, but has a similar interface to a Mutex and can be used with a Write...</div><div class="ttdef"><b>Definition:</b> <a href="readwritelock_8h_source.html#l00111">readwritelock.h:111</a></div></div>
<div class="ttc" id="vector_8h_html"><div class="ttname"><a href="vector_8h.html">vector.h</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a91d3c0a06913e26e0d0767e16ef201f6"><div class="ttname"><a href="namespaceion_1_1gfx.html#a91d3c0a06913e26e0d0767e16ef201f6">ion::gfx::UpdateFromStateTable</a></div><div class="ttdeci">void UpdateFromStateTable(const StateTable &amp;new_state, StateTable *save_state, GraphicsManager *gm)</div><div class="ttdoc">This internal function can be used to update the OpenGL state managed by a GraphicsManager to match a...</div><div class="ttdef"><b>Definition:</b> <a href="updatestatetable_8cc_source.html#l00744">updatestatetable.cc:744</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572a4af48b30c3a8560da50e555ae2ff928c"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a4af48b30c3a8560da50e555ae2ff928c">ion::gfx::GraphicsManager::kInstancedDrawing</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00153">graphicsmanager.h:153</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a6c1236c56d99c202b404c5f6166c85adad16a39ae4cc9c9ab8eaa28298a3414a8"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a6c1236c56d99c202b404c5f6166c85adad16a39ae4cc9c9ab8eaa28298a3414a8">ion::gfx::BufferObject::kFloatMatrixColumn4</a></div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00090">bufferobject.h:90</a></div></div>
<div class="ttc" id="base_2logging_8h_html_ae89df3243bbb8341130c7b3f44145ea0"><div class="ttname"><a href="base_2logging_8h.html#ae89df3243bbb8341130c7b3f44145ea0">DCHECK_EQ</a></div><div class="ttdeci">#define DCHECK_EQ(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="base_2logging_8h_source.html#l00332">logging.h:332</a></div></div>
<div class="ttc" id="fontimage_8cc_html_a05732ec89e3a90546399c62f2c7d90ac"><div class="ttname"><a href="fontimage_8cc.html#a05732ec89e3a90546399c62f2c7d90ac">texture</a></div><div class="ttdeci">TexturePtr texture</div><div class="ttdoc">The Texture to add sub-image data to. </div><div class="ttdef"><b>Definition:</b> <a href="fontimage_8cc_source.html#l00107">fontimage.cc:107</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a955ebbdc8a1b60161e621708351cc33aac50b144c1addf71ed56d8c9255731152"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aac50b144c1addf71ed56d8c9255731152">ion::gfx::Sampler::kCompareFunctionChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00034">sampler.h:34</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_holder_html_ad5d5ff5af566f7bc7082050f4d4dc6d3"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_holder.html#ad5d5ff5af566f7bc7082050f4d4dc6d3">ion::gfx::ResourceHolder::GetResource</a></div><div class="ttdeci">ResourceBase * GetResource(size_t index, ResourceKey key) const </div><div class="ttdoc">Returns the Resource at the given index and key, or NULL if no resource was previously set at that lo...</div><div class="ttdef"><b>Definition:</b> <a href="resourceholder_8cc_source.html#l00122">resourceholder.cc:122</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a5eec43d1921c8d1bad9bf03ecacebd22"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a5eec43d1921c8d1bad9bf03ecacebd22">ion::gfx::kIntUniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00040">uniform.h:40</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_input_registry_html_ad8794cffdad6b1ae0846e189d5cbb1eb"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_input_registry.html#ad8794cffdad6b1ae0846e189d5cbb1eb">ion::gfx::ShaderInputRegistry::AttributeSpec</a></div><div class="ttdeci">Spec&lt; Attribute &gt; AttributeSpec</div><div class="ttdef"><b>Definition:</b> <a href="shaderinputregistry_8h_source.html#l00162">shaderinputregistry.h:162</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_aba06e33a9a020bd7cc1f1f986ee8c52c"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#aba06e33a9a020bd7cc1f1f986ee8c52c">ion::gfx::Renderer::SetTextureImageUnitRange</a></div><div class="ttdeci">void SetTextureImageUnitRange(const math::Range1i &amp;units)</div><div class="ttdoc">Sets the inclusive range of texture image units that the Renderer should use. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05580">renderer.cc:5580</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a34d1c8be9d95ebc1cd7c04db6f3ab212"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a34d1c8be9d95ebc1cd7c04db6f3ab212">ion::gfx::Renderer::kClearVertexArray</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00073">renderer.h:73</a></div></div>
<div class="ttc" id="macros_8h_html_a0687ad8a544bc4ce58b34f03f07a32c6"><div class="ttname"><a href="macros_8h.html#a0687ad8a544bc4ce58b34f03f07a32c6">ION_PRETTY_FUNCTION</a></div><div class="ttdeci">#define ION_PRETTY_FUNCTION</div><div class="ttdoc">Make ION_PRETTY_FUNCTION available on all platforms. </div><div class="ttdef"><b>Definition:</b> <a href="macros_8h_source.html#l00046">macros.h:46</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a443fc9334fbde5d43d4df744d4d8a9f5"><div class="ttname"><a href="namespaceion_1_1gfx.html#a443fc9334fbde5d43d4df744d4d8a9f5">ion::gfx::GraphicsManagerPtr</a></div><div class="ttdeci">base::ReferentPtr&lt; GraphicsManager &gt;::Type GraphicsManagerPtr</div><div class="ttdoc">Convenience typedef for shared pointer to a GraphicsManager. </div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00435">graphicsmanager.h:435</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_cube_map_texture_html"><div class="ttname"><a href="classion_1_1gfx_1_1_cube_map_texture.html">ion::gfx::CubeMapTexture</a></div><div class="ttdoc">A CubeMapTexture object represents the image data and mipmaps associated with the six faces of a cube...</div><div class="ttdef"><b>Definition:</b> <a href="cubemaptexture_8h_source.html#l00028">cubemaptexture.h:28</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ae983af9af643383c283e33038773fd48a8e60defeac9388416b220d35aa41f750"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a8e60defeac9388416b220d35aa41f750">ion::gfx::Renderer::kShaderProgram</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00107">renderer.h:107</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a9fa2acc9f24c0a4ad6c03a108af8591e"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a9fa2acc9f24c0a4ad6c03a108af8591e">ion::gfx::Renderer::CreateOrUpdateShapeResources</a></div><div class="ttdeci">void CreateOrUpdateShapeResources(const ShapePtr &amp;shape)</div><div class="ttdoc">Creates or updates any resources necessary to draw the passed Shape, i.e., buffer data is uploaded...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05059">renderer.cc:5059</a></div></div>
<div class="ttc" id="lockguards_8h_html"><div class="ttname"><a href="lockguards_8h.html">lockguards.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a3b33f2c3538d70af07d779c12227c535"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a3b33f2c3538d70af07d779c12227c535">ion::gfx::Renderer::kRestoreShaderProgram</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00082">renderer.h:82</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a955ebbdc8a1b60161e621708351cc33aafd006a0aab90a09eabd6b3e19666cc89"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aafd006a0aab90a09eabd6b3e19666cc89">ion::gfx::Sampler::kCompareModeChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00035">sampler.h:35</a></div></div>
<div class="ttc" id="base_2logging_8h_html_a4395e95bab44e222cb2e77251017a0e2"><div class="ttname"><a href="base_2logging_8h.html#a4395e95bab44e222cb2e77251017a0e2">DCHECK_LE</a></div><div class="ttdeci">#define DCHECK_LE(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="base_2logging_8h_source.html#l00334">logging.h:334</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a0ba5458a2c1cfe30bd1347b50e3790dba20f4a4b5bbab9ff3a4ef3b9447d8f5f7"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a0ba5458a2c1cfe30bd1347b50e3790dba20f4a4b5bbab9ff3a4ef3b9447d8f5f7">ion::gfx::Sampler::kClampToEdge</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00078">sampler.h:78</a></div></div>
<div class="ttc" id="namespaceion_1_1math_html_a1fbc614275fefed32e6ebf43af56409a"><div class="ttname"><a href="namespaceion_1_1math.html#a1fbc614275fefed32e6ebf43af56409a">ion::math::IsPowerOfTwo</a></div><div class="ttdeci">bool IsPowerOfTwo(int value)</div><div class="ttdoc">Returns true if a value is a power of two. </div><div class="ttdef"><b>Definition:</b> <a href="utils_8h_source.html#l00216">utils.h:216</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04ad8ee0fd1040ce90f36495c105ce299fc"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ad8ee0fd1040ce90f36495c105ce299fc">ion::gfx::Renderer::kSaveVertexArray</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00095">renderer.h:95</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_state_table_html_ae6f345fc251ac53d5797d6300859d665a1a0753a214b1ec21abb3865c3f27ea3f"><div class="ttname"><a href="classion_1_1gfx_1_1_state_table.html#ae6f345fc251ac53d5797d6300859d665a1a0753a214b1ec21abb3865c3f27ea3f">ion::gfx::StateTable::kDither</a></div><div class="ttdef"><b>Definition:</b> <a href="statetable_8h_source.html#l00060">statetable.h:60</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_allocation_tracker_html_a087f02cd46f4551363caef5f6b7201ee"><div class="ttname"><a href="classion_1_1base_1_1_allocation_tracker.html#a087f02cd46f4551363caef5f6b7201ee">ion::base::AllocationTracker::GetGpuTracker</a></div><div class="ttdeci">virtual AllocationSizeTrackerPtr GetGpuTracker()=0</div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_a5739ea2401844cf4db67bf82349bc13daacf37b197f8db1eb8eb8633d34cf293f"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#a5739ea2401844cf4db67bf82349bc13daacf37b197f8db1eb8eb8633d34cf293f">ion::gfx::GraphicsManager::kMaxTextureImageUnits</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00090">graphicsmanager.h:90</a></div></div>
<div class="ttc" id="glheaders_8h_html_adb7e71e2c7c36c9788223afed8c27d61"><div class="ttname"><a href="glheaders_8h.html#adb7e71e2c7c36c9788223afed8c27d61">GL_TEXTURE_EXTERNAL_OES</a></div><div class="ttdeci">#define GL_TEXTURE_EXTERNAL_OES</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l01029">glheaders.h:1029</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_ad2a5bbee7fd2c231589f603bfa5e1c2fa6cd47172001c514d63abd9a72c9a08c7"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#ad2a5bbee7fd2c231589f603bfa5e1c2fa6cd47172001c514d63abd9a72c9a08c7">ion::gfx::Image::kExternalEgl</a></div><div class="ttdef"><b>Definition:</b> <a href="image_8h_source.html#l00181">image.h:181</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_base_html_aa4149d792923c0c5545b506339375ab3a9ebb538e101ef75f2eca721d9cc7e513"><div class="ttname"><a href="classion_1_1gfx_1_1_texture_base.html#aa4149d792923c0c5545b506339375ab3a9ebb538e101ef75f2eca721d9cc7e513">ion::gfx::TextureBase::kBaseLevelChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00065">texture.h:65</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_adef08666b2cb7f0520b1d9e40b194114"><div class="ttname"><a href="namespaceion_1_1gfx.html#adef08666b2cb7f0520b1d9e40b194114">ion::gfx::ResourceKey</a></div><div class="ttdeci">intptr_t ResourceKey</div><div class="ttdoc">Type of identifiers used to disambiguate between multiple resources created for the same Ion object b...</div><div class="ttdef"><b>Definition:</b> <a href="resourcebase_8h_source.html#l00027">resourcebase.h:27</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_html_aca9140cab5ea349eeb2da728c92e3e6a"><div class="ttname"><a href="classion_1_1gfx_1_1_texture.html#aca9140cab5ea349eeb2da728c92e3e6a">ion::gfx::Texture::ExpectedDimensionsForMipmap</a></div><div class="ttdeci">static bool ExpectedDimensionsForMipmap(const uint32 mipmap_width, const uint32 mipmap_height, const uint32 mipmap_level, const uint32 base_width, const uint32 base_height, uint32 *expected_width, uint32 *expected_height)</div><div class="ttdoc">Tests mipmap dimensions to see that they are proportional and in range with respect to base_width and...</div><div class="ttdef"><b>Definition:</b> <a href="gfx_2texture_8cc_source.html#l00140">texture.cc:140</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a955ebbdc8a1b60161e621708351cc33aa1792af985e2c2d88c5c8f2511c6f6526"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aa1792af985e2c2d88c5c8f2511c6f6526">ion::gfx::Sampler::kMaxAnisotropyChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00037">sampler.h:37</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_html"><div class="ttname"><a href="classion_1_1gfx_1_1_shader.html">ion::gfx::Shader</a></div><div class="ttdoc">A Shader represents an OpenGL shader stage. </div><div class="ttdef"><b>Definition:</b> <a href="shader_8h_source.html#l00059">shader.h:59</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_ad9f0be4740e4ec6c2221726138cd69f2a14ed49fd56755b8a81ce368ebedbd51e"><div class="ttname"><a href="namespaceion_1_1gfx.html#ad9f0be4740e4ec6c2221726138cd69f2a14ed49fd56755b8a81ce368ebedbd51e">ion::gfx::kFloatAttribute</a></div><div class="ttdoc">Scalar types. </div><div class="ttdef"><b>Definition:</b> <a href="attribute_8h_source.html#l00035">attribute.h:35</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_cube_map_texture_html_a3bc28b6f02de422506a28cf596b9cd02aa2656a15be36cab8225fd55f5f543c9d"><div class="ttname"><a href="classion_1_1gfx_1_1_cube_map_texture.html#a3bc28b6f02de422506a28cf596b9cd02aa2656a15be36cab8225fd55f5f543c9d">ion::gfx::CubeMapTexture::kNegativeXSubImageChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="cubemaptexture_8h_source.html#l00032">cubemaptexture.h:32</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_allocator_html_a910d1c7bdc8220ec9b7322ed0392e2cc"><div class="ttname"><a href="classion_1_1base_1_1_allocator.html#a910d1c7bdc8220ec9b7322ed0392e2cc">ion::base::Allocator::AllocateMemory</a></div><div class="ttdeci">void * AllocateMemory(size_t size)</div><div class="ttdoc">Allocates memory of the given size. </div><div class="ttdef"><b>Definition:</b> <a href="allocator_8cc_source.html#l00032">allocator.cc:32</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04aa1b8fa14097b0b8f0df80fda39598120"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04aa1b8fa14097b0b8f0df80fda39598120">ion::gfx::Renderer::kClearFramebuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00069">renderer.h:69</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a8890095cb957be1d882f4bcf4a7befdd"><div class="ttname"><a href="namespaceion_1_1gfx.html#a8890095cb957be1d882f4bcf4a7befdd">ion::gfx::ShaderInputRegistryPtr</a></div><div class="ttdeci">base::ReferentPtr&lt; ShaderInputRegistry &gt;::Type ShaderInputRegistryPtr</div><div class="ttdoc">Convenience typedef for shared pointer to a ShaderInputRegistry. </div><div class="ttdef"><b>Definition:</b> <a href="shaderinputregistry_8h_source.html#l00042">shaderinputregistry.h:42</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a2d8dcaec87d0c04f51726301060fcfd5"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a2d8dcaec87d0c04f51726301060fcfd5">ion::gfx::Renderer::BindFramebuffer</a></div><div class="ttdeci">void BindFramebuffer(const FramebufferObjectPtr &amp;fbo)</div><div class="ttdoc">Binds the passed FramebufferObject; all future calls to DrawScene() will be drawn into it...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04839">renderer.cc:4839</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a0b00a6356aa38324ab35bcd554ff8eb0"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a0b00a6356aa38324ab35bcd554ff8eb0">ion::gfx::Renderer::CreateOrUpdateResources</a></div><div class="ttdeci">void CreateOrUpdateResources(const NodePtr &amp;node)</div><div class="ttdoc">Traverses the scene rooted by the given node and creates or updates resources for ShaderPrograms...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04965">renderer.cc:4965</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_attribute_array_html_abcccfb5627ac2b2f56e944ff9609a3fea57fc67716e2c90c6b4907bf304aadacf"><div class="ttname"><a href="classion_1_1gfx_1_1_attribute_array.html#abcccfb5627ac2b2f56e944ff9609a3fea57fc67716e2c90c6b4907bf304aadacf">ion::gfx::AttributeArray::kAttributeChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="attributearray_8h_source.html#l00040">attributearray.h:40</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a461f0570b14d2a978dcb90b9434abe32"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a461f0570b14d2a978dcb90b9434abe32">ion::gfx::Renderer::ReleaseResources</a></div><div class="ttdeci">void ReleaseResources()</div><div class="ttdoc">Immediately releases all internal resources of the Renderer which are pending release. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05619">renderer.cc:5619</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_holder_html_a1a5d4cc7445a7a36218519bbce5b488eafbaf96637df1fba193f735aa8689222c"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_holder.html#a1a5d4cc7445a7a36218519bbce5b488eafbaf96637df1fba193f735aa8689222c">ion::gfx::ResourceHolder::kLabelChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="resourceholder_8h_source.html#l00057">resourceholder.h:57</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_image_html_a67f4d8fadb4e5118436683371d4f4fd5a4f15255e18cf8038ebd2ea1337fe36c9"><div class="ttname"><a href="classion_1_1gfx_1_1_image.html#a67f4d8fadb4e5118436683371d4f4fd5a4f15255e18cf8038ebd2ea1337fe36c9">ion::gfx::Image::k3d</a></div><div class="ttdef"><b>Definition:</b> <a href="image_8h_source.html#l00188">image.h:188</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a1bd04e896509c052970b6238a1eb972a"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a1bd04e896509c052970b6238a1eb972a">ion::gfx::kUnsignedIntVector3Uniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00055">uniform.h:55</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a16f48925c0fae133716a1644b0a41cf8"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a16f48925c0fae133716a1644b0a41cf8">ion::gfx::Renderer::ReadImage</a></div><div class="ttdeci">const ImagePtr ReadImage(const math::Range2i &amp;range, Image::Format format, const base::AllocatorPtr &amp;allocator)</div><div class="ttdoc">Returns an image of the specified format that contains the contents of the hardware framebuffer...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05524">renderer.cc:5524</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a3294308f6647ada5a52464ed425ae421"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a3294308f6647ada5a52464ed425ae421">ion::gfx::Renderer::MapBufferObjectDataRange</a></div><div class="ttdeci">void MapBufferObjectDataRange(const BufferObjectPtr &amp;buffer, BufferObjectDataMapMode mode, const math::Range1ui &amp;range)</div><div class="ttdoc">This function maps a DataContainer with the size of the passed range. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05498">renderer.cc:5498</a></div></div>
<div class="ttc" id="shape_8h_html"><div class="ttname"><a href="shape_8h.html">shape.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_program_html_ae25945c249b76bd9da62b5132d140480"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_program.html#ae25945c249b76bd9da62b5132d140480">ion::gfx::ShaderProgram::IsConcurrent</a></div><div class="ttdeci">bool IsConcurrent() const </div><div class="ttdef"><b>Definition:</b> <a href="shaderprogram_8h_source.html#l00089">shaderprogram.h:89</a></div></div>
<div class="ttc" id="shaderinputregistry_8h_html"><div class="ttname"><a href="shaderinputregistry_8h.html">shaderinputregistry.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_html_a56ef347565e68fec664f3b2d86fffd8fa9818e5a607070eef926b1f03db2d8a27"><div class="ttname"><a href="classion_1_1gfx_1_1_texture.html#a56ef347565e68fec664f3b2d86fffd8fa9818e5a607070eef926b1f03db2d8a27">ion::gfx::Texture::kNumChanges</a></div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00271">texture.h:271</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a54de8efde6ddd1e64bcef41ca8f9e902"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a54de8efde6ddd1e64bcef41ca8f9e902">ion::gfx::kUnsignedIntUniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00041">uniform.h:41</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_read_lock_html"><div class="ttname"><a href="classion_1_1base_1_1_read_lock.html">ion::base::ReadLock</a></div><div class="ttdoc">A ReadLock obtains a read lock, but has a similar interface to a Mutex and can be used with a ReadGua...</div><div class="ttdef"><b>Definition:</b> <a href="readwritelock_8h_source.html#l00086">readwritelock.h:86</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_cube_map_texture_html_a3bc28b6f02de422506a28cf596b9cd02ad8eeadd01252aeaccd97f6c0abaa4752"><div class="ttname"><a href="classion_1_1gfx_1_1_cube_map_texture.html#a3bc28b6f02de422506a28cf596b9cd02ad8eeadd01252aeaccd97f6c0abaa4752">ion::gfx::CubeMapTexture::kNegativeXMipmapChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="cubemaptexture_8h_source.html#l00038">cubemaptexture.h:38</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_a9aea056fa3b5c46e3182f5427fb5f010"><div class="ttname"><a href="namespaceion_1_1base.html#a9aea056fa3b5c46e3182f5427fb5f010">ion::base::DataContainerPtr</a></div><div class="ttdeci">base::ReferentPtr&lt; DataContainer &gt;::Type DataContainerPtr</div><div class="ttdef"><b>Definition:</b> <a href="datacontainer_8h_source.html#l00038">datacontainer.h:38</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a717de862b7059b46a9cf72ddca101fd0a9fd76cf5dc9b8c76ecdda014595e47b6"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a717de862b7059b46a9cf72ddca101fd0a9fd76cf5dc9b8c76ecdda014595e47b6">ion::gfx::Sampler::kNearestMipmapNearest</a></div><div class="ttdoc">These are only usable with the minification filter. </div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00070">sampler.h:70</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a461f30e6f866977271f2c9960237e30c"><div class="ttname"><a href="namespaceion_1_1gfx.html#a461f30e6f866977271f2c9960237e30c">ion::gfx::BufferObjectPtr</a></div><div class="ttdeci">base::ReferentPtr&lt; BufferObject &gt;::Type BufferObjectPtr</div><div class="ttdoc">Convenience typedef for shared pointer to a BufferObject. </div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00031">bufferobject.h:31</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_state_table_html"><div class="ttname"><a href="classion_1_1gfx_1_1_state_table.html">ion::gfx::StateTable</a></div><div class="ttdoc">A StateTable represents a collection of graphical state items that affect OpenGL rendering. </div><div class="ttdef"><b>Definition:</b> <a href="statetable_8h_source.html#l00048">statetable.h:48</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_aa71c7f5c7a6cc8b71ab0a0d713a7781b"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#aa71c7f5c7a6cc8b71ab0a0d713a7781b">ion::gfx::Renderer::GetResourceManager</a></div><div class="ttdeci">gfx::ResourceManager * GetResourceManager() const </div><div class="ttdoc">Returns the ResourceManager for this renderer. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04767">renderer.cc:4767</a></div></div>
<div class="ttc" id="visual_8h_html"><div class="ttname"><a href="visual_8h.html">visual.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_shader_input_html_afe4dcdd379cb2619fa5ee30dcd0d11d5"><div class="ttname"><a href="classion_1_1gfx_1_1_shader_input.html#afe4dcdd379cb2619fa5ee30dcd0d11d5">ion::gfx::ShaderInput::IsValid</a></div><div class="ttdeci">bool IsValid() const </div><div class="ttdoc">Returns true if this is a valid instance created by a ShaderInputRegistry. </div><div class="ttdef"><b>Definition:</b> <a href="shaderinput_8h_source.html#l00059">shaderinput.h:59</a></div></div>
<div class="ttc" id="freetypefont_8cc_html_ab1b7efa1bbe0578df2c74e7c31a79a92"><div class="ttname"><a href="freetypefont_8cc.html#ab1b7efa1bbe0578df2c74e7c31a79a92">mutex_</a></div><div class="ttdeci">port::Mutex mutex_</div><div class="ttdoc">Protects shared access to the Allocator and FT_Library. </div><div class="ttdef"><b>Definition:</b> <a href="freetypefont_8cc_source.html#l00149">freetypefont.cc:149</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_framebuffer_object_1_1_attachment_html"><div class="ttname"><a href="classion_1_1gfx_1_1_framebuffer_object_1_1_attachment.html">ion::gfx::FramebufferObject::Attachment</a></div><div class="ttdoc">An attachment represents a data store attached to one of the framebuffer&#39;s targets. </div><div class="ttdef"><b>Definition:</b> <a href="framebufferobject_8h_source.html#l00077">framebufferobject.h:77</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_texture_html_a56ef347565e68fec664f3b2d86fffd8fa7897839473df0b2d619f0aa8266f398f"><div class="ttname"><a href="classion_1_1gfx_1_1_texture.html#a56ef347565e68fec664f3b2d86fffd8fa7897839473df0b2d619f0aa8266f398f">ion::gfx::Texture::kMipmapChanged</a></div><div class="ttdoc">kMipmapChanged must be last since it is a range of slots. </div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00270">texture.h:270</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_allocatable_html_abf64f94fc5627fd973153954cff6d8db"><div class="ttname"><a href="classion_1_1base_1_1_allocatable.html#abf64f94fc5627fd973153954cff6d8db">ion::base::Allocatable::GetAllocator</a></div><div class="ttdeci">const AllocatorPtr &amp; GetAllocator() const </div><div class="ttdoc">Returns the Allocator that was used for the instance. </div><div class="ttdef"><b>Definition:</b> <a href="allocatable_8h_source.html#l00068">allocatable.h:68</a></div></div>
<div class="ttc" id="class_t_html"><div class="ttname"><a href="class_t.html">T</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572ae6f498655e1baed043a1de831359babd"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572ae6f498655e1baed043a1de831359babd">ion::gfx::GraphicsManager::kVertexArrays</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00156">graphicsmanager.h:156</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_a5fca7f9340dcefae18f258053de7757cae13e720cb817ed225d324290a0acd4f0"><div class="ttname"><a href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757cae13e720cb817ed225d324290a0acd4f0">ion::base::kLongTerm</a></div><div class="ttdoc">kLongTerm is used for objects that have persistent lifetimes, such as managers. </div><div class="ttdef"><b>Definition:</b> <a href="allocator_8h_source.html#l00044">allocator.h:44</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04acaba63e5bb38117a91f17cff263612d8"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04acaba63e5bb38117a91f17cff263612d8">ion::gfx::Renderer::kClearSamplers</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00070">renderer.h:70</a></div></div>
<div class="ttc" id="glheaders_8h_html_a5ebfb7e4321ee2838cb17b10b8d44959"><div class="ttname"><a href="glheaders_8h.html#a5ebfb7e4321ee2838cb17b10b8d44959">GL_LUMINANCE</a></div><div class="ttdeci">#define GL_LUMINANCE</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l00465">glheaders.h:465</a></div></div>
<div class="ttc" id="namespaceion_1_1port_html_ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a"><div class="ttname"><a href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57aedde294e9d2f5ace5dceb420b1b7c87a">ion::port::WARNING</a></div><div class="ttdef"><b>Definition:</b> <a href="port_2logging_8h_source.html#l00028">logging.h:28</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572a112409cde13470d53088b409f456bc2a"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a112409cde13470d53088b409f456bc2a">ion::gfx::GraphicsManager::kTexture3d</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00149">graphicsmanager.h:149</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ad8bc3aa52a0fda49a820724427948df7"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ad8bc3aa52a0fda49a820724427948df7">ion::gfx::Renderer::PushDebugMarker</a></div><div class="ttdeci">void PushDebugMarker(const std::string &amp;marker)</div><div class="ttdoc">In non-production builds, pushes marker onto the Renderer&#39;s tracing stream marker stack...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05536">renderer.cc:5536</a></div></div>
<div class="ttc" id="namespaceion_1_1port_html_ac3891fcab8d4f2dbdb03f9c5d8dcfb57a0ae9c6ad40506517346789803b6c79c8"><div class="ttname"><a href="namespaceion_1_1port.html#ac3891fcab8d4f2dbdb03f9c5d8dcfb57a0ae9c6ad40506517346789803b6c79c8">ion::port::FATAL</a></div><div class="ttdef"><b>Definition:</b> <a href="port_2logging_8h_source.html#l00030">logging.h:30</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a9ce2e112ba103677976ede3e20593c8b"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a9ce2e112ba103677976ede3e20593c8b">ion::gfx::Renderer::MapBufferObjectData</a></div><div class="ttdeci">void MapBufferObjectData(const BufferObjectPtr &amp;buffer, BufferObjectDataMapMode mode)</div><div class="ttdoc">In the below MapBuffer functions the passed BufferObject is assigned a DataContainer (retrievable via...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05485">renderer.cc:5485</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a6cc63466f4f1bfe9372c50399132a9c8"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a6cc63466f4f1bfe9372c50399132a9c8">ion::gfx::kIntVector3Uniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00052">uniform.h:52</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_shared_ptr_html"><div class="ttname"><a href="classion_1_1base_1_1_shared_ptr.html">ion::base::SharedPtr</a></div><div class="ttdoc">A SharedPtr is a smart shared pointer to an instance of some class that implements reference counting...</div><div class="ttdef"><b>Definition:</b> <a href="sharedptr_8h_source.html#l00060">sharedptr.h:60</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_a5fca7f9340dcefae18f258053de7757caf03f24745ec5729b9c4ba500f7ff654d"><div class="ttname"><a href="namespaceion_1_1base.html#a5fca7f9340dcefae18f258053de7757caf03f24745ec5729b9c4ba500f7ff654d">ion::base::kMediumTerm</a></div><div class="ttdoc">kMediumTerm is used for objects that don&#39;t fall into the kShortTerm or kLongTerm categories. </div><div class="ttdef"><b>Definition:</b> <a href="allocator_8h_source.html#l00040">allocator.h:40</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a73d6bb540bb4c30bbc94bf986dbdfada"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a73d6bb540bb4c30bbc94bf986dbdfada">ion::gfx::Renderer::Renderer</a></div><div class="ttdeci">Renderer(const GraphicsManagerPtr &amp;gm)</div><div class="ttdoc">The constructor is passed a GraphicsManager instance to use for rendering. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04694">renderer.cc:4694</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ac1c04abbc2f2b2a68d8c5a37ac55b392"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ac1c04abbc2f2b2a68d8c5a37ac55b392">ion::gfx::Renderer::UpdateDefaultFramebufferFromOpenGL</a></div><div class="ttdeci">void UpdateDefaultFramebufferFromOpenGL()</div><div class="ttdoc">Updates the system default framebuffer to whatever framebuffer is currently bound. </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04863">renderer.cc:4863</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_base_html_abd0637110d81f9e4e1991182c925d04e"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_base.html#abd0637110d81f9e4e1991182c925d04e">ion::gfx::ResourceBase::ResourceBase</a></div><div class="ttdeci">ResourceBase(const ResourceHolder *holder, ResourceKey key)</div><div class="ttdoc">The constructor accepts a holder parameter to simplify control flow during construction. </div><div class="ttdef"><b>Definition:</b> <a href="resourcebase_8h_source.html#l00041">resourcebase.h:41</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04ae849f42d833e99960d1199c3a51354e8"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04ae849f42d833e99960d1199c3a51354e8">ion::gfx::Renderer::kRestoreArrayBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00079">renderer.h:79</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a717de862b7059b46a9cf72ddca101fd0"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a717de862b7059b46a9cf72ddca101fd0">ion::gfx::Sampler::FilterMode</a></div><div class="ttdeci">FilterMode</div><div class="ttdoc">Texture filter modes. </div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00066">sampler.h:66</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ab3208d1239b11d3c6262e08982da3d04a7b66885ac31e9a56ca30cf359f897938"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ab3208d1239b11d3c6262e08982da3d04a7b66885ac31e9a56ca30cf359f897938">ion::gfx::Renderer::kRestoreVertexArray</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00084">renderer.h:84</a></div></div>
<div class="ttc" id="renderer_8h_html"><div class="ttname"><a href="renderer_8h.html">renderer.h</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_buffer_object_html_a1f4e6b4b4bd00e5536203e46bffe9521"><div class="ttname"><a href="classion_1_1gfx_1_1_buffer_object.html#a1f4e6b4b4bd00e5536203e46bffe9521">ion::gfx::BufferObject::Target</a></div><div class="ttdeci">Target</div><div class="ttdef"><b>Definition:</b> <a href="bufferobject_8h_source.html#l00093">bufferobject.h:93</a></div></div>
<div class="ttc" id="namespaceion_1_1base_html_aa710835f4c8519208e8640e83e9a95db"><div class="ttname"><a href="namespaceion_1_1base.html#aa710835f4c8519208e8640e83e9a95db">ion::base::WriteGuard</a></div><div class="ttdeci">GenericLockGuard&lt; WriteLock &gt; WriteGuard</div><div class="ttdef"><b>Definition:</b> <a href="lockguards_8h_source.html#l00203">lockguards.h:203</a></div></div>
<div class="ttc" id="resourcebase_8h_html"><div class="ttname"><a href="resourcebase_8h.html">resourcebase.h</a></div></div>
<div class="ttc" id="namespaceion_1_1math_html_a249c32950a150c8cf5d7f8b80292ce21"><div class="ttname"><a href="namespaceion_1_1math.html#a249c32950a150c8cf5d7f8b80292ce21">ion::math::Transpose</a></div><div class="ttdeci">Matrix&lt; Dimension, T &gt; Transpose(const Matrix&lt; Dimension, T &gt; &amp;m)</div><div class="ttdoc">Public functions. </div><div class="ttdef"><b>Definition:</b> <a href="matrixutils_8h_source.html#l00065">matrixutils.h:65</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ae983af9af643383c283e33038773fd48a984a3857aee726e827404bd6bf6acf0f"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ae983af9af643383c283e33038773fd48a984a3857aee726e827404bd6bf6acf0f">ion::gfx::Renderer::kAttributeArray</a></div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00102">renderer.h:102</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_allocatable_html_adeca96d4002bdb25bc780f693c3e0a75"><div class="ttname"><a href="classion_1_1base_1_1_allocatable.html#adeca96d4002bdb25bc780f693c3e0a75">ion::base::Allocatable::operator=</a></div><div class="ttdeci">void operator=(const Allocatable &amp;other)</div><div class="ttdoc">The assignment operator does nothing, since all members are intrinsically tied to a particular alloca...</div><div class="ttdef"><b>Definition:</b> <a href="allocatable_8h_source.html#l00133">allocatable.h:133</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_resource_holder_html"><div class="ttname"><a href="classion_1_1gfx_1_1_resource_holder.html">ion::gfx::ResourceHolder</a></div><div class="ttdoc">ResourceHolder is an internal base class for objects that hold resources managed by an outside entity...</div><div class="ttdef"><b>Definition:</b> <a href="resourceholder_8h_source.html#l00052">resourceholder.h:52</a></div></div>
<div class="ttc" id="cubemaptexture_8h_html"><div class="ttname"><a href="cubemaptexture_8h.html">cubemaptexture.h</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a898ebd00d721a2589edc7d818ff17533"><div class="ttname"><a href="namespaceion_1_1gfx.html#a898ebd00d721a2589edc7d818ff17533">ion::gfx::TexturePtr</a></div><div class="ttdeci">base::ReferentPtr&lt; Texture &gt;::Type TexturePtr</div><div class="ttdoc">Convenience typedef for shared pointer to a Texture. </div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00333">texture.h:333</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a955ebbdc8a1b60161e621708351cc33aa1a7551f99458ee42e54709da97e2a69f"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a955ebbdc8a1b60161e621708351cc33aa1a7551f99458ee42e54709da97e2a69f">ion::gfx::Sampler::kWrapTChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00043">sampler.h:43</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643ac4e47e833e681048f10c0fbd01932b06"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643ac4e47e833e681048f10c0fbd01932b06">ion::gfx::kFloatVector4Uniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00050">uniform.h:50</a></div></div>
<div class="ttc" id="namespaceion_1_1gfx_html_a08bbfe864fd7c473f2873534535a9643a827f2bfcad70a68aa5435e931fa18286"><div class="ttname"><a href="namespaceion_1_1gfx.html#a08bbfe864fd7c473f2873534535a9643a827f2bfcad70a68aa5435e931fa18286">ion::gfx::kUnsignedIntVector4Uniform</a></div><div class="ttdef"><b>Definition:</b> <a href="uniform_8h_source.html#l00056">uniform.h:56</a></div></div>
<div class="ttc" id="glheaders_8h_html_a9e49f916b21619b15ba482318b30656f"><div class="ttname"><a href="glheaders_8h.html#a9e49f916b21619b15ba482318b30656f">GL_VERTEX_ARRAY_OBJECT</a></div><div class="ttdeci">#define GL_VERTEX_ARRAY_OBJECT</div><div class="ttdef"><b>Definition:</b> <a href="glheaders_8h_source.html#l01170">glheaders.h:1170</a></div></div>
<div class="ttc" id="base_2logging_8h_html_ab62f5ed8f2d48e29802be0cbbcd1359a"><div class="ttname"><a href="base_2logging_8h.html#ab62f5ed8f2d48e29802be0cbbcd1359a">DCHECK_LT</a></div><div class="ttdeci">#define DCHECK_LT(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="base_2logging_8h_source.html#l00335">logging.h:335</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_afe483c6cc2e75618b57e9269e5cd7628a2641041b6785a83379197dcfaeb9ef4d"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#afe483c6cc2e75618b57e9269e5cd7628a2641041b6785a83379197dcfaeb9ef4d">ion::gfx::GraphicsManager::kEs</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00163">graphicsmanager.h:163</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_ac114f7e665e2dc43ae183edae3f684ce"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#ac114f7e665e2dc43ae183edae3f684ce">ion::gfx::Renderer::kNumResourceTypes</a></div><div class="ttdeci">static const int kNumResourceTypes</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00111">renderer.h:111</a></div></div>
<div class="ttc" id="classion_1_1base_1_1_allocation_manager_html_a026c479373cc9b9d16738cbaf86d49f1"><div class="ttname"><a href="classion_1_1base_1_1_allocation_manager.html#a026c479373cc9b9d16738cbaf86d49f1">ion::base::AllocationManager::GetDefaultAllocatorForLifetime</a></div><div class="ttdeci">static const AllocatorPtr &amp; GetDefaultAllocatorForLifetime(AllocationLifetime lifetime)</div><div class="ttdef"><b>Definition:</b> <a href="allocationmanager_8h_source.html#l00062">allocationmanager.h:62</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html">ion::gfx::Sampler</a></div><div class="ttdoc">A Sampler object represents texture parameters that control how texture data is accessed in shaders...</div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00029">sampler.h:29</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_sampler_html_a8af3dbd386f605c5275a40c38196be43"><div class="ttname"><a href="classion_1_1gfx_1_1_sampler.html#a8af3dbd386f605c5275a40c38196be43">ion::gfx::Sampler::CompareFunction</a></div><div class="ttdeci">CompareFunction</div><div class="ttdoc">Texture comparison functions for depth textures. </div><div class="ttdef"><b>Definition:</b> <a href="sampler_8h_source.html#l00048">sampler.h:48</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_a575e5076307b4bc22ce115baa0372f77"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#a575e5076307b4bc22ce115baa0372f77">ion::gfx::Renderer::ClearCachedBindings</a></div><div class="ttdeci">void ClearCachedBindings()</div><div class="ttdoc">Notifies the Renderer that it cannot rely on internally cached bindings; the next objects it encounte...</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l04869">renderer.cc:4869</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_graphics_manager_html_ab9f765cbd64df7cc49cfe7587ab64572a621d8a2222a0c0bcfc612f1a6c030609"><div class="ttname"><a href="classion_1_1gfx_1_1_graphics_manager.html#ab9f765cbd64df7cc49cfe7587ab64572a621d8a2222a0c0bcfc612f1a6c030609">ion::gfx::GraphicsManager::kTextureMultisample</a></div><div class="ttdef"><b>Definition:</b> <a href="graphicsmanager_8h_source.html#l00150">graphicsmanager.h:150</a></div></div>
<div class="ttc" id="classion_1_1gfx_1_1_renderer_html_aefd5770da601a22d4c9c729c22300feb"><div class="ttname"><a href="classion_1_1gfx_1_1_renderer.html#aefd5770da601a22d4c9c729c22300feb">ion::gfx::Renderer::UpdateStateFromStateTable</a></div><div class="ttdeci">void UpdateStateFromStateTable(const StateTablePtr &amp;state_to_clear)</div><div class="ttdoc">This is more efficient than UpdateStateFromOpenGL(). </div><div class="ttdef"><b>Definition:</b> <a href="renderer_8cc_source.html#l05467">renderer.cc:5467</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_3a924b96366437974edfa9bf6ddad245.html">gfx</a></li><li class="navelem"><a class="el" href="renderer_8cc.html">renderer.cc</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
